<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.8">
<title>The Neo4j Manual v2.0-SNAPSHOT</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}


#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>

<!-- favicon -->

<link rel="shortcut icon" href="http://neo4j.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://neo4j.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/neo.css" rel="stylesheet" type="text/css" />
<link href="css/neo-asciidoc.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushCypher.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushProperties.js"></script>

<!-- activate when needed
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
-->

<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Replace SVG for browsers that lack support. -->
<script type="text/javascript" src="js/svgreplacer.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Cypher Console -->

<script type="text/javascript" src="js/cypherconsole.js"></script>

<!-- Version -->

<script type="text/javascript" src="js/version.js"></script>


</head>
<body class="book">
<div id="header">
<h1>The Neo4j Manual v2.0-SNAPSHOT</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph"><p>This is the reference manual for Neo4j version 2.0-SNAPSHOT, authored by the Neo4j Team.</p></div>
<div class="paragraph"><p>The main parts of the manual are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#introduction">[introduction]</a>&#8201;&#8212;&#8201;introducing graph database concepts and Neo4j.
</p>
</li>
<li>
<p>
<a href="#tutorials">[tutorials]</a>&#8201;&#8212;&#8201;learn how to use Neo4j.
</p>
</li>
<li>
<p>
<a href="#reference-documentation">[reference-documentation]</a>&#8201;&#8212;&#8201;detailed information on Neo4j.
</p>
</li>
<li>
<p>
<a href="#operations">[operations]</a>&#8201;&#8212;&#8201;how to install and maintain Neo4j.
</p>
</li>
<li>
<p>
<a href="#tools">[tools]</a>&#8201;&#8212;&#8201;guides on tools.
</p>
</li>
<li>
<p>
<a href="#community">[community]</a>&#8201;&#8212;&#8201;getting help from, contributing to.
</p>
</li>
<li>
<p>
<a href="#manpages">[manpages]</a>&#8201;&#8212;&#8201;command line documentation.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The material is practical, technical, and focused on answering specific questions.
It addresses how things work, what to do and what to avoid to successfully run Neo4j in a production environment.</p></div>
<div class="paragraph"><p>The goal is to be thumb-through and rule-of-thumb friendly.</p></div>
<div class="paragraph"><p>Each section should stand on its own, so you can hop right to whatever interests you.
When possible, the sections distill &#8220;rules of thumb&#8221; which you can keep in mind whenever you wander out of the house without this manual in your back pocket.</p></div>
<div class="paragraph"><p>The included code examples are executed when Neo4j is built and tested.
Also, the REST API request and response examples are captured from real interaction with a Neo4j server.
Thus, the examples are always in sync with how Neo4j actually works.</p></div>
<div class="paragraph"><p><em>Who should read this?</em></p></div>
<div class="paragraph"><p>The topics should be relevant to architects, administrators, developers and operations personnel.</p></div>
</div>
</div>
<h1 id="introduction">Introduction</h1>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>This part gives a bird&#8217;s eye view of what a graph database is, and then outlines some specifics of Neo4j.</p></div>
</div></div>
<div class="sect1">
<h2 id="introduction-highlights">Neo4j Highlights</h2>
<div class="sectionbody">
<div class="paragraph"><p>As a robust, scalable and high-performance database, Neo4j is suitable for full enterprise deployment or a subset of the full server can be used in lightweight projects.</p></div>
<div class="paragraph"><p>It features:</p></div>
<div class="ulist"><ul>
<li>
<p>
true ACID transactions,
</p>
</li>
<li>
<p>
high availability,
</p>
</li>
<li>
<p>
scales to billions of nodes and relationships,
</p>
</li>
<li>
<p>
high speed querying through traversals,
</p>
</li>
<li>
<p>
declarative graph query language.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Proper ACID behavior is the foundation of data reliability.
Neo4j enforces that all operations that modify data occur within a transaction, guaranteeing consistent data.
This robustness extends from single instance embedded graphs to multi-server high availability installations.
For details, see <a href="#transactions">[transactions]</a>.</p></div>
<div class="paragraph"><p>Reliable graph storage can easily be added to any application.
A graph can scale in size and complexity as the application evolves, with little impact on performance.
Whether starting new development, or augmenting existing functionality, Neo4j is only limited by physical hardware.</p></div>
<div class="paragraph"><p>A single server instance can handle a graph of billions of nodes and relationships.
When data throughput is insufficient, the graph database can be distributed among multiple servers in a high availability configuration.
See <a href="#ha">[ha]</a> to learn more.</p></div>
<div class="paragraph"><p>The graph database storage shines when storing richly-connected data.
Querying is performed through traversals, which can perform millions of traversal steps per second.
A traversal step resembles a <em>join</em> in a RDBMS.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="graphdb-concepts">Graph Database Concepts</h2>
<div class="sectionbody">
<div class="paragraph"><p>This chapter contains an introduction to the graph data model and also compares it to other data models used when persisting data.</p></div>
<div class="sect2">
<h3 id="what-is-a-graphdb">What is a Graph Database?</h3>
<div class="paragraph"><p>A graph database stores data in a graph, the most generic of data structures, capable of elegantly representing any kind of data in a highly accessible way.
Let’s follow along some graphs, using them to express graph concepts.
We’ll &#8220;read&#8221; a graph by following arrows around the diagram to form sentences.</p></div>
<div class="sect3">
<h4 id="_a_graph_contains_nodes_and_relationships">A Graph contains Nodes and Relationships</h4>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>&#8220;A Graph —records data in&#8594; Nodes —which have&#8594; Properties&#8221;</p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>The simplest possible graph is a single Node, a record that has named values referred to as Properties.
A Node could start with a single Property and grow to a few million Properties, though that can get a little awkward.
At some point it makes sense to distribute the data into multiple nodes, organized with explicit Relationships.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-GVE.svg" alt="graphdb-GVE.svg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_relationships_organize_the_graph">Relationships organize the Graph</h4>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>&#8220;Nodes —are organized by&#8594; Relationships —which also have&#8594; Properties&#8221;</p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>Relationships organize Nodes into arbitrary structures, allowing a Graph to resemble a List, a Tree, a Map, or a compound Entity – any of which can be combined into yet more complex, richly inter-connected structures.</p></div>
</div>
<div class="sect3">
<h4 id="_labels_group_the_nodes">Labels group the Nodes</h4>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>&#8220;Nodes —are grouped by&#8594; Labels —into&#8594; Sets&#8221;</p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>Labels are a means of grouping the nodes in the graph.
They can be used to restrict queries to subsets of the graph, as well as enabling optional model constraints and indexing rules.</p></div>
</div>
<div class="sect3">
<h4 id="_query_a_graph_with_a_traversal">Query a Graph with a Traversal</h4>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>&#8220;A Traversal —navigates&#8594; a Graph; it —identifies&#8594; Paths —which order&#8594; Nodes&#8221;</p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>A Traversal is how you query a Graph, navigating from starting Nodes to related Nodes according to an algorithm, finding answers to questions like &#8220;what music do my friends like that I don&#8217;t yet own,&#8221; or &#8220;if this power supply goes down, what web services are affected?&#8221;</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-traversal.svg" alt="graphdb-traversal.svg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_indexes_look_up_nodes_or_relationships">Indexes look-up Nodes or Relationships</h4>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>&#8220;An Index —maps from&#8594; Properties —to either&#8594; Nodes or Relationships&#8221;</p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>Often, you want to find a specific Node or Relationship according to a Property it has.
Rather than traversing the entire graph, use an Index to perform a look-up, for questions like &#8220;find the Account for username master-of-graphs.&#8221;</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-indexes.svg" alt="graphdb-indexes.svg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_neo4j_is_a_graph_database">Neo4j is a Graph Database</h4>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>&#8220;A Graph Database —manages a&#8594; Graph and —also manages related&#8594; Indexes&#8221;</p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>Neo4j is a commercially supported open-source graph database.
It was designed and built from the ground-up to be a reliable database, optimized for graph structures instead of tables.
Working with Neo4j, your application gets all the expressiveness of a graph, with all the dependability you expect out of a database.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-overview.svg" alt="graphdb-overview.svg">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tutorial-comparing-models">Comparing Database Models</h3>
<div class="paragraph"><p>A Graph Database stores data structured in the Nodes and Relationships of a graph.
How does this compare to other persistence models?
Because a graph is a generic structure, let&#8217;s compare how a few models would look in a graph.</p></div>
<div class="sect3">
<h4 id="_a_graph_database_transforms_a_rdbms">A Graph Database transforms a RDBMS</h4>
<div class="paragraph"><p>Topple the stacks of records in a relational database while keeping all the relationships, and you&#8217;ll see a graph.
Where an RDBMS is optimized for aggregated data, Neo4j is optimized for highly connected data.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-compare-rdbms.svg" alt="graphdb-compare-rdbms.svg">
</div>
<div class="title">Figure 1. RDBMS</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-compare-rdbms-g.svg" alt="graphdb-compare-rdbms-g.svg">
</div>
<div class="title">Figure 2. Graph Database as RDBMS</div>
</div>
</div>
<div class="sect3">
<h4 id="_a_graph_database_elaborates_a_key_value_store">A Graph Database elaborates a Key-Value Store</h4>
<div class="paragraph"><p>A Key-Value model is great for lookups of simple values or lists.
When the values are themselves interconnected, you&#8217;ve got a graph.
Neo4j lets you elaborate the simple data structures into more complex, interconnected data.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-compare-kvstore.svg" alt="graphdb-compare-kvstore.svg">
</div>
<div class="title">Figure 3. Key-Value Store</div>
</div>
<div class="paragraph"><p><span class="monospaced">K*</span> represents a key, <span class="monospaced">V*</span> a value.
Note that some keys point to other keys as well as plain values.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-compare-kvstore-g.svg" alt="graphdb-compare-kvstore-g.svg">
</div>
<div class="title">Figure 4. Graph Database as Key-Value Store</div>
</div>
</div>
<div class="sect3">
<h4 id="_a_graph_database_relates_column_family">A Graph Database relates Column-Family</h4>
<div class="paragraph"><p>Column Family (BigTable-style) databases are an evolution of key-value,  using "families" to allow grouping of rows.
Stored in a graph, the families could become hierarchical, and the relationships among data becomes explicit.</p></div>
</div>
<div class="sect3">
<h4 id="_a_graph_database_navigates_a_document_store">A Graph Database navigates a Document Store</h4>
<div class="paragraph"><p>The container hierarchy of a document database accommodates nice, schema-free data that can easily be represented as a tree.
Which is of course a graph.
Refer to other documents (or document elements) within that tree and you have a more expressive representation of the same data.
When in Neo4j, those relationships are easily navigable.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-compare-docdb.svg" alt="graphdb-compare-docdb.svg">
</div>
<div class="title">Figure 5. Document Store</div>
</div>
<div class="paragraph"><p><span class="monospaced">D</span>=Document, <span class="monospaced">S</span>=Subdocument, <span class="monospaced">V</span>=Value, <span class="monospaced">D2/S2</span> = reference to subdocument in (other) document.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-compare-docdb-g.svg" alt="graphdb-compare-docdb-g.svg">
</div>
<div class="title">Figure 6. Graph Database as Document Store</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graphdb-neo4j">The Neo4j Graph Database</h2>
<div class="sectionbody">
<div class="paragraph"><p>This chapter goes into more detail on the data model and behavior of Neo4j.</p></div>
<div class="sect2">
<h3 id="graphdb-neo4j-nodes">Nodes</h3>
<div class="paragraph"><p>The fundamental units that form a graph are nodes and relationships.
In Neo4j, both nodes and relationships can contain <a href="#graphdb-neo4j-properties">properties</a>.</p></div>
<div class="paragraph"><p>Nodes are often used to represent <em>entities,</em> but depending on the domain relationships may be used for that purpose as well.</p></div>
<div class="paragraph"><p>Apart from properties and relationships, nodes can also be <a href="#graphdb-neo4j-labels">labeled</a> with zero or more labels.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-nodes-overview.svg" alt="graphdb-nodes-overview.svg">
</div>
</div>
<div class="paragraph"><p>Let&#8217;s start out with a really simple graph, containing only a single node with one property:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-nodes.svg" alt="graphdb-nodes.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="graphdb-neo4j-relationships">Relationships</h3>
<div class="paragraph"><p>Relationships between nodes are a key part of a graph database.
They allow for finding related data.
Just like nodes, relationships can have <a href="#graphdb-neo4j-properties">properties</a>.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-rels-overview.svg" alt="graphdb-rels-overview.svg">
</div>
</div>
<div class="paragraph"><p>A relationship connects two nodes, and is guaranteed to have valid start and end nodes.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-rels.svg" alt="graphdb-rels.svg">
</div>
</div>
<div class="paragraph"><p>As relationships are always directed, they can be viewed as outgoing or incoming relative to a node, which is useful when traversing the graph:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-rels-dir.svg" alt="graphdb-rels-dir.svg">
</div>
</div>
<div class="paragraph"><p><em>Relationships are equally well traversed in either direction.</em>
This means that there is no need to add duplicate relationships in the opposite direction (with regard to traversal or performance).</p></div>
<div class="paragraph"><p>While relationships always have a direction, you can ignore the direction where it is not useful in your application.</p></div>
<div class="paragraph"><p>Note that a node can have relationships to itself as well:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-rels-loop.svg" alt="graphdb-rels-loop.svg">
</div>
</div>
<div class="paragraph"><p>To further enhance graph traversal all relationships have a relationship type.
Note that the word <em>type</em> might be misleading here, you could rather think of it as a <em>label</em>.
The following example shows a simple social network with two relationship types.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-rels-twitter.svg" alt="graphdb-rels-twitter.svg">
</div>
</div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 1. Using relationship direction and type</caption>
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > What </th>
<th class="tableblock halign-left valign-top" > How</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get who a person follows</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">outgoing <span class="monospaced">follows</span> relationships, depth one</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get the followers of a person</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">incoming <span class="monospaced">follows</span> relationships, depth one</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get who a person blocks</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">outgoing <span class="monospaced">blocks</span> relationships, depth one</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get who a person is blocked by</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">incoming <span class="monospaced">blocks</span> relationships, depth one</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>This example is a simple model of a file system, which includes symbolic links:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-rels-filesys.svg" alt="graphdb-rels-filesys.svg">
</div>
</div>
<div class="paragraph"><p>Depending on what you are looking for, you will use the direction and type of relationships during traversal.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >What </th>
<th class="tableblock halign-left valign-top" > How</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get the full path of a file</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">incoming <span class="monospaced">file</span> relationships</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get all paths for a file</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">incoming <span class="monospaced">file</span> and <span class="monospaced">symbolic link</span> relationships</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get all files in a directory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">outgoing <span class="monospaced">file</span> and <span class="monospaced">symbolic link</span> relationships, depth one</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get all files in a directory, excluding symbolic links</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">outgoing <span class="monospaced">file</span> relationships, depth one</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">get all files in a directory, recursively</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">outgoing <span class="monospaced">file</span> and <span class="monospaced">symbolic link</span> relationships</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="graphdb-neo4j-properties">Properties</h3>
<div class="paragraph"><p>Both nodes and relationships can have properties.</p></div>
<div class="paragraph"><p>Properties are key-value pairs where the key is a string.
Property values can be either a primitive or an array of one primitive type.
For example <span class="monospaced">String</span>, <span class="monospaced">int</span> and <span class="monospaced">int[]</span> values are valid for properties.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content"><span class="monospaced">null</span> is not a valid property value.
Nulls can instead be modeled by the absence of a key.</td>
</tr></table>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-properties.svg" alt="graphdb-properties.svg">
</div>
</div>
<table class="tableblock frame-all grid-all" id="property-value-types"
style="
width:100%;
">
<caption class="title">Table 2. Property value types</caption>
<col style="width:15%;">
<col style="width:45%;">
<col style="width:40%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Type </th>
<th class="tableblock halign-left valign-top" > Description </th>
<th class="tableblock halign-left valign-top" > Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">boolean</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">true</span>/<span class="monospaced">false</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">byte</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8-bit integer</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">-128</span> to <span class="monospaced">127</span>, inclusive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">short</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16-bit integer</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">-32768</span> to <span class="monospaced">32767</span>, inclusive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">int</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">32-bit integer</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">-2147483648</span> to <span class="monospaced">2147483647</span>, inclusive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">64-bit integer</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">-9223372036854775808</span> to <span class="monospaced">9223372036854775807</span>, inclusive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">float</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">32-bit IEEE 754 floating-point number</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">double</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">64-bit IEEE 754 floating-point number</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">char</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16-bit unsigned integers representing Unicode characters</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">u0000</span> to <span class="monospaced">uffff</span> (<span class="monospaced">0</span> to <span class="monospaced">65535</span>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sequence of Unicode characters</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>For further details on float/double values, see <a href="http://docs.oracle.com/javase/specs/jls/se5.0/html/typesValues.html#4.2.3">Java Language Specification</a>.</p></div>
</div>
<div class="sect2">
<h3 id="graphdb-neo4j-labels">Labels</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This is a new feature in Neo4j, it is experimental and may still change.
Your feedback on this addition to the model is very welcome.</td>
</tr></table>
</div>
<div class="paragraph"><p>A label is a named graph construct that is used to group nodes into sets; all nodes labeled with the same label belongs to the same set.
Many database queries can work with these sets instead of the whole graph, making queries easier to write and more efficient.
A node may be labeled with any number of labels, including none, making labels an optional addition to the graph.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-labels.svg" alt="graphdb-labels.svg">
</div>
</div>
<div class="paragraph"><p>An example would be a label named <em>User</em> that you label all your nodes representing users with.
With that in place, you can ask Neo4j to perform operations only on your user nodes, such as finding all users with a given name.</p></div>
<div class="paragraph"><p>However, you can use labels for much more.
For instance, since labels can be added and removed during runtime, they can be used to mark temporary states for your nodes.
You might create an "Offline" label for phones that are offline, a "Happy" label for happy pets, and so on.</p></div>
<div class="sect3">
<h4 id="_label_names">Label names</h4>
<div class="paragraph"><p>Any non-empty unicode string can be used as a label name.
In Cypher, you may need to use the backtick (``) syntax to avoid clashes with Cypher identifier rules.
By convention, labels are written with CamelCase notation, with the first letter in upper case.
For instance, <em>User</em> or <em>CarOwner</em>.</p></div>
<div class="paragraph"><p>Labels currently share id space with property keys, meaning the maximum number of labels the database can contain depends on the number of property keys it stores.
The combined number of property keys and labels that can be stored at the same time is 2<sup>24</sup> (&#8764; 16 000 000)</p></div>
</div>
</div>
<div class="sect2">
<h3 id="graphdb-neo4j-paths">Paths</h3>
<div class="paragraph"><p>A path is one or more nodes with connecting relationships, typically retrieved as a query or traversal result.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-path.svg" alt="graphdb-path.svg">
</div>
</div>
<div class="paragraph"><p>The shortest possible path has length zero and looks like this:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-path-example1.svg" alt="graphdb-path-example1.svg">
</div>
</div>
<div class="paragraph"><p>A path of length one:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-path-example2.svg" alt="graphdb-path-example2.svg">
</div>
</div>
<div class="paragraph"><p>Another path of length one:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-path-example-loop.svg" alt="graphdb-path-example-loop.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="graphdb-neo4j-traversal">Traversal</h3>
<div class="paragraph"><p>Traversing a graph means visiting its nodes, following relationships according to some rules.
In most cases only a subgraph is visited, as you already know where in the graph the interesting nodes and relationships are found.</p></div>
<div class="paragraph"><p>Neo4j comes with a callback based traversal API which lets you specify the traversal rules.
At a basic level there&#8217;s a choice between traversing breadth- or depth-first.</p></div>
<div class="paragraph"><p>For an in-depth introduction to the traversal framework, see <a href="#tutorial-traversal">[tutorial-traversal]</a>.
For Java code examples see <a href="#tutorials-java-embedded-traversal">[tutorials-java-embedded-traversal]</a>.</p></div>
<div class="paragraph"><p>You can also use <a href="#cypher-query-lang">The Cypher Query Language</a> as a powerful declarative way to query the graph.</p></div>
</div>
<div class="sect2">
<h3 id="graphdb-neo4j-schema">Schema</h3>
<div class="paragraph"><p>Neo4j is a schema-optional graph database. You can use Neo4j without any schema.  Optionally you can introduce it in order to gain performance or modeling benefits. This allows a way of working where the schema does not get in your way until you are at a stage where you want to reap the benefits of having one.</p></div>
<div class="sect3">
<h4 id="graphdb-neo4j-schema-indexes">Indexes</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This feature was introduced in Neo4j 2.0, and is not the same as the <a href="#indexing">legacy indexes</a>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Performance is gained by creating indexes, which improve the speed of looking up nodes in the database.
Once you’ve specified which properties to index, Neo4j will make sure your indexes are kept up to date as your graph evolves.
Any operation that looks up nodes by the newly indexed properties will see a significant performance boost.</p></div>
<div class="paragraph"><p>Indexes in Neo4j are <em>eventually available</em>. That means that when you first create an index, the operation returns immediately.
The index is not immediately available for querying, however. The new index will be created in the background, and eventually come online.</p></div>
<div class="paragraph"><p>You can track the status of your index by asking for the index state through the API you are using.
Note, however, that this is not yet possible through cypher.</p></div>
<div class="paragraph"><p>How to use indexes in the different APIs:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#query-schema-index">Cypher</a>
</p>
</li>
<li>
<p>
<a href="#tutorials-java-embedded-new-index">Java Core API</a>
</p>
</li>
<li>
<p>
<a href="#rest-api-schema-indexes">REST API</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<h1 id="tutorials">Tutorials</h1>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>The tutorial part describes how to set up your environment, and write programs using Neo4j.
It takes you from Hello World to advanced usage of graphs.</p></div>
</div></div>
<div class="sect1">
<h2 id="tutorials-java-embedded">Using Neo4j embedded in Java applications</h2>
<div class="sectionbody">
<div class="paragraph"><p>It&#8217;s easy to use Neo4j embedded in Java applications.
In this chapter you will find everything needed&#8201;&#8212;&#8201;from setting up the environment to doing something useful with your data.</p></div>
<div class="sect2">
<h3 id="tutorials-java-embedded-setup">Include Neo4j in your project</h3>
<div class="paragraph"><p>After selecting the appropriate <a href="#editions">edition</a> for your platform, embed Neo4j in your Java application by including the Neo4j library jars in your build.
The following sections will show how to do this by either altering the build path directly or by using dependency management.</p></div>
<div class="sect3">
<h4 id="_add_neo4j_to_the_build_path">Add Neo4j to the build path</h4>
<div class="paragraph"><p>Get the Neo4j libraries from one of these sources:</p></div>
<div class="ulist"><ul>
<li>
<p>
Extract a Neo4j <a href="http://neo4j.org/download/">download</a> zip/tarball, and use the <em>jar</em> files found in the <em>lib/</em> directory.
</p>
</li>
<li>
<p>
Use the <em>jar</em> files available from <a href="http://search.maven.org/#search|ga|1|g%3A%22org.neo4j%22">Maven Central Repository</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Add the jar files to your project:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
JDK tools
</dt>
<dd>
<p>
 Append to <span class="monospaced">-classpath</span>
</p>
</dd>
<dt class="hdlist1">
Eclipse
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Right-click on the project and then go <em>Build Path &#8594; Configure Build Path.</em>
   In the dialog, choose <em>Add External JARs</em>, browse to the Neo4j <em>lib/</em> directory and select all of the jar files.
</p>
</li>
<li>
<p>
Another option is to use <a href="http://help.eclipse.org/indigo/index.jsp?topic=/org.eclipse.jdt.doc.user/reference/preferences/java/buildpath/ref-preferences-user-libraries.htm">User Libraries</a>.
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
IntelliJ IDEA
</dt>
<dd>
<p>
 See <a href="http://www.jetbrains.com/idea/webhelp/configuring-project-and-global-libraries.html">Libraries, Global Libraries, and the Configure Library dialog</a>
</p>
</dd>
<dt class="hdlist1">
NetBeans
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Right-click on the <em>Libraries</em> node of the project, choose <em>Add JAR/Folder</em>, browse to the Neo4j <em>lib/</em> directory and select all of the jar files.
</p>
</li>
<li>
<p>
You can also handle libraries from the project node, see <a href="http://netbeans.org/kb/docs/java/project-setup.html#projects-classpath">Managing a Project&#8217;s Classpath</a>.
</p>
</li>
</ul></div>
</dd>
</dl></div>
</div>
<div class="sect3">
<h4 id="_add_neo4j_as_a_dependency">Add Neo4j as a dependency</h4>
<div class="paragraph"><p>For an overview of the main Neo4j artifacts, see <a href="#editions">[editions]</a>.
The artifacts listed there are top-level artifacts that will transitively include the actual Neo4j implementation.
You can either go with the top-level artifact or include the individual components directly.
The examples included here use the top-level artifact approach.</p></div>
<div class="sect4">
<h5 id="_maven">Maven</h5>
<div class="listingblock">
<div class="title">Maven dependency</div>
<pre class="programlisting brush: xml">&lt;project&gt;
...
 &lt;dependencies&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
   &lt;artifactId&gt;neo4j&lt;/artifactId&gt;
   &lt;version&gt;2.0-SNAPSHOT&lt;/version&gt;
  &lt;/dependency&gt;
  ...
 &lt;/dependencies&gt;
...
&lt;/project&gt;</pre></div>
<div class="paragraph"><p><em>Where the <span class="monospaced">artifactId</span> is found in <a href="#editions">[editions]</a>.</em></p></div>
</div>
<div class="sect4">
<h5 id="_eclipse_and_maven">Eclipse and Maven</h5>
<div class="paragraph"><p>For development in <a href="http://www.eclipse.org">Eclipse</a>, it is recommended to install the <a href="http://www.eclipse.org/m2e/">m2e plugin</a> and let Maven manage the project build classpath instead, see above.
This also adds the possibility to build your project both via the command line with Maven and have a working Eclipse setup for development.</p></div>
</div>
<div class="sect4">
<h5 id="_ivy">Ivy</h5>
<div class="paragraph"><p>Make sure to resolve dependencies from Maven Central, for example using this configuration in your <em>ivysettings.xml</em> file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: xml">&lt;ivysettings&gt;
  &lt;settings defaultResolver="main"/&gt;
  &lt;resolvers&gt;
    &lt;chain name="main"&gt;
      &lt;filesystem name="local"&gt;
        &lt;artifact pattern="${ivy.settings.dir}/repository/[artifact]-[revision].[ext]" /&gt;
      &lt;/filesystem&gt;
      &lt;ibiblio name="maven_central" root="http://repo1.maven.org/maven2/" m2compatible="true"/&gt;
    &lt;/chain&gt;
  &lt;/resolvers&gt;
&lt;/ivysettings&gt;</pre></div>
<div class="paragraph"><p>With that in place you can add Neo4j to the mix by having something along these lines to your <em>ivy.xml</em> file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: xml">..
&lt;dependencies&gt;
  ..
  &lt;dependency org="org.neo4j" name="neo4j" rev="2.0-SNAPSHOT"/&gt;
  ..
&lt;/dependencies&gt;
..</pre></div>
<div class="paragraph"><p><em>Where the <span class="monospaced">name</span> is found in <a href="#editions">[editions]</a>.</em></p></div>
</div>
<div class="sect4">
<h5 id="_gradle">Gradle</h5>
<div class="paragraph"><p>The example below shows an example gradle build script for including the Neo4j libraries.</p></div>
<div class="listingblock">
<pre class="programlisting brush: groovy">def neo4jVersion = "2.0-SNAPSHOT"
apply plugin: 'java'
repositories {
   mavenCentral()
}
dependencies {
   compile "org.neo4j:neo4j:${neo4jVersion}"
}</pre></div>
<div class="paragraph"><p><em>Where the coordinates (<span class="monospaced">org.neo4j:neo4j</span> in the example) are found in <a href="#editions">[editions]</a>.</em></p></div>
</div>
</div>
<div class="sect3">
<h4 id="tutorials-java-embedded-setup-startstop">Starting and stopping</h4>
<div class="paragraph"><p>To create a new database or ópen an existing one you instantiate an <span class="monospaced"><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/EmbeddedGraphDatabase.html">EmbeddedGraphDatabase</a></span>.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">graphDb = new GraphDatabaseFactory().newEmbeddedDatabase( DB_PATH );
registerShutdownHook( graphDb );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <span class="monospaced">EmbeddedGraphDatabase</span> instance can be shared among multiple threads.
Note however that you can&#8217;t create multiple instances pointing to the same database.</td>
</tr></table>
</div>
<div class="paragraph"><p>To stop the database, call the <span class="monospaced">shutdown()</span> method:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">graphDb.shutdown();</pre>
</div></div>
<div class="paragraph"><p>To make sure Neo4j is shut down properly you can add a shutdown hook:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static void registerShutdownHook( final GraphDatabaseService graphDb )
{
    // Registers a shutdown hook for the Neo4j instance so that it
    // shuts down nicely when the VM exits (even if you "Ctrl-C" the
    // running application).
    Runtime.getRuntime().addShutdownHook( new Thread()
    {
        @Override
        public void run()
        {
            graphDb.shutdown();
        }
    } );
}</pre>
</div></div>
<div class="sect4">
<h5 id="tutorials-java-embedded-setup-config">Starting an embedded database with configuration settings</h5>
<div class="paragraph"><p>To start Neo4j with configuration settings, a Neo4j properties file can be loaded like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">GraphDatabaseService graphDb = new GraphDatabaseFactory()
    .newEmbeddedDatabaseBuilder( storeDir )
    .loadPropertiesFromFile( pathToConfig + "neo4j.properties" )
    .newGraphDatabase();</pre>
</div></div>
<div class="paragraph"><p>Or you could of course create you own <span class="monospaced">Map&lt;String, String&gt;</span> programmatically and use that instead, like so:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, String&gt; config = new HashMap&lt;String, String&gt;();
config.put( "neostore.nodestore.db.mapped_memory", "10M" );
config.put( "string_block_size", "60" );
config.put( "array_block_size", "300" );
GraphDatabaseService graphDb = new GraphDatabaseFactory()
    .newEmbeddedDatabaseBuilder( storeDir )
    .setConfig( config )
    .newGraphDatabase();</pre>
</div></div>
<div class="paragraph"><p>For configuration settings, see <a href="#embedded-configuration">[embedded-configuration]</a>.</p></div>
</div>
<div class="sect4">
<h5 id="tutorials-java-embedded-setup-readonly">Starting an embedded read-only instance</h5>
<div class="paragraph"><p>If you want a <em>read-only view</em> of the database, create an instance this way:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, String&gt; config = new HashMap&lt;String, String&gt;();
config.put( "read_only", "true" );
graphDb = new GraphDatabaseFactory().newEmbeddedDatabaseBuilder(
        "target/read-only-db/location" )
        .setConfig( config )
        .newGraphDatabase();</pre>
</div></div>
<div class="paragraph"><p>Obviously the database has to exist already in this case.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Concurrent access to the same database files by multiple (read-only or write) instances is not supported.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-hello-world">Hello World</h3>
<div class="paragraph"><p>Learn how to create and access nodes and relationships.
For information on project setup, see <a href="#tutorials-java-embedded-setup">[tutorials-java-embedded-setup]</a>.</p></div>
<div class="paragraph"><p>Remember, from <a href="#what-is-a-graphdb">[what-is-a-graphdb]</a>, that a Neo4j graph consist of:</p></div>
<div class="ulist"><ul>
<li>
<p>
Nodes that are connected by
</p>
</li>
<li>
<p>
Relationships, with
</p>
</li>
<li>
<p>
Properties on both nodes and relationships.
</p>
</li>
</ul></div>
<div class="paragraph"><p>All relationships have a type.
For example, if the graph represents a social network, a relationship type could be <span class="monospaced">KNOWS</span>.
If a relationship of the type <span class="monospaced">KNOWS</span> connects two nodes, that probably represents two people that know each other.
A lot of the semantics (that is the meaning) of a graph is encoded in the relationship types of the application.
And although relationships are directed they are equally well traversed regardless of which direction they are traversed.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of this example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/main/java/org/neo4j/examples/EmbeddedNeo4j.java">EmbeddedNeo4j.java</a></td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_prepare_the_database">Prepare the database</h4>
<div class="paragraph"><p>Relationship types can be created by using an <span class="monospaced">enum</span>.
In this example we only need a single relationship type. This is how to
define it:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static enum RelTypes implements RelationshipType
{
    KNOWS
}</pre>
</div></div>
<div class="paragraph"><p>We also prepare some variables to use:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">GraphDatabaseService graphDb;
Node firstNode;
Node secondNode;
Relationship relationship;</pre>
</div></div>
<div class="paragraph"><p>The next step is to start the database server.
Note that if the directory given for the database doesn&#8217;t already exist, it will be created.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">graphDb = new GraphDatabaseFactory().newEmbeddedDatabase( DB_PATH );
registerShutdownHook( graphDb );</pre>
</div></div>
<div class="paragraph"><p>Note that starting a database server is an expensive operation, so don&#8217;t start up a new instance every time you need to interact with the database!
The instance can be shared by multiple threads.
Transactions are thread confined.</p></div>
<div class="paragraph"><p>As seen, we register a shutdown hook that will make sure the database shuts down when the JVM exits.
Now it&#8217;s time to interact with the database.</p></div>
</div>
<div class="sect3">
<h4 id="_wrap_writes_in_a_transaction">Wrap writes in a transaction</h4>
<div class="paragraph"><p>All writes (creating, deleting and updating any data) have to be performed in a transaction.
This is a conscious design decision, since we believe transaction demarcation to be an important part of working with a real enterprise database.
Now, transaction handling in Neo4j is very easy:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Transaction tx = graphDb.beginTx();
try
{
    // Updating operations go here
    tx.success();
}
finally
{
    tx.finish();
}</pre>
</div></div>
<div class="paragraph"><p>For more information on transactions, see <a href="#transactions">[transactions]</a> and
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Transaction.html">Java API for Transaction</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_create_a_small_graph">Create a small graph</h4>
<div class="paragraph"><p>Now, let&#8217;s create a few nodes.
The API is very intuitive.
Feel free to have a look at the JavaDocs at <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/">http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/</a>.
They&#8217;re included in the distribution, as well.
Here&#8217;s how to create a small graph consisting of two nodes, connected with one relationship and some properties:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">firstNode = graphDb.createNode();
firstNode.setProperty( "message", "Hello, " );
secondNode = graphDb.createNode();
secondNode.setProperty( "message", "World!" );

relationship = firstNode.createRelationshipTo( secondNode, RelTypes.KNOWS );
relationship.setProperty( "message", "brave Neo4j " );</pre>
</div></div>
<div class="paragraph"><p>We now have a graph that looks like this:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Hello-World-Graph-java.svg" alt="Hello-World-Graph-java.svg">
</div>
<div class="title">Figure 7. Hello World Graph</div>
</div>
</div>
<div class="sect3">
<h4 id="_print_the_result">Print the result</h4>
<div class="paragraph"><p>After we&#8217;ve created our graph, let&#8217;s read from it and print the result.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">System.out.print( firstNode.getProperty( "message" ) );
System.out.print( relationship.getProperty( "message" ) );
System.out.print( secondNode.getProperty( "message" ) );</pre>
</div></div>
<div class="paragraph"><p>Which will output:</p></div>
<div class="paragraph"><p>Hello, brave Neo4j World!</p></div>
</div>
<div class="sect3">
<h4 id="_remove_the_data">Remove the data</h4>
<div class="paragraph"><p>In this case we&#8217;ll remove the data before committing:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// let's remove the data
firstNode.getSingleRelationship( RelTypes.KNOWS, Direction.OUTGOING ).delete();
firstNode.delete();
secondNode.delete();</pre>
</div></div>
<div class="paragraph"><p>Note that deleting a node which still has relationships when the transaction commits will fail.
This is to make sure relationships always have a start node and an end node.</p></div>
</div>
<div class="sect3">
<h4 id="_shut_down_the_database_server">Shut down the database server</h4>
<div class="paragraph"><p>Finally, shut down the database server <em>when the application finishes:</em></p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">graphDb.shutdown();</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-index">User database with index</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Please read <a href="#tutorials-java-embedded-resource-iteration">[tutorials-java-embedded-resource-iteration]</a> on how to properly close ResourceIterators returned from index lookups when not using a transaction.</td>
</tr></table>
</div>
<div class="paragraph"><p>You have a user database, and want to retrieve users by name.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code used in this example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/main/java/org/neo4j/examples/EmbeddedNeo4jWithIndexing.java">EmbeddedNeo4jWithIndexing.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>We have created two helper methods to handle user names and adding users to the database:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static String idToUserName( final int id )
{
    return "user" + id + "@neo4j.org";
}

private static Node createAndIndexUser( final String username )
{
    Node node = graphDb.createNode();
    node.setProperty( USERNAME_KEY, username );
    nodeIndex.add( node, USERNAME_KEY, username );
    return node;
}</pre>
</div></div>
<div class="paragraph"><p>The next step is to start the database server:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">graphDb = new GraphDatabaseFactory().newEmbeddedDatabase( DB_PATH );
nodeIndex = graphDb.index().forNodes( "nodes" );
registerShutdownHook();</pre>
</div></div>
<div class="paragraph"><p>It&#8217;s time to add the users:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Transaction tx = graphDb.beginTx();
try
{
    // Create some users and index their names with the IndexService
    for ( int id = 0; id &lt; 100; id++ )
    {
        createAndIndexUser( idToUserName( id ) );
    }</pre>
</div></div>
<div class="paragraph"><p>And here&#8217;s how to find a user by Id:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">int idToFind = 45;
String userName = idToUserName( idToFind );
Node foundUser = nodeIndex.get( USERNAME_KEY, userName ).getSingle();

System.out.println( "The username of user " + idToFind + " is "
    + foundUser.getProperty( USERNAME_KEY ) );</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-new-index">User database with schema based indexing</h3>
<div class="paragraph"><p>You have a user database, and want to retrieve users by name using schema based indexing.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code used in this example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/main/java/org/neo4j/examples/EmbeddedNeo4jWithNewIndexing.java">EmbeddedNeo4jWithNewIndexing.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>To begin with, we start the database server</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">GraphDatabaseService graphDb = new GraphDatabaseFactory().newEmbeddedDatabase( DB_PATH );</pre>
</div></div>
<div class="paragraph"><p>Then we have to configure the database to index users by name. This only needs to be done once.</p></div>
<div class="paragraph"><p>New indexes are populated asynchronously. It is possible to use the core API to wait for index population to complete.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">GraphDatabaseService graphDb = new GraphDatabaseFactory().newEmbeddedDatabase( DB_PATH );</pre>
</div></div>
<div class="paragraph"><p>It&#8217;s time to add the users:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Transaction tx = graphDb.beginTx();
try
{
    Label label = DynamicLabel.label( "User" );

    // Create some users and index their names with the new IndexingService
    for ( int id = 0; id &lt; 100; id++ )
    {
        Node userNode = graphDb.createNode( label );
        userNode.setProperty( "username", "user" + id + "@neo4j.org" );
    }
    System.out.println( "Users created" );
    tx.success();
}
finally
{
    tx.finish();
}</pre>
</div></div>
<div class="paragraph"><p>And here&#8217;s how to find a user by id:</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Please read <a href="#tutorials-java-embedded-resource-iteration">[tutorials-java-embedded-resource-iteration]</a> on how to properly close ResourceIterators returned from index lookups.</td>
</tr></table>
</div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Label label = DynamicLabel.label( "User" );
int idToFind = 45;
String nameToFind = "user" + idToFind + "@neo4j.org";
ResourceIterator&lt;Node&gt; users = graphDb.findNodesByLabelAndProperty( label, "username", nameToFind ).iterator();
try
{
    while ( users.hasNext() )
    {
        Node node = users.next();
        System.out.println( "The username of user " + idToFind + " is " + node.getProperty( "username" ) );
    }
}
finally
{
    // alternatively use a transaction
    users.close();
}</pre>
</div></div>
<div class="paragraph"><p>When updating the name of a user, the index is updated as well:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Transaction tx = graphDb.beginTx();
try
{
    Label label = DynamicLabel.label( "User" );
    int idToFind = 45;
    String nameToFind = "user" + idToFind + "@neo4j.org";

    for (Node node : graphDb.findNodesByLabelAndProperty( label, "username", nameToFind ) )
    {
        node.setProperty( "username", "user" + (idToFind+1) + "@neo4j.org" );
    }
    tx.success();
}
finally
{
    tx.finish();
}</pre>
</div></div>
<div class="paragraph"><p>When deleting a user, it is automatically removed from the index:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Transaction tx = graphDb.beginTx();
try
{
    Label label = DynamicLabel.label( "User" );
    int idToFind = 46;
    String nameToFind = "user" + idToFind + "@neo4j.org";

    for (Node node : graphDb.findNodesByLabelAndProperty( label, "username", nameToFind ) )
    {
        node.delete();
    }
    tx.success();
}
finally
{
    tx.finish();
}</pre>
</div></div>
<div class="paragraph"><p>In case we change our data model, we can drop the index as well:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Transaction tx = graphDb.beginTx();
try
{
    Label label = DynamicLabel.label( "User" );
    for ( IndexDefinition indexDefinition : graphDb.schema().getIndexes(label) )
    {
        // There is only one index
        indexDefinition.drop();
    }

    tx.success();
}
finally
{
    tx.finish();
}</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-resource-iteration">Managing resources when not using transactions</h3>
<div class="paragraph"><p>It is recommended to always open a transaction when accessing the database. While it is possible to perform read only operations without opening a transaction, it is advised that you open transactions anyhow. Otherwise you should take care to close any ResourceIterators that you retrieve (generally these come from ResourceIterables). If these ResourceIterators are not closed, files and other resources will be kept open for a long time, potentially blocking other operations.
The best way to ensure this, is to close each ResourceIterator in a finally-block.</p></div>
<div class="paragraph"><p>What follows is an example of how to close a ResourceIterator. The example is taken from <a href="#tutorials-java-embedded-new-index">[tutorials-java-embedded-new-index]</a>.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Label label = DynamicLabel.label( "User" );
int idToFind = 45;
String nameToFind = "user" + idToFind + "@neo4j.org";
ResourceIterator&lt;Node&gt; users = graphDb.findNodesByLabelAndProperty( label, "username", nameToFind ).iterator();
try
{
    while ( users.hasNext() )
    {
        Node node = users.next();
        System.out.println( "The username of user " + idToFind + " is " + node.getProperty( "username" ) );
    }
}
finally
{
    // alternatively use a transaction
    users.close();
}</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="tutorials-java-unit-testing">Basic unit testing</h3>
<div class="paragraph"><p>The basic pattern of unit testing with Neo4j is illustrated by the following example.</p></div>
<div class="paragraph"><p>To access the Neo4j testing facilities you should have the <span class="monospaced">neo4j-kernel</span> <em>tests.jar</em> on the classpath during tests.
You can download it from Maven Central: <a href="http://search.maven.org/#search|ga|1|g%3A%22org.neo4j%22%20AND%20a%3A%22neo4j-kernel%22">org.neo4j:neo4j-kernel</a>.</p></div>
<div class="paragraph"><p>Using Maven as a dependency manager you would typically add this dependency together with JUnit and Hamcrest like so:</p></div>
<div class="listingblock">
<div class="title">Maven dependency</div>
<pre class="programlisting brush: xml">&lt;project&gt;
...
 &lt;dependencies&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
   &lt;artifactId&gt;neo4j-kernel&lt;/artifactId&gt;
   &lt;version&gt;2.0-SNAPSHOT&lt;/version&gt;
   &lt;type&gt;test-jar&lt;/type&gt;
   &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;junit&lt;/groupId&gt;
   &lt;artifactId&gt;junit-dep&lt;/artifactId&gt;
   &lt;version&gt;4.11&lt;/version&gt;
   &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;
   &lt;artifactId&gt;hamcrest-all&lt;/artifactId&gt;
   &lt;version&gt;1.3&lt;/version&gt;
   &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  ...
 &lt;/dependencies&gt;
...
&lt;/project&gt;</pre></div>
<div class="paragraph"><p>Observe that the <span class="monospaced">&lt;type&gt;test-jar&lt;/type&gt;</span> is crucial.
Without it you would get the common <span class="monospaced">neo4j-kernel</span> jar, not the one containing the testing facilities.</p></div>
<div class="paragraph"><p>With that in place, we&#8217;re ready to code our tests.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">For the full source code of this example see:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/test/java/org/neo4j/examples/Neo4jBasicDocTest.java">Neo4jBasicDocTest.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>Before each test, create a fresh database:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">@Before
public void prepareTestDatabase()
{
    graphDb = new TestGraphDatabaseFactory().newImpermanentDatabase();
}</pre>
</div></div>
<div class="paragraph"><p>After the test has executed, the database should be shut down:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">@After
public void destroyTestDatabase()
{
    graphDb.shutdown();
}</pre>
</div></div>
<div class="paragraph"><p>During a test, create nodes and check to see that they are there, while enclosing write operations in a transaction.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Transaction tx = graphDb.beginTx();

Node n = null;
try
{
    n = graphDb.createNode();
    n.setProperty( "name", "Nancy" );
    tx.success();
}
catch ( Exception e )
{
    tx.failure();
}
finally
{
    tx.finish();
}

// The node should have an id greater than 0, which is the id of the
// reference node.
assertThat( n.getId(), is( greaterThan( 0L ) ) );

// Retrieve a node by using the id of the created node. The id's and
// property should match.
Node foundNode = graphDb.getNodeById( n.getId() );
assertThat( foundNode.getId(), is( n.getId() ) );
assertThat( (String) foundNode.getProperty( "name" ), is( "Nancy" ) );</pre>
</div></div>
<div class="paragraph"><p>If you want to set configuration parameters at database creation, it&#8217;s done like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, String&gt; config = new HashMap&lt;String, String&gt;();
config.put( "neostore.nodestore.db.mapped_memory", "10M" );
config.put( "string_block_size", "60" );
config.put( "array_block_size", "300" );
GraphDatabaseService db = new TestGraphDatabaseFactory()
    .newImpermanentDatabaseBuilder()
    .setConfig( config )
    .newGraphDatabase();</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-traversal">Traversal</h3>
<div class="paragraph"><p>For reading about traversals, see <a href="#tutorial-traversal">[tutorial-traversal]</a>.</p></div>
<div class="paragraph"><p>For more examples of traversals, see <a href="#data-modeling-examples">[data-modeling-examples]</a>.</p></div>
<div class="sect3">
<h4 id="_the_matrix">The Matrix</h4>
<div class="paragraph"><p>This is the first graph we want to traverse into:</p></div>
<div class="imageblock">
<div class="content">
<img src="images/examples-matrix.png" alt="examples-matrix.png">
</div>
<div class="title">Figure 8. Matrix node space view</div>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of this example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/main/java/org/neo4j/examples/NewMatrix.java">NewMatrix.java</a></td>
</tr></table>
</div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static Traverser getFriends(
        final Node person )
{
    TraversalDescription td = Traversal.description()
            .breadthFirst()
            .relationships( RelTypes.KNOWS, Direction.OUTGOING )
            .evaluator( Evaluators.excludeStartPosition() );
    return td.traverse( person );
}</pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s perform the actual traversal and print the results:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">int numberOfFriends = 0;
String output = neoNode.getProperty( "name" ) + "'s friends:\n";
Traverser friendsTraverser = getFriends( neoNode );
for ( Path friendPath : friendsTraverser )
{
    output += "At depth " + friendPath.length() + " =&gt; "
              + friendPath.endNode()
                      .getProperty( "name" ) + "\n";
    numberOfFriends++;
}
output += "Number of friends found: " + numberOfFriends + "\n";</pre>
</div></div>
<div class="paragraph"><p>Which will give us the following output:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Thomas Anderson's friends:
At depth 1 =&gt; Trinity
At depth 1 =&gt; Morpheus
At depth 2 =&gt; Cypher
At depth 3 =&gt; Agent Smith
Number of friends found: 4</pre></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static Traverser findHackers( final Node startNode )
{
    TraversalDescription td = Traversal.description()
            .breadthFirst()
            .relationships( RelTypes.CODED_BY, Direction.OUTGOING )
            .relationships( RelTypes.KNOWS, Direction.OUTGOING )
            .evaluator(
                    Evaluators.includeWhereLastRelationshipTypeIs( RelTypes.CODED_BY ) );
    return td.traverse( startNode );
}</pre>
</div></div>
<div class="paragraph"><p>Print out the result:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">String output = "Hackers:\n";
int numberOfHackers = 0;
Traverser traverser = findHackers( getNeoNode() );
for ( Path hackerPath : traverser )
{
    output += "At depth " + hackerPath.length() + " =&gt; "
              + hackerPath.endNode()
                      .getProperty( "name" ) + "\n";
    numberOfHackers++;
}
output += "Number of hackers found: " + numberOfHackers + "\n";</pre>
</div></div>
<div class="paragraph"><p>Now we know who coded the Matrix:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Hackers:
At depth 4 =&gt; The Architect
Number of hackers found: 1</pre></div>
<div class="sect4">
<h5 id="_walking_an_ordered_path">Walking an ordered path</h5>
<div class="paragraph"><p>This example shows how to use a path context holding a representation of a path.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of this example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/main/java/org/neo4j/examples/orderedpath/OrderedPath.java">OrderedPath.java</a></td>
</tr></table>
</div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Node A = db.createNode();
Node B = db.createNode();
Node C = db.createNode();
Node D = db.createNode();
A.createRelationshipTo( B, REL1 );
B.createRelationshipTo( C, REL2 );
C.createRelationshipTo( D, REL3 );
A.createRelationshipTo( C, REL2 );</pre>
</div></div>
<div class="imageblock dot">
<div class="content">
<img src="images/example-ordered-path.svg" alt="example-ordered-path.svg">
</div>
</div>
<div class="paragraph"><p>Now, the order of relationships (<span class="monospaced">REL1</span> &#8594; <span class="monospaced">REL2</span> &#8594; <span class="monospaced">REL3</span>) is stored in an <span class="monospaced">ArrayList</span>.
Upon traversal, the <span class="monospaced">Evaluator</span> can check against it to ensure that only paths are included and returned that have the predefined order of relationships:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">final ArrayList&lt;RelationshipType&gt; orderedPathContext = new ArrayList&lt;RelationshipType&gt;();
orderedPathContext.add( REL1 );
orderedPathContext.add( withName( "REL2" ) );
orderedPathContext.add( withName( "REL3" ) );
TraversalDescription td = Traversal.description()
        .evaluator( new Evaluator()
        {
            @Override
            public Evaluation evaluate( final Path path )
            {
                if ( path.length() == 0 )
                {
                    return Evaluation.EXCLUDE_AND_CONTINUE;
                }
                RelationshipType expectedType = orderedPathContext.get( path.length() - 1 );
                boolean isExpectedType = path.lastRelationship()
                        .isType( expectedType );
                boolean included = path.length() == orderedPathContext.size()
                                   &amp;&amp; isExpectedType;
                boolean continued = path.length() &lt; orderedPathContext.size()
                                    &amp;&amp; isExpectedType;
                return Evaluation.of( included, continued );
            }
        } );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Traverser traverser = td.traverse( A );
PathPrinter pathPrinter = new PathPrinter( "name" );
for ( Path path : traverser )
{
    output += Traversal.pathToString( path, pathPrinter );
}</pre>
</div></div>
<div class="paragraph"><p>Which will output:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">(A)--[REL1]--&gt;(B)--[REL2]--&gt;(C)--[REL3]--&gt;(D)</pre></div>
<div class="paragraph"><p>In this case we use a custom class to format the path output.
This is how it&#8217;s done:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">static class PathPrinter implements Traversal.PathDescriptor&lt;Path&gt;
{
    private final String nodePropertyKey;

    public PathPrinter( String nodePropertyKey )
    {
        this.nodePropertyKey = nodePropertyKey;
    }

    @Override
    public String nodeRepresentation( Path path, Node node )
    {
        return "(" + node.getProperty( nodePropertyKey, "" ) + ")";
    }

    @Override
    public String relationshipRepresentation( Path path, Node from,
            Relationship relationship )
    {
        String prefix = "--", suffix = "--";
        if ( from.equals( relationship.getEndNode() ) )
        {
            prefix = "&lt;--";
        }
        else
        {
            suffix = "--&gt;";
        }
        return prefix + "[" + relationship.getType().name() + "]" + suffix;
    }
}</pre>
</div></div>
<div class="paragraph"><p>For options regarding output of a <span class="monospaced">Path</span>, see the
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/Traversal.html">Traversal</a> class.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="examples-uniqueness-of-paths-in-traversals">Uniqueness of Paths in traversals</h4>
<div class="paragraph"><p>This example is demonstrating the use of node uniqueness.
Below an imaginary domain graph with Principals
that own pets that are descendant to other pets.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Descendants-Example-Graph-Uniqueness-of-Paths-in-traversals.svg" alt="Descendants-Example-Graph-Uniqueness-of-Paths-in-traversals.svg">
</div>
<div class="title">Figure 9. Descendants Example Graph</div>
</div>
<div class="paragraph"><p>In order to return all descendants
of <span class="monospaced">Pet0</span> which have the relation <span class="monospaced">owns</span> to <span class="monospaced">Principal1</span> (<span class="monospaced">Pet1</span> and <span class="monospaced">Pet3</span>),
the Uniqueness of the traversal needs to be set to
<span class="monospaced">NODE_PATH</span> rather than the default <span class="monospaced">NODE_GLOBAL</span> so that nodes
can be traversed more that once, and paths that have
different nodes but can have some nodes in common (like the
start and end node) can be returned.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">final Node target = data.get().get( "Principal1" );
TraversalDescription td = Traversal.description()
        .uniqueness( Uniqueness.NODE_PATH )
        .evaluator( new Evaluator()
{
    @Override
    public Evaluation evaluate( Path path )
    {
        if ( path.endNode().equals( target ) )
        {
            return Evaluation.INCLUDE_AND_PRUNE;
        }
        return Evaluation.EXCLUDE_AND_CONTINUE;
    }
} );

Traverser results = td.traverse( start );</pre>
</div></div>
<div class="paragraph"><p>This will return the following paths:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">(3)--[descendant,0]--&gt;(1)&lt;--[owns,3]--(5)
(3)--[descendant,2]--&gt;(4)&lt;--[owns,5]--(5)</pre></div>
<div class="paragraph"><p>In the default <span class="monospaced">path.toString()</span> implementation, <span class="monospaced">(1)--[knows,2]--&gt;(4)</span> denotes
a node with ID=1 having a relationship with ID 2 or type <span class="monospaced">knows</span> to a node with ID-4.</p></div>
<div class="paragraph"><p>Let&#8217;s create a new <span class="monospaced">TraversalDescription</span> from the old one,
having <span class="monospaced">NODE_GLOBAL</span> uniqueness to see the difference.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <span class="monospaced">TraversalDescription</span> object is immutable,
     so we have to use the new instance returned
     with the new uniqueness setting.</td>
</tr></table>
</div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">TraversalDescription nodeGlobalTd = td.uniqueness( Uniqueness.NODE_GLOBAL );
results = nodeGlobalTd.traverse( start );</pre>
</div></div>
<div class="paragraph"><p>Now only one path is returned:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">(3)--[descendant,0]--&gt;(1)&lt;--[owns,3]--(5)</pre></div>
</div>
<div class="sect3">
<h4 id="tutorials-java-embedded-social">Social network</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The following example uses the new enhanced traversal API.</td>
</tr></table>
</div>
<div class="paragraph"><p>Social networks (know as social graphs out on the web) are natural to model with a graph.
This example shows a very simple social model that connects friends and keeps track of status updates.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of the example is found here:
<a href="https://github.com/neo4j/neo4j/tree/master/community/embedded-examples/src/main/java/org/neo4j/examples/socnet">socnet</a></td>
</tr></table>
</div>
<div class="sect4">
<h5 id="_simple_social_model">Simple social model</h5>
<div class="imageblock">
<div class="content">
<img src="images/socnet-model.png" alt="socnet-model.png">
</div>
<div class="title">Figure 10. Social network data model</div>
</div>
<div class="paragraph"><p>The data model for a social network is pretty simple: <span class="monospaced">Persons</span> with names and <span class="monospaced">StatusUpdates</span> with timestamped text.
These entities are then connected by specific relationships.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Person</span>
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">friend</span>: relates two distinct <span class="monospaced">Person</span> instances (no self-reference)
</p>
</li>
<li>
<p>
<span class="monospaced">status</span>: connects to the most recent <span class="monospaced">StatusUpdate</span>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<span class="monospaced">StatusUpdate</span>
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">next</span>: points to the next <span class="monospaced">StatusUpdate</span> in the chain, which was posted before the current one
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_status_graph_instance">Status graph instance</h5>
<div class="paragraph"><p>The <span class="monospaced">StatusUpdate</span> list for a <span class="monospaced">Person</span> is a linked list.
The head of the list (the most recent status) is found by following <span class="monospaced">status</span>.
Each subsequent <span class="monospaced">StatusUpdate</span> is connected by <span class="monospaced">next</span>.</p></div>
<div class="paragraph"><p>Here&#8217;s an example where Andreas Kollegger micro-blogged his way to work in the morning:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/andreas-status-updates.svg" alt="andreas-status-updates.svg">
</div>
</div>
<div class="paragraph"><p>To read the status updates, we can create a traversal, like so:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">TraversalDescription traversal = Traversal.description().
        depthFirst().
        relationships( NEXT );</pre>
</div></div>
<div class="paragraph"><p>This gives us a traverser that will start at one <span class="monospaced">StatusUpdate</span>, and will follow the chain of updates until they run out.
Traversers are lazy loading, so it&#8217;s performant even when dealing with thousands of statuses&#8201;&#8212;&#8201;they are not loaded until we actually consume them.</p></div>
</div>
<div class="sect4">
<h5 id="_activity_stream">Activity stream</h5>
<div class="paragraph"><p>Once we have friends, and they have status messages, we might want to read our friends status' messages, in reverse time order&#8201;&#8212;&#8201;latest first.
To do this, we go through these steps:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Gather all friend&#8217;s status update iterators in a list&#8201;&#8212;&#8201;latest date first.
</p>
</li>
<li>
<p>
Sort the list.
</p>
</li>
<li>
<p>
Return the first item in the list.
</p>
</li>
<li>
<p>
If the first iterator is exhausted, remove it from the list.
  Otherwise, get the next item in that iterator.
</p>
</li>
<li>
<p>
Go to step 2 until there are no iterators left in the list.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Animated, the sequence looks like <a href="http://www.slideshare.net/systay/pattern-activity-stream">this</a>.</p></div>
<div class="paragraph"><p>The code looks like:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">PositionedIterator&lt;StatusUpdate&gt; first = statuses.get(0);
StatusUpdate returnVal = first.current();

if ( !first.hasNext() )
{
    statuses.remove( 0 );
}
else
{
    first.next();
    sort();
}

return returnVal;</pre>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-entities">Domain entities</h3>
<div class="paragraph"><p>This page demonstrates one way to handle domain entities when using Neo4j.
The principle at use is to wrap the entities around a node (the same approach can be used with relationships
as well).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of the examples is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/main/java/org/neo4j/examples/socnet/Person.java">Person.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>First off, store the node and make it accessible inside the package:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private final Node underlyingNode;

Person( Node personNode )
{
    this.underlyingNode = personNode;
}

protected Node getUnderlyingNode()
{
    return underlyingNode;
}</pre>
</div></div>
<div class="paragraph"><p>Delegate attributes to the node:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public String getName()
{
    return (String)underlyingNode.getProperty( NAME );
}</pre>
</div></div>
<div class="paragraph"><p>Make sure to override these methods:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">@Override
public int hashCode()
{
    return underlyingNode.hashCode();
}

@Override
public boolean equals( Object o )
{
    return o instanceof Person &amp;&amp;
            underlyingNode.equals( ( (Person)o ).getUnderlyingNode() );
}

@Override
public String toString()
{
    return "Person[" + getName() + "]";
}</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-graph-algo">Graph Algorithm examples</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code used in the example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/test/java/org/neo4j/examples/PathFindingDocTest.java">PathFindingDocTest.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>Calculating the shortest path (least number of relationships) between two nodes:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Node startNode = graphDb.createNode();
Node middleNode1 = graphDb.createNode();
Node middleNode2 = graphDb.createNode();
Node middleNode3 = graphDb.createNode();
Node endNode = graphDb.createNode();
createRelationshipsBetween( startNode, middleNode1, endNode );
createRelationshipsBetween( startNode, middleNode2, middleNode3, endNode );

// Will find the shortest path between startNode and endNode via
// "MY_TYPE" relationships (in OUTGOING direction), like f.ex:
//
// (startNode)--&gt;(middleNode1)--&gt;(endNode)
//
PathFinder&lt;Path&gt; finder = GraphAlgoFactory.shortestPath(
        Traversal.expanderForTypes( ExampleTypes.MY_TYPE, Direction.OUTGOING ), 15 );
Iterable&lt;Path&gt; paths = finder.findAllPaths( startNode, endNode );</pre>
</div></div>
<div class="paragraph"><p>Using <a href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra&#8217;s algorithm</a> to calculate cheapest path between node A and B where each relationship can have a weight (i.e. cost) and the path(s) with least cost are found.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">PathFinder&lt;WeightedPath&gt; finder = GraphAlgoFactory.dijkstra(
        Traversal.expanderForTypes( ExampleTypes.MY_TYPE, Direction.BOTH ), "cost" );

WeightedPath path = finder.findSinglePath( nodeA, nodeB );

// Get the weight for the found path
path.weight();</pre>
</div></div>
<div class="paragraph"><p>Using <a href="http://en.wikipedia.org/wiki/A*_search_algorithm">A*</a> to calculate the cheapest path between node A and B, where cheapest is for example the path in a network of roads which has the shortest length between node A and B.
Here&#8217;s our example graph:</p></div>
<div class="imageblock">
<div class="content">
<img src="images/graphalgo-astar.png" alt="A* algorithm example graph">
</div>
</div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Node nodeA = createNode( "name", "A", "x", 0d, "y", 0d );
Node nodeB = createNode( "name", "B", "x", 7d, "y", 0d );
Node nodeC = createNode( "name", "C", "x", 2d, "y", 1d );
Relationship relAB = createRelationship( nodeA, nodeC, "length", 2d );
Relationship relBC = createRelationship( nodeC, nodeB, "length", 3d );
Relationship relAC = createRelationship( nodeA, nodeB, "length", 10d );

EstimateEvaluator&lt;Double&gt; estimateEvaluator = new EstimateEvaluator&lt;Double&gt;()
{
    public Double getCost( final Node node, final Node goal )
    {
        double dx = (Double) node.getProperty( "x" ) - (Double) goal.getProperty( "x" );
        double dy = (Double) node.getProperty( "y" ) - (Double) goal.getProperty( "y" );
        double result = Math.sqrt( Math.pow( dx, 2 ) + Math.pow( dy, 2 ) );
        return result;
    }
};
PathFinder&lt;WeightedPath&gt; astar = GraphAlgoFactory.aStar(
        Traversal.expanderForAllTypes(),
        CommonEvaluators.doubleCostEvaluator( "length" ), estimateEvaluator );
WeightedPath path = astar.findSinglePath( nodeA, nodeB );</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-jmx">Reading a management attribute</h3>
<div class="paragraph"><p>The <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/jmx/JmxUtils.html">JmxUtils</a>
class includes methods to access Neo4j management beans.
The common JMX service can be used as well, but from your code you probably rather
want to use the approach outlined here.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of the example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/test/java/org/neo4j/examples/JmxDocTest.java">JmxDocTest.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>This example shows how to get the start time of a database:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static Date getStartTimeFromManagementBean(
        GraphDatabaseService graphDbService )
{
    GraphDatabaseAPI graphDb = (GraphDatabaseAPI) graphDbService;
    ObjectName objectName = JmxUtils.getObjectName( graphDb, "Kernel" );
    Date date = JmxUtils.getAttribute( objectName, "KernelStartTime" );
    return date;
}</pre>
</div></div>
<div class="paragraph"><p>Depending on which Neo4j edition you are using different sets of management beans are available.</p></div>
<div class="ulist"><ul>
<li>
<p>
For all editions, see the
<a href="http://components.neo4j.org/neo4j-jmx/2.0-SNAPSHOT/apidocs/org/neo4j/jmx/package-summary.html">org.neo4j.jmx</a>
  package.
</p>
</li>
<li>
<p>
For the Advanced and Enterprise editions, see the
<a href="http://components.neo4j.org/neo4j-management/2.0-SNAPSHOT/apidocs/org/neo4j/management/package-summary.html">org.neo4j.management</a>
  package as well.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="tutorials-java-embedded-osgi">OSGi setup</h3>
<div class="paragraph"><p>In <a href="http://www.osgi.org/">OSGi</a>-related contexts like a number of Application Servers (e.g. <a href="http://glassfish.java.net/">Glassfish</a> )
and <a href="http://www.eclipse.org">Eclipse</a>-based systems, Neo4j can be set up explicitly rather than being discovered by the Java Service Loader
mechanism.</p></div>
<div class="sect3">
<h4 id="_simple_osgi_activator_scenario">Simple OSGi Activator scenario</h4>
<div class="paragraph"><p>As seen in the following example, instead of relying on the Classloading of the Neo4j kernel, the Neo4j bundles are treated as library bundles,
and services like the IndexProviders and CacheProviders are explicitly instantiated, configured and registered. Just make the necessary jars available
as wrapped library bundles, so all needed classes are exported and seen by the bundle containing the Activator.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public class Neo4jActivator implements BundleActivator
{

    private static GraphDatabaseService db;
    private ServiceRegistration serviceRegistration;
    private ServiceRegistration indexServiceRegistration;

    @Override
    public void start( BundleContext context ) throws Exception
    {
        //the cache providers
        ArrayList&lt;CacheProvider&gt; cacheList = new ArrayList&lt;CacheProvider&gt;();
        cacheList.add( new SoftCacheProvider() );

        //the kernel extensions
        LuceneKernelExtensionFactory lucene = new LuceneKernelExtensionFactory();
        List&lt;KernelExtensionFactory&lt;?&gt;&gt; extensions = new ArrayList&lt;KernelExtensionFactory&lt;?&gt;&gt;();
        extensions.add( lucene );

        //the database setup
        GraphDatabaseFactory gdbf = new GraphDatabaseFactory();
        gdbf.setKernelExtensions( extensions );
        gdbf.setCacheProviders( cacheList );
        db = gdbf.newEmbeddedDatabase( "target/db" );

        //the OSGi registration
        serviceRegistration = context.registerService(
                GraphDatabaseService.class.getName(), db, new Hashtable&lt;String, String&gt;() );
        System.out.println( "registered " + serviceRegistration.getReference() );
        indexServiceRegistration = context.registerService(
                Index.class.getName(), db.index().forNodes( "nodes" ),
                new Hashtable&lt;String, String&gt;() );
        Transaction tx = db.beginTx();
        try
        {
            Node firstNode = db.createNode();
            Node secondNode = db.createNode();
            Relationship relationship = firstNode.createRelationshipTo(
                    secondNode, DynamicRelationshipType.withName( "KNOWS" ) );

            firstNode.setProperty( "message", "Hello, " );
            secondNode.setProperty( "message", "world!" );
            relationship.setProperty( "message", "brave Neo4j " );
            db.index().forNodes( "nodes" ).add( firstNode, "message", "Hello" );
            tx.success();
        }
        catch ( Exception e )
        {
            e.printStackTrace();
            throw new RuntimeException( e );
        }
        finally
        {
            tx.finish();
        }

    }

    @Override
    public void stop( BundleContext context ) throws Exception
    {
        serviceRegistration.unregister();
        indexServiceRegistration.unregister();
        db.shutdown();

    }

}</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of the example above is found <a href="https://github.com/neo4j/neo4j/tree/master/community/embedded-examples/src/test/java/org/neo4j/examples/osgi/">here</a>.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tutorials-cypher-java">Execute Cypher Queries from Java</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The full source code of the example:
<a href="https://github.com/neo4j/neo4j/blob/master/community/cypher/src/test/java/org/neo4j/cypher/javacompat/JavaQuery.java">JavaQuery.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>In Java, you can use the <a href="#cypher-query-lang">Cypher query language</a> as per the example below.
First, let&#8217;s add some data.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">GraphDatabaseService db = new GraphDatabaseFactory().newEmbeddedDatabase( DB_PATH );
Transaction tx = db.beginTx();
try
{
    Node myNode = db.createNode();
    myNode.setProperty( "name", "my node" );
    tx.success();
}
finally
{
    tx.finish();
}</pre>
</div></div>
<div class="paragraph"><p>Execute a query:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">ExecutionEngine engine = new ExecutionEngine( db );
ExecutionResult result = engine.execute( "start n=node(*) where n.name! = 'my node' return n, n.name" );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Keep the <span class="monospaced">ExecutionEngine</span> around, don&#8217;t create a new one for each query!</td>
</tr></table>
</div>
<div class="paragraph"><p>The result will be:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">+-------------------------------------+
| n                       | n.name    |
+-------------------------------------+
| Node[1]{name:"my node"} | "my node" |
+-------------------------------------+
1 row</pre></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">The classes used here are from the <span class="monospaced">org.neo4j.cypher.javacompat</span> package, <em>not</em> <span class="monospaced">org.neo4j.cypher</span>, see link to the Java API below.</td>
</tr></table>
</div>
<div class="paragraph"><p>You can get a list of the columns in the result:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">List&lt;String&gt; columns = result.columns();</pre>
</div></div>
<div class="paragraph"><p>This contains:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">[n, n.name]</pre></div>
<div class="paragraph"><p>To fetch the result items from a single column, do like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Iterator&lt;Node&gt; n_column = result.columnAs( "n" );
for ( Node node : IteratorUtil.asIterable( n_column ) )
{
    // note: we're grabbing the name property from the node,
    // not from the n.name in this case.
    nodeResult = node + ": " + node.getProperty( "name" );
}</pre>
</div></div>
<div class="paragraph"><p>In this case there&#8217;s only one node in the result:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Node[1]: my node</pre></div>
<div class="paragraph"><p>To get all columns, do like this instead:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Map&lt;String, Object&gt; row : result )
{
    for ( Entry&lt;String, Object&gt; column : row.entrySet() )
    {
        rows += column.getKey() + ": " + column.getValue() + "; ";
    }
    rows += "\n";
}</pre>
</div></div>
<div class="paragraph"><p>This outputs:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">n.name: my node; n: Node[1];</pre></div>
<div class="paragraph"><p>For more information on the Java interface to Cypher, see the
<a href="http://components.neo4j.org/neo4j-cypher/2.0-SNAPSHOT/apidocs/index.html">Java API</a>.</p></div>
<div class="paragraph"><p>For more information and examples for Cypher, see <a href="#cypher-query-lang">[cypher-query-lang]</a> and <a href="#data-modeling-examples">[data-modeling-examples]</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorials-rest">Neo4j Remote Client Libraries</h2>
<div class="sectionbody">
<div class="paragraph"><p>The included Java example shows a &#8220;low-level&#8221; approach to using the Neo4j REST API from Java.
For other options, see below.</p></div>
<div class="paragraph" id="rest-clients"><div class="title">Neo4j REST clients contributed by the community.</div><p>Please see <a href="http://www.neo4j.org/drivers">http://www.neo4j.org/drivers</a> for the current set of REST clients!</p></div>
<div class="sect2">
<h3 id="server-java-rest-client-example">How to use the REST API from Java</h3>
<div class="sect3">
<h4 id="_creating_a_graph_through_the_rest_api_from_java">Creating a graph through the REST API from Java</h4>
<div class="paragraph"><p>The REST API uses HTTP and JSON, so that it can be used from many languages and platforms.
Still, when geting started it&#8217;s useful to see some patterns that can be re-used.
In this brief overview, we&#8217;ll show you how to create and manipulate a simple graph through the REST API and also how to query it.</p></div>
<div class="paragraph"><p>For these examples, we&#8217;ve chosen the <a href="http://jersey.java.net/">Jersey</a> client components,
which are easily <a href="http://jersey.java.net/nonav/documentation/latest/user-guide.html#chapter_deps">downloaded</a> via Maven.</p></div>
</div>
<div class="sect3">
<h4 id="_start_the_server">Start the server</h4>
<div class="paragraph"><p>Before we can perform any actions on the server, we need to start it as per <a href="#server-installation">[server-installation]</a>.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">WebResource resource = Client.create()
        .resource( SERVER_ROOT_URI );
ClientResponse response = resource.get( ClientResponse.class );

System.out.println( String.format( "GET on [%s], status code [%d]",
        SERVER_ROOT_URI, response.getStatus() ) );
response.close();</pre>
</div></div>
<div class="paragraph"><p>If the status of the response is <span class="monospaced">200 OK</span>, then we know the server is running fine and we can continue.
If the code fails to conenct to the server, then please have a look at <a href="#server">[server]</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you get any other response than <span class="monospaced">200 OK</span> (particularly <span class="monospaced">4xx</span> or <span class="monospaced">5xx</span> responses) then please check your configuration and look in the log files in the <em>data/log</em> directory.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_node">Creating a node</h4>
<div class="paragraph"><p>The REST API uses <span class="monospaced">POST</span> to create nodes.
Encapsulating that in Java is straightforward using the Jersey client:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">final String nodeEntryPointUri = SERVER_ROOT_URI + "node";
// http://localhost:7474/db/data/node

WebResource resource = Client.create()
        .resource( nodeEntryPointUri );
// POST {} to the node entry point URI
ClientResponse response = resource.accept( MediaType.APPLICATION_JSON )
        .type( MediaType.APPLICATION_JSON )
        .entity( "{}" )
        .post( ClientResponse.class );

final URI location = response.getLocation();
System.out.println( String.format(
        "POST to [%s], status code [%d], location header [%s]",
        nodeEntryPointUri, response.getStatus(), location.toString() ) );
response.close();

return location;</pre>
</div></div>
<div class="paragraph"><p>If the call completes successfully, under the covers it will have sent a HTTP request containing a JSON payload to the server.
The server will then have created a new node in the database and responded with a <span class="monospaced">201 Created</span> response and a <span class="monospaced">Location</span> header with the URI of the newly created node.</p></div>
<div class="paragraph"><p>In our example, we call this functionality twice to create two nodes in our database.</p></div>
</div>
<div class="sect3">
<h4 id="_adding_properties">Adding properties</h4>
<div class="paragraph"><p>Once we have nodes in our datatabase, we can use them to store useful data.
In this case, we&#8217;re going to store information about music in our database.
Let&#8217;s start by looking at the code that we use to create nodes and add properties.
Here we&#8217;ve added nodes to represent "Joe Strummer" and a band called "The Clash".</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">URI firstNode = createNode();
addProperty( firstNode, "name", "Joe Strummer" );
URI secondNode = createNode();
addProperty( secondNode, "band", "The Clash" );</pre>
</div></div>
<div class="paragraph"><p>Inside the <span class="monospaced">addProperty</span> method we determine the resource that represents properties for the node and decide on a name for that property.
We then proceed to <span class="monospaced">PUT</span> the value of that property to the server.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">String propertyUri = nodeUri.toString() + "/properties/" + propertyName;
// http://localhost:7474/db/data/node/{node_id}/properties/{property_name}

WebResource resource = Client.create()
        .resource( propertyUri );
ClientResponse response = resource.accept( MediaType.APPLICATION_JSON )
        .type( MediaType.APPLICATION_JSON )
        .entity( "\"" + propertyValue + "\"" )
        .put( ClientResponse.class );

System.out.println( String.format( "PUT to [%s], status code [%d]",
        propertyUri, response.getStatus() ) );
response.close();</pre>
</div></div>
<div class="paragraph"><p>If everything goes well, we&#8217;ll get a <span class="monospaced">204 No Content</span> back indicating that the server processed the request but didn&#8217;t echo back the property value.</p></div>
</div>
<div class="sect3">
<h4 id="_adding_relationships">Adding relationships</h4>
<div class="paragraph"><p>Now that we have nodes to represent Joe Strummer and The Clash, we can relate them.
The REST API supports this through a <span class="monospaced">POST</span> of a relationship representation to the start node of the relationship.
Correspondingly in Java we <span class="monospaced">POST</span> some JSON to the URI of our node that represents Joe Strummer,
to establish a relationship between that node and the node representing The Clash.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">URI relationshipUri = addRelationship( firstNode, secondNode, "singer",
        "{ \"from\" : \"1976\", \"until\" : \"1986\" }" );</pre>
</div></div>
<div class="paragraph"><p>Inside the <span class="monospaced">addRelationship</span> method, we determine the URI of the Joe Strummer node&#8217;s relationships, and then <span class="monospaced">POST</span> a JSON description of our intended relationship.
This description contains the destination node, a label for the relationship type, and any attributes for the relation as a
JSON collection.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static URI addRelationship( URI startNode, URI endNode,
        String relationshipType, String jsonAttributes )
        throws URISyntaxException
{
    URI fromUri = new URI( startNode.toString() + "/relationships" );
    String relationshipJson = generateJsonRelationship( endNode,
            relationshipType, jsonAttributes );

    WebResource resource = Client.create()
            .resource( fromUri );
    // POST JSON to the relationships URI
    ClientResponse response = resource.accept( MediaType.APPLICATION_JSON )
            .type( MediaType.APPLICATION_JSON )
            .entity( relationshipJson )
            .post( ClientResponse.class );

    final URI location = response.getLocation();
    System.out.println( String.format(
            "POST to [%s], status code [%d], location header [%s]",
            fromUri, response.getStatus(), location.toString() ) );

    response.close();
    return location;
}</pre>
</div></div>
<div class="paragraph"><p>If all goes well, we receive a <span class="monospaced">201 Created</span> status code and a <span class="monospaced">Location</span> header which contains a URI of the newly created relation.</p></div>
</div>
<div class="sect3">
<h4 id="_add_properties_to_a_relationship">Add properties to a relationship</h4>
<div class="paragraph"><p>Like nodes, relationships can have properties.
Since we&#8217;re big fans of both Joe Strummer and the Clash, we&#8217;ll add a rating to the relationship so that others can see he&#8217;s a 5-star singer with the band.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">addMetadataToProperty( relationshipUri, "stars", "5" );</pre>
</div></div>
<div class="paragraph"><p>Inside the <span class="monospaced">addMetadataToProperty</span> method, we determine the URI of the properties of the relationship and <span class="monospaced">PUT</span> our new values (since it&#8217;s <span class="monospaced">PUT</span> it will always overwrite existing values, so be careful).</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static void addMetadataToProperty( URI relationshipUri,
        String name, String value ) throws URISyntaxException
{
    URI propertyUri = new URI( relationshipUri.toString() + "/properties" );
    String entity = toJsonNameValuePairCollection( name, value );
    WebResource resource = Client.create()
            .resource( propertyUri );
    ClientResponse response = resource.accept( MediaType.APPLICATION_JSON )
            .type( MediaType.APPLICATION_JSON )
            .entity( entity )
            .put( ClientResponse.class );

    System.out.println( String.format(
            "PUT [%s] to [%s], status code [%d]", entity, propertyUri,
            response.getStatus() ) );
    response.close();
}</pre>
</div></div>
<div class="paragraph"><p>Assuming all goes well, we&#8217;ll get a <span class="monospaced">204 OK</span> response back from the server (which we can check by calling
<span class="monospaced">ClientResponse.getStatus()</span>) and we&#8217;ve now established a very small graph that we can query.</p></div>
</div>
<div class="sect3">
<h4 id="_querying_graphs">Querying graphs</h4>
<div class="paragraph"><p>As with the embedded version of the database, the Neo4j server uses graph traversals to look for data in graphs.
Currently the Neo4j server expects a JSON payload describing the traversal to be <span class="monospaced">POST</span>-ed at the starting node for the traversal (though this is <em>likely to change</em> in time to a <span class="monospaced">GET</span>-based approach).</p></div>
<div class="paragraph"><p>To start this process, we use a simple class that can turn itself into the equivalent JSON, ready for <span class="monospaced">POST</span>-ing to the server, and in this case we&#8217;ve hardcoded the traverser to look for all nodes with outgoing relationships with the type <span class="monospaced">"singer"</span>.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// TraversalDefinition turns into JSON to send to the Server
TraversalDefinition t = new TraversalDefinition();
t.setOrder( TraversalDefinition.DEPTH_FIRST );
t.setUniqueness( TraversalDefinition.NODE );
t.setMaxDepth( 10 );
t.setReturnFilter( TraversalDefinition.ALL );
t.setRelationships( new Relation( "singer", Relation.OUT ) );</pre>
</div></div>
<div class="paragraph"><p>Once we have defined the parameters of our traversal, we just need to transfer it.
We do this by determining the URI of the traversers for the start node, and then <span class="monospaced">POST</span>-ing the JSON representation
of the traverser to it.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">URI traverserUri = new URI( startNode.toString() + "/traverse/node" );
WebResource resource = Client.create()
        .resource( traverserUri );
String jsonTraverserPayload = t.toJson();
ClientResponse response = resource.accept( MediaType.APPLICATION_JSON )
        .type( MediaType.APPLICATION_JSON )
        .entity( jsonTraverserPayload )
        .post( ClientResponse.class );

System.out.println( String.format(
        "POST [%s] to [%s], status code [%d], returned data: "
                + System.getProperty( "line.separator" ) + "%s",
        jsonTraverserPayload, traverserUri, response.getStatus(),
        response.getEntity( String.class ) ) );
response.close();</pre>
</div></div>
<div class="paragraph"><p>Once that request has completed, we get back our dataset of singers and the bands they belong to:</p></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/82/relationships/out",
  "data" : {
    "band" : "The Clash",
    "name" : "Joe Strummer"
  },
  "traverse" : "http://localhost:7474/db/data/node/82/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/82/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/82/properties/{key}",
  "all_relationships" : "http://localhost:7474/db/data/node/82/relationships/all",
  "self" : "http://localhost:7474/db/data/node/82",
  "properties" : "http://localhost:7474/db/data/node/82/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/82/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/82/relationships/in",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/82/relationships/in/{-list|&amp;|types}",
  "create_relationship" : "http://localhost:7474/db/data/node/82/relationships"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/83/relationships/out",
  "data" : {
  },
  "traverse" : "http://localhost:7474/db/data/node/83/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/83/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/83/properties/{key}",
  "all_relationships" : "http://localhost:7474/db/data/node/83/relationships/all",
  "self" : "http://localhost:7474/db/data/node/83",
  "properties" : "http://localhost:7474/db/data/node/83/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/83/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/83/relationships/in",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/83/relationships/in/{-list|&amp;|types}",
  "create_relationship" : "http://localhost:7474/db/data/node/83/relationships"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="_phew_is_that_it">Phew, is that it?</h4>
<div class="paragraph"><p>That&#8217;s a flavor of what we can do with the REST API.
Naturally any of the HTTP idioms we provide on the server can be easily wrapped, including removing nodes and relationships through <span class="monospaced">DELETE</span>.
Still if you&#8217;ve gotten this far, then switching <span class="monospaced">.post()</span> for <span class="monospaced">.delete()</span> in the Jersey client code should be straightforward.</p></div>
</div>
<div class="sect3">
<h4 id="_what_8217_s_next">What&#8217;s next?</h4>
<div class="paragraph"><p>The HTTP API provides a good basis for implementers of client libraries, it&#8217;s also great for HTTP and REST folks.
In the future though we expect that idiomatic language bindings will appear to take advantage of the REST API while providing comfortable language-level constructs for developers to use, much as there are similar bindings for the embedded database.</p></div>
</div>
<div class="sect3">
<h4 id="_appendix_the_code">Appendix: the code</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/CreateSimpleGraph.java">CreateSimpleGraph.java</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/Relation.java">Relation.java</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/TraversalDefinition.java">TraversalDefinition.java</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial-traversal">The Traversal Framework</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/package-summary.html">Neo4j Traversal API</a> is a callback based, lazily executed way of specifying desired movements through a graph in Java.
Some traversal examples are collected under <a href="#tutorials-java-embedded-traversal">[tutorials-java-embedded-traversal]</a>.</p></div>
<div class="paragraph"><p>You can also use <a href="#cypher-query-lang">The Cypher Query Language</a> as a powerful declarative way to query the graph.</p></div>
<div class="sect2">
<h3 id="tutorial-traversal-concepts">Main concepts</h3>
<div class="paragraph"><p>Here follows a short explanation of all different methods that can modify or add to a traversal description.</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>Expanders</em>&#8201;&#8212;&#8201;define what to traverse, typically in terms of relationship direction and type.
</p>
</li>
<li>
<p>
<em>Order</em>&#8201;&#8212;&#8201;for example depth-first or breadth-first.
</p>
</li>
<li>
<p>
<em>Uniqueness</em>&#8201;&#8212;&#8201;visit nodes (relationships, paths) only once.
</p>
</li>
<li>
<p>
<em>Evaluator</em>&#8201;&#8212;&#8201;decide what to return and whether to stop or continue traversal beyond the current position.
</p>
</li>
<li>
<p>
<em>Starting nodes</em> where the traversal will begin.
</p>
</li>
</ul></div>
<div class="imageblock dot">
<div class="content">
<img src="images/graphdb-traversal-description.svg" alt="graphdb-traversal-description.svg">
</div>
</div>
<div class="paragraph"><p>See <a href="#tutorial-traversal-java-api">[tutorial-traversal-java-api]</a> for more details.</p></div>
</div>
<div class="sect2">
<h3 id="tutorial-traversal-java-api">Traversal Framework Java API</h3>
<div class="paragraph"><p>The traversal framework consists of a few main interfaces in addition to <span class="monospaced">Node</span> and <span class="monospaced">Relationship</span>: <span class="monospaced">TraversalDescription</span>, <span class="monospaced">Evaluator</span>, <span class="monospaced">Traverser</span> and <span class="monospaced">Uniqueness</span> are the main ones.
The <span class="monospaced">Path</span> interface also has a special purpose in traversals, since it is used to represent a position in the graph when evaluating that position.
Furthermore the <span class="monospaced">PathExpander</span> (replacing <span class="monospaced">RelationshipExpander</span>) and <span class="monospaced">Expander</span> interfaces are central to traversals, but users of the API rarely need to implement them.
There are also a set of interfaces for advanced use, when explicit control over the traversal order is required: <span class="monospaced">BranchSelector</span>, <span class="monospaced">BranchOrderingPolicy</span> and <span class="monospaced">TraversalBranch</span>.</p></div>
<div class="sect3">
<h4 id="_traversaldescription">TraversalDescription</h4>
<div class="paragraph"><p>The <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html"><span class="monospaced">TraversalDescription</span></a> is the main interface used for defining and initializing traversals.
It is not meant to be implemented by users of the traversal framework, but rather to be provided by the implementation of the traversal framework as a way for the user to describe traversals.
<span class="monospaced">TraversalDescription</span> instances are immutable and its methods returns a new <span class="monospaced">TraversalDescription</span> that is modified compared to the object the method was invoked on with the arguments of the method.</p></div>
<div class="sect4">
<h5 id="_relationships">Relationships</h5>
<div class="paragraph"><p>Adds a relationship type to the list of relationship types to traverse.
By default that list is empty and it means that it will traverse <em>all relationships</em>, irregardless of type.
If one or more relationships are added to this list <em>only the added</em> types will be traversed.
There are two methods, one <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#relationships">including direction</a> and another one <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#relationships">excluding direction</a>, where the latter traverses relationships in <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Direction.html#BOTH">both directions</a>.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_evaluator">Evaluator</h4>
<div class="paragraph"><p><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/Evaluator.html"><span class="monospaced">Evaluator</span></a>s are used for deciding, at each position (represented as a <span class="monospaced">Path</span>): should the traversal continue, and/or should the node be included in the result.
Given a <span class="monospaced">Path</span>, it asks for one of four actions for that branch of the traversal:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Evaluation.INCLUDE_AND_CONTINUE</span>: Include this node in the result and continue the traversal
</p>
</li>
<li>
<p>
<span class="monospaced">Evaluation.INCLUDE_AND_PRUNE</span>: Include this node in the result, but don&#8217;t continue the traversal
</p>
</li>
<li>
<p>
<span class="monospaced">Evaluation.EXCLUDE_AND_CONTINUE</span>: Exclude this node from the result, but continue the traversal
</p>
</li>
<li>
<p>
<span class="monospaced">Evaluation.EXCLUDE_AND_PRUNE</span>: Exclude this node from the result and don&#8217;t continue the traversal
</p>
</li>
</ul></div>
<div class="paragraph"><p>More than one evaluator can be added. Note that evaluators will be called for all positions the traverser encounters, even for the start node.</p></div>
</div>
<div class="sect3">
<h4 id="_traverser">Traverser</h4>
<div class="paragraph"><p>The <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/Traverser.html"><span class="monospaced">Traverser</span></a> object is the result of invoking <a href="http://components.neo4j.org/neo4j-kernel/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#traverse(org.neo4j.graphdb.Node)"><span class="monospaced">traverse()</span></a> of a TraversalDescription object.
It represents a traversal positioned in the graph, and a specification of the format of the result.
The actual traversal is performed lazily each time the <span class="monospaced">next()</span>-method of the iterator of the <span class="monospaced">Traverser</span> is invoked.</p></div>
</div>
<div class="sect3">
<h4 id="_uniqueness">Uniqueness</h4>
<div class="paragraph"><p>Sets the rules for how positions can be revisited during a traversal as stated in <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/Uniqueness.html"><span class="monospaced">Uniqueness</span></a>.
Default if not set is <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/Uniqueness.html#NODE_GLOBAL"><span class="monospaced">NODE_GLOBAL</span></a>.</p></div>
<div class="paragraph"><p>A Uniqueness can be supplied to the TraversalDescription to dictate under what circumstances a traversal may revisit the same position in the graph. The various uniqueness levels that can be used in Neo4j are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">NONE</span>: Any position in the graph may be revisited.
</p>
</li>
<li>
<p>
<span class="monospaced">NODE_GLOBAL</span> uniqueness: No node in the entire graph may be visited more than once. This could potentially consume a lot of memory since it requires keeping an in-memory data structure remembering all the visited nodes.
</p>
</li>
<li>
<p>
<span class="monospaced">RELATIONSHIP_GLOBAL</span> uniqueness: no relationship in the entire graph may be visited more than once. For the same reasons as <span class="monospaced">NODE_GLOBAL</span> uniqueness, this could use up a lot of memory. But since graphs typically have a larger number of relationships than nodes, the memory overhead of this uniqueness level could grow even quicker.
</p>
</li>
<li>
<p>
<span class="monospaced">NODE_PATH</span> uniqueness: A node may not occur previously in the path reaching up to it.
</p>
</li>
<li>
<p>
<span class="monospaced">RELATIONSHIP_PATH</span> uniqueness: A relationship may not occur previously in the path reaching up to it.
</p>
</li>
<li>
<p>
<span class="monospaced">NODE_RECENT</span> uniqueness: Similar to <span class="monospaced">NODE_GLOBAL</span> uniqueness in that there is a global collection of visited nodes each position is checked against. This uniqueness level does however have a cap on how much memory it may consume in the form of a collection that only contains the most recently visited nodes. The size of this collection can be specified by providing a number as the second argument to the TraversalDescription.uniqueness()-method along with the uniqueness level.
</p>
</li>
<li>
<p>
<span class="monospaced">RELATIONSHIP_RECENT</span> uniqueness: Works like <span class="monospaced">NODE_RECENT</span> uniqueness, but with relationships instead of nodes.
</p>
</li>
</ul></div>
<div class="sect4">
<h5 id="_depth_first_breadth_first">Depth First / Breadth First</h5>
<div class="paragraph"><p>These are convenience methods for setting preorder <a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a>/ <a href="http://en.wikipedia.org/wiki/Breadth-first_search">breadth-first</a> <span class="monospaced">BranchSelector</span>|<span class="monospaced">ordering</span> policies.
The same result can be achieved by calling the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#order"><span class="monospaced">order</span></a> method with ordering policies from the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/Traversal.html#preorderDepthFirst"><span class="monospaced">Traversal</span></a> <a href="http://components.neo4j.org/neo4j-kernel/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/Traversal.html#preorderBreadthFirst"><span class="monospaced">factory</span></a>, or to write your own <span class="monospaced">BranchSelector</span>/<span class="monospaced">BranchOrderingPolicy</span> and pass in.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_order_8201_8212_8201_how_to_move_through_branches">Order&#8201;&#8212;&#8201;How to move through branches?</h4>
<div class="paragraph"><p>A more generic version of depthFirst/breadthFirst methods in that it allows an arbitrary <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/BranchOrderingPolicy.html"><span class="monospaced">BranchOrderingPolicy</span></a> to be injected into the description.</p></div>
</div>
<div class="sect3">
<h4 id="_branchselector">BranchSelector</h4>
<div class="paragraph"><p>A BranchSelector is used for selecting which branch of the traversal to attempt next. This is used for implementing traversal orderings. The traversal framework provides a few basic ordering implementations:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Traversal.preorderDepthFirst()</span>: Traversing depth first, visiting each node before visiting its child nodes.
</p>
</li>
<li>
<p>
<span class="monospaced">Traversal.postorderDepthFirst()</span>: Traversing depth first, visiting each node after visiting its child nodes.
</p>
</li>
<li>
<p>
<span class="monospaced">Traversal.preorderBreadthFirst()</span>: Traversing breadth first, visiting each node before visiting its child nodes.
</p>
</li>
<li>
<p>
<span class="monospaced">Traversal.postorderBreadthFirst()</span>: Traversing breadth first, visiting each node after visiting its child nodes.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Please note that breadth first traversals have a higher memory overhead than depth first traversals.</td>
</tr></table>
</div>
<div class="paragraph"><p>BranchSelectors carries state and hence needs to be uniquely instantiated for each traversal. Therefore it is supplied to the TraversalDescription through a BranchOrderingPolicy interface, which is a factory of BranchSelector instances.</p></div>
<div class="paragraph"><p>A user of the Traversal framework rarely needs to implement his own BranchSelector or BranchOrderingPolicy, it is provided to let graph algorithm implementors provide their own traversal orders. The Neo4j Graph Algorithms package contains for example a BestFirst order BranchSelector/BranchOrderingPolicy that is used in BestFirst search algorithms such as A* and Dijkstra.</p></div>
<div class="sect4">
<h5 id="_branchorderingpolicy">BranchOrderingPolicy</h5>
<div class="paragraph"><p>A factory for creating BranchSelectors to decide in what order branches are returned (where a branch&#8217;s position is represented as a <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Path.html"><span class="monospaced">Path</span></a> from the start node to the current node). Common policies are <a href="http://components.neo4j.org/neo4j-kernel/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#depthFirst()"><span class="monospaced">depth-first</span></a> and <a href="http://components.neo4j.org/neo4j-kernel/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#breadthFirst()"><span class="monospaced">breadth-first</span></a> and that&#8217;s why there are convenience methods for those.
For example, calling <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html#depthFirst()"><span class="monospaced">TraversalDescription#depthFirst()</span></a> is equivalent to:</p></div>
<div class="listingblock">
<pre class="programlisting brush: java">description.order( Traversal.preorderDepthFirst() );</pre></div>
</div>
<div class="sect4">
<h5 id="_traversalbranch">TraversalBranch</h5>
<div class="paragraph"><p>An object used by the BranchSelector to get more branches from a certain branch. In essence these are a composite of a Path and a RelationshipExpander that can be used to get new <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalBranch.html"><span class="monospaced">TraversalBranch</span></a>es from the current one.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_path">Path</h4>
<div class="paragraph"><p>A <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Path.html"><span class="monospaced">Path</span></a> is a general interface that is part of the Neo4j API.
In the traversal API of Neo4j the use of Paths are twofold.
Traversers can return their results in the form of the Paths of the visited positions in the graph that are marked for being returned.
Path objects are also used in the evaluation of positions in the graph, for determining if the traversal should continue from a certain point or not, and whether a certain position should be included in the result set or not.</p></div>
</div>
<div class="sect3">
<h4 id="_pathexpander_relationshipexpander">PathExpander/RelationshipExpander</h4>
<div class="paragraph"><p>The traversal framework use PathExpanders (replacing RelationshipExpander) to discover the relationships that should be followed from a particular path to further branches in the traversal.</p></div>
</div>
<div class="sect3">
<h4 id="_expander">Expander</h4>
<div class="paragraph"><p>A more generic version of relationships where a <span class="monospaced">RelationshipExpander</span> is injected, defining all relationships to be traversed for any given node. By default (and when using relationships) a <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/Traversal.html#emptyExpander">default expander</a> is used, where any particular order of relationships isn&#8217;t guaranteed.
There&#8217;s another implementation which guarantees that relationships are traversed in <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/OrderedByTypeExpander.html">order of relationship type</a>, where types are iterated in the order they were added.</p></div>
<div class="paragraph"><p>The <span class="monospaced">Expander</span> interface is an extension of the <span class="monospaced">RelationshipExpander</span> interface that makes it possible to build customized versions of an <span class="monospaced">Expander</span>.
The implementation of <span class="monospaced">TraversalDescription</span> uses this to provide methods for defining which relationship types to traverse, this is the usual way a user of the API would define a <span class="monospaced">RelationshipExpander</span>&#8201;&#8212;&#8201;by building it internally in the <span class="monospaced">TraversalDescription</span>.</p></div>
<div class="paragraph"><p>All the RelationshipExpanders provided by the Neo4j traversal framework also implement the Expander interface.
For a user of the traversal API it is easier to implement the PathExpander/RelationshipExpander interface, since it only contains one method&#8201;&#8212;&#8201;the method for getting the relationships from a path/node, the methods that the Expander interface adds are just for building new Expanders.</p></div>
</div>
<div class="sect3">
<h4 id="examples-how-to-use-the-traversal-framework">How to use the Traversal framework</h4>
<div class="paragraph"><p>A
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html">traversal description</a> is built using a
fluent interface and such a description can then spawn
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/Traverser.html">traversers</a>.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Traversal-Example-Graph-how-to-use-the-Traversal-framework.svg" alt="Traversal-Example-Graph-how-to-use-the-Traversal-framework.svg">
</div>
<div class="title">Figure 11. Traversal Example Graph</div>
</div>
<div class="paragraph"><p>With the definition of the <span class="monospaced">RelationshipTypes</span> as</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private enum Rels implements RelationshipType
{
    LIKES, KNOWS
}</pre>
</div></div>
<div class="paragraph"><p>The graph can be traversed with for example the following traverser, starting at the &#8220;Joe&#8221; node:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Path position : Traversal.description()
        .depthFirst()
        .relationships( Rels.KNOWS )
        .relationships( Rels.LIKES, Direction.INCOMING )
        .evaluator( Evaluators.toDepth( 5 ) )
        .traverse( node ) )
{
    output += position + "\n";
}</pre>
</div></div>
<div class="paragraph"><p>The traversal will output:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">(7)
(7)&lt;--[LIKES,1]--(4)
(7)&lt;--[LIKES,1]--(4)--[KNOWS,6]--&gt;(1)
(7)&lt;--[LIKES,1]--(4)--[KNOWS,6]--&gt;(1)--[KNOWS,4]--&gt;(6)
(7)&lt;--[LIKES,1]--(4)--[KNOWS,6]--&gt;(1)--[KNOWS,4]--&gt;(6)--[KNOWS,3]--&gt;(5)
(7)&lt;--[LIKES,1]--(4)--[KNOWS,6]--&gt;(1)--[KNOWS,4]--&gt;(6)--[KNOWS,3]--&gt;(5)--[KNOWS,2]--&gt;(2)
(7)&lt;--[LIKES,1]--(4)--[KNOWS,6]--&gt;(1)&lt;--[KNOWS,5]--(3)</pre></div>
<div class="paragraph"><p>Since <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/TraversalDescription.html"><span class="monospaced">TraversalDescription</span></a>s
are immutable it is also useful to create template descriptions which holds common
settings shared by different traversals. For example, let&#8217;s start with this traverser:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">final TraversalDescription FRIENDS_TRAVERSAL = Traversal.description()
        .depthFirst()
        .relationships( Rels.KNOWS )
        .uniqueness( Uniqueness.RELATIONSHIP_GLOBAL );</pre>
</div></div>
<div class="paragraph"><p>This traverser would yield the following output (we will keep starting from the &#8220;Joe&#8221; node):</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">(7)
(7)--[KNOWS,0]--&gt;(2)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)&lt;--[KNOWS,3]--(6)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)&lt;--[KNOWS,3]--(6)&lt;--[KNOWS,4]--(1)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)&lt;--[KNOWS,3]--(6)&lt;--[KNOWS,4]--(1)&lt;--[KNOWS,5]--(3)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)&lt;--[KNOWS,3]--(6)&lt;--[KNOWS,4]--(1)&lt;--[KNOWS,6]--(4)</pre></div>
<div class="paragraph"><p>Now let&#8217;s create a new traverser from it, restricting depth to three:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Path path : FRIENDS_TRAVERSAL
        .evaluator( Evaluators.toDepth( 3 ) )
        .traverse( node ) )
{
    output += path + "\n";
}</pre>
</div></div>
<div class="paragraph"><p>This will give us the following result:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">(7)
(7)--[KNOWS,0]--&gt;(2)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)&lt;--[KNOWS,3]--(6)</pre></div>
<div class="paragraph"><p>Or how about from depth two to four?
That&#8217;s done like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Path path : FRIENDS_TRAVERSAL
        .evaluator( Evaluators.fromDepth( 2 ) )
        .evaluator( Evaluators.toDepth( 4 ) )
        .traverse( node ) )
{
    output += path + "\n";
}</pre>
</div></div>
<div class="paragraph"><p>This traversal gives us:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)&lt;--[KNOWS,3]--(6)
(7)--[KNOWS,0]--&gt;(2)&lt;--[KNOWS,2]--(5)&lt;--[KNOWS,3]--(6)&lt;--[KNOWS,4]--(1)</pre></div>
<div class="paragraph"><p>For various useful evaluators, see the
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/Evaluators.html">Evaluators</a> Java API
or simply implement the
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/Evaluator.html">Evaluator</a> interface yourself.</p></div>
<div class="paragraph"><p>If you&#8217;re not interested in the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Path.html"><span class="monospaced">Path</span></a>s,
but the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Node.html"><span class="monospaced">Node</span></a>s
you can transform the traverser into an iterable of <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/Traverser.html#nodes()">nodes</a>
like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Node currentNode : FRIENDS_TRAVERSAL
        .traverse( node )
        .nodes() )
{
    output += currentNode.getProperty( "name" ) + "\n";
}</pre>
</div></div>
<div class="paragraph"><p>In this case we use it to retrieve the names:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Joe
Sara
Peter
Dirk
Lars
Ed
Lisa</pre></div>
<div class="paragraph"><p><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/traversal/Traverser.html#relationships()">Relationships</a>
are fine as well, here&#8217;s how to get them:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Relationship relationship : FRIENDS_TRAVERSAL
        .traverse( node )
        .relationships() )
{
    output += relationship.getType() + "\n";
}</pre>
</div></div>
<div class="paragraph"><p>Here the relationship types are written, and we get:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">KNOWS
KNOWS
KNOWS
KNOWS
KNOWS
KNOWS</pre></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code for the traversers in this example is available at:
<a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/main/java/org/neo4j/examples/TraversalExample.java">TraversalExample.java</a></td>
</tr></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-modeling-examples">Data Modeling Examples</h2>
<div class="sectionbody">
<div class="paragraph"><p>The following chapters contain simplified examples of how different domains can be modeled using Neo4j.
The aim is not to give full examples, but to suggest possible ways to think using nodes, relationships, graph patterns and data locality in traversals.</p></div>
<div class="paragraph"><p>The examples use Cypher queries a lot, read <a href="#cypher-query-lang">[cypher-query-lang]</a> for more information.</p></div>
<div class="sect2">
<h3 id="examples-user-roles-in-graphs">User roles in graphs</h3>
<div class="paragraph"><p>This is an example showing a hierarchy of
roles.
What&#8217;s interesting is that a tree is not sufficient for storing this kind of structure,
as elaborated below.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/roles.png" alt="roles.png">
</div>
</div>
<div class="paragraph"><p>This is an implementation of an example found in the article
<a href="http://www.codeproject.com/Articles/22824/A-Model-to-Represent-Directed-Acyclic-Graphs-DAG-o">A Model to Represent Directed Acyclic Graphs (DAG) on SQL Databases</a>
by <a href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=274518">Kemal Erdogan</a>.
The article discusses how to store <a href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">
directed acyclic graphs</a> (DAGs)
in SQL based DBs. DAGs are almost trees, but with a twist: it may be possible to reach
the same node through different paths. Trees are restricted from this possibility, which
makes them much easier to handle. In our case it is &#8220;Ali&#8221; and &#8220;Engin&#8221;,
as they are both admins and users and thus reachable through these group nodes.
Reality often looks this way and can&#8217;t be captured by tree structures.</p></div>
<div class="paragraph"><p>In the article an SQL Stored Procedure solution is provided. The main idea,
that also have some support from scientists, is to pre-calculate all possible (transitive) paths.
Pros and cons of this approach:</p></div>
<div class="ulist"><ul>
<li>
<p>
decent performance on read
</p>
</li>
<li>
<p>
low performance on insert
</p>
</li>
<li>
<p>
wastes <em>lots</em> of space
</p>
</li>
<li>
<p>
relies on stored procedures
</p>
</li>
</ul></div>
<div class="paragraph"><p>In Neo4j storing the roles is trivial. In this case we use <span class="monospaced">PART_OF</span> (green edges) relationships
to model the group hierarchy and <span class="monospaced">MEMBER_OF</span> (blue edges) to model membership in groups.
We also connect the top level groups to the reference node by <span class="monospaced">ROOT</span> relationships.
This gives us a useful partitioning of the graph. Neo4j has no predefined relationship
types, you are free to create any relationship types and give them the semantics you want.</p></div>
<div class="paragraph"><p>Lets now have a look at how to retrieve information from the graph. The Java code is using
the Neo4j Traversal API (see <a href="#tutorial-traversal-java-api">[tutorial-traversal-java-api]</a>), the queries are done using <a href="#cypher-query-lang">Cypher</a>.</p></div>
<div class="sect3">
<h4 id="_get_the_admins">Get the admins</h4>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Node admins = getNodeByName( "Admins" );
TraversalDescription traversalDescription = Traversal.description()
        .breadthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.PART_OF, Direction.INCOMING )
        .relationships( RoleRels.MEMBER_OF, Direction.INCOMING );
Traverser traverser = traversalDescription.traverse( admins );</pre>
</div></div>
<div class="paragraph"><p>resulting in the output</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Found: HelpDesk at depth: 0
Found: Ali at depth: 0
Found: Engin at depth: 1
Found: Demet at depth: 1</pre></div>
<div class="paragraph"><p>The result is collected from the traverser using this code:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">String output = "";
for ( Path path : traverser )
{
    Node node = path.endNode();
    output += "Found: " + node.getProperty( NAME ) + " at depth: "
              + ( path.length() - 1 ) + "\n";
}</pre>
</div></div>
<div class="paragraph"><p>In Cypher, a similar query would be:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START admins=node(14)
MATCH admins&lt;-[:PART_OF*0..]-group&lt;-[:MEMBER_OF]-user
RETURN user.name, group.name</pre></div>
<div class="paragraph"><p>resulting in:</p></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">user.name</td><td align="left" valign="top">group.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Ali"</code></p></td><td align="left" valign="top"><p><code class="literal">"Admins"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Engin"</code></p></td><td align="left" valign="top"><p><code class="literal">"HelpDesk"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Demet"</code></p></td><td align="left" valign="top"><p><code class="literal">"HelpDesk"</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect3">
<h4 id="_get_the_group_memberships_of_a_user">Get the group memberships of a user</h4>
<div class="paragraph"><p>Using the Neo4j Java Traversal API, this query looks like:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Node jale = getNodeByName( "Jale" );
traversalDescription = Traversal.description()
        .depthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.MEMBER_OF, Direction.OUTGOING )
        .relationships( RoleRels.PART_OF, Direction.OUTGOING );
traverser = traversalDescription.traverse( jale );</pre>
</div></div>
<div class="paragraph"><p>resuling in:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Found: ABCTechnicians at depth: 0
Found: Technicians at depth: 1
Found: Users at depth: 2</pre></div>
<div class="paragraph"><p>In Cypher:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START jale=node(10)
MATCH jale-[:MEMBER_OF]-&gt;()-[:PART_OF*0..]-&gt;group
RETURN group.name</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">group.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"ABCTechnicians"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Technicians"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Users"</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect3">
<h4 id="_get_all_groups">Get all groups</h4>
<div class="paragraph"><p>In Java:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Node referenceNode = getNodeByName( "Reference_Node") ;
traversalDescription = Traversal.description()
        .breadthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.ROOT, Direction.INCOMING )
        .relationships( RoleRels.PART_OF, Direction.INCOMING );
traverser = traversalDescription.traverse( referenceNode );</pre>
</div></div>
<div class="paragraph"><p>resulting in:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Found: Admins at depth: 0
Found: Users at depth: 0
Found: HelpDesk at depth: 1
Found: Managers at depth: 1
Found: Technicians at depth: 1
Found: ABCTechnicians at depth: 2</pre></div>
<div class="paragraph"><p>In Cypher:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START refNode=node(16)
MATCH refNode&lt;-[:ROOT]-&gt;()&lt;-[:PART_OF*0..]-group
RETURN group.name</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">group.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">6 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Admins"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"HelpDesk"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Users"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Managers"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Technicians"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"ABCTechnicians"</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect3">
<h4 id="_get_all_members_of_all_groups">Get all members of all groups</h4>
<div class="paragraph"><p>Now, let&#8217;s try to find all users in the system being part of any group.</p></div>
<div class="paragraph"><p>in Java:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">traversalDescription = Traversal.description()
        .breadthFirst()
        .evaluator(
                Evaluators.includeWhereLastRelationshipTypeIs( RoleRels.MEMBER_OF ) );
traverser = traversalDescription.traverse( referenceNode );</pre>
</div></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Found: Ali at depth: 1
Found: Engin at depth: 1
Found: Burcu at depth: 1
Found: Can at depth: 1
Found: Demet at depth: 2
Found: Gul at depth: 2
Found: Fuat at depth: 2
Found: Hakan at depth: 2
Found: Irmak at depth: 2
Found: Jale at depth: 3</pre></div>
<div class="paragraph"><p>In Cypher, this looks like:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START refNode=node(16)
MATCH refNode&lt;-[:ROOT]-&gt;root, p=root&lt;-[PART_OF*0..]-()&lt;-[:MEMBER_OF]-user
RETURN user.name, min(length(p))
ORDER BY min(length(p)), user.name</pre></div>
<div class="paragraph"><p>and results in the following output:</p></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">user.name</td><td align="left" valign="top">min(length(p))</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">10 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Ali"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Burcu"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Can"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Engin"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Demet"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Fuat"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Gul"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Hakan"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Irmak"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Jale"</code></p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>As seen above, querying even more complex scenarios can be done using comparatively short
constructs in Java and other query mechanisms.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="examples-acl-structures-in-graphs">ACL structures in graphs</h3>
<div class="paragraph"><p>This example gives a generic overview of an approach to handling Access Control Lists (ACLs) in graphs,
and a simplified example with concrete queries.</p></div>
<div class="sect3">
<h4 id="_generic_approach">Generic approach</h4>
<div class="paragraph"><p>In many scenarios, an application needs to handle security on some form of managed
objects. This example describes one pattern to handle this through the use of a graph structure and traversers
that build a full permissions-structure for any managed object with exclude and include overriding
possibilities. This results in a dynamic construction of ACLs based on the
position and context of the managed object.</p></div>
<div class="paragraph"><p>The result is a complex security scheme that can easily be implemented in a graph structure,
supporting permissions overriding, principal and content composition, without duplicating data anywhere.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/ACL.png" alt="ACL.png">
</div>
</div>
<div class="sect4">
<h5 id="_technique">Technique</h5>
<div class="paragraph"><p>As seen in the example graph layout, there are some key concepts in this domain model:</p></div>
<div class="ulist"><ul>
<li>
<p>
The managed content (folders and files) that are connected by <span class="monospaced">HAS_CHILD_CONTENT</span> relationships
</p>
</li>
<li>
<p>
The Principal subtree pointing out principals that can act as ACL members, pointed out by the <span class="monospaced">PRINCIPAL</span> relationships.
</p>
</li>
<li>
<p>
The aggregation of principals into groups, connected by the <span class="monospaced">IS_MEMBER_OF</span> relationship. One principal (user or group) can be part of many groups at the same time.
</p>
</li>
<li>
<p>
The <span class="monospaced">SECURITY</span>&#8201;&#8212;&#8201;relationships, connecting the content composite structure to the principal composite structure, containing a addition/removal modifier property ("<span class="monospaced">+RW</span>").
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_constructing_the_acl">Constructing the ACL</h5>
<div class="paragraph"><p>The calculation of the effective permissions (e.g. Read, Write, Execute) for a
principal for any given ACL-managed node (content) follows a number of rules that will be encoded into the permissions-traversal:</p></div>
</div>
<div class="sect4">
<h5 id="_top_down_traversal">Top-down-Traversal</h5>
<div class="paragraph"><p>This approach will let you define a generic permission pattern on the root content,
and then refine that for specific sub-content nodes and specific principals.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Start at the content node in question traverse upwards to the content root node to determine the path to it.
</p>
</li>
<li>
<p>
Start with a effective optimistic permissions list of "all permitted" (<span class="monospaced">111</span> in a bit encoded ReadWriteExecute case)
  or <span class="monospaced">000</span> if you like pessimistic security handling (everything is forbidden unless explicitly allowed).
</p>
</li>
<li>
<p>
Beginning from the topmost content node, look for any <span class="monospaced">SECURITY</span> relationships on it.
</p>
</li>
<li>
<p>
If found, look if the principal in question is part of the end-principal of the <span class="monospaced">SECURITY</span> relationship.
</p>
</li>
<li>
<p>
If yes, add the "<span class="monospaced">+</span>" permission modifiers to the existing permission pattern, revoke the "<span class="monospaced">-</span>" permission modifiers from the pattern.
</p>
</li>
<li>
<p>
If two principal nodes link to the same content node, first apply the more generic prinipals modifiers.
</p>
</li>
<li>
<p>
Repeat the security modifier search all the way down to the target content node, thus overriding more
  generic permissions with the set on nodes closer to the target node.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The same algorithm is applicable for the bottom-up approach, basically just
traversing from the target content node upwards and applying the security modifiers dynamically
as the traverser goes up.</p></div>
</div>
<div class="sect4">
<h5 id="_example">Example</h5>
<div class="paragraph"><p>Now, to get the resulting access rights for e.g. "<span class="monospaced">user 1</span>" on the "<span class="monospaced">My File.pdf</span>" in a Top-Down
approach on the model in the graph above would go like:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Traveling upward, we start with "<span class="monospaced">Root folder</span>", and set the permissions to <span class="monospaced">11</span> initially (only considering Read, Write).
</p>
</li>
<li>
<p>
There are two <span class="monospaced">SECURITY</span> relationships to that folder.
  User 1 is contained in both of them, but "<span class="monospaced">root</span>" is more generic, so apply it first then "<span class="monospaced">All principals</span>" <span class="monospaced">+W</span> <span class="monospaced">+R</span> &#8594; <span class="monospaced">11</span>.
</p>
</li>
<li>
<p>
"<span class="monospaced">Home</span>" has no <span class="monospaced">SECURITY</span> instructions, continue.
</p>
</li>
<li>
<p>
"<span class="monospaced">user1 Home</span>" has <span class="monospaced">SECURITY</span>.
  First apply "<span class="monospaced">Regular Users</span>" (<span class="monospaced">-R</span> <span class="monospaced">-W</span>) &#8594; <span class="monospaced">00</span>, Then "<span class="monospaced">user 1</span>" (<span class="monospaced">+R</span> <span class="monospaced">+W</span>) &#8594; <span class="monospaced">11</span>.
</p>
</li>
<li>
<p>
The target node "<span class="monospaced">My File.pdf</span>" has no <span class="monospaced">SECURITY</span> modifiers on it, so the effective permissions for "<span class="monospaced">User 1</span>" on "<span class="monospaced">My File.pdf</span>" are <span class="monospaced">ReadWrite</span> &#8594; <span class="monospaced">11</span>.
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect3">
<h4 id="_read_permission_example">Read-permission example</h4>
<div class="paragraph"><p>In this example, we are going to examine a tree structure of <span class="monospaced">directories</span> and
<span class="monospaced">files</span>. Also, there are users that own files and roles that can be assigned to
users. Roles can have permissions on directory or files structures (here we model
only <span class="monospaced">canRead</span>, as opposed to full <span class="monospaced">rwx</span> Unix permissions) and be nested. A more thorough
example of modeling ACL structures can be found at
<a href="http://www.xaprb.com/blog/2006/08/16/how-to-build-role-based-access-control-in-sql/">How to Build Role-Based Access Control in SQL</a>.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/The-Domain-Structure-ACL-structures-in-graphs.svg" alt="The-Domain-Structure-ACL-structures-in-graphs.svg">
</div>
</div>
<div class="sect4">
<h5 id="_find_all_files_in_the_directory_structure">Find all files in the directory structure</h5>
<div class="paragraph"><p>In order to find all files contained in this structure, we need a variable length
query that follows all <span class="monospaced">contains</span> relationships and retrieves the nodes at the other
end of the <span class="monospaced">leaf</span> relationships.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START root=node:node_auto_index(name = 'FileRoot')
MATCH root-[:contains*0..]-&gt;(parentDir)-[:leaf]-&gt;file
RETURN file</pre></div>
<div class="paragraph"><p>resulting in:</p></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">file</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[11]{name:"File1"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[10]{name:"File2"}</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect4">
<h5 id="_what_files_are_owned_by_whom">What files are owned by whom?</h5>
<div class="paragraph"><p>If we introduce the concept of ownership on files, we then can ask for the owners of the files we find&#8201;&#8212;&#8201;connected via <span class="monospaced">owns</span> relationships to file nodes.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START root=node:node_auto_index(name = 'FileRoot')
MATCH root-[:contains*0..]-&gt;()-[:leaf]-&gt;file&lt;-[:owns]-user
RETURN file, user</pre></div>
<div class="paragraph"><p>Returning the owners of all files below the <span class="monospaced">FileRoot</span> node.</p></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">file</td><td align="left" valign="top">user</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[11]{name:"File1"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[8]{name:"User1"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[10]{name:"File2"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[7]{name:"User2"}</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect4">
<h5 id="_who_has_access_to_a_file">Who has access to a File?</h5>
<div class="paragraph"><p>If we now want to check what users have read access to all Files, and define our ACL as</p></div>
<div class="ulist"><ul>
<li>
<p>
The root directory has no access granted.
</p>
</li>
<li>
<p>
Any user having a role that has been granted <span class="monospaced">canRead</span> access to one of the parent folders of a File has read access.
</p>
</li>
</ul></div>
<div class="paragraph"><p>In order to find users that can read any part of the parent folder hierarchy above the files,
Cypher provides optional variable length path.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START file=node:node_auto_index('name:File*')
MATCH file&lt;-[:leaf]-()&lt;-[:contains*0..]-dir&lt;-[?:canRead]-role-[:member]-&gt;readUser
RETURN file.name, dir.name, role.name, readUser.name</pre></div>
<div class="paragraph"><p>This will return the <span class="monospaced">file</span>, and the directory where the user has the <span class="monospaced">canRead</span> permission along
with the <span class="monospaced">user</span> and their <span class="monospaced">role</span>.</p></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">file.name</td><td align="left" valign="top">dir.name</td><td align="left" valign="top">role.name</td><td align="left" valign="top">readUser.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="4">9 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"File2"</code></p></td><td align="left" valign="top"><p><code class="literal">"Desktop"</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File2"</code></p></td><td align="left" valign="top"><p><code class="literal">"HomeU2"</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File2"</code></p></td><td align="left" valign="top"><p><code class="literal">"Home"</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File2"</code></p></td><td align="left" valign="top"><p><code class="literal">"FileRoot"</code></p></td><td align="left" valign="top"><p><code class="literal">"SUDOers"</code></p></td><td align="left" valign="top"><p><code class="literal">"Admin1"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File2"</code></p></td><td align="left" valign="top"><p><code class="literal">"FileRoot"</code></p></td><td align="left" valign="top"><p><code class="literal">"SUDOers"</code></p></td><td align="left" valign="top"><p><code class="literal">"Admin2"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File1"</code></p></td><td align="left" valign="top"><p><code class="literal">"HomeU1"</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File1"</code></p></td><td align="left" valign="top"><p><code class="literal">"Home"</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File1"</code></p></td><td align="left" valign="top"><p><code class="literal">"FileRoot"</code></p></td><td align="left" valign="top"><p><code class="literal">"SUDOers"</code></p></td><td align="left" valign="top"><p><code class="literal">"Admin1"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"File1"</code></p></td><td align="left" valign="top"><p><code class="literal">"FileRoot"</code></p></td><td align="left" valign="top"><p><code class="literal">"SUDOers"</code></p></td><td align="left" valign="top"><p><code class="literal">"Admin2"</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>The results listed above contain <span class="monospaced">null</span> values for optional path segments, which can be mitigated by either asking several
queries or returning just the really needed values.</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-linked-list">Linked Lists</h3>
<div class="paragraph"><p>A powerful feature of using a graph database, is that you can create your own in-graph data structures&#8201;&#8212;&#8201;like a linked
list.</p></div>
<div class="paragraph"><p>This datastructure uses a single node as the list reference. The reference has an outgoing relationship to the head of
the list, and an incoming relationship from the last element of the list. If the list is empty, the reference will point
to it self.</p></div>
<div class="paragraph"><p>Something like this:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-linkedlist-graph.svg" alt="cypher-linkedlist-graph.svg">
</div>
<div class="title">Figure 12. Graph</div>
</div>
<div class="paragraph"><p>To initialize an empty linked list, we simply create an empty node, and make it link to itself.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE root-[:LINK]-&gt;root // no ‘value’ property assigned to root
RETURN root</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">start n=node(*) match n-[r?]-&gt;() delete n, r;
</span><span class="command"><strong>CREATE root-[:LINK]-&gt;root // no ‘value’ property assigned to root
 RETURN root</strong></span></p>
<div class="paragraph"><p>Adding values is done by finding the relationship where the new value should be placed in, and replacing it with
a new node, and two relationships to it.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH root-[:LINK*0..]-&gt;before,// before could be same as root
after-[:LINK*0..]-&gt;root, // after could be same as root
before-[old:LINK]-&gt;after
WHERE root.name! = 'ROOT'
AND before.value? &lt; 25  // This is the value, which would normally
AND 25 &lt; after.value?   // be supplied through a parameter.
CREATE before-[:LINK]-&gt;({value:25})-[:LINK]-&gt;after
DELETE old</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A", `value`:10})
create (_2 {`name`:"B", `value`:20})
create (_3 {`name`:"C", `value`:30})
create (_4 {`name`:"ROOT"})
create _1-[:`LINK`]-&gt;_2
create _2-[:`LINK`]-&gt;_3
create _3-[:`LINK`]-&gt;_4
create _4-[:`LINK`]-&gt;_1
</span><span class="command"><strong>
 MATCH root-[:LINK*0..]-&gt;before,// before could be same as root
       after-[:LINK*0..]-&gt;root, // after could be same as root
       before-[old:LINK]-&gt;after
 WHERE root.name! = 'ROOT'
   AND before.value? &lt; 25  // This is the value, which would normally
   AND 25 &lt; after.value?   // be supplied through a parameter.
 CREATE before-[:LINK]-&gt;({value:25})-[:LINK]-&gt;after
 DELETE old</strong></span></p>
<div class="paragraph"><p>Deleting a value, conversely, is done by finding the node with the value, and the two relationships going in and out
from it, and replacing with a new value.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH root-[:LINK*0..]-&gt;before,
before-[delBefore:LINK]-&gt;del-[delAfter:LINK]-&gt;after,
after-[:LINK*0..]-&gt;root
WHERE root.name! = 'ROOT'
AND del.value! = 10
CREATE before-[:LINK]-&gt;after
DELETE del, delBefore, delAfter</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A", `value`:10})
create (_2 {`name`:"B", `value`:20})
create (_3 {`name`:"C", `value`:30})
create (_4 {`name`:"ROOT"})
create (_5 {`value`:25})
create _1-[:`LINK`]-&gt;_2
create _2-[:`LINK`]-&gt;_5
create _3-[:`LINK`]-&gt;_4
create _4-[:`LINK`]-&gt;_1
create _5-[:`LINK`]-&gt;_3
</span><span class="command"><strong>
 MATCH root-[:LINK*0..]-&gt;before,
       before-[delBefore:LINK]-&gt;del-[delAfter:LINK]-&gt;after,
       after-[:LINK*0..]-&gt;root
 WHERE root.name! = 'ROOT'
   AND del.value! = 10
 CREATE before-[:LINK]-&gt;after
 DELETE del, delBefore, delAfter</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-hyperedges">Hyperedges</h3>
<div class="paragraph"><p>Imagine a user being part of different groups.
A group can have different roles, and a user can be part of different groups.
He also can have different roles in different groups apart from the membership.
The association of a User, a Group and a Role can be referred to as a <em>HyperEdge</em>.
However, it can be easily modeled in a property graph as a node that captures this n-ary relationship, as depicted below in the <span class="monospaced">U1G2R1</span> node.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-hyperedge-graph.svg" alt="cypher-hyperedge-graph.svg">
</div>
<div class="title">Figure 13. Graph</div>
</div>
<div class="sect3">
<h4 id="cookbook-find-groups">Find Groups</h4>
<div class="paragraph"><p>To find out in what roles a user is for a particular groups (here
        <em>Group2</em>), the following query can traverse this HyperEdge node and
        provide answers.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n-[:hasRoleInGroup]-&gt;hyperEdge-[:hasGroup]-&gt;group, hyperEdge-[:hasRole]-&gt;role
WHERE n.name = 'User1' and group.name = 'Group2'
RETURN role.name</pre></div>
<div class="paragraph"><p>The role of <span class="monospaced">User1</span> is returned:</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">role.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Role1"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"U1G2R1"})
create (_2 {`name`:"Role2"})
create (_3 {`name`:"Group1"})
create (_4 {`name`:"Group2"})
create (_5 {`name`:"Role1"})
create (_6 {`name`:"Role"})
create (_7 {`name`:"User1"})
create (_8 {`name`:"U1G1R2"})
create (_9 {`name`:"Group"})
create _1-[:`hasRole`]-&gt;_5
create _1-[:`hasGroup`]-&gt;_4
create _2-[:`isA`]-&gt;_6
create _3-[:`canHave`]-&gt;_5
create _3-[:`canHave`]-&gt;_2
create _3-[:`isA`]-&gt;_9
create _4-[:`canHave`]-&gt;_2
create _4-[:`canHave`]-&gt;_5
create _4-[:`isA`]-&gt;_9
create _5-[:`isA`]-&gt;_6
create _7-[:`in`]-&gt;_3
create _7-[:`in`]-&gt;_4
create _7-[:`hasRoleInGroup`]-&gt;_1
create _7-[:`hasRoleInGroup`]-&gt;_8
create _8-[:`hasRole`]-&gt;_2
create _8-[:`hasGroup`]-&gt;_3
</span><span class="command"><strong>
 match n-[:hasRoleInGroup]-&gt;hyperEdge-[:hasGroup]-&gt;group, hyperEdge-[:hasRole]-&gt;role where n.name = 'User1' and group.name = 'Group2' return role.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="cookbook-find-all-groups-and-roles-for-a-user">Find all groups and roles for a user</h4>
<div class="paragraph"><p>Here, find all groups and the roles a user has, sorted by the name of the role.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n-[:hasRoleInGroup]-&gt;hyperEdge-[:hasGroup]-&gt;group, hyperEdge-[:hasRole]-&gt;role
WHERE n.name = 'User1'
RETURN role.name, group.name
ORDER BY role.name asc</pre></div>
<div class="paragraph"><p>The groups and roles of <span class="monospaced">User1</span> are returned:</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">role.name</td><td align="left" valign="top">group.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Role1"</code></p></td><td align="left" valign="top"><p><code class="literal">"Group2"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Role2"</code></p></td><td align="left" valign="top"><p><code class="literal">"Group1"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"U1G2R1"})
create (_2 {`name`:"Role2"})
create (_3 {`name`:"Group1"})
create (_4 {`name`:"Group2"})
create (_5 {`name`:"Role1"})
create (_6 {`name`:"Role"})
create (_7 {`name`:"User1"})
create (_8 {`name`:"U1G1R2"})
create (_9 {`name`:"Group"})
create _1-[:`hasRole`]-&gt;_5
create _1-[:`hasGroup`]-&gt;_4
create _2-[:`isA`]-&gt;_6
create _3-[:`canHave`]-&gt;_5
create _3-[:`canHave`]-&gt;_2
create _3-[:`isA`]-&gt;_9
create _4-[:`canHave`]-&gt;_2
create _4-[:`canHave`]-&gt;_5
create _4-[:`isA`]-&gt;_9
create _5-[:`isA`]-&gt;_6
create _7-[:`in`]-&gt;_3
create _7-[:`in`]-&gt;_4
create _7-[:`hasRoleInGroup`]-&gt;_1
create _7-[:`hasRoleInGroup`]-&gt;_8
create _8-[:`hasRole`]-&gt;_2
create _8-[:`hasGroup`]-&gt;_3
</span><span class="command"><strong>
 match n-[:hasRoleInGroup]-&gt;hyperEdge-[:hasGroup]-&gt;group, hyperEdge-[:hasRole]-&gt;role where n.name = 'User1' return role.name, group.name order by role.name asc</strong></span></p>
</div>
<div class="sect3">
<h4 id="cookbook-find-common-groups-based-on-shared-roles">Find common groups based on shared roles</h4>
<div class="paragraph"><p>Assume a more complicated graph:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Two user nodes <span class="monospaced">User1</span>, <span class="monospaced">User2</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">User1</span> is in <span class="monospaced">Group1</span>, <span class="monospaced">Group2</span>, <span class="monospaced">Group3</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">User1</span> has <span class="monospaced">Role1</span>, <span class="monospaced">Role2</span> in <span class="monospaced">Group1</span>; <span class="monospaced">Role2</span>, <span class="monospaced">Role3</span> in <span class="monospaced">Group2</span>; <span class="monospaced">Role3</span>, <span class="monospaced">Role4</span> in <span class="monospaced">Group3</span> (hyper edges).
</p>
</li>
<li>
<p>
<span class="monospaced">User2</span> is in <span class="monospaced">Group1</span>, <span class="monospaced">Group2</span>, <span class="monospaced">Group3</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">User2</span> has <span class="monospaced">Role2</span>, <span class="monospaced">Role5</span> in <span class="monospaced">Group1</span>; <span class="monospaced">Role3</span>, <span class="monospaced">Role4</span> in <span class="monospaced">Group2</span>; <span class="monospaced">Role5</span>, <span class="monospaced">Role6</span> in <span class="monospaced">Group3</span> (hyper edges).
</p>
</li>
</ol></div>
<div class="paragraph"><p>The graph for this looks like the following (nodes like <span class="monospaced">U1G2R23</span> representing the HyperEdges):</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-hyperedgecommongroups-graph.svg" alt="cypher-hyperedgecommongroups-graph.svg">
</div>
<div class="title">Figure 14. Graph</div>
</div>
<div class="paragraph"><p>To return <span class="monospaced">Group1</span> and <span class="monospaced">Group2</span> as <span class="monospaced">User1</span> and <span class="monospaced">User2</span> share at least one common role in these two groups, the query looks like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH u1-[:hasRoleInGroup]-&gt;hyperEdge1-[:hasGroup]-&gt;group,
      hyperEdge1-[:hasRole]-&gt;role,
      u2-[:hasRoleInGroup]-&gt;hyperEdge2-[:hasGroup]-&gt;group,
      hyperEdge2-[:hasRole]-&gt;role
WHERE u1.name = 'User1' and u2.name = 'User2'
RETURN group.name, count(role)
ORDER BY group.name ASC</pre></div>
<div class="paragraph"><p>The groups where <span class="monospaced">User1</span> and <span class="monospaced">User2</span> share at least one common role:</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">group.name</td><td align="left" valign="top">count(role)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Group1"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Group2"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"U2G2R34"})
create (_2 {`name`:"U1G3R34"})
create (_3 {`name`:"User2"})
create (_4 {`name`:"User1"})
create (_5 {`name`:"Role6"})
create (_6 {`name`:"U1G2R23"})
create (_7 {`name`:"Role4"})
create (_8 {`name`:"Role5"})
create (_9 {`name`:"U2G1R25"})
create (_10 {`name`:"Group1"})
create (_11 {`name`:"Role2"})
create (_12 {`name`:"Group2"})
create (_13 {`name`:"Role3"})
create (_14 {`name`:"Group3"})
create (_15 {`name`:"U1G1R12"})
create (_16 {`name`:"Role1"})
create (_17 {`name`:"U2G3R56"})
create _1-[:`hasGroup`]-&gt;_12
create _1-[:`hasRole`]-&gt;_13
create _1-[:`hasRole`]-&gt;_7
create _2-[:`hasGroup`]-&gt;_14
create _2-[:`hasRole`]-&gt;_13
create _2-[:`hasRole`]-&gt;_7
create _3-[:`hasRoleInGroup`]-&gt;_9
create _3-[:`hasRoleInGroup`]-&gt;_1
create _3-[:`hasRoleInGroup`]-&gt;_17
create _4-[:`hasRoleInGroup`]-&gt;_15
create _4-[:`hasRoleInGroup`]-&gt;_6
create _4-[:`hasRoleInGroup`]-&gt;_2
create _6-[:`hasGroup`]-&gt;_12
create _6-[:`hasRole`]-&gt;_11
create _6-[:`hasRole`]-&gt;_13
create _9-[:`hasGroup`]-&gt;_10
create _9-[:`hasRole`]-&gt;_11
create _9-[:`hasRole`]-&gt;_8
create _15-[:`hasGroup`]-&gt;_10
create _15-[:`hasRole`]-&gt;_16
create _15-[:`hasRole`]-&gt;_11
create _17-[:`hasGroup`]-&gt;_14
create _17-[:`hasRole`]-&gt;_8
create _17-[:`hasRole`]-&gt;_5
</span><span class="command"><strong>
 match u1-[:hasRoleInGroup]-&gt;hyperEdge1-[:hasGroup]-&gt;group, hyperEdge1-[:hasRole]-&gt;role, u2-[:hasRoleInGroup]-&gt;hyperEdge2-[:hasGroup]-&gt;group, hyperEdge2-[:hasRole]-&gt;role where u1.name = 'User1' and u2.name = 'User2' return group.name, count(role) order by group.name ASC</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-friend-finding">Basic friend finding based on social neighborhood</h3>
<div class="paragraph"><p>Imagine an example graph like the following one:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-collabfiltering-graph.svg" alt="cypher-collabfiltering-graph.svg">
</div>
<div class="title">Figure 15. Graph</div>
</div>
<div class="paragraph" id="cookbook-simple-friend-finder"><p>To find out the friends of Joe&#8217;s friends that are not already his friends, the query looks like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH joe-[:knows*2..2]-friend_of_friend
WHERE joe.name = 'Joe' and not(joe-[:knows]-friend_of_friend)
RETURN friend_of_friend.name, COUNT(*)
ORDER BY COUNT(*) DESC, friend_of_friend.name</pre></div>
<div class="paragraph"><p>This returns a list of friends-of-friends ordered by the number of connections to them, and secondly by their name.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">friend_of_friend.name</td><td align="left" valign="top">COUNT(*)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Ian"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Derrick"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Jill"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Bill"})
create (_2 {`name`:"Sara"})
create (_3 {`name`:"Derrick"})
create (_4 {`name`:"Ian"})
create (_5 {`name`:"Jill"})
create (_6 {`name`:"Joe"})
create _1-[:`knows`]-&gt;_3
create _1-[:`knows`]-&gt;_4
create _2-[:`knows`]-&gt;_1
create _2-[:`knows`]-&gt;_4
create _2-[:`knows`]-&gt;_5
create _6-[:`knows`]-&gt;_1
create _6-[:`knows`]-&gt;_2
</span><span class="command"><strong>
 match joe-[:knows*2..2]-friend_of_friend where joe.name = 'Joe' and not(joe-[:knows]-friend_of_friend) return friend_of_friend.name, COUNT(*) order by COUNT(*) DESC, friend_of_friend.name</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-co-favorited-places">Co-favorited places</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-cofavoritedplaces-graph.svg" alt="cypher-cofavoritedplaces-graph.svg">
</div>
<div class="title">Figure 16. Graph</div>
</div>
<div class="sect3">
<h4 id="cookbook-co-favorited-places----users-who-like-x-also-like-y">Co-favorited places&#8201;&#8212;&#8201;users who like x also like y</h4>
<div class="paragraph"><p>Find places that people also like who favorite this place:</p></div>
<div class="ulist"><ul>
<li>
<p>
Determine who has favorited place x.
</p>
</li>
<li>
<p>
What else have they favorited that is not place x.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH place&lt;-[:favorite]-person-[:favorite]-&gt;stuff

WHERE place.name = 'CoffeeShop1'
RETURN stuff.name, count(*)
ORDER BY count(*) DESC, stuff.name</pre></div>
<div class="paragraph"><p>The list of places that are favorited by people that favorited the start place.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">stuff.name</td><td align="left" valign="top">count(*)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"MelsPlace"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"CoffeShop2"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"SaunaX"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"SaunaX"})
create (_2 {`name`:"CoffeeShop1"})
create (_3 {`name`:"MelsPlace"})
create (_4 {`name`:"CoffeeShop3"})
create (_5 {`name`:"Cool"})
create (_6 {`name`:"CoffeeShop2"})
create (_7 {`name`:"CoffeShop2"})
create (_8 {`name`:"Cosy"})
create (_9 {`name`:"Jill"})
create (_10 {`name`:"Joe"})
create _2-[:`tagged`]-&gt;_5
create _2-[:`tagged`]-&gt;_8
create _3-[:`tagged`]-&gt;_8
create _3-[:`tagged`]-&gt;_5
create _4-[:`tagged`]-&gt;_8
create _6-[:`tagged`]-&gt;_5
create _9-[:`favorite`]-&gt;_2
create _9-[:`favorite`]-&gt;_3
create _9-[:`favorite`]-&gt;_7
create _10-[:`favorite`]-&gt;_2
create _10-[:`favorite`]-&gt;_1
create _10-[:`favorite`]-&gt;_3
</span><span class="command"><strong>
 MATCH place&lt;-[:favorite]-person-[:favorite]-&gt;stuff
           WHERE place.name = 'CoffeeShop1'
             RETURN stuff.name, count(*)
             ORDER BY count(*) DESC, stuff.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="cookbook-co-tagged-places----places-related-through-tags">Co-Tagged places&#8201;&#8212;&#8201;places related through tags</h4>
<div class="paragraph"><p>Find places that are tagged with the same tags:</p></div>
<div class="ulist"><ul>
<li>
<p>
Determine the tags for place x.
</p>
</li>
<li>
<p>
What else is tagged the same as x that is not x.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH place-[:tagged]-&gt;tag&lt;-[:tagged]-otherPlace
WHERE place.name = 'CoffeeShop1'
RETURN otherPlace.name, collect(tag.name)
ORDER BY length(collect(tag.name)) DESC, otherPlace.name</pre></div>
<div class="paragraph"><p>This query returns other places than CoffeeShop1 which share the same tags; they are ranked by the number of tags.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">otherPlace.name</td><td align="left" valign="top">collect(tag.name)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"MelsPlace"</code></p></td><td align="left" valign="top"><p><code class="literal">["Cool","Cosy"]</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"CoffeeShop2"</code></p></td><td align="left" valign="top"><p><code class="literal">["Cool"]</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"CoffeeShop3"</code></p></td><td align="left" valign="top"><p><code class="literal">["Cosy"]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"SaunaX"})
create (_2 {`name`:"CoffeeShop1"})
create (_3 {`name`:"MelsPlace"})
create (_4 {`name`:"CoffeeShop3"})
create (_5 {`name`:"Cool"})
create (_6 {`name`:"CoffeeShop2"})
create (_7 {`name`:"CoffeShop2"})
create (_8 {`name`:"Cosy"})
create (_9 {`name`:"Jill"})
create (_10 {`name`:"Joe"})
create _2-[:`tagged`]-&gt;_5
create _2-[:`tagged`]-&gt;_8
create _3-[:`tagged`]-&gt;_8
create _3-[:`tagged`]-&gt;_5
create _4-[:`tagged`]-&gt;_8
create _6-[:`tagged`]-&gt;_5
create _9-[:`favorite`]-&gt;_2
create _9-[:`favorite`]-&gt;_3
create _9-[:`favorite`]-&gt;_7
create _10-[:`favorite`]-&gt;_2
create _10-[:`favorite`]-&gt;_1
create _10-[:`favorite`]-&gt;_3
</span><span class="command"><strong>
 MATCH place-[:tagged]-&gt;tag&lt;-[:tagged]-otherPlace
 WHERE place.name = 'CoffeeShop1'
 RETURN otherPlace.name, collect(tag.name)
 ORDER BY length(collect(tag.name)) DESC, otherPlace.name</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-similar-favorites">Find people based on similar favorites</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-peoplesimilarityfavorites-graph.svg" alt="cypher-peoplesimilarityfavorites-graph.svg">
</div>
<div class="title">Figure 17. Graph</div>
</div>
<div class="paragraph" id="cookbook-find-people-based-on-similar-favorites"><p>To find out the possible new friends based on them liking similar things as the asking person, use a query like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH me-[:favorite]-&gt;stuff&lt;-[:favorite]-person
WHERE me.name = 'Joe' AND NOT(me-[:friend]-person)
RETURN person.name, count(stuff)
ORDER BY count(stuff) DESC</pre></div>
<div class="paragraph"><p>The list of possible friends ranked by them liking similar stuff that are not yet friends is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person.name</td><td align="left" valign="top">count(stuff)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Derrick"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Jill"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Sara"})
create (_2 {`name`:"Cats"})
create (_3 {`name`:"Derrick"})
create (_4 {`name`:"Bikes"})
create (_5 {`name`:"Jill"})
create (_6 {`name`:"Joe"})
create _1-[:`favorite`]-&gt;_2
create _1-[:`favorite`]-&gt;_4
create _3-[:`favorite`]-&gt;_2
create _3-[:`favorite`]-&gt;_4
create _5-[:`favorite`]-&gt;_4
create _6-[:`favorite`]-&gt;_2
create _6-[:`favorite`]-&gt;_4
create _6-[:`friend`]-&gt;_1
</span><span class="command"><strong>
 MATCH me-[:favorite]-&gt;stuff&lt;-[:favorite]-person WHERE me.name = 'Joe' AND NOT(me-[:friend]-person) RETURN person.name, count(stuff) ORDER BY count(stuff) DESC</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-mutual-friends-and-groups">Find people based on mutual friends and groups</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-mutualfriendsandgroups-graph.svg" alt="cypher-mutualfriendsandgroups-graph.svg">
</div>
<div class="title">Figure 18. Graph</div>
</div>
<div class="paragraph" id="cookbook-find-mutual-friends-and-groups"><p>In this scenario, the problem is to determine mutual friends and groups, if any,
between persons. If no mutual groups or friends are found, there should be a <span class="monospaced">0</span> returned.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START me=node(5), other=node(4, 3)
MATCH pGroups=me-[?:member_of_group]-&gt;mg&lt;-[?:member_of_group]-other,
pMutualFriends=me-[?:knows]-&gt;mf&lt;-[?:knows]-other
RETURN other.name as name,
count(distinct pGroups) AS mutualGroups,
count(distinct pMutualFriends) AS mutualFriends
ORDER BY mutualFriends DESC</pre></div>
<div class="paragraph"><p>The question we are asking is&#8201;&#8212;&#8201;how many unique paths are there between me and Jill, the paths being common group memberships, and common friends.
If the paths are mandatory, no results will be returned if me and Bob lack any common friends, and we don&#8217;t want that. To make a path optional,
you have to make at least one of it&#8217;s relationships optional. That makes the whole path optional.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">name</td><td align="left" valign="top">mutualGroups</td><td align="left" valign="top">mutualFriends</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="3">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Jill"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Bob"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td><td align="left" valign="top"><p><code class="literal">0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Bill"})
create (_2 {`name`:"Group1"})
create (_3 {`name`:"Bob"})
create (_4 {`name`:"Jill"})
create (_5 {`name`:"Joe"})
create _1-[:`member_of_group`]-&gt;_2
create _3-[:`member_of_group`]-&gt;_2
create _4-[:`member_of_group`]-&gt;_2
create _4-[:`knows`]-&gt;_1
create _5-[:`member_of_group`]-&gt;_2
create _5-[:`knows`]-&gt;_1
</span><span class="command"><strong>
 START me=node(5), other=node(4, 3) MATCH pGroups=me-[?:member_of_group]-&gt;mg&lt;-[?:member_of_group]-other,
 pMutualFriends=me-[?:knows]-&gt;mf&lt;-[?:knows]-other RETURN other.name as name,
  count(distinct pGroups) AS mutualGroups,
  count(distinct pMutualFriends) AS mutualFriends ORDER BY mutualFriends DESC</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-similar-tags">Find friends based on similar tagging</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-peoplesimilaritytags-graph.svg" alt="cypher-peoplesimilaritytags-graph.svg">
</div>
<div class="title">Figure 19. Graph</div>
</div>
<div class="paragraph" id="cookbook-find-people-based-on-similar-tagged-favorties"><p>To find people similar to me based on the taggings of their favorited items, one approach could be:</p></div>
<div class="ulist"><ul>
<li>
<p>
Determine the tags associated with what I favorite.
</p>
</li>
<li>
<p>
What else is tagged with those tags?
</p>
</li>
<li>
<p>
Who favorites items tagged with the same tags?
</p>
</li>
<li>
<p>
Sort the result by how many of the same things these people like.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH me-[:favorite]-&gt;myFavorites-[:tagged]-&gt;tag&lt;-[:tagged]-theirFavorites&lt;-[:favorite]-people
WHERE me.name = 'Joe' AND NOT(me=people)
RETURN people.name as name, count(*) as similar_favs
ORDER BY similar_favs DESC</pre></div>
<div class="paragraph"><p>The query returns the list of possible friends ranked by them liking similar stuff that are not yet friends.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">name</td><td align="left" valign="top">similar_favs</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Sara"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Derrick"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Animals"})
create (_2 {`name`:"Hobby"})
create (_3 {`name`:"Surfing"})
create (_4 {`name`:"Sara"})
create (_5 {`name`:"Cats"})
create (_6 {`name`:"Derrick"})
create (_7 {`name`:"Horses"})
create (_8 {`name`:"Bikes"})
create (_9 {`name`:"Joe"})
create _3-[:`tagged`]-&gt;_2
create _4-[:`favorite`]-&gt;_8
create _4-[:`favorite`]-&gt;_7
create _5-[:`tagged`]-&gt;_1
create _6-[:`favorite`]-&gt;_8
create _7-[:`tagged`]-&gt;_1
create _8-[:`tagged`]-&gt;_2
create _9-[:`favorite`]-&gt;_5
create _9-[:`favorite`]-&gt;_7
create _9-[:`favorite`]-&gt;_8
create _9-[:`favorite`]-&gt;_3
</span><span class="command"><strong>
 MATCH me-[:favorite]-&gt;myFavorites-[:tagged]-&gt;tag&lt;-[:tagged]-theirFavorites&lt;-[:favorite]-people WHERE me.name = 'Joe' AND NOT(me=people) RETURN people.name as name, count(*) as similar_favs ORDER BY similar_favs DESC</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-multirelational-social-network">Multirelational (social) graphs</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-multirelationalsocialnetwork-graph.svg" alt="cypher-multirelationalsocialnetwork-graph.svg">
</div>
<div class="title">Figure 20. Graph</div>
</div>
<div class="paragraph" id="cookbook-who-follows-or-loves-me-back"><p>This example shows a multi-relational network between persons and things they like.
        A multi-relational graph is a graph with more than one kind of relationship between nodes.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH me-[r1:FOLLOWS|:LOVES]-&gt;other-[r2]-&gt;me
WHERE me.name='Joe' and type(r1)=type(r2)
RETURN other.name, type(r1)</pre></div>
<div class="paragraph"><p>The query returns people that <span class="monospaced">FOLLOWS</span> or <span class="monospaced">LOVES</span> <span class="monospaced">Joe</span> back.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">other.name</td><td align="left" valign="top">type(r1)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Sara"</code></p></td><td align="left" valign="top"><p><code class="literal">"FOLLOWS"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Maria"</code></p></td><td align="left" valign="top"><p><code class="literal">"FOLLOWS"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Maria"</code></p></td><td align="left" valign="top"><p><code class="literal">"LOVES"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"cats"})
create (_2 {`name`:"nature"})
create (_3 {`name`:"Ben"})
create (_4 {`name`:"Sara"})
create (_5 {`name`:"bikes"})
create (_6 {`name`:"Maria"})
create (_7 {`name`:"cars"})
create (_8 {`name`:"Joe"})
create _4-[:`FOLLOWS`]-&gt;_8
create _4-[:`FOLLOWS`]-&gt;_3
create _4-[:`LIKES`]-&gt;_5
create _4-[:`LIKES`]-&gt;_7
create _4-[:`LIKES`]-&gt;_1
create _6-[:`FOLLOWS`]-&gt;_8
create _6-[:`LOVES`]-&gt;_8
create _6-[:`LIKES`]-&gt;_7
create _8-[:`FOLLOWS`]-&gt;_4
create _8-[:`FOLLOWS`]-&gt;_6
create _8-[:`LOVES`]-&gt;_6
create _8-[:`LIKES`]-&gt;_5
create _8-[:`LIKES`]-&gt;_2
</span><span class="command"><strong>
 MATCH me-[r1:FOLLOWS|:LOVES]-&gt;other-[r2]-&gt;me WHERE me.name='Joe' and type(r1)=type(r2) RETURN other.name, type(r1)</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-newsfeed">Implementing newsfeeds in a graph</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-newsfeed-graph.svg" alt="cypher-newsfeed-graph.svg">
</div>
</div>
<div class="paragraph" id="cookbook-retrieve-the-ordered-timeline-of-status-updates-of-all-my-friends"><p>Implementation of newsfeed or timeline feature is a frequent requirement for social applications. The following exmaples are inspired by <a href="http://techfin.in/2012/10/newsfeed-feature-powered-by-neo4j-graph-database/">Newsfeed feature powered by Neo4j Graph Database</a>.
The query asked here is:</p></div>
<div class="paragraph"><p>Starting at <span class="monospaced">me</span>, retrieve the time-ordered status feed of the status updates of me and and all friends that are connected via a <span class="monospaced">CONFIRMED</span> <span class="monospaced">FRIEND</span> relationship to me.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH me-[rels:FRIEND*0..1]-myfriend
WHERE me.name = 'Joe' AND ALL(r in rels
WHERE r.status = 'CONFIRMED')
WITH myfriend
MATCH myfriend-[:STATUS]-latestupdate-[:NEXT*0..1]-statusupdates
RETURN myfriend.name as name, statusupdates.date as date, statusupdates.text as text
ORDER BY statusupdates.date DESC
LIMIT 3</pre></div>
<div class="paragraph"><p>To understand the strategy, let&#8217;s divide the query into five steps:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
First Get the list of all my friends (along with me) through <span class="monospaced">FRIEND</span> relationship (<span class="monospaced">MATCH me-[rels:FRIEND*0..1]-myfriend</span>). Also,  the <span class="monospaced">WHERE</span> predicate can be added to check whether the friend request is pending or confirmed.
</p>
</li>
<li>
<p>
Get the latest status update of my friends through Status relationship (<span class="monospaced">MATCH myfriend-[:STATUS]-latestupdate</span>).
</p>
</li>
<li>
<p>
Get subsequent status updates (along with the latest one) of my friends through <span class="monospaced">NEXT</span> relationships (<span class="monospaced">MATCH myfriend-[:STATUS]-latestupdate-[:NEXT*0..1]-statusupdates</span>) which will give you the latest and one additional statusupdate, adjust <span class="monospaced">0..1</span> to whatever suits your case.
</p>
</li>
<li>
<p>
Sort the status updates by posted date (<span class="monospaced">ORDER BY statusupdates.date DESC</span>).
</p>
</li>
<li>
<p>
<span class="monospaced">LIMIT</span> the number of updates you need in every query (<span class="monospaced">LIMIT x SKIP x*y</span>).
</p>
</li>
</ol></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">name</td><td align="left" valign="top">date</td><td align="left" valign="top">text</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="3">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Joe"</code></p></td><td align="left" valign="top"><p><code class="literal">6</code></p></td><td align="left" valign="top"><p><code class="literal">"Joe status2"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Bob"</code></p></td><td align="left" valign="top"><p><code class="literal">4</code></p></td><td align="left" valign="top"><p><code class="literal">"bobs status2"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Joe"</code></p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td><td align="left" valign="top"><p><code class="literal">"Joe status1"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Bob"})
create (_2 {`date`:1, `name`:"bob_s1", `text`:"bobs status1"})
create (_3 {`date`:4, `name`:"bob_s2", `text`:"bobs status2"})
create (_4 {`name`:"Alice"})
create (_5 {`date`:2, `name`:"alice_s1", `text`:"Alices status1"})
create (_6 {`date`:5, `name`:"alice_s2", `text`:"Alices status2"})
create (_7 {`name`:"Joe"})
create (_8 {`date`:3, `name`:"joe_s1", `text`:"Joe status1"})
create (_9 {`date`:6, `name`:"joe_s2", `text`:"Joe status2"})
create _1-[:`STATUS`]-&gt;_2
create _1-[:`FRIEND` {`status`:"CONFIRMED"}]-&gt;_4
create _2-[:`NEXT`]-&gt;_3
create _4-[:`STATUS`]-&gt;_5
create _4-[:`FRIEND` {`status`:"PENDING"}]-&gt;_7
create _5-[:`NEXT`]-&gt;_6
create _7-[:`STATUS`]-&gt;_8
create _7-[:`FRIEND` {`status`:"CONFIRMED"}]-&gt;_1
create _8-[:`NEXT`]-&gt;_9
</span><span class="command"><strong>
 MATCH me-[rels:FRIEND*0..1]-myfriend
 WHERE me.name = 'Joe' AND ALL(r in rels WHERE r.status = 'CONFIRMED')
 WITH myfriend
 MATCH myfriend-[:STATUS]-latestupdate-[:NEXT*0..1]-statusupdates
 RETURN myfriend.name as name, statusupdates.date as date, statusupdates.text as text
 ORDER BY statusupdates.date DESC LIMIT 3</strong></span></p>
<div class="paragraph" id="cookbook-insert-a-new-status-update-for-a-user"><p>Here, the example shows how to add a new status update into the existing data for a user.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START me=node:node_auto_index(name='Bob')
MATCH me-[r?:STATUS]-secondlatestupdate
WHERE me.name='Bob'
CREATE me-[:STATUS]-&gt;(latest_update{text:'Status',date:123})
DELETE r
WITH latest_update, collect(secondlatestupdate) as seconds
FOREACH(x in seconds :
CREATE latest_update-[:NEXT]-x)
RETURN latest_update.text as new_status</pre></div>
<div class="paragraph"><p>Dividing the query into steps, this query resembles adding new item in middle of a doubly linked list:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Get the latest update (if it exists) of the user through the <span class="monospaced">STATUS</span> relationship (<span class="monospaced">MATCH me-[r?:STATUS]-secondlatestupdate</span>).
</p>
</li>
<li>
<p>
Delete the <span class="monospaced">STATUS</span> relationship between <span class="monospaced">user</span> and <span class="monospaced">secondlatestupdate</span> (if it exists), as this would become the second latest update now and only the latest update would be added through a <span class="monospaced">STATUS</span> relationship, all earlier updates would be connected to their subsequent updates through a <span class="monospaced">NEXT</span> relationship. (<span class="monospaced">DELETE r</span>).
</p>
</li>
<li>
<p>
Now, create the new <span class="monospaced">statusupdate</span> node (with text and date as properties) and connect this with the user through a <span class="monospaced">STATUS</span> relationship (<span class="monospaced">CREATE me-[:STATUS]-&gt;(latest_update{text:'Status',date:123})</span>).
</p>
</li>
<li>
<p>
Now, create a <span class="monospaced">NEXT</span> relationship between the latest status update and the second latest status update (if it exists) (<span class="monospaced">CREATE latest_update-[:NEXT]-secondlatestupdate WHERE secondlatestupdate &lt;&gt; null</span>).
</p>
</li>
</ol></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">new_status</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 2
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 2
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships deleted: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Status"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Bob"})
create (_2 {`date`:1, `name`:"bob_s1", `text`:"bobs status1"})
create (_3 {`date`:4, `name`:"bob_s2", `text`:"bobs status2"})
create _1-[:`STATUS`]-&gt;_2
create _2-[:`NEXT`]-&gt;_3
</span><span class="command"><strong>
 START me=node:node_auto_index(name='Bob')
 MATCH me-[r?:STATUS]-secondlatestupdate
 WHERE me.name='Bob'
 CREATE me-[:STATUS]-&gt;(latest_update{text:'Status',date:123})
 DELETE r
 WITH latest_update, collect(secondlatestupdate) as seconds
 FOREACH(x in seconds : CREATE latest_update-[:NEXT]-x)
 RETURN latest_update.text as new_status</strong></span></p>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-insertstatusupdate-graph.svg" alt="cypher-insertstatusupdate-graph.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-boostingrecommendations">Boosting recommendation results</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-boostingrecommendationresults-graph.svg" alt="cypher-boostingrecommendationresults-graph.svg">
</div>
<div class="title">Figure 21. Graph</div>
</div>
<div class="paragraph" id="cookbook-boosting-with-properties-on-relationships"><p>This query finds the recommended friends for the origin that are working at the same place as the origin,
or know a person that the origin knows, also, the origin should not already know the target. This recommendation is
weighted for the weight of the relationship <span class="monospaced">r2</span>, and boosted with a factor of 2, if there is an <span class="monospaced">activity</span>-property on that relationship</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH origin-[r1:KNOWS|:WORKSAT]-(c)-[r2:KNOWS|:WORKSAT]-candidate
WHERE origin.name = "Clark Kent"
AND type(r1)=type(r2) AND (NOT (origin-[:KNOWS]-candidate))
RETURN origin.name as origin, candidate.name as candidate,
SUM(ROUND(r2.weight + (COALESCE(r2.activity?, 0) * 2))) as boost
ORDER BY boost desc
LIMIT 10</pre></div>
<div class="paragraph"><p>This returns the recommended friends for the origin nodes and their recommendation score.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">origin</td><td align="left" valign="top">candidate</td><td align="left" valign="top">boost</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="3">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Clark Kent"</code></p></td><td align="left" valign="top"><p><code class="literal">"Perry White"</code></p></td><td align="left" valign="top"><p><code class="literal">22</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Clark Kent"</code></p></td><td align="left" valign="top"><p><code class="literal">"Anderson Cooper"</code></p></td><td align="left" valign="top"><p><code class="literal">4</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>MATCH origin-[r1:KNOWS|:WORKSAT]-(c)-[r2:KNOWS|:WORKSAT]-candidate
 WHERE origin.name = "Clark Kent"
 AND type(r1)=type(r2) AND (NOT (origin-[:KNOWS]-candidate))
 RETURN origin.name as origin, candidate.name as candidate,
     SUM(ROUND(r2.weight + (COALESCE(r2.activity?, 0) * 2))) as boost
 ORDER BY boost desc limit 10</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-clustering-coefficient">Calculating the clustering coefficient of a network</h3>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-clusteringcoefficient-graph.svg" alt="cypher-clusteringcoefficient-graph.svg">
</div>
<div class="title">Figure 22. Graph</div>
</div>
<div class="paragraph" id="cookbook-calculating-the-clustering-coefficient-of-a-friend-network"><p>In this example, adapted from
<a href="http://mypetprojects.blogspot.se/2012/06/social-network-analysis-with-neo4j.html">Niko Gamulins blog post on Neo4j for Social Network Analysis</a>,
the graph in question is showing the 2-hop relationships of a sample person as nodes with <span class="monospaced">KNOWS</span> relationships.</p></div>
<div class="paragraph"><p>The <a href="http://en.wikipedia.org/wiki/Clustering_coefficient">clustering coefficient</a> of a selected node is defined as the probability that two randomly selected neighbors are connected to each other.
With the number of neighbors as <span class="monospaced">n</span> and the number of mutual connections between the neighbors <span class="monospaced">r</span> the calculation is:</p></div>
<div class="paragraph"><p>The number of possible connections between two neighbors is <span class="monospaced">n!/(2!(n-2)!) = 4!/(2!(4-2)!) = 24/4 = 6</span>,
where <span class="monospaced">n</span> is the number of neighbors <span class="monospaced">n = 4</span> and the actual number <span class="monospaced">r</span> of connections is <span class="monospaced">1</span>.
Therefore the clustering coefficient of node 1 is <span class="monospaced">1/6</span>.</p></div>
<div class="paragraph"><p><span class="monospaced">n</span> and <span class="monospaced">r</span> are quite simple to retrieve via the following query:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (a)--(b)
WITH a, count(distinct b) as n
MATCH (a)--()-[r]-()--(a)
WHERE a.name! = "startnode"
RETURN n, count(distinct r) as r</pre></div>
<div class="paragraph"><p>This returns <span class="monospaced">n</span> and <span class="monospaced">r</span> for the above calculations.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">4</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"startnode"})
create (_2)
create (_3)
create (_4)
create (_5)
create (_6)
create (_7)
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`KNOWS`]-&gt;_3
create _1-[:`KNOWS`]-&gt;_4
create _1-[:`KNOWS`]-&gt;_5
create _2-[:`KNOWS`]-&gt;_6
create _2-[:`KNOWS`]-&gt;_7
create _3-[:`KNOWS`]-&gt;_4
</span><span class="command"><strong>
 MATCH (a)--(b)  WITH a, count(distinct b) as n MATCH (a)--()-[r]-()--(a) WHERE a.name! = "startnode" RETURN n, count(distinct r) as r</strong></span></p>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-pretty-graphs">Pretty graphs</h3>
<div class="paragraph"><p>This section is showing how to create some of the <a href="http://en.wikipedia.org/wiki/Gallery_of_named_graphs">named pretty graphs on Wikipedia</a>.</p></div>
<div class="sect3">
<h4 id="cookbook-star-graph">Star graph</h4>
<div class="paragraph"><p>The graph is created by first creating a center node, and then once per element in the range, creates a leaf node and connects it to the center.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE center
foreach( x in range(1,6) :

CREATE leaf, center-[:X]-&gt;leaf
)
RETURN id(center) as id;</pre></div>
<div class="paragraph"><p>The query returns the id of the center node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">id</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 7
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 6</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">8</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create center
 foreach( x in range(1,6) :
    create leaf, center-[:X]-&gt;leaf
 )
 return id(center) as id;</strong></span></p>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-prettygraphsstar-graph.svg" alt="cypher-prettygraphsstar-graph.svg">
</div>
<div class="title">Figure 23. Graph</div>
</div>
</div>
<div class="sect3">
<h4 id="cookbook-wheel-graph">Wheel graph</h4>
<div class="paragraph"><p>This graph is created in a number of steps:</p></div>
<div class="ulist"><ul>
<li>
<p>
Create a center node.
</p>
</li>
<li>
<p>
Once per element in the range, create a leaf and connect it to the center.
</p>
</li>
<li>
<p>
Select 2 leafs from the center node and connect them.
</p>
</li>
<li>
<p>
Find the minimum and maximum leaf and connect these.
</p>
</li>
<li>
<p>
Return the id of the center node.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE center
foreach( x in range(1,6) :

CREATE (leaf {count:x}), center-[:X]-&gt;leaf
)
==== center ====
MATCH large_leaf&lt;--center--&gt;small_leaf
WHERE large_leaf.count = small_leaf.count + 1
CREATE small_leaf-[:X]-&gt;large_leaf

==== center, min(small_leaf.count) as min, max(large_leaf.count) as max ====
MATCH first_leaf&lt;--center--&gt;last_leaf
WHERE first_leaf.count = min AND last_leaf.count = max
CREATE last_leaf-[:X]-&gt;first_leaf

RETURN id(center) as id</pre></div>
<div class="paragraph"><p>The query returns the id of the center node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">id</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 7
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 12
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 6</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">8</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>CREATE center
 foreach( x in range(1,6) :
    CREATE (leaf {count:x}), center-[:X]-&gt;leaf
 )
 ==== center ====
 MATCH large_leaf&lt;--center--&gt;small_leaf
 WHERE large_leaf.count = small_leaf.count + 1
 CREATE small_leaf-[:X]-&gt;large_leaf

 ==== center, min(small_leaf.count) as min, max(large_leaf.count) as max ====
 MATCH first_leaf&lt;--center--&gt;last_leaf
 WHERE first_leaf.count = min AND last_leaf.count = max
 CREATE last_leaf-[:X]-&gt;first_leaf

 RETURN id(center) as id</strong></span></p>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-prettygraphswheel-graph.svg" alt="cypher-prettygraphswheel-graph.svg">
</div>
<div class="title">Figure 24. Graph</div>
</div>
</div>
<div class="sect3">
<h4 id="cookbook-complete-graph">Complete graph</h4>
<div class="paragraph"><p>For this graph, a root node is created, and used to hang a number
        of nodes from. Then, two nodes are selected, hanging from the center, with the requirement that the
        id of the first is less than the id of the next. This is to prevent double relationships and
        self relationships. Using said match, relationships between all these nodes are created. Lastly,
        the center node and all relationships connected to it are removed.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE center
foreach( x in range(1,6) :

CREATE (leaf {count : x}), center-[:X]-&gt;leaf
)
==== center ====
MATCH leaf1&lt;--center--&gt;leaf2
WHERE id(leaf1)&lt;id(leaf2)
CREATE leaf1-[:X]-&gt;leaf2
==== center ====
MATCH center-[r]-&gt;()
DELETE center,r;</pre></div>
<div class="paragraph"><p>Nothing is returned by this query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Nodes created: 7
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 21
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 6
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes deleted: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships deleted: 6</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create center
 foreach( x in range(1,6) :
    create (leaf {count : x}), center-[:X]-&gt;leaf
 )
 ==== center ====
 MATCH leaf1&lt;--center--&gt;leaf2
 WHERE id(leaf1)&lt;id(leaf2)
 CREATE leaf1-[:X]-&gt;leaf2
 ==== center ====
 MATCH center-[r]-&gt;()
 DELETE center,r;</strong></span></p>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-prettygraphscompletegraph-graph.svg" alt="cypher-prettygraphscompletegraph-graph.svg">
</div>
<div class="title">Figure 25. Graph</div>
</div>
</div>
<div class="sect3">
<h4 id="cookbook-friendship-graph">Friendship graph</h4>
<div class="paragraph"><p>This query first creates a center node, and then once per element in the range, creates a cycle graph and connects it to the center</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE center
foreach( x in range(1,3) :

CREATE leaf1, leaf2, center-[:X]-&gt;leaf1, center-[:X]-&gt;leaf2, leaf1-[:X]-&gt;leaf2
)
RETURN ID(center) as id</pre></div>
<div class="paragraph"><p>The id of the center node is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">id</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 7
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 9</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">8</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>CREATE center
 foreach( x in range(1,3) :
    CREATE leaf1, leaf2, center-[:X]-&gt;leaf1, center-[:X]-&gt;leaf2, leaf1-[:X]-&gt;leaf2
 )
 RETURN ID(center) as id</strong></span></p>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-prettygraphsfriendshipgraph-graph.svg" alt="cypher-prettygraphsfriendshipgraph-graph.svg">
</div>
<div class="title">Figure 26. Graph</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-path-tree">A multilevel indexing structure (path tree)</h3>
<div class="paragraph"><p>In this example, a multi-level tree structure
is used to index event nodes (here <span class="monospaced">Event1</span>, <span class="monospaced">Event2</span> and <span class="monospaced">Event3</span>,
in this case with a YEAR-MONTH-DAY granularity, making this a timeline indexing structure.
However, this approach should work for a wide range of multi-level ranges.</p></div>
<div class="paragraph"><p>The structure follows a couple of rules:</p></div>
<div class="ulist"><ul>
<li>
<p>
Events can be indexed multiple times by connecting the indexing structure leafs with the events via a <span class="monospaced">VALUE</span> relationship.
</p>
</li>
<li>
<p>
The querying is done in a path-range fashion. That is, the start- and end path from the indexing root to the start and end leafs in the tree are calculated
</p>
</li>
<li>
<p>
Using Cypher, the queries following different strategies can be expressed as path sections and put together using one single query.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The graph below depicts a structure with 3 Events being attached to an index structure at different leafs.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-pathtree-layout-path.svg" alt="cypher-pathtree-layout-path.svg">
</div>
<div class="title">Figure 27. Graph</div>
</div>
<div class="sect3">
<h4 id="cookbook-return-zero-range">Return zero range</h4>
<div class="paragraph"><p>Here, only the events indexed under one leaf (2010-12-31) are returned.
The query only needs one path segment <span class="monospaced">rootPath</span>  (color <span class="monospaced">Green</span>) through the index.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-pathtree-layout-zero-range.svg" alt="cypher-pathtree-layout-zero-range.svg">
</div>
<div class="title">Figure 28. Graph</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH rootPath=root-[:`2010`]-&gt;()-[:`12`]-&gt;()-[:`31`]-&gt;leaf, leaf-[:VALUE]-&gt;event
WHERE root.name = 'Root'RETURN event.name
ORDER BY event.name ASC</pre></div>
<div class="paragraph"><p>Returning all events on the date 2010-12-31, in this case <span class="monospaced">Event1</span> and <span class="monospaced">Event2</span></p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">event.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Event1"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Event2"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Y11M01"})
create (_2 {`name`:"Y10M12D31"})
create (_3 {`name`:"Y10M12"})
create (_4 {`name`:"Event2"})
create (_5 {`name`:"Y11M11D02"})
create (_6 {`name`:"Y11"})
create (_7 {`name`:"Event3"})
create (_8 {`name`:"Y10"})
create (_9 {`name`:"Root"})
create (_10 {`name`:"Event1"})
create (_11 {`name`:"Y11M01D01"})
create (_12 {`name`:"Y11M12D03"})
create _1-[:`01`]-&gt;_11
create _1-[:`02`]-&gt;_5
create _1-[:`03`]-&gt;_12
create _2-[:`NEXT`]-&gt;_11
create _2-[:`VALUE`]-&gt;_10
create _2-[:`VALUE`]-&gt;_4
create _3-[:`31`]-&gt;_2
create _5-[:`NEXT`]-&gt;_12
create _6-[:`01`]-&gt;_1
create _8-[:`12`]-&gt;_3
create _9-[:`2010`]-&gt;_8
create _9-[:`2011`]-&gt;_6
create _11-[:`NEXT`]-&gt;_5
create _11-[:`VALUE`]-&gt;_4
create _12-[:`VALUE`]-&gt;_7
</span><span class="command"><strong>
 MATCH rootPath=root-[:`2010`]-&gt;()-[:`12`]-&gt;()-[:`31`]-&gt;leaf, leaf-[:VALUE]-&gt;event WHERE root.name = 'Root'RETURN event.name ORDER BY event.name ASC</strong></span></p>
</div>
<div class="sect3">
<h4 id="cookbook-return-the-full-range">Return the full range</h4>
<div class="paragraph"><p>In this case, the range goes from the first to the last leaf of the index tree. Here,
<span class="monospaced">startPath</span> (color <span class="monospaced">Greenyellow</span>) and <span class="monospaced">endPath</span>  (color <span class="monospaced">Green</span>) span up the range, <span class="monospaced">valuePath</span>  (color <span class="monospaced">Blue</span>) is then connecting the leafs, and the values can
be read from the <span class="monospaced">middle</span> node, hanging off the <span class="monospaced">values</span> (color <span class="monospaced">Red</span>) path.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-pathtree-layout-full-range-path.svg" alt="cypher-pathtree-layout-full-range-path.svg">
</div>
<div class="title">Figure 29. Graph</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH startPath=root-[:`2010`]-&gt;()-[:`12`]-&gt;()-[:`31`]-&gt;startLeaf,
      endPath=root-[:`2011`]-&gt;()-[:`01`]-&gt;()-[:`03`]-&gt;endLeaf,
      valuePath=startLeaf-[:NEXT*0..]-&gt;middle-[:NEXT*0..]-&gt;endLeaf,
      vals=middle-[:VALUE]-&gt;event
WHERE root.name = 'Root'RETURN event.name
ORDER BY event.name ASC</pre></div>
<div class="paragraph"><p>Returning all events between 2010-12-31 and 2011-01-03, in this case all events.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">event.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">4 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Event1"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Event2"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Event2"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Event3"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Y11M01"})
create (_2 {`name`:"Y10M12D31"})
create (_3 {`name`:"Y10M12"})
create (_4 {`name`:"Event2"})
create (_5 {`name`:"Y11M11D02"})
create (_6 {`name`:"Y11"})
create (_7 {`name`:"Event3"})
create (_8 {`name`:"Y10"})
create (_9 {`name`:"Root"})
create (_10 {`name`:"Event1"})
create (_11 {`name`:"Y11M01D01"})
create (_12 {`name`:"Y11M12D03"})
create _1-[:`01`]-&gt;_11
create _1-[:`02`]-&gt;_5
create _1-[:`03`]-&gt;_12
create _2-[:`NEXT`]-&gt;_11
create _2-[:`VALUE`]-&gt;_10
create _2-[:`VALUE`]-&gt;_4
create _3-[:`31`]-&gt;_2
create _5-[:`NEXT`]-&gt;_12
create _6-[:`01`]-&gt;_1
create _8-[:`12`]-&gt;_3
create _9-[:`2010`]-&gt;_8
create _9-[:`2011`]-&gt;_6
create _11-[:`NEXT`]-&gt;_5
create _11-[:`VALUE`]-&gt;_4
create _12-[:`VALUE`]-&gt;_7
</span><span class="command"><strong>
 MATCH startPath=root-[:`2010`]-&gt;()-[:`12`]-&gt;()-[:`31`]-&gt;startLeaf, endPath=root-[:`2011`]-&gt;()-[:`01`]-&gt;()-[:`03`]-&gt;endLeaf, valuePath=startLeaf-[:NEXT*0..]-&gt;middle-[:NEXT*0..]-&gt;endLeaf, vals=middle-[:VALUE]-&gt;event WHERE root.name = 'Root'RETURN event.name ORDER BY event.name ASC</strong></span></p>
</div>
<div class="sect3">
<h4 id="cookbook-return-partly-shared-path-ranges">Return partly shared path ranges</h4>
<div class="paragraph"><p>Here, the query range results in partly shared paths when querying the index,
making the introduction of and common path segment <span class="monospaced">commonPath</span> (color <span class="monospaced">Black</span>) necessary, before spanning up <span class="monospaced">startPath</span> (color <span class="monospaced">Greenyellow</span>) and
<span class="monospaced">endPath</span> (color <span class="monospaced">Darkgreen</span>) . After that, <span class="monospaced">valuePath</span> (color <span class="monospaced">Blue</span>) connects the leafs and the indexed values are returned off <span class="monospaced">values</span> (color <span class="monospaced">Red</span>)  path.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-pathtree-layout-shared-root-path.svg" alt="cypher-pathtree-layout-shared-root-path.svg">
</div>
<div class="title">Figure 30. Graph</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH commonPath=root-[:`2011`]-&gt;()-[:`01`]-&gt;commonRootEnd,
      startPath=commonRootEnd-[:`01`]-&gt;startLeaf,
      endPath=commonRootEnd-[:`03`]-&gt;endLeaf,
      valuePath=startLeaf-[:NEXT*0..]-&gt;middle-[:NEXT*0..]-&gt;endLeaf,
      vals=middle-[:VALUE]-&gt;event
WHERE root.name = 'Root'RETURN event.name
ORDER BY event.name ASC</pre></div>
<div class="paragraph"><p>Returning all events between 2011-01-01 and 2011-01-03, in this case <span class="monospaced">Event2</span> and <span class="monospaced">Event3</span>.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">event.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Event2"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Event3"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Y11M01"})
create (_2 {`name`:"Y10M12D31"})
create (_3 {`name`:"Y10M12"})
create (_4 {`name`:"Event2"})
create (_5 {`name`:"Y11M11D02"})
create (_6 {`name`:"Y11"})
create (_7 {`name`:"Event3"})
create (_8 {`name`:"Y10"})
create (_9 {`name`:"Root"})
create (_10 {`name`:"Event1"})
create (_11 {`name`:"Y11M01D01"})
create (_12 {`name`:"Y11M12D03"})
create _1-[:`01`]-&gt;_11
create _1-[:`02`]-&gt;_5
create _1-[:`03`]-&gt;_12
create _2-[:`NEXT`]-&gt;_11
create _2-[:`VALUE`]-&gt;_10
create _2-[:`VALUE`]-&gt;_4
create _3-[:`31`]-&gt;_2
create _5-[:`NEXT`]-&gt;_12
create _6-[:`01`]-&gt;_1
create _8-[:`12`]-&gt;_3
create _9-[:`2010`]-&gt;_8
create _9-[:`2011`]-&gt;_6
create _11-[:`NEXT`]-&gt;_5
create _11-[:`VALUE`]-&gt;_4
create _12-[:`VALUE`]-&gt;_7
</span><span class="command"><strong>
 MATCH commonPath=root-[:`2011`]-&gt;()-[:`01`]-&gt;commonRootEnd, startPath=commonRootEnd-[:`01`]-&gt;startLeaf, endPath=commonRootEnd-[:`03`]-&gt;endLeaf, valuePath=startLeaf-[:NEXT*0..]-&gt;middle-[:NEXT*0..]-&gt;endLeaf, vals=middle-[:VALUE]-&gt;event WHERE root.name = 'Root'RETURN event.name ORDER BY event.name ASC</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-similarity-calc">Complex similarity computations</h3>
<div class="sect3">
<h4 id="cookbook-calculate-similarities-by-complex-calculations">Calculate similarities by complex calculations</h4>
<div class="paragraph"><p>Here, a similarity between two players in a game is calculated by the number of times they have eaten the same food.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH me-[r1:ATE]-&gt;food&lt;-[r2:ATE]-you
WHERE me.name = 'me'
==== me,count(distinct r1) as H1,count(distinct r2) as H2,you ====
MATCH me-[r1:ATE]-&gt;food&lt;-[r2:ATE]-you
RETURN sum((1-ABS(r1.times/H1-r2.times/H2))*(r1.times+r2.times)/(H1+H2)) as similarity</pre></div>
<div class="paragraph"><p>The two players and their similarity measure.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">similarity</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">-30.0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"me"})
create (_2 {`name`:"meat"})
create (_3 {`name`:"you"})
create _1-[:`ATE` {`times`:10}]-&gt;_2
create _3-[:`ATE` {`times`:5}]-&gt;_2
</span><span class="command"><strong>
 MATCH me-[r1:ATE]-&gt;food&lt;-[r2:ATE]-you
 WHERE me.name = 'me'
 ==== me,count(distinct r1) as H1,count(distinct r2) as H2,you ====
 MATCH me-[r1:ATE]-&gt;food&lt;-[r2:ATE]-you
 RETURN sum((1-ABS(r1.times/H1-r2.times/H2))*(r1.times+r2.times)/(H1+H2)) as similarity</strong></span></p>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-complexsimilarity-graph.svg" alt="cypher-complexsimilarity-graph.svg">
</div>
<div class="title">Figure 31. Graph</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cypher-cookbook-graphity">The Graphity activity stream model</h3>
<div class="sect3">
<h4 id="cookbook-find-activity-streams-in-a-network-without-scaling-penalty">Find Activity Streams in a network without scaling penalty</h4>
<div class="paragraph"><p>This is an approach for scaling the retrieval of activity streams in a friend graph put forward by Rene Pickard as <a href="http://www.rene-pickhardt.de/graphity-an-efficient-graph-model-for-retrieving-the-top-k-news-feeds-for-users-in-social-networks/">Graphity</a>.
In short, a linked list is created for every persons friends in the order that the last activities of these friends have occured.
When new activities occur for a friend, all the ordered friend lists that this friend is part of are reordered, transferring computing load to the time of new event updates instead of activity stream reads.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">This approach of course makes excessive use of relationship types.
This needs to be taken into consideration when designing a production system with this approach.
See <a href="#capabilities-capacity">[capabilities-capacity]</a> for the maximum number of relationship types.</td>
</tr></table>
</div>
<div class="paragraph"><p>To find the activity stream for a person, just follow the linked list of the friend list, and retrieve the needed amount of activities form the respective activity list of the friends.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=me-[:jane_knows*]-&gt;friend, friend-[:has]-&gt;status
WHERE me.name = 'Jane'
RETURN me.name, friend.name, status.name, length(p)
ORDER BY length(p)</pre></div>
<div class="paragraph"><p>The returns the activity stream for Jane.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">me.name</td><td align="left" valign="top">friend.name</td><td align="left" valign="top">status.name</td><td align="left" valign="top">length(p)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="4">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Jane"</code></p></td><td align="left" valign="top"><p><code class="literal">"Bill"</code></p></td><td align="left" valign="top"><p><code class="literal">"Bill_s1"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Jane"</code></p></td><td align="left" valign="top"><p><code class="literal">"Joe"</code></p></td><td align="left" valign="top"><p><code class="literal">"Joe_s1"</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Jane"</code></p></td><td align="left" valign="top"><p><code class="literal">"Bob"</code></p></td><td align="left" valign="top"><p><code class="literal">"Bob_s1"</code></p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Bill"})
create (_2 {`name`:"Ted_s1"})
create (_3 {`name`:"Bill_s1"})
create (_4 {`name`:"Ted_s2"})
create (_5 {`name`:"Bill_s2"})
create (_6 {`name`:"Jane"})
create (_7 {`name`:"Joe_s1"})
create (_8 {`name`:"Bob"})
create (_9 {`name`:"Ted"})
create (_10 {`name`:"Joe_s2"})
create (_11 {`name`:"Bob_s1"})
create (_12 {`name`:"Joe"})
create _1-[:`has`]-&gt;_3
create _1-[:`jane_knows`]-&gt;_12
create _2-[:`next`]-&gt;_4
create _3-[:`next`]-&gt;_5
create _6-[:`jane_knows`]-&gt;_1
create _7-[:`next`]-&gt;_10
create _8-[:`has`]-&gt;_11
create _8-[:`bob_knows`]-&gt;_9
create _9-[:`has`]-&gt;_2
create _9-[:`bob_knows`]-&gt;_1
create _12-[:`has`]-&gt;_7
create _12-[:`jane_knows`]-&gt;_8
</span><span class="command"><strong>
 MATCH p=me-[:jane_knows*]-&gt;friend, friend-[:has]-&gt;status WHERE me.name = 'Jane' RETURN me.name, friend.name, status.name, length(p) ORDER BY length(p)</strong></span></p>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-graphity-graph.svg" alt="cypher-graphity-graph.svg">
</div>
<div class="title">Figure 32. Graph</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="languages">Languages</h2>
<div class="sectionbody">
<div class="paragraph"><p>The table below lists community contributed language- and framework bindings for using Neo4j in embedded mode.</p></div>
<div class="paragraph" id="embedded-drivers"><div class="title">Neo4j embedded drivers contributed by the community.</div><p>Please see <a href="http://www.neo4j.org/drivers">http://www.neo4j.org/drivers</a> for the current set of drivers!</p></div>
<div class="paragraph"><p>For information on REST clients for different languages, see <a href="#tutorials-rest">[tutorials-rest]</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="server-extending">Extending the Neo4j Server</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Neo4j Server can be extended by either plugins or unmanaged extensions.
For more information on the server, see <a href="#server">[server]</a>.</p></div>
<div class="sect2">
<h3 id="server-plugins">Server Plugins</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick info</div>
<div class="ulist"><ul>
<li>
<p>
The server&#8217;s functionality can be extended by adding plugins.
</p>
</li>
<li>
<p>
Plugins are user-specified code which extend the capabilities of the database, nodes, or relationships.
</p>
</li>
<li>
<p>
The neo4j server will then advertise the plugin functionality within representations as clients interact via HTTP.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>Plugins provide an easy way to extend the Neo4j REST API with new functionality, without the need to
invent your own API.
Think of plugins as server-side scripts that can add functions for retrieving and manipulating nodes, relationships, paths, properties or indices.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you want to have full control over your API, and are willing to put in the effort, and understand the risks, then Neo4j server also provides hooks for <a href="#server-unmanaged-extensions">unmanaged extensions</a> based on JAX-RS.</td>
</tr></table>
</div>
<div class="paragraph"><p>The needed classes reside in the <a href="http://search.maven.org/#search|gav|1|g%3A%22org.neo4j%22%20AND%20a%3A%22server-api%22">org.neo4j:server-api</a> jar file.
See the linked page for downloads and instructions on how to include it using dependency management.
For Maven projects, add the Server API dependencies in your <span class="monospaced">pom.xml</span> like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: xml">&lt;dependency&gt;
  &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
  &lt;artifactId&gt;server-api&lt;/artifactId&gt;
  &lt;version&gt;${neo4j-version}&lt;/version&gt;
&lt;/dependency&gt;</pre></div>
<div class="paragraph"><p><em>Where ${neo4j-version} is the intended version.</em></p></div>
<div class="paragraph"><p>To create a plugin, your code must inherit from the <a href="http://components.neo4j.org/server-api/2.0-SNAPSHOT/apidocs/org/neo4j/server/plugins/ServerPlugin.html">ServerPlugin</a> class.
Your plugin should also:</p></div>
<div class="ulist"><ul>
<li>
<p>
ensure that it can produce an (Iterable of) <span class="monospaced">Node</span>, <span class="monospaced">Relationship</span> or <span class="monospaced">Path</span>, any Java primitive or <span class="monospaced">String</span> or an instance of a <span class="monospaced">org.neo4j.server.rest.repr.Representation</span>
</p>
</li>
<li>
<p>
specify parameters,
</p>
</li>
<li>
<p>
specify a point of extension and of course
</p>
</li>
<li>
<p>
contain the application logic.
</p>
</li>
<li>
<p>
make sure that the discovery point type in the <span class="monospaced">@PluginTarget</span> and the <span class="monospaced">@Source</span> parameter are of the same type.
</p>
</li>
</ul></div>
<div class="paragraph"><p>An example of a plugin which augments the database (as opposed to nodes or relationships) follows:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">@Description( "An extension to the Neo4j Server for getting all nodes or relationships" )
public class GetAll extends ServerPlugin
{
    @Name( "get_all_nodes" )
    @Description( "Get all nodes from the Neo4j graph database" )
    @PluginTarget( GraphDatabaseService.class )
    public Iterable&lt;Node&gt; getAllNodes( @Source GraphDatabaseService graphDb )
    {
        return GlobalGraphOperations.at( graphDb ).getAllNodes();
    }

    @Description( "Get all relationships from the Neo4j graph database" )
    @PluginTarget( GraphDatabaseService.class )
    public Iterable&lt;Relationship&gt; getAllRelationships( @Source GraphDatabaseService graphDb )
    {
        return GlobalGraphOperations.at( graphDb ).getAllRelationships();
    }
}</pre>
</div></div>
<div class="paragraph"><p>The full source code is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/plugins/GetAll.java">GetAll.java</a></p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public class ShortestPath extends ServerPlugin
{
    @Description( "Find the shortest path between two nodes." )
    @PluginTarget( Node.class )
    public Iterable&lt;Path&gt; shortestPath(
            @Source Node source,
            @Description( "The node to find the shortest path to." )
                @Parameter( name = "target" ) Node target,
            @Description( "The relationship types to follow when searching for the shortest path(s). " +
                    "Order is insignificant, if omitted all types are followed." )
                @Parameter( name = "types", optional = true ) String[] types,
            @Description( "The maximum path length to search for, default value (if omitted) is 4." )
                @Parameter( name = "depth", optional = true ) Integer depth )
    {
        Expander expander;
        if ( types == null )
        {
            expander = Traversal.expanderForAllTypes();
        }
        else
        {
            expander = Traversal.emptyExpander();
            for ( int i = 0; i &lt; types.length; i++ )
            {
                expander = expander.add( DynamicRelationshipType.withName( types[i] ) );
            }
        }
        PathFinder&lt;Path&gt; shortestPath = GraphAlgoFactory.shortestPath(
                expander, depth == null ? 4 : depth.intValue() );
        return shortestPath.findAllPaths( source, target );
    }
}</pre>
</div></div>
<div class="paragraph"><p>The full source code is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/plugins/ShortestPath.java">ShortestPath.java</a></p></div>
<div class="paragraph"><p>To deploy the code, simply compile it into a .jar file and place it onto the server classpath (which by
convention is the plugins directory under the Neo4j server home directory).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Make sure the directories listings are retained in the jarfile by either building with default Maven, or with <span class="monospaced">jar -cvf myext.jar *</span>, making sure
to jar directories instead of specifying single files.</td>
</tr></table>
</div>
<div class="paragraph"><p>The <em>.jar</em> file must include the file <em>META-INF/services/org.neo4j.server.plugins.ServerPlugin</em> with the fully qualified name of the implementation class.
This is an example with multiple entries, each on a separate line:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.examples.server.plugins.GetAll
org.neo4j.examples.server.plugins.DepthTwo
org.neo4j.examples.server.plugins.ShortestPath</pre></div>
<div class="paragraph"><p>The code above makes an extension visible in the database representation (via the <span class="monospaced">@PluginTarget</span> annotation)
whenever it is served from the Neo4j Server.
Simply changing the <span class="monospaced">@PluginTarget</span> parameter to <span class="monospaced">Node.class</span> or <span class="monospaced">Relationship.class</span> allows us to target those parts of the data model should we wish.
The functionality extensions provided by the plugin are automatically advertised in representations on the wire.
For example, clients can discover the extension implemented by the above plugin easily by examining the representations
they receive as responses from the server, e.g. by performing a <span class="monospaced">GET</span> on the default database URI:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">curl -v http://localhost:7474/db/data/</pre></div>
<div class="paragraph"><p>The response to the <span class="monospaced">GET</span> request will contain (by default) a JSON container that itself contains a container
called "extensions" where the available plugins are listed.
In the following case, we only have the <span class="monospaced">GetAll</span> plugin registered with the server, so only its extension functionality is available.
Extension names will be automatically assigned, based on method names, if not specifically specified using the <span class="monospaced">@Name</span> annotation.</p></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
"extensions-info" : "http://localhost:7474/db/data/ext",
"node" : "http://localhost:7474/db/data/node",
"node_index" : "http://localhost:7474/db/data/index/node",
"relationship_index" : "http://localhost:7474/db/data/index/relationship",
"reference_node" : "http://localhost:7474/db/data/node/0",
"extensions_info" : "http://localhost:7474/db/data/ext",
"extensions" : {
  "GetAll" : {
    "get_all_nodes" : "http://localhost:7474/db/data/ext/GetAll/graphdb/get_all_nodes",
    "get_all_relationships" : "http://localhost:7474/db/data/ext/GetAll/graphdb/getAllRelationships"
  }
}</pre></div>
<div class="paragraph"><p>Performing a <span class="monospaced">GET</span> on one of the two extension URIs gives back the meta information about the service:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">curl http://localhost:7474/db/data/ext/GetAll/graphdb/get_all_nodes</pre></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extends" : "graphdb",
  "description" : "Get all nodes from the Neo4j graph database",
  "name" : "get_all_nodes",
  "parameters" : [ ]
}</pre></div>
<div class="paragraph"><p>To use it, just <span class="monospaced">POST</span> to this URL, with parameters as specified in the description and encoded as JSON data content.
F.ex for calling the <span class="monospaced">shortest path</span> extension (URI gotten from a <span class="monospaced">GET</span> to <a href="http://localhost:7474/db/data/node/123">http://localhost:7474/db/data/node/123</a>):</p></div>
<div class="listingblock">
<pre class="programlisting brush: bash">curl -X POST http://localhost:7474/db/data/ext/GetAll/node/123/shortestPath \
  -H "Content-Type: application/json" \
  -d '{"target":"http://localhost:7474/db/data/node/456&amp;depth=5"}'</pre></div>
<div class="paragraph"><p>If everything is OK a response code <span class="monospaced">200</span> and a list of zero or more items will be returned.
If nothing is returned (null returned from extension) an empty result and response code <span class="monospaced">204</span> will be returned.
If the extension throws an exception response code <span class="monospaced">500</span> and a detailed error message is returned.</p></div>
<div class="paragraph"><p>Extensions that do any kind of write operation will have to manage their own transactions, i.e. transactions aren&#8217;t managed automatically.</p></div>
<div class="paragraph"><p>Through this model, any plugin can naturally fit into the general hypermedia scheme that Neo4j espouses&#8201;&#8212;&#8201;meaning that
clients can still take advantage of abstractions like  Nodes, Relationships and Paths with a straightforward upgrade
path as servers are enriched with plugins (old clients don&#8217;t break).</p></div>
</div>
<div class="sect2">
<h3 id="server-unmanaged-extensions">Unmanaged Extensions</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick info</div>
<div class="ulist"><ul>
<li>
<p>
Danger: Men at Work!
  The unmanaged extensions are a way of deploying arbitrary JAX-RS code into the Neo4j server.
</p>
</li>
<li>
<p>
The unmanaged extensions are exactly that: unmanaged.
  If you drop poorly tested code into the server, it&#8217;s highly likely you&#8217;ll degrade its performance, so be careful.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>Some projects want extremely fine control over their server-side code.
For this we&#8217;ve introduced an unmanaged extension API.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">This is a sharp tool, allowing users to deploy arbitrary <a href="http://en.wikipedia.org/wiki/JAX-RS">JAX-RS</a> classes to the server and so you should be careful when thinking about using this.
In particular you should understand that it&#8217;s easy to consume lots of heap space on the server and hinder performance if you&#8217;re not careful.</td>
</tr></table>
</div>
<div class="paragraph"><p>Still, if you understand the disclaimer, then you load your JAX-RS classes into the Neo4j server simply by adding adding a @Context annotation to your code, compiling against the JAX-RS jar and any Neo4j jars you&#8217;re making use of.
Then add your classes to the runtime classpath (just drop it in the lib directory of the Neo4j server).
In return you get access to the hosted environment of the Neo4j server like logging through the <span class="monospaced">org.neo4j.server.logging.Logger</span>.</p></div>
<div class="paragraph"><p>In your code, you get access to the underlying <span class="monospaced">GraphDatabaseService</span> through the <span class="monospaced">@Context</span> annotation like so:</p></div>
<div class="listingblock">
<pre class="programlisting brush: java">public MyCoolService( @Context GraphDatabaseService database )
{
  // Have fun here, but be safe!
}</pre></div>
<div class="paragraph"><p>Remember, the unmanaged API is a very sharp tool.
It&#8217;s all to easy to compromise the server by deploying code this way, so think first and see if you can&#8217;t use the managed extensions in preference.
However, a number of context parameters can be automatically provided for you, like the reference to the database.</p></div>
<div class="paragraph"><p>In order to specify the mount point of your extension, a full class looks like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">@Path( "/helloworld" )
public class HelloWorldResource
{
    private final GraphDatabaseService database;

    public HelloWorldResource( @Context GraphDatabaseService database )
    {
        this.database = database;
    }

    @GET
    @Produces( MediaType.TEXT_PLAIN )
    @Path( "/{nodeId}" )
    public Response hello( @PathParam( "nodeId" ) long nodeId )
    {
        // Do stuff with the database
        return Response.status( Status.OK ).entity(
                ("Hello World, nodeId=" + nodeId).getBytes( Charset.forName("UTF-8") ) ).build();
    }
}</pre>
</div></div>
<div class="paragraph"><p>The full source code is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/unmanaged/HelloWorldResource.java">HelloWorldResource.java</a></p></div>
<div class="paragraph"><p>Build this code, and place the resulting jar file (and any custom dependencies) into the <span class="monospaced">$NEO4J_SERVER_HOME/plugins</span> directory, and include this class in the <span class="monospaced">neo4j-server.properties</span> file, like so:</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Make sure the directories listings are retained in the jarfile by either building with default Maven, or with <span class="monospaced">jar -cvf myext.jar *</span>, making sure
to jar directories instead of specifying single files.</td>
</tr></table>
</div>
<div class="listingblock">
<pre class="programlisting brush: plain">#Comma separated list of JAXRS packages containing JAXRS Resource, one package name for each mountpoint.
org.neo4j.server.thirdparty_jaxrs_classes=org.neo4j.examples.server.unmanaged=/examples/unmanaged</pre></div>
<div class="paragraph"><p>Which binds the hello method to respond to <span class="monospaced">GET</span> requests at the URI: <span class="monospaced">http://{neo4j_server}:{neo4j_port}/examples/unmanaged/helloworld/{nodeId}</span></p></div>
<div class="listingblock">
<pre class="programlisting brush: bash">curl http://localhost:7474/examples/unmanaged/helloworld/123</pre></div>
<div class="paragraph"><p>which results in</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Hello World, nodeId=123</pre></div>
</div>
</div>
</div>
<h1 id="cypher-query-lang">Cypher Query Language</h1>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>The Cypher part is the authoritative source for details on the Cypher Query Language.
For an introduction, see <a href="#cypher-introduction">[cypher-introduction]</a>.</p></div>
</div></div>
<div class="sect1">
<h2 id="cypher-intro">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>To get an overview of Cypher, continue reading <a href="#cypher-introduction">[cypher-introduction]</a>.
The rest of this chapter deals with the context of Cypher statements, like for examaple transaction management and how to use parameters.
For the Cypher langauage reference itself see other chapters at <a href="#cypher-query-lang">[cypher-query-lang]</a>.</p></div>
<div class="sect2">
<h3 id="cypher-introduction">What is Cypher?</h3>
<div class="paragraph"><p><em>Cypher</em> is a declarative graph query language that allows for expressive and efficient querying and updating of the graph store without having to write traversals through the graph structure in code.
Cypher is still growing and maturing, and that means that there probably will be breaking syntax changes.
It also means that it has not undergone the same rigorous performance testing as other Neo4j components.</p></div>
<div class="paragraph"><p>Cypher is designed to be a humane query language, suitable for both developers and (importantly, we think) operations professionals who want to make ad-hoc queries on the database.
Our guiding goal is to make the simple things simple, and the complex things possible.
Its constructs are based on English prose and neat iconography, which helps to make it (somewhat) self-explanatory.</p></div>
<div class="paragraph"><p>Cypher is inspired by a number of different approaches and builds upon established practices for expressive querying.
Most of the keywords like <span class="monospaced">WHERE</span> and <span class="monospaced">ORDER BY</span> are inspired by <a href="http://en.wikipedia.org/wiki/SQL">SQL</a>.
Pattern matching borrows expression approaches from <a href="http://en.wikipedia.org/wiki/SPARQL">SPARQL</a>.</p></div>
<div class="paragraph"><p>Being a declarative language, Cypher focuses on the clarity of expressing <em>what</em> to retrieve from a graph, not <em>how</em>
to do it, in contrast to imperative languages like Java, and scripting languages like
<a href="http://gremlin.tinkerpop.com">Gremlin</a> and <a href="http://neo4j.rubyforge.org/">the JRuby Neo4j bindings</a>. This makes the concern of how to optimize queries an
implementation detail not exposed to the user.</p></div>
<div class="paragraph"><p>The query language is comprised of several distinct clauses.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">START</span>: Starting points in the graph, obtained via index lookups or by element IDs.
</p>
</li>
<li>
<p>
<span class="monospaced">MATCH</span>: The graph pattern to match, bound to the starting points in <span class="monospaced">START</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">WHERE</span>: Filtering criteria.
</p>
</li>
<li>
<p>
<span class="monospaced">RETURN</span>: What to return.
</p>
</li>
<li>
<p>
<span class="monospaced">CREATE</span>: Creates nodes and relationships.
</p>
</li>
<li>
<p>
<span class="monospaced">DELETE</span>: Removes nodes, relationships and properties.
</p>
</li>
<li>
<p>
<span class="monospaced">SET</span>: Set values to properties.
</p>
</li>
<li>
<p>
<span class="monospaced">FOREACH</span>: Performs updating actions once per element in a list.
</p>
</li>
<li>
<p>
<span class="monospaced">WITH</span>: Divides a query into multiple, distinct parts.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s see three of them in action.</p></div>
<div class="paragraph"><p>Imagine an example graph like the following one:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Example-Graph-cypher-intro.svg" alt="Example-Graph-cypher-intro.svg">
</div>
<div class="title">Figure 33. Example Graph</div>
</div>
<div class="paragraph"><p>For example, here is a query which finds a user called John in an index and then traverses the graph looking for friends of Johns friends (though not his direct friends) before returning both John and any friends-of-friends that are found.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START john=node:node_auto_index(name = 'John')
MATCH john-[:friend]-&gt;()-[:friend]-&gt;fof
RETURN john, fof</pre></div>
<div class="paragraph"><p>Resulting in:</p></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">john</td><td align="left" valign="top">fof</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[4]{name:"John"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Maria"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[4]{name:"John"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Steve"}</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>Next up we will add filtering to set more parts in motion:</p></div>
<div class="paragraph"><p>In this next example, we take a list of users (by node ID) and traverse the graph looking for those other users that have an outgoing <span class="monospaced">friend</span> relationship, returning only those followed users who have a <span class="monospaced">name</span> property starting with <span class="monospaced">S</span>.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START user=node(5,4,1,2,3)
MATCH user-[:friend]-&gt;follower
WHERE follower.name =~ 'S.*'
RETURN user, follower.name</pre></div>
<div class="paragraph"><p>Resulting in:</p></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">user</td><td align="left" valign="top">follower.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[5]{name:"Joe"}</code></p></td><td align="left" valign="top"><p><code class="literal">"Steve"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[4]{name:"John"}</code></p></td><td align="left" valign="top"><p><code class="literal">"Sara"</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>To use Cypher from Java, see <a href="#tutorials-cypher-java">[tutorials-cypher-java]</a>.
For more Cypher examples, see <a href="#data-modeling-examples">[data-modeling-examples]</a> as well.</p></div>
</div>
<div class="sect2">
<h3 id="query-updating">Updating the graph</h3>
<div class="paragraph"><p>Cypher can be used for both querying and updating your graph.</p></div>
<div class="sect3">
<h4 id="query-updating-structure">The Structure of Updating Queries</h4>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick info</div>
<div class="ulist"><ul>
<li>
<p>
A Cypher query part can&#8217;t both match and update the graph at the same time.
</p>
</li>
<li>
<p>
Every part can either read and match on the graph, or make updates on it.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>If you read from the graph, and then update the graph, your query implicitly has two parts&#8201;&#8212;&#8201;the reading is the first
part, and the writing is the second. If your query is read-only, Cypher will be lazy, and not actually pattern match
until you ask for the results. Here, the semantics are that <em>all</em> the reading will be done before any writing actually
happens. This is very important&#8201;&#8212;&#8201;without this it&#8217;s easy to find cases where the pattern matcher runs into data that is
being created by the very same query, and all bets are off. That road leads to Heisenbugs, Brownian motion and cats that
are dead and alive at the same time.</p></div>
<div class="paragraph"><p>First reading, and then writing, is the only pattern where the query parts are implicit&#8201;&#8212;&#8201;any other order and you
have to be explicit about your query parts. The parts are separated using the <span class="monospaced">WITH</span> statement. <span class="monospaced">WITH</span> is like the event
horizon&#8201;&#8212;&#8201;it&#8217;s a barrier between a plan and the finished execution of that plan.</p></div>
<div class="paragraph"><p>When you want to filter using aggregated data, you have to chain together two reading query parts&#8201;&#8212;&#8201;the first one does the
aggregating, and the second query filters on the results coming from the first one.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n=node(...)
MATCH n-[:friend]-friend
WITH n, count(friend) as friendsCount
WHERE friendsCount &gt; 3
RETURN n, friendsCount</pre></div>
<div class="paragraph"><p>Using <span class="monospaced">WITH</span>, you specify how you want the aggregation to happen, and that the aggregation has to be finished before
Cypher can start filtering.</p></div>
<div class="paragraph"><p>You can chain together as many query parts as you have JVM heap for.</p></div>
</div>
<div class="sect3">
<h4 id="query-updating-return">Returning data</h4>
<div class="paragraph"><p>Any query can return data. If your query only reads, it has to return data&#8201;&#8212;&#8201;it serves no purpose if it doesn&#8217;t, and
 it is not a valid Cypher query. Queries that update the graph don&#8217;t have to return anything, but they can.</p></div>
<div class="paragraph"><p>After all the parts of the query comes one final <span class="monospaced">RETURN</span> statement. <span class="monospaced">RETURN</span> is not part of any query part&#8201;&#8212;&#8201;it
is a period symbol after an eloquent statement. When <span class="monospaced">RETURN</span> is legal, it&#8217;s also legal to use <span class="monospaced">SKIP</span>/<span class="monospaced">LIMIT</span> and <span class="monospaced">ORDER BY</span>.</p></div>
<div class="paragraph"><p>If you return graph elements from a query that has just deleted them&#8201;&#8212;&#8201;beware, you are holding a pointer that is no
 longer valid. Operations on that node might fail mysteriously and unpredictably.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="query-transactions">Transactions</h3>
<div class="paragraph"><p>Any query that updates the graph will run in a transaction.
An updating query will always either fully succeed, or not succeed at all.</p></div>
<div class="paragraph"><p>Cypher will either create a new transaction or run inside an existing one:</p></div>
<div class="ulist"><ul>
<li>
<p>
If no transaction exists in the running context Cypher will create one and commit it once the query finishes.
</p>
</li>
<li>
<p>
In case there already exists a transaction in the running context, the query will run inside it, and nothing will be persisted to disk until that transaction is successfully committed.
</p>
</li>
</ul></div>
<div class="paragraph"><p>This can be used to have multiple queries be committed as a single transaction:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Open a transaction,
</p>
</li>
<li>
<p>
run multiple updating Cypher queries,
</p>
</li>
<li>
<p>
and commit all of them in one go.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Note that a query will hold the changes in memory until the whole query has finished executing.
A large query will consequently need a JVM with lots of heap space.</p></div>
</div>
<div class="sect2">
<h3 id="cypher-parameters">Parameters</h3>
<div class="paragraph"><p>Cypher supports querying with parameters. This allows developers to not to have to do string building
to create a query, and it also makes caching of execution plans much easier for Cypher.</p></div>
<div class="paragraph"><p>Parameters can be used for literals and expressions in the <span class="monospaced">WHERE</span> clause, for the index key and index value in the <span class="monospaced">START</span>
clause, index queries, and finally for node/relationship ids. Parameters can not be used as for property names, since
property notation is part of query structure that is compiled into a query plan.</p></div>
<div class="paragraph"><p>Accepted names for parameter are letters and number, and any combination of these.</p></div>
<div class="paragraph"><p>Here follows a few examples of how you can use parameters from Java.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "id", 0 );
ExecutionResult result = engine.execute( "start n=node({id}) return n.name", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "node", andreasNode );
ExecutionResult result = engine.execute( "start n=node({node}) return n.name", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "id", Arrays.asList( 0, 1, 2 ) );
ExecutionResult result = engine.execute( "start n=node({id}) return n.name", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "name", "Johan" );
ExecutionResult result =
        engine.execute( "start n=node(0,1,2) where n.name = {name} return n", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "value", "Michaela" );
ExecutionResult result =
        engine.execute( "start n=node:people(name = {value}) return n", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "query", "name:Andreas" );
ExecutionResult result = engine.execute( "start n=node:people({query}) return n", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "s", 1 );
params.put( "l", 1 );
ExecutionResult result =
        engine.execute( "start n=node(0,1,2) return n.name skip {s} limit {l}", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "regex", ".*h.*" );
ExecutionResult result =
        engine.execute( "start n=node(0,1,2) where n.name =~ {regex} return n.name", params );</pre>
</div></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; n1 = new HashMap&lt;String, Object&gt;();
n1.put( "name", "Andres" );
n1.put( "position", "Developer" );

Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "props", n1 );
engine.execute( "START n=node(0) SET n = {props}", params );</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="cypher-compatibility">Compatibility</h3>
<div class="paragraph"><p>Cypher is still changing rather rapidly. Parts of the changes are internal&#8201;&#8212;&#8201;we add new pattern matchers,
aggregators and other optimizations, which hopefully makes your queries run faster.</p></div>
<div class="paragraph"><p>Other changes are directly visible to our users&#8201;&#8212;&#8201;the syntax is still changing. New concepts are being added
and old ones changed to fit into new possibilities. To guard you from having to keep up with our syntax changes,
Cypher allows you to use an older parser, but still gain the speed from new optimizations.</p></div>
<div class="paragraph"><p>There are two ways you can select which parser to use. You can configure your database with the configuration parameter
<span class="monospaced">cypher_parser_version</span>, and enter which parser you&#8217;d like to use (1.7, 1.8 and 1.9 are supported now). Any Cypher query
that doesn&#8217;t explicitly say anything else, will get the parser you have configured.</p></div>
<div class="paragraph"><p>The other way is on a query by query basis. By simply pre-pending your query with <span class="monospaced">"CYPHER 1.7"</span>, that particular query
will be parsed with the 1.7 version of the parser. Example:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">CYPHER 1.7 START n=node(0)
WHERE n.foo = "bar"
RETURN n</pre></div>
</div>
<div class="sect2">
<h3 id="query-plans">Viewing Execution Plans</h3>
<div class="paragraph"><p>Cypher works very hard to execute queries as fast as possible. However, when optimizing for maximum query
execution performance, it may be helpful to rephrase queries using knowledge about the domain and the application.</p></div>
<div class="paragraph"><p>The overall goal of manual query performance optimization is to ensure that only necessary data is retrieved from the
graph or at least that data gets filtered out as early as possible in order to reduce the amount of work that has to
be done at later stages of query execution.</p></div>
<div class="paragraph"><p>In order to be able to do this manual optimization, it is necessary to understand how a given query is going
to be executed.</p></div>
<div class="paragraph"><p>Each Cypher query gets transformed into an execution plan by the Cypher execution engine. The execution plan consists of
a series of execution steps called pipes which may produce data, transform it, or even update the database or the schema.
Data enters the execution at one pipe and is passed on from pipe to pipe until it either is filtered out, transformed,
or returned to the user.</p></div>
<div class="paragraph"><p>To look at the execution plan description used to satisfy your query, you can look at the execution plan description on
the execution result object returned by the Java Core API.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-syntax">Syntax</h2>
<div class="sectionbody">
<div class="paragraph"><p>The nitty-gritty details of Cypher syntax.</p></div>
<div class="sect2">
<h3 id="query-operators">Operators</h3>
<div class="sect3">
<h4 id="query-operators-mathematical">Mathematical operators</h4>
<div class="paragraph"><p>The mathematical operators are <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, <span class="monospaced">/</span> and <span class="monospaced">%</span>.</p></div>
</div>
<div class="sect3">
<h4 id="query-operators-comparison">Comparison operators</h4>
<div class="paragraph"><p>The comparison operators are <span class="monospaced">=</span>, <span class="monospaced">&lt;&gt;</span>, <span class="monospaced">&lt;</span>, <span class="monospaced">&gt;</span>, <span class="monospaced">&lt;=</span>, <span class="monospaced">&gt;=</span>.</p></div>
</div>
<div class="sect3">
<h4 id="query-operators-boolean">Boolean operators</h4>
<div class="paragraph"><p>The boolean operators are <span class="monospaced">AND, `OR</span>, <span class="monospaced">NOT</span>.</p></div>
</div>
<div class="sect3">
<h4 id="query-operators-string">String operators</h4>
<div class="paragraph"><p>Strings can be concatenated using the <span class="monospaced">+</span> operator.</p></div>
</div>
<div class="sect3">
<h4 id="query-operators-collection">Collection operators</h4>
<div class="paragraph"><p>Collections can be concatenated using the <span class="monospaced">+</span> operator.</p></div>
</div>
<div class="sect3">
<h4 id="query-operators-property">Property operators</h4>
<div class="paragraph"><p>Since Neo4j is a schema-free graph database, Cypher has two special operators: <span class="monospaced">?</span> and <span class="monospaced">!</span>.</p></div>
<div class="paragraph"><p>They are used on properties, and are used to deal with missing values.
A comparison on a property that does not exist would normally cause an error.
Instead of having to always check if the property exists before comparing its value with something else, the special property operators can be used.
The question mark makes the comparison always return true if the property is missing, and the exclamation mark makes the comparator return false.</p></div>
<div class="paragraph"><p>This predicate will evaluate to true if <span class="monospaced">n.prop</span> is missing.</p></div>
<div class="paragraph"><p><span class="monospaced">WHERE n.prop? = "foo"</span></p></div>
<div class="paragraph"><p>This predicate will evaluate to false if <span class="monospaced">n.prop</span> is missing.</p></div>
<div class="paragraph"><p><span class="monospaced">WHERE n.prop! = "foo"</span></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Mixing the two in the same comparison will lead to unpredictable results.</td>
</tr></table>
</div>
<div class="paragraph"><p>This is really syntactic sugar that expands to this:</p></div>
<div class="paragraph"><p><span class="monospaced">WHERE n.prop? = "foo"</span>  &#8658; <span class="monospaced">WHERE (not(has(n.prop)) OR n.prop = "foo")</span></p></div>
<div class="paragraph"><p><span class="monospaced">WHERE n.prop! = "foo"</span>  &#8658; <span class="monospaced">WHERE (has(n.prop) AND n.prop = "foo")</span></p></div>
</div>
</div>
<div class="sect2">
<h3 id="cypher-expressions">Expressions</h3>
<div class="sect3">
<h4 id="_expressions_in_general">Expressions in general</h4>
<div class="paragraph"><p>An expression in Cypher can be:</p></div>
<div class="ulist"><ul>
<li>
<p>
A numeric literal (integer or double): <span class="monospaced">13</span>, <span class="monospaced">40000</span>, <span class="monospaced">3.14</span>.
</p>
</li>
<li>
<p>
A string literal: <span class="monospaced">"Hello"</span>, <span class="monospaced">'World'</span>.
</p>
</li>
<li>
<p>
A boolean literal:  <span class="monospaced">true</span>, <span class="monospaced">false</span>, <span class="monospaced">TRUE</span>, <span class="monospaced">FALSE</span>.
</p>
</li>
<li>
<p>
An identifier: <span class="monospaced">n</span>, <span class="monospaced">x</span>, <span class="monospaced">rel</span>, <span class="monospaced">myFancyIdentifier</span>, <span class="monospaced">`A name with weird stuff in it[]!`</span>.
</p>
</li>
<li>
<p>
A property: <span class="monospaced">n.prop</span>, <span class="monospaced">x.prop</span>, <span class="monospaced">rel.thisProperty</span>, <span class="monospaced">myFancyIdentifier.`(weird property name)`</span>.
</p>
</li>
<li>
<p>
A nullable property: it&#8217;s a property, with a question mark or exclamation mark&#8201;&#8212;&#8201;<span class="monospaced">n.prop?</span>, <span class="monospaced">rel.thisProperty!</span>.
</p>
</li>
<li>
<p>
A parameter: <span class="monospaced">{param}</span>, <span class="monospaced">{0}</span>
</p>
</li>
<li>
<p>
A collection of expressions: <span class="monospaced">["a", "b"]</span>, <span class="monospaced">[1,2,3]</span>, <span class="monospaced">["a", 2, n.property, {param}]</span>, <span class="monospaced">[ ]</span>.
</p>
</li>
<li>
<p>
A function call: <span class="monospaced">length(p)</span>, <span class="monospaced">nodes(p)</span>.
</p>
</li>
<li>
<p>
An aggregate function: <span class="monospaced">avg(x.prop)</span>, <span class="monospaced">count(*)</span>.
</p>
</li>
<li>
<p>
Relationship types: <span class="monospaced">:REL_TYPE</span>, <span class="monospaced">:`REL TYPE`</span>, <span class="monospaced">:REL1|REL2</span>.
</p>
</li>
<li>
<p>
A path-pattern: <span class="monospaced">a--&gt;()&lt;--b</span>.
</p>
</li>
<li>
<p>
A predicate expression is an expression that returns true or false: a.prop = "Hello", length(p) &gt; 10, has(a.name)
</p>
</li>
<li>
<p>
a <span class="monospaced">CASE</span> expression
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_note_on_string_literals">Note on string literals</h4>
<div class="paragraph"><p>String literals can contain these escape sequences.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<col style="width:33%;">
<col style="width:66%;">
<thead>
<tr>
<th class="tableblock halign-right valign-top" >Escape sequence</th>
<th class="tableblock halign-left valign-top" >Character</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\t</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tab</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\b</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Backspace</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\n</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Newline</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\r</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Carriage return</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\f</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Form feed</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\'</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Single quote</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\"</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Double quote</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">\\</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Backslash</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cypher-identifiers">Identifiers</h3>
<div class="paragraph"><p>When you reference parts of the pattern, you do so by naming them.
The names you give the different parts are called identifiers.</p></div>
<div class="paragraph"><p>In this example:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n=node(1) MATCH n--&gt;b RETURN b</pre></div>
<div class="paragraph"><p>The identifiers are <span class="monospaced">n</span> and <span class="monospaced">b</span>.</p></div>
<div class="paragraph"><p>Identifier names are case sensitive, and can contain underscores and alphanumeric characters (a-z, 0-9), but must
start with a letter. If other characters are needed, you can quote the identifier using backquote (<span class="monospaced">`</span>) signs.</p></div>
<div class="paragraph"><p>The same rules apply to property names.</p></div>
</div>
<div class="sect2">
<h3 id="cypher-comments">Comments</h3>
<div class="paragraph"><p>To add comments to your queries, use double slash. Examples:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n=node(1) RETURN n //This is an end of line comment</pre></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n=node(1)
//This is a whole line comment
RETURN n</pre></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n=node(1) WHERE n.property = "//This is NOT a comment" RETURN n</pre></div>
</div>
<div class="sect2">
<h3 id="introduction-pattern">Patterns</h3>
<div class="paragraph"><p>Patterns are at the very core of Cypher, and are used in a lot of different places.
Using patterns, you describe the shape of the data that you are looking for.
Patterns are used in the <span class="monospaced">MATCH</span> clause. Path patterns are expressions.
Since these expressions are collections, they can also be used as predicates (a non-empty collection signifies true).
They are also used to <span class="monospaced">CREATE</span>/<span class="monospaced">CREATE UNIQUE</span> the graph.</p></div>
<div class="paragraph"><p>So, understanding patterns is important, to be able to be effective with Cypher.</p></div>
<div class="paragraph"><p>You describe the pattern, and Cypher will figure out how to get that data for you. The idea is for you to draw your
query on a whiteboard, naming the interesting parts of the pattern, so you can then use values from these parts
to create the result set you are looking for.</p></div>
<div class="paragraph"><p>Patterns have bound points, or starting points. They are the parts of the pattern that are already &#8220;bound&#8221; to a set of
graph nodes or relationships. All parts of the pattern must be directly or indirectly connected to a starting point&#8201;&#8212;&#8201;a pattern
where parts of the pattern are not reachable from any starting point will be rejected.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>|===================
|Clause|Optional|Multiple rel. types|Varlength|Paths|Maps|Label OR syntax
|Match|Yes|Yes|Yes|Yes|-|Yes
|Create|-|-|-|Yes|Yes|-
|Create Unique|-|-|-|Yes|Yes|-
|Expressions|-|Yes|Yes|-|-|Yes
|===================</pre>
</div></div>
<div class="sect3">
<h4 id="_patterns_for_related_nodes">Patterns for related nodes</h4>
<div class="paragraph"><p>The description of the pattern is made up of one or more paths, separated by commas. A path is a sequence of nodes and
relationships that always start and end in nodes. An example path would be:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">(a)--&gt;(b)</span></span></p></div>
<div class="paragraph"><p>This is a path starting from the pattern node <span class="monospaced">a</span>, with an outgoing relationship from it to pattern node <span class="monospaced">b</span>.</p></div>
<div class="paragraph"><p>Paths can be of arbitrary length, and the same node may appear in multiple places in the path.</p></div>
<div class="paragraph"><p>Node identifiers can be used with or without surrounding parenthesis. The following match is semantically identical to
the one we saw above&#8201;&#8212;&#8201;the difference is purely aesthetic.</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a--&gt;b</span></span></p></div>
<div class="paragraph"><p>If you don&#8217;t care about a node, you don&#8217;t need to name it. Empty parenthesis are used for these nodes, like so:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a--&gt;()&lt;--b</span></span></p></div>
</div>
<div class="sect3">
<h4 id="_labels">Labels</h4>
<div class="paragraph"><p>You can declare that nodes should have a certain label in your pattern.</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a:User--&gt;b</span></span></p></div>
<div class="paragraph"><p>Or that it should have multiple labels:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a:User:Admin--&gt;b</span></span></p></div>
</div>
<div class="sect3">
<h4 id="_working_with_relationships">Working with relationships</h4>
<div class="paragraph"><p>If you need to work with the relationship between two nodes, you can name it.</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a-[r]-&gt;b</span></span></p></div>
<div class="paragraph"><p>If you don&#8217;t care about the direction of the relationship, you can omit the arrow at either end of the relationship, like this:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a--b</span></span></p></div>
<div class="paragraph"><p>Relationships have types. When you are only interested in a specific relationship type, you can specify this like so:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a-[:REL_TYPE]-&gt;b</span></span></p></div>
<div class="paragraph"><p>If multiple relationship types are acceptable, you can list them, separating them with the pipe symbol <span class="monospaced">|</span> like this:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">a-[r:TYPE1|TYPE2]-&gt;b</span></span></p></div>
<div class="paragraph"><p>This pattern matches a relationship of type <span class="monospaced">TYPE1</span> or <span class="monospaced">TYPE2</span>, going from <span class="monospaced">a</span> to <span class="monospaced">b</span>. The relationship is named <span class="monospaced">r</span>.
Multiple relationship types can not be used with <span class="monospaced">CREATE</span> or <span class="monospaced">CREATE UNIQUE</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_optional_relationships">Optional relationships</h4>
<div class="paragraph"><p>An optional relationship is matched when it is found, but replaced by a <span class="monospaced">null</span> otherwise.
Normally, if no matching relationship is found, that sub-graph is not matched.
Optional relationships could be called the Cypher equivalent of the outer join in SQL.</p></div>
<div class="paragraph"><p>They can only be used in <span class="monospaced">MATCH</span>.</p></div>
<div class="paragraph"><p>Optional relationships are marked with a question mark.
They allow you to write queries like this one:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START me=node(*)
MATCH me--&gt;friend-[?]-&gt;friend_of_friend
RETURN friend, friend_of_friend</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Dilshad"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Filipa"})
create (_4 {`name`:"Anders"})
create (_5 {`name`:"Becky"})
create (_6 {`name`:"Cesar"})
create _1-[:`KNOWS`]-&gt;_3
create _4-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_6
create _4-[:`KNOWS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
create _6-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 START me=node(*)
 MATCH me--&gt;friend-[?]-&gt;friend_of_friend
 RETURN friend, friend_of_friend</strong></span></p>
<div class="paragraph"><p>The query above says &#8220;for every person, give me all their friends, and their friends friends, if they have any.&#8221;</p></div>
<div class="paragraph"><p>Optionality is transitive&#8201;&#8212;&#8201;if a part of the pattern can only be reached from a bound point through an optional relationship,
that part is also optional. In the pattern above, the only bound point in the pattern is <span class="monospaced">me</span>. Since the relationship
between <span class="monospaced">friend</span> and <span class="monospaced">children</span> is optional, <span class="monospaced">children</span> is an optional part of the graph.</p></div>
<div class="paragraph"><p>Also, named paths that contain optional parts are also optional&#8201;&#8212;&#8201;if any part of the path is
<span class="monospaced">null</span>, the whole path is <span class="monospaced">null</span>.</p></div>
<div class="paragraph"><p>In the following examples, <span class="monospaced">b</span> and <span class="monospaced">p</span> are all optional and can contain <span class="monospaced">null</span>:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(4)
MATCH p = a-[?]-&gt;b
RETURN b</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Dilshad"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Filipa"})
create (_4 {`name`:"Anders"})
create (_5 {`name`:"Becky"})
create (_6 {`name`:"Cesar"})
create _1-[:`KNOWS`]-&gt;_3
create _4-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_6
create _4-[:`KNOWS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
create _6-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 START a=node(4)
 MATCH p = a-[?]-&gt;b
 RETURN b</strong></span></p>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(4)
MATCH p = a-[?*]-&gt;b
RETURN b</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Dilshad"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Filipa"})
create (_4 {`name`:"Anders"})
create (_5 {`name`:"Becky"})
create (_6 {`name`:"Cesar"})
create _1-[:`KNOWS`]-&gt;_3
create _4-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_6
create _4-[:`KNOWS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
create _6-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 START a=node(4)
 MATCH p = a-[?*]-&gt;b
 RETURN b</strong></span></p>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(4)
MATCH p = a-[?]-&gt;x--&gt;b
RETURN b</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Dilshad"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Filipa"})
create (_4 {`name`:"Anders"})
create (_5 {`name`:"Becky"})
create (_6 {`name`:"Cesar"})
create _1-[:`KNOWS`]-&gt;_3
create _4-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_6
create _4-[:`KNOWS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
create _6-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 START a=node(4)
 MATCH p = a-[?]-&gt;x--&gt;b
 RETURN b</strong></span></p>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(4), x=node(3)
MATCH p = shortestPath( a-[?*]-&gt;x )
RETURN p</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Dilshad"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Filipa"})
create (_4 {`name`:"Anders"})
create (_5 {`name`:"Becky"})
create (_6 {`name`:"Cesar"})
create _1-[:`KNOWS`]-&gt;_3
create _4-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_6
create _4-[:`KNOWS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
create _6-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 START a=node(4), x=node(3)
 MATCH p = shortestPath( a-[?*]-&gt;x )
 RETURN p</strong></span></p>
</div>
<div class="sect3">
<h4 id="_controlling_depth">Controlling depth</h4>
<div class="paragraph"><p>A pattern relationship can span multiple graph relationships. These are called variable length relationships, and are
marked as such using an asterisk (<span class="monospaced">*</span>):</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">(a)-[*]-&gt;(b)</span></span></p></div>
<div class="paragraph"><p>This signifies a path starting on the pattern node <span class="monospaced">a</span>, following only outgoing relationships, until it reaches pattern
node <span class="monospaced">b</span>. Any number of relationships can be followed searching for a path to <span class="monospaced">b</span>, so this can be a very expensive query,
depending on what your graph looks like.</p></div>
<div class="paragraph"><p>You can set a minimum set of steps that can be taken, and/or the maximum number of steps:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">(a)-[*3..5]-&gt;(b)</span></span></p></div>
<div class="paragraph"><p>This is a variable length relationship containing at least three graph relationships, and at most five.</p></div>
<div class="paragraph"><p>Variable length relationships can not be used with <span class="monospaced">CREATE</span> and <span class="monospaced">CREATE UNIQUE</span>.</p></div>
<div class="paragraph"><p>As a simple example, let&#8217;s take the query below:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START me=node(3)
MATCH me-[:KNOWS*1..2]-remote_friend
RETURN remote_friend</pre></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">remote_friend</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">0 row</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Dilshad"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Filipa"})
create (_4 {`name`:"Anders"})
create (_5 {`name`:"Becky"})
create (_6 {`name`:"Cesar"})
create _1-[:`KNOWS`]-&gt;_3
create _4-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_6
create _4-[:`KNOWS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
create _6-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 START me=node(3)
 MATCH me-[:KNOWS*1..2]-remote_friend
 RETURN remote_friend</strong></span></p>
<div class="paragraph"><p>This query starts from one node, and follows <span class="monospaced">KNOWS</span> relationships two or three steps out, and then stops.</p></div>
</div>
<div class="sect3">
<h4 id="_assigning_to_path_identifiers">Assigning to path identifiers</h4>
<div class="paragraph"><p>In a graph database, a path is a very important concept. A path is a collection of nodes and relationships,
that describe a path in the graph. To assign a path to a path identifier, you simply assign a path pattern to an
identifier, like so:</p></div>
<div class="paragraph"><p><span class="monospaced"><span class="monospaced">p = (a)-[*3..5]-&gt;(b)</span></span></p></div>
<div class="paragraph"><p>You can do this in <span class="monospaced">MATCH</span>, <span class="monospaced">CREATE</span> and <span class="monospaced">CREATE UNIQUE</span>, but not when using patterns as expressions. Example of the
three in a single query:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START me=node(3)
MATCH p1 = me-[*2]-friendOfFriend
CREATE p2 = me-[:MARRIED_TO]-(wife {name:"Gunhild"})
CREATE UNIQUE p3 = wife-[:KNOWS]-friendOfFriend
RETURN p1,p2,p3</pre></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Dilshad"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Filipa"})
create (_4 {`name`:"Anders"})
create (_5 {`name`:"Becky"})
create (_6 {`name`:"Cesar"})
create _1-[:`KNOWS`]-&gt;_3
create _4-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_6
create _4-[:`KNOWS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
create _6-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 START me=node(3)
 MATCH p1 = me-[*2]-friendOfFriend
 CREATE p2 = me-[:MARRIED_TO]-(wife {name:"Gunhild"})
 CREATE UNIQUE p3 = wife-[:KNOWS]-friendOfFriend
 RETURN p1,p2,p3</strong></span></p>
</div>
<div class="sect3">
<h4 id="_setting_properties">Setting properties</h4>
<div class="paragraph"><p>Nodes and relationships are important, but Neo4j uses properties on both of these to allow for far denser graphs models.</p></div>
<div class="paragraph"><p>Properties are expressed in patterns using the map-construct, which is simply curly brackets surrounding a number of
key-expression pairs, separated by commas, e.g. <span class="monospaced">{ name: "Andres", sport: "BJJ" }</span>. If the map is supplied through a
parameter, the normal parameter expression is used: <span class="monospaced">{ paramName }</span>.</p></div>
<div class="paragraph"><p>Maps are only used by <span class="monospaced">CREATE</span> and <span class="monospaced">CREATE UNIQUE</span>. In <span class="monospaced">CREATE</span> they are used to set the properties on the newly created
nodes and relationships.</p></div>
<div class="paragraph"><p>When used with <span class="monospaced">CREATE UNIQUE</span>, they are used to try to match a pattern element with the corresponding graph element.
The match is successful if the properties on the pattern element can be matched exactly against properties on the graph
elements. The graph element can have additional properties, and they do not affect the match. If Neo4j fails to find
matching graph elements, the maps is used to set the properties on the newly created elements.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-general">General Clauses</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="query-return">Return</h3>
<div class="paragraph"><p>In the <span class="monospaced">RETURN</span> part of your query, you define which parts of the pattern you are
interested in. It can be nodes, relationships, or properties on these.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-return-graph.svg" alt="cypher-return-graph.svg">
</div>
<div class="title">Figure 34. Graph</div>
</div>
<div class="sect3">
<h4 id="return-return-nodes">Return nodes</h4>
<div class="paragraph"><p>To return a node, list it in the <span class="monospaced">RETURN</span> statemenet.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='B'
RETURN n</pre></div>
<div class="paragraph"><p>The example will return the node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"B"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name='B' return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-return-relationships">Return relationships</h4>
<div class="paragraph"><p>To return a relationship, just include it in the <span class="monospaced">RETURN</span> list.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (n)-[r:KNOWS]-&gt;(c)
WHERE n.name='A'
RETURN r</pre></div>
<div class="paragraph"><p>The relationship is returned by the example.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:KNOWS[0] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match (n)-[r:KNOWS]-&gt;(c) where n.name='A' return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-return-property">Return property</h4>
<div class="paragraph"><p>To return a property, use the dot separator, like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='A'
RETURN n.name</pre></div>
<div class="paragraph"><p>The value of the property <span class="monospaced">name</span> gets returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"A"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name='A' return n.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-return-all-elements">Return all elements</h4>
<div class="paragraph"><p>When you want to return all nodes, relationships and paths found in a query, you can use the <span class="monospaced">*</span> symbol.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=a-[r]-&gt;b
WHERE a.name='A'
RETURN *</pre></div>
<div class="paragraph"><p>This returns the two nodes, the relationship and the path used in the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a</td><td align="left" valign="top">b</td><td align="left" valign="top">r</td><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="4">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{happy:"Yes!",age:55,name:"A"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[2]{name:"B"}</code></p></td><td align="left" valign="top"><p><code class="literal">:KNOWS[0] {}</code></p></td><td align="left" valign="top"><p><code class="literal">[Node[1]{happy:"Yes!",age:55,name:"A"},:KNOWS[0] {},Node[2]{name:"B"}]</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[1]{happy:"Yes!",age:55,name:"A"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[2]{name:"B"}</code></p></td><td align="left" valign="top"><p><code class="literal">:BLOCKS[1] {}</code></p></td><td align="left" valign="top"><p><code class="literal">[Node[1]{happy:"Yes!",age:55,name:"A"},:BLOCKS[1] {},Node[2]{name:"B"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match p=a-[r]-&gt;b where a.name='A' return *</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-identifier-with-uncommon-characters">Identifier with uncommon characters</h4>
<div class="paragraph"><p>To introduce a placeholder that is made up of characters that are
      outside of the english alphabet, you can use the <span class="monospaced">`</span> to enclose the identifier, like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH `This isn't a common identifier`
WHERE `This isn't a common identifier`.name='A'
RETURN `This isn't a common identifier`.happy</pre></div>
<div class="paragraph"><p>The node indexed with name "A" is returned</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">This isn't a common identifier.happy</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Yes!"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match `This isn't a common identifier` where `This isn't a common identifier`.name='A'
 return `This isn't a common identifier`.happy</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-column-alias">Column alias</h4>
<div class="paragraph"><p>If the name of the column should be different from the expression used, you can rename it by using <span class="monospaced">AS</span> &lt;new name&gt;.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='A'
RETURN a.age AS SomethingTotallyDifferent</pre></div>
<div class="paragraph"><p>Returns the age property of a node, but renames the column.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">SomethingTotallyDifferent</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">55</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match a where a.name='A' return a.age AS SomethingTotallyDifferent</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-optional-properties">Optional properties</h4>
<div class="paragraph"><p>If a property might or might not be there, you can select it optionally by adding a questionmark to the identifier,
like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n.age?</pre></div>
<div class="paragraph"><p>This example returns the age when the node has that property, or <span class="monospaced">null</span> if the property is not there.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n.age?</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">55</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match n return n.age?</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-other-expressions">Other expressions</h4>
<div class="paragraph"><p>Any expression can be used as a return item - literals, predicates, properties, functions, and everything else.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='A'
RETURN a.age &gt; 30, "I'm a literal", a--&gt;()</pre></div>
<div class="paragraph"><p>Returns a predicate, a literal and function call with a pattern expression parameter.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a.age &gt; 30</td><td align="left" valign="top">"I'm a literal"</td><td align="left" valign="top">a--&gt;()</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="3">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">"I'm a literal"</code></p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match a where a.name='A' return a.age &gt; 30, "I'm a literal", a--&gt;()</strong></span></p>
</div>
<div class="sect3">
<h4 id="return-unique-results">Unique results</h4>
<div class="paragraph"><p><span class="monospaced">DISTINCT</span> retrieves only unique rows depending on the columns that have been selected to output.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (a)--&gt;(b)
WHERE a.name='A'
RETURN distinct b</pre></div>
<div class="paragraph"><p>The node named B is returned by the query, but only once.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">b</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"B"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:55, `happy`:"Yes!", `name`:"A"})
create (_2 {`name`:"B"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`BLOCKS`]-&gt;_2
</span><span class="command"><strong>
 match (a)--&gt;(b) where a.name='A' return distinct b</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-order">Order by</h3>
<div class="paragraph"><p>To sort the output, use the <span class="monospaced">ORDER BY</span> clause. Note that you can not sort on nodes or relationships,
just on properties on these.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-orderby-graph.svg" alt="cypher-orderby-graph.svg">
</div>
<div class="title">Figure 35. Graph</div>
</div>
<div class="sect3">
<h4 id="order-by-order-nodes-by-property">Order nodes by property</h4>
<div class="paragraph"><p><span class="monospaced">ORDER BY</span> is used to sort the output.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n
ORDER BY n.name</pre></div>
<div class="paragraph"><p>The nodes are returned, sorted by their name.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:34,name:"A",length:170}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"B"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:32,name:"C",length:185}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:34, `length`:170, `name`:"A"})
create (_2 {`age`:34, `name`:"B"})
create (_3 {`age`:32, `length`:185, `name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _2-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n return n order by n.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="order-by-order-nodes-by-multiple-properties">Order nodes by multiple properties</h4>
<div class="paragraph"><p>You can order by multiple properties by stating each identifier in the <span class="monospaced">ORDER BY</span> clause. Cypher will sort the result by the first identifier listed, and for equals values, go to the next property in the <span class="monospaced">ORDER BY</span> clause, and so on.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n
ORDER BY n.age, n.name</pre></div>
<div class="paragraph"><p>This returns the nodes, sorted first by their age, and then by their name.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:32,name:"C",length:185}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:34,name:"A",length:170}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"B"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:34, `length`:170, `name`:"A"})
create (_2 {`age`:34, `name`:"B"})
create (_3 {`age`:32, `length`:185, `name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _2-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n return n order by n.age, n.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="order-by-order-nodes-in-descending-order">Order nodes in descending order</h4>
<div class="paragraph"><p>By adding <span class="monospaced">DESC[ENDING]</span> after the identifier to sort on, the sort will be done in reverse order.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n
ORDER BY n.name DESC</pre></div>
<div class="paragraph"><p>The example returns the nodes, sorted by their name reversely.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:32,name:"C",length:185}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"B"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:34,name:"A",length:170}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:34, `length`:170, `name`:"A"})
create (_2 {`age`:34, `name`:"B"})
create (_3 {`age`:32, `length`:185, `name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _2-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n return n order by n.name DESC</strong></span></p>
</div>
<div class="sect3">
<h4 id="order-by-ordering-null">Ordering null</h4>
<div class="paragraph"><p>When sorting the result set, <span class="monospaced">null</span> will always come at the end of the result set for ascending sorting, and first when doing descending sort.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n.length?, n
ORDER BY n.length?</pre></div>
<div class="paragraph"><p>The nodes are returned sorted by the length property, with a node without that property last.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n.length?</td><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">170</code></p></td><td align="left" valign="top"><p><code class="literal">Node[1]{age:34,name:"A",length:170}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">185</code></p></td><td align="left" valign="top"><p><code class="literal">Node[3]{age:32,name:"C",length:185}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"B"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:34, `length`:170, `name`:"A"})
create (_2 {`age`:34, `name`:"B"})
create (_3 {`age`:32, `length`:185, `name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _2-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n return n.length?, n order by n.length?</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-limit">Limit</h3>
<div class="paragraph"><p><span class="monospaced">LIMIT</span> enables the return of only subsets of the total result.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-limit-graph.svg" alt="cypher-limit-graph.svg">
</div>
<div class="title">Figure 36. Graph</div>
</div>
<div class="sect3">
<h4 id="limit-return-first-part">Return first part</h4>
<div class="paragraph"><p>To return a subset of the result, starting from the top, use this syntax:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n
LIMIT 3</pre></div>
<div class="paragraph"><p>The top three items are returned by the example query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"D"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"E"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"A"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"D"})
create (_2 {`name`:"E"})
create (_3 {`name`:"A"})
create (_4 {`name`:"B"})
create (_5 {`name`:"C"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n return n limit 3</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-skip">Skip</h3>
<div class="paragraph"><p><span class="monospaced">SKIP</span> enables the return of only subsets of the total result.
By using <span class="monospaced">SKIP</span>, the result set will get trimmed from the top.
Please note that no guarantees are made on the order of the result unless the query specifies the <span class="monospaced">ORDER BY</span> clause.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-skip-graph.svg" alt="cypher-skip-graph.svg">
</div>
<div class="title">Figure 37. Graph</div>
</div>
<div class="sect3">
<h4 id="skip-skip-first-three">Skip first three</h4>
<div class="paragraph"><p>To return a subset of the result, starting from the fourth result, use the following syntax:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n
ORDER BY n.name
SKIP 3</pre></div>
<div class="paragraph"><p>The first three nodes are skipped, and only the last two are returned in the result.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"D"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"E"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"D"})
create (_2 {`name`:"E"})
create (_3 {`name`:"A"})
create (_4 {`name`:"B"})
create (_5 {`name`:"C"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n return n order by n.name skip 3</strong></span></p>
</div>
<div class="sect3">
<h4 id="skip-return-middle-two">Return middle two</h4>
<div class="paragraph"><p>To return a subset of the result, starting from somewhere in the middle, use this syntax:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n
ORDER BY n.name
SKIP 1
LIMIT 2</pre></div>
<div class="paragraph"><p>Two nodes from the middle are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[4]{name:"B"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[5]{name:"C"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"D"})
create (_2 {`name`:"E"})
create (_3 {`name`:"A"})
create (_4 {`name`:"B"})
create (_5 {`name`:"C"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n return n order by n.name skip 1 limit 2</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-with">With</h3>
<div class="paragraph"><p>The ability to chain queries together allows for powerful constructs. In Cypher, the <span class="monospaced">WITH</span> clause is
used to pipe the result from one query to the next.</p></div>
<div class="paragraph"><p><span class="monospaced">WITH</span> is also used to separate reading from updating of the graph. Every sub-query of a query must be either read-only or write-only.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-with-graph.svg" alt="cypher-with-graph.svg">
</div>
<div class="title">Figure 38. Graph</div>
</div>
<div class="sect3">
<h4 id="with-filter-on-aggregate-function-results">Filter on aggregate function results</h4>
<div class="paragraph"><p>Aggregated results have to pass through a <span class="monospaced">WITH</span> clause to be able to filter on.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH david--otherPerson--&gt;()
WHERE david.name='David'
WITH otherPerson, count(*) as foaf
WHERE foaf &gt; 1
RETURN otherPerson</pre></div>
<div class="paragraph"><p>The person connected to David with the at least more than one outgoing relationship will be returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">otherPerson</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Anders"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"David"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Anders"})
create (_4 {`name`:"Bossman"})
create (_5 {`name`:"Ceasar"})
create _1-[:`KNOWS`]-&gt;_3
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`BLOCKS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_2
create _4-[:`BLOCKS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match david--otherPerson--&gt;() where david.name='David' with otherPerson, count(*) as foaf where foaf &gt; 1 return otherPerson</strong></span></p>
</div>
<div class="sect3">
<h4 id="with-sort-results-before-using-collect-on-them">Sort results before using collect on them</h4>
<div class="paragraph"><p>You can sort your results before passing them to collect, thus sorting the resulting collection.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WITH n
ORDER BY n.name desc
LIMIT 3
RETURN collect(n.name)</pre></div>
<div class="paragraph"><p>A list of the names of people in reverse order, limited to 3, in a collection.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">collect(n.name)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">["Emil","David","Ceasar"]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"David"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Anders"})
create (_4 {`name`:"Bossman"})
create (_5 {`name`:"Ceasar"})
create _1-[:`KNOWS`]-&gt;_3
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`BLOCKS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_2
create _4-[:`BLOCKS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n with n order by n.name desc limit 3 return collect(n.name)</strong></span></p>
</div>
<div class="sect3">
<h4 id="with-limit-branching-of-your-path-search">Limit branching of your path search</h4>
<div class="paragraph"><p>You can match paths, limit to a certain number, and then match again using those paths as a base As well as any number of similar limited searches.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n--m
WHERE n.name = 'Anders'
WITH m
ORDER BY m.name desc
LIMIT 1
MATCH m--o
RETURN o.name</pre></div>
<div class="paragraph"><p>Starting at Anders, find all matching nodes, order by name descending and get the top result, then find all the nodes connected to that top result, and return their names.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">o.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Anders"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Bossman"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"David"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Anders"})
create (_4 {`name`:"Bossman"})
create (_5 {`name`:"Ceasar"})
create _1-[:`KNOWS`]-&gt;_3
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`BLOCKS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_2
create _4-[:`BLOCKS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n--m where n.name = 'Anders' with m order by m.name desc limit 1 match m--o return o.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="with-alternative-syntax-of-with">Alternative syntax of WITH</h4>
<div class="paragraph"><p>If you prefer a more visual way of writing your query, you can use equal-signs as delimiters before and after the column list. Use at least three before the column list, and at least three after.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH david--otherPerson--&gt;()
WHERE david.name='David'
========== otherPerson, count(*) as foaf ==========
SET otherPerson.connection_count = foaf</pre></div>
<div class="paragraph"><p>For persons connected to David, the <span class="monospaced">connection_count</span> property is set to their number of outgoing relationships.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Properties set: 2</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"David"})
create (_2 {`name`:"Emil"})
create (_3 {`name`:"Anders"})
create (_4 {`name`:"Bossman"})
create (_5 {`name`:"Ceasar"})
create _1-[:`KNOWS`]-&gt;_3
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`BLOCKS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_2
create _4-[:`BLOCKS`]-&gt;_1
create _5-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>

 match david--otherPerson--&gt;()
 where david.name='David'
 ========== otherPerson, count(*) as foaf ==========
 set otherPerson.connection_count = foaf</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-union">Union</h3>
<div class="paragraph"><p>Combining results from multiple queries is done through the UNION operator.</p></div>
<div class="paragraph"><p>Combines the results of two or more queries into a single result set that includes all the rows that belong to all
queries in the union.</p></div>
<div class="paragraph"><p>The number and the names of the columns must be identical in all queries combined by using UNION.</p></div>
<div class="paragraph"><p>To keep all the result rows, use <span class="monospaced">UNION</span> <span class="monospaced">ALL</span>. Using just <span class="monospaced">UNION</span> will combine and remove duplicates from the
result set.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-union-graph.svg" alt="cypher-union-graph.svg">
</div>
<div class="title">Figure 39. Graph</div>
</div>
<div class="sect3">
<h4 id="union-union-two-queries">Union two queries</h4>
<div class="paragraph"><p>Combining the results from two queries is done using UNION ALL</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Actor
RETURN n.name as name
UNION ALL

MATCH n:Movie
RETURN n.title as name</pre></div>
<div class="paragraph"><p>The combined result is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Movie` {`name`:"Cypher", `title`:"Cypher"})
create (_2:`Actor` {`name`:"Lucy Liu"})
create (_3:`Actor` {`name`:"Kevin Bacon"})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`ACTS_IN`]-&gt;_1
create _3-[:`ACTS_IN`]-&gt;_1
</span><span class="command"><strong>
 match n:Actor return n.name as name
            UNION ALL
            match n:Movie return n.title as name</strong></span></p>
</div>
<div class="sect3">
<h4 id="union-combine-two-queries-and-removing-duplicates">Combine two queries and removing duplicates</h4>
<div class="paragraph"><p>By not uncluding <span class="monospaced">ALL</span> in the <span class="monospaced">UNION</span>, duplicates are removed from the combined result set</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Actor
RETURN n.name as name
UNION

MATCH n:Movie
RETURN n.title as name</pre></div>
<div class="paragraph"><p>The combined result is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Movie` {`name`:"Cypher", `title`:"Cypher"})
create (_2:`Actor` {`name`:"Lucy Liu"})
create (_3:`Actor` {`name`:"Kevin Bacon"})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`ACTS_IN`]-&gt;_1
create _3-[:`ACTS_IN`]-&gt;_1
</span><span class="command"><strong>
 match n:Actor return n.name as name
            UNION
            match n:Movie return n.title as name</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-using">Using</h3>
<div class="paragraph"><p>If you do not specify an explicit <span class="monospaced">START</span> clause, Cypher needs to infer where in the graph to start your query.
One way Cypher might find start points is by looking at available indexes, but currently this can only be done automatically
when there is only one index that is applicable to the query.
If there is more than one possible index to use, you must use an index hint to tell cypher which index to use.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">You cannot use index hints if your query has a <span class="monospaced">START</span> clause.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="using-query-using-an-index-hint">Query using an index hint</h4>
<div class="paragraph"><p>To query using an index hint, use <span class="monospaced">USING</span> +INDEX.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Swedish--&gt;()
USING INDEX n:Swedish(surname)
WHERE n.surname = 'Taylor'
RETURN n</pre></div>
<div class="paragraph"><p>The query result is returned as usual.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[4]{awesome:true,age:36,name:"Andres",surname:"Taylor"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Emil"})
create (_2:`German` {`name`:"Stefan", `surname`:"Plantikow"})
create (_3 {`age`:34, `name`:"Peter"})
create (_4:`Swedish` {`age`:36, `awesome`:true, `name`:"Andres", `surname`:"Taylor"})
create _1-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n:Swedish--&gt;() using index n:Swedish(surname) where n.surname = 'Taylor' return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="using-query-using-multiple-index-hints">Query using multiple index hints</h4>
<div class="paragraph"><p>To query using multiple index hints, use <span class="monospaced">USING</span> +INDEX.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH m:German--&gt;n:Swedish
USING INDEX m:German(surname)
USING INDEX n:Swedish(surname)
WHERE m.surname = 'Plantikow' and n.surname = 'Taylor'
RETURN m</pre></div>
<div class="paragraph"><p>The query result is returned as usual.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">m</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Stefan",surname:"Plantikow"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Emil"})
create (_2:`German` {`name`:"Stefan", `surname`:"Plantikow"})
create (_3 {`age`:34, `name`:"Peter"})
create (_4:`Swedish` {`age`:36, `awesome`:true, `name`:"Andres", `surname`:"Taylor"})
create _1-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match m:German--&gt;n:Swedish using index m:German(surname) using index n:Swedish(surname) where m.surname = 'Plantikow' and n.surname = 'Taylor' return m</strong></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-read">Reading Clauses</h2>
<div class="sectionbody">
<div class="paragraph"><p>Read data from the database.</p></div>
<div class="sect2">
<h3 id="query-start">Start</h3>
<div class="paragraph"><p>Every query describes a pattern, and in that pattern one can have multiple
starting points. A starting point is a relationship or a node where a pattern is anchored.
You can either introduce starting points by id, or by
index lookups. Note that trying to use an index that doesn&#8217;t exist will throw
an exception.</p></div>
<div class="paragraph"><p><span class="monospaced">START</span> is optional. If you do not specify explicit start points, Cypher will try and infer start points from your
query. This is done based on node labels and predicates contained in your query.
Additionally, you can use index hints with the <span class="monospaced">USING</span> clause to help Cypher pick an index to use to find start points.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-start-graph.svg" alt="cypher-start-graph.svg">
</div>
<div class="title">Figure 40. Graph</div>
</div>
<div class="sect3">
<h4 id="start-node-by-id">Node by id</h4>
<div class="paragraph"><p>Binding a node as a starting point is done with the <span class="monospaced">node(*)</span> function.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Neo4j reuses its internal ids when nodes and relationships are deleted, which means it&#8217;s bad practice to refer to them this way. Instead, use application generated ids.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START n=node(1)
RETURN n</pre></div>
<div class="paragraph"><p>The corresponding node is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"A"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"B"})
create (_3 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 start n=node(1) return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="start-relationship-by-id">Relationship by id</h4>
<div class="paragraph"><p>Binding a relationship as a starting point is done with the <span class="monospaced">relationship(*)</span> function, which can also be abbreviated <span class="monospaced">rel(*)</span>. See <a href="#start-node-by-id">[start-node-by-id]</a> for more information on Neo4j ids.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START r=relationship(0)
RETURN r</pre></div>
<div class="paragraph"><p>The relationship with id <span class="monospaced">0</span> is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:KNOWS[0] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"B"})
create (_3 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 start r=relationship(0) return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="start-multiple-nodes-by-id">Multiple nodes by id</h4>
<div class="paragraph"><p>Multiple nodes are selected by listing them separated by commas.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START n=node(1, 2, 3)
RETURN n</pre></div>
<div class="paragraph"><p>This returns the nodes listed in the <span class="monospaced">START</span> statement.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"A"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"B"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"C"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"B"})
create (_3 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 start n=node(1, 2, 3) return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="start-all-nodes">All nodes</h4>
<div class="paragraph"><p>To get all the nodes, use an asterisk. This can be done with relationships as well.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START n=node(*)
RETURN n</pre></div>
<div class="paragraph"><p>This query returns all the nodes in the graph.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"A"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"B"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"C"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"B"})
create (_3 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 start n=node(*) return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="start-node-by-index-lookup">Node by index lookup</h4>
<div class="paragraph"><p>When the starting point can be found by using index lookups, it can be done like this: <span class="monospaced">node:index-name(key = "value")</span>. In this example, there exists a node index named <span class="monospaced">nodes</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START n=node:nodes(name = "A")
RETURN n</pre></div>
<div class="paragraph"><p>The query returns the node indexed with the name "<span class="monospaced">A</span>".</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"A"}</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect3">
<h4 id="start-relationship-by-index-lookup">Relationship by index lookup</h4>
<div class="paragraph"><p>When the starting point can be found by using index lookups, it can be done like this: <span class="monospaced">relationship:index-name(key = "value")</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START r=relationship:rels(name = "Andrés")
RETURN r</pre></div>
<div class="paragraph"><p>The relationship indexed with the <span class="monospaced">name</span> property set to "<span class="monospaced">Andrés</span>" is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:KNOWS[0] {name:"Andrés"</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect3">
<h4 id="start-node-by-index-query">Node by index query</h4>
<div class="paragraph"><p>When the starting point can be found by more complex Lucene queries, this is the syntax to use: <span class="monospaced">node:index-name("query")</span>.This allows you to write more advanced index queries.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START n=node:nodes("name:A")
RETURN n</pre></div>
<div class="paragraph"><p>The node indexed with name "A" is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"A"}</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect3">
<h4 id="start-multiple-starting-points">Multiple starting points</h4>
<div class="paragraph"><p>Sometimes you want to bind multiple starting points. Just list them separated by commas.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(1), b=node(2)
RETURN a,b</pre></div>
<div class="paragraph"><p>Both the nodes <span class="monospaced">A</span> and the <span class="monospaced">B</span>  are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a</td><td align="left" valign="top">b</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"A"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[2]{name:"B"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"B"})
create (_3 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_2
create _1-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 start a=node(1), b=node(2) return a,b</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-match">Match</h3>
<div class="sect3">
<h4 id="_introduction">Introduction</h4>
<div class="paragraph"><p>The <span class="monospaced">MATCH</span> clause allows you to specify the pattern Cypher will search for in the database.
Nodes and relationships that are already known at this stage are called <em>bound pattern elements</em>.
Cypher will now try to find the unknown parts of the pattern.</p></div>
<div class="paragraph"><p>If <span class="monospaced">MATCH</span> is the first clause in your query, nothing is bound at this stage.
Cypher needs start points to do it&#8217;s pattern matching.
If no bound nodes exist, Cypher can scan all nodes in the database, all nodes with a certain label, or it can use indexes to quickly find the relevant start points.
If you want to use index hints to force Cypher to use a specific index, read more here: <a href="#query-using">[query-using]</a>.</p></div>
<div class="paragraph"><p>After finding start points&#8201;&#8212;&#8201;either by using scans, indexes or already bound points, the execution engine will use pattern matching to find matching sub graphs.
Because Cypher is declarative, it can change order of these operations.
<span class="monospaced">WHERE</span> predicates can be evaluated before pattern matching, or during pattern matching, not only filtering after finding matches.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In the <span class="monospaced">MATCH</span> clause, patterns are used a lot.
Read <a href="#introduction-pattern">[introduction-pattern]</a> for an introduction.</td>
</tr></table>
</div>
<div class="paragraph"><p>The following graph is used for the examples below:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-match-graph.svg" alt="cypher-match-graph.svg">
</div>
<div class="title">Figure 41. Graph</div>
</div>
</div>
<div class="sect3">
<h4 id="match-get-all-nodes">Get all nodes</h4>
<div class="paragraph"><p>By just specifying a pattern with a single node and no labels, all nodes in the graph will be returned.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN n</pre></div>
<div class="paragraph"><p>Returns all the nodes in the database.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">7 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"Oliver Stone"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Martin Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[4]{title:"The American President",name:"TheAmericanPresident"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[6]{name:"Rob Reiner"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match n return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-get-all-nodes-with-a-label">Get all nodes with a label</h4>
<div class="paragraph"><p>Getting all nodes with a label on them is done with a single node pattern where the node has a label on it.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH movie:Movie
RETURN movie</pre></div>
<div class="paragraph"><p>Returns all the movies in the database.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">movie</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[4]{title:"The American President",name:"TheAmericanPresident"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match movie:Movie return movie</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-related-nodes">Related nodes</h4>
<div class="paragraph"><p>The symbol <span class="monospaced">--</span> means <em>related to,</em> without regard to type or direction.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (director)--(movie)
WHERE director.name='Oliver Stone'
RETURN movie.title</pre></div>
<div class="paragraph"><p>Returns all the movies directed by Oliver Stone.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">movie.title</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Wall Street"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (director)--(movie) where director.name='Oliver Stone' return movie.title</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-outgoing-relationships">Outgoing relationships</h4>
<div class="paragraph"><p>When the direction of a relationship is interesting, it is shown by using <span class="monospaced">--&gt;</span> or <span class="monospaced">&lt;--</span>, like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (martin)--&gt;(movie)
WHERE martin.name='Martin Sheen'
RETURN movie.title</pre></div>
<div class="paragraph"><p>Returns nodes connected to Martin by outgoing relationships.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">movie.title</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Wall Street"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"The American President"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (martin)--&gt;(movie) where martin.name='Martin Sheen' return movie.title</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-directed-relationships-and-identifier">Directed relationships and identifier</h4>
<div class="paragraph"><p>If an identifier is needed, either for filtering on properties of the relationship, or to return the relationship, this is how you introduce the identifier.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (martin)-[r]-&gt;(movie)
WHERE martin.name='Martin Sheen'
RETURN r</pre></div>
<div class="paragraph"><p>Returns all outgoing relationships from Martin.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:ACTED_IN[1] {}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">:ACTED_IN[3] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (martin)-[r]-&gt;(movie) where martin.name='Martin Sheen' return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-match-by-relationship-type">Match by relationship type</h4>
<div class="paragraph"><p>When you know the relationship type you want to match on, you can specify it by using a colon together with the relationship type.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (wallstreet)&lt;-[:ACTED_IN]-(actor)
WHERE wallstreet.title='Wall Street'
RETURN actor</pre></div>
<div class="paragraph"><p>Returns nodes that <span class="monospaced">ACTED_IN</span> Wall Street.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">actor</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Martin Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (wallstreet)&lt;-[:ACTED_IN]-(actor) where wallstreet.title='Wall Street' return actor</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-match-by-multiple-relationship-types">Match by multiple relationship types</h4>
<div class="paragraph"><p>To match on one of multiple types, you can specify this by chaining them together with the pipe symbol <span class="monospaced">|</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (wallstreet)&lt;-[:ACTED_IN|:DIRECTED]-(person)
WHERE wallstreet.title='Wall Street'
RETURN person</pre></div>
<div class="paragraph"><p>Returns nodes with a <span class="monospaced">ACTED_IN</span> or <span class="monospaced">DIRECTED</span> relationship to Wall Street.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">4 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"Oliver Stone"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Martin Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (wallstreet)&lt;-[:ACTED_IN|:DIRECTED]-(person) where wallstreet.title='Wall Street' return person</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-match-by-relationship-type-and-use-an-identifier">Match by relationship type and use an identifier</h4>
<div class="paragraph"><p>If you both want to introduce an identifier to hold the relationship, and specify the relationship type you want, just add them both, like this.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (wallstreet)&lt;-[r:ACTED_IN]-(actor)
WHERE wallstreet.title='Wall Street'
RETURN r</pre></div>
<div class="paragraph"><p>Returns nodes that <span class="monospaced">ACTED_IN</span> Wall Street.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:ACTED_IN[0] {}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">:ACTED_IN[1] {}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">:ACTED_IN[2] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (wallstreet)&lt;-[r:ACTED_IN]-(actor) where wallstreet.title='Wall Street' return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-match-with-labels">Match with labels</h4>
<div class="paragraph"><p>To constrain your pattern with labels on nodes, you add it to your pattern nodes, using the label syntax.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH charlie:Person--&gt;movie:Movie
WHERE charlie.name='Charlie Sheen'
RETURN movie</pre></div>
<div class="paragraph"><p>Return any nodes connected with Charlie that are labeled :Movie</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">movie</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match charlie:Person--&gt;movie:Movie where charlie.name='Charlie Sheen' return movie</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-relationship-types-with-uncommon-characters">Relationship types with uncommon characters</h4>
<div class="paragraph"><p>Sometime your database will have types with non-letter characters, or with spaces in them. Use <span class="monospaced">`</span> (backtick) to quote these.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (n)-[r:`TYPE THAT HAS SPACE IN IT`]-&gt;()
WHERE n.name='Rob Reiner'
RETURN r</pre></div>
<div class="paragraph"><p>Returns a relationship of a type with spaces in it.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:TYPE THAT HAS SPACE IN IT[8] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _6-[:`TYPE THAT HAS SPACE IN IT`]-&gt;_2
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (n)-[r:`TYPE THAT HAS SPACE IN IT`]-&gt;() where n.name='Rob Reiner' return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-multiple-relationships">Multiple relationships</h4>
<div class="paragraph"><p>Relationships can be expressed by using multiple statements in the form of <span class="monospaced">()--()</span>, or they can be strung together, like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (charlie)-[:ACTED_IN]-&gt;(movie)&lt;-[:DIRECTED]-&gt;(director)
WHERE charlie.name='Charlie Sheen'
RETURN charlie,movie,director</pre></div>
<div class="paragraph"><p>Returns the three nodes in the path.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">charlie</td><td align="left" valign="top">movie</td><td align="left" valign="top">director</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="3">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[1]{name:"Oliver Stone"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (charlie)-[:ACTED_IN]-&gt;(movie)&lt;-[:DIRECTED]-&gt;(director) where charlie.name='Charlie Sheen' return charlie,movie,director</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-variable-length-relationships">Variable length relationships</h4>
<div class="paragraph"><p>Nodes that are a variable number of relationship&#8594;node hops away can be found using the following syntax: <span class="monospaced">-[:TYPE*minHops..maxHops]-&gt;</span>. minHops and maxHops are optional and default to 1 and infinity respectively. When no bounds are given the dots may be omitted.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (martin)-[:ACTED_IN*1..2]-(x)
WHERE martin.name='Martin Sheen'
RETURN x</pre></div>
<div class="paragraph"><p>Returns nodes that are 1 or 2 relationships away from Martin.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">x</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">5 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[4]{title:"The American President",name:"TheAmericanPresident"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (martin)-[:ACTED_IN*1..2]-(x) where martin.name='Martin Sheen' return x</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-relationship-identifier-in-variable-length-relationships">Relationship identifier in variable length relationships</h4>
<div class="paragraph"><p>When the connection between two nodes is of variable length, a relationship identifier becomes an collection of relationships.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (actor)-[r:ACTED_IN*2]-(co_actor)
WHERE actor.name='Charlie Sheen'
RETURN r</pre></div>
<div class="paragraph"><p>The query returns a collection of relationships.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[:ACTED_IN[0] {},:ACTED_IN[1] {}]</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">[:ACTED_IN[0] {},:ACTED_IN[2] {}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (actor)-[r:ACTED_IN*2]-(co_actor) where actor.name='Charlie Sheen' return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-zero-length-paths">Zero length paths</h4>
<div class="paragraph"><p>Using variable length paths that have the lower bound zero means that two identifiers can point to the same node. If the distance between two nodes is zero, they are by definition the same node. Note that when matching zero length paths the result may contain a match even when matching on a relationship type not in use.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (wallstreet:Movie)-[*0..1]-(x)
WHERE wallstreet.title='Wall Street'
RETURN x</pre></div>
<div class="paragraph"><p>Returns all nodes that are zero or one relationships away from Wall Street.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">x</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">5 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Martin Sheen"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"Oliver Stone"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match (wallstreet:Movie)-[*0..1]-(x) where wallstreet.title='Wall Street' return x</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-optional-relationship">Optional relationship</h4>
<div class="paragraph"><p>If a relationship is optional, it can be marked with a question mark. This is similar to how a SQL outer join works. If the relationship is there, it is returned. If it&#8217;s not, <span class="monospaced">null</span> is returned in it&#8217;s place. Remember that anything hanging off an optional relationship, is in turn optional, unless it is connected with a bound node through some other path.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(5)
MATCH a-[?]-&gt;x
RETURN x</pre></div>
<div class="paragraph"><p>Returns <span class="monospaced">null</span>, since the node has no outgoing relationships.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">x</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 start a=node(5) match a-[?]-&gt;x return x</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-optional-typed-and-named-relationship">Optional typed and named relationship</h4>
<div class="paragraph"><p>Just as with a normal relationship, you can decide which identifier it goes into, and what relationship type you need.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(5)
MATCH a-[r?:ACTS_IN]-&gt;()
RETURN r</pre></div>
<div class="paragraph"><p>This returns a node, and <span class="monospaced">null</span>, since the node has no outgoing <span class="monospaced">ACTS_IN</span> relationships.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 start a=node(5) match a-[r?:ACTS_IN]-&gt;() return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-properties-on-optional-elements">Properties on optional elements</h4>
<div class="paragraph"><p>Returning a property from an optional element that is <span class="monospaced">null</span> will also return <span class="monospaced">null</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(5)
MATCH a-[?]-&gt;x
RETURN x, x.name</pre></div>
<div class="paragraph"><p>Returns the element x (<span class="monospaced">null</span> in this query), and <span class="monospaced">null</span> as its name.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">x</td><td align="left" valign="top">x.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 start a=node(5) match a-[?]-&gt;x return x, x.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-shortest-path">Shortest path</h4>
<div class="paragraph"><p>Finding a single shortest path between two nodes is as easy as using the <span class="monospaced">shortestPath</span> function. It&#8217;s done like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p = shortestPath( (martin:Person)-[*..15]-(oliver:Person) )
WHERE martin.name = 'Martin Sheen' and oliver.name = 'Oliver Stone'
RETURN p</pre></div>
<div class="paragraph"><p>This means: find a single shortest path between two nodes, as long as the path is max 15 relationships long. Inside of the parenthesis
 you define a single link of a path&#8201;&#8212;&#8201;the starting node, the connecting relationship and the end node. Characteristics describing the relationship
 like relationship type, max hops and direction are all used when finding the shortest path. You can also mark the path as optional.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{name:"Martin Sheen"},:ACTED_IN[1] {},Node[5]{title:"Wall Street",name:"WallStreet"},:DIRECTED[5] {},Node[1]{name:"Oliver Stone"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match p = shortestPath( (martin:Person)-[*..15]-(oliver:Person) )
 where martin.name = 'Martin Sheen' and oliver.name = 'Oliver Stone'
 return p</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-all-shortest-paths">All shortest paths</h4>
<div class="paragraph"><p>Finds all the shortest paths between two nodes.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START martin=node(3), michael=node(7)
MATCH p = allShortestPaths( martin-[*]-michael )
RETURN p</pre></div>
<div class="paragraph"><p>Finds the two shortest paths between Martin and Michael.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{name:"Martin Sheen"},:ACTED_IN[3] {},Node[4]{title:"The American President",name:"TheAmericanPresident"},:ACTED_IN[4] {},Node[7]{name:"Michael Douglas"}]</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{name:"Martin Sheen"},:ACTED_IN[1] {},Node[5]{title:"Wall Street",name:"WallStreet"},:ACTED_IN[2] {},Node[7]{name:"Michael Douglas"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 start martin=node(3), michael=node(7) match p = allShortestPaths( martin-[*]-michael ) return p</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-named-path">Named path</h4>
<div class="paragraph"><p>If you want to return or filter on a path in your pattern graph, you can a introduce a named path.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p = (michael)--&gt;()
WHERE michael.name='Michael Douglas'
RETURN p</pre></div>
<div class="paragraph"><p>Returns the two paths starting from Michael.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[7]{name:"Michael Douglas"},:ACTED_IN[2] {},Node[5]{title:"Wall Street",name:"WallStreet"}]</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">[Node[7]{name:"Michael Douglas"},:ACTED_IN[4] {},Node[4]{title:"The American President",name:"TheAmericanPresident"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match p = (michael)--&gt;() where michael.name='Michael Douglas' return p</strong></span></p>
</div>
<div class="sect3">
<h4 id="match-matching-on-a-bound-relationship">Matching on a bound relationship</h4>
<div class="paragraph"><p>When your pattern contains a bound relationship, and that relationship pattern doesn&#8217;t specify direction,
Cypher will try to match the relationship where the connected nodes switch sides.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a-[r]-b
WHERE id(r) = 0
RETURN a,b</pre></div>
<div class="paragraph"><p>This returns the two connected nodes, once as the start node, and once as the end node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a</td><td align="left" valign="top">b</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[5]{title:"Wall Street",name:"WallStreet"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 match a-[r]-b where id(r) = 0 return a,b</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-where">Where</h3>
<div class="paragraph"><p>If you need filtering apart from the pattern of the data that you are looking
for, you can add clauses in the <span class="monospaced">WHERE</span> part of the query.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-where-graph.svg" alt="cypher-where-graph.svg">
</div>
<div class="title">Figure 42. Graph</div>
</div>
<div class="sect3">
<h4 id="where-boolean-operations">Boolean operations</h4>
<div class="paragraph"><p>You can use the expected boolean operators <span class="monospaced">AND</span> and <span class="monospaced">OR</span>, and also the boolean function <span class="monospaced">NOT()</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE (n.age &lt; 30 and n.name = "Tobias") or not(n.name = "Tobias" or n.name="Peter")
RETURN n</pre></div>
<div class="paragraph"><p>This will return both nodes in the start clause.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:25,name:"Tobias"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:36,name:"Andres",belt:"white"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where (n.age &lt; 30 and n.name = "Tobias") or not(n.name = "Tobias" or n.name="Peter")  return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-filter-on-node-label">Filter on node label</h4>
<div class="paragraph"><p>To filter nodes by label, write a label predicate after the <span class="monospaced">WHERE</span> keyword using either the short <span class="monospaced">WHERE n:foo</span> or the long <span class="monospaced">WHERE n LABEL [:foo, :bar]</span> form</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n:Swedish
RETURN n</pre></div>
<div class="paragraph"><p>The "<span class="monospaced">Andres</span>" node will be returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:36,name:"Andres",belt:"white"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n:Swedish return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-filter-on-node-property">Filter on node property</h4>
<div class="paragraph"><p>To filter on a property, write your clause after the <span class="monospaced">WHERE</span> keyword. Filtering on relationship properties works just the same way.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.age &lt; 30
RETURN n</pre></div>
<div class="paragraph"><p>The "<span class="monospaced">Tobias</span>" node will be returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:25,name:"Tobias"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.age &lt; 30 return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-regular-expressions">Regular expressions</h4>
<div class="paragraph"><p>You can match on regular expressions by using <span class="monospaced">=~ "regexp"</span>, like this:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name =~ 'Tob.*'
RETURN n</pre></div>
<div class="paragraph"><p>The "<span class="monospaced">Tobias</span>" node will be returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:25,name:"Tobias"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name =~ 'Tob.*' return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-escaping-in-regular-expressions">Escaping in regular expressions</h4>
<div class="paragraph"><p>If you need a forward slash inside of your regular expression, escape it. Remember that back slash needs to be escaped in string literals</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name =~ 'Some\\/thing'
RETURN n</pre></div>
<div class="paragraph"><p>No nodes match this regular expression.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">0 row</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name =~ 'Some\\/thing' return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-case-insensitive-regular-expressions">Case insensitive regular expressions</h4>
<div class="paragraph"><p>By pre-pending a regular expression with <span class="monospaced">(?i)</span>, the whole expression becomes case insensitive.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name =~ '(?i)ANDR.*'
RETURN n</pre></div>
<div class="paragraph"><p>The node with name "<span class="monospaced">Andres</span>" is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:36,name:"Andres",belt:"white"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name =~ '(?i)ANDR.*' return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-filtering-on-relationship-type">Filtering on relationship type</h4>
<div class="paragraph"><p>You can put the exact relationship type in the <span class="monospaced">MATCH</span> pattern, but sometimes you want to be able to do more advanced filtering on the type. You can use the special property <span class="monospaced">TYPE</span> to compare the type with something else. In this example, the query does a regular expression comparison with the name of the relationship type.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (n)-[r]-&gt;()
WHERE n.name='Andres' and type(r) =~ 'K.*'
RETURN r</pre></div>
<div class="paragraph"><p>This returns relationships that has a type whose name starts with K.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:KNOWS[0] {}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">:KNOWS[1] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match (n)-[r]-&gt;() where n.name='Andres' and type(r) =~ 'K.*' return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-property-exists">Property exists</h4>
<div class="paragraph"><p>To only include nodes/relationships that have a property, use the <span class="monospaced">HAS()</span> function and just write out the identifier and the property you expect it to have.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE has(n.belt)
RETURN n</pre></div>
<div class="paragraph"><p>The node named "<span class="monospaced">Andres</span>" is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:36,name:"Andres",belt:"white"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where has(n.belt) return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-default-true-if-property-is-missing">Default true if property is missing</h4>
<div class="paragraph"><p>If you want to compare a property on a graph element, but only if it exists, use the nullable property syntax. You can use a question mark if you want missing property to return true, like:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.belt? = 'white'
RETURN n
ORDER BY n.name</pre></div>
<div class="paragraph"><p>This returns all nodes, even those without the belt property.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:36,name:"Andres",belt:"white"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"Peter"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:25,name:"Tobias"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.belt? = 'white' return n order by n.name</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-default-false-if-property-is-missing">Default false if property is missing</h4>
<div class="paragraph"><p>When you need missing property to evaluate to false, use the exclamation mark.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.belt! = 'white'
RETURN n</pre></div>
<div class="paragraph"><p>No nodes without the belt property are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:36,name:"Andres",belt:"white"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.belt! = 'white' return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-filter-on-null-values">Filter on null values</h4>
<div class="paragraph"><p>Sometimes you might want to test if a value or an identifier is <span class="monospaced">null</span>. This is done just like SQL does it, with <span class="monospaced">IS NULL</span>. Also like SQL, the negative is <span class="monospaced">IS NOT NULL</span>, although <span class="monospaced">NOT(IS NULL x)</span> also works.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START a=node(1), b=node(3, 2)
MATCH a&lt;-[r?]-b
WHERE r is null
RETURN b</pre></div>
<div class="paragraph"><p>Nodes that Tobias is not connected to are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">b</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"Peter"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 start a=node(1), b=node(3, 2) match a&lt;-[r?]-b where r is null return b</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-filter-on-patterns">Filter on patterns</h4>
<div class="paragraph"><p>Patterns are expressions in Cypher, expressions that return a collection of paths. Collection
expressions are also predicates&#8201;&#8212;&#8201;an empty collection represents <span class="monospaced">false</span>, and a non-empty represents <span class="monospaced">true</span>.</p></div>
<div class="paragraph"><p>So, patterns are not only expressions, they are also predicates. The only limitation to your pattern is that you must be
able to express it in a single path. You can not use commas between multiple paths like you do in <span class="monospaced">MATCH</span>. You can achieve
the same effect by combining multiple patterns with <span class="monospaced">AND</span>.</p></div>
<div class="paragraph"><p>Note that you can not introduce new identifiers here. Although it might look very similar to the <span class="monospaced">MATCH</span> patterns, the
<span class="monospaced">WHERE</span> clause is all about eliminating matched subgraphs. <span class="monospaced">MATCH a-[*]-&gt;b</span> is very different from <span class="monospaced">WHERE a-[*]-&gt;b</span>; the
first will produce a subgraph for every path it can find between <span class="monospaced">a</span> and <span class="monospaced">b</span>, and the latter will eliminate any matched
subgraphs where <span class="monospaced">a</span> and <span class="monospaced">b</span> do not have a directed relationship chain between them.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH tobias, others
WHERE tobias.name='Tobias' and (others.name='Andres' or others.name='Peter') and tobias&lt;--others
RETURN others</pre></div>
<div class="paragraph"><p>Nodes that have an outgoing relationship to the "<span class="monospaced">Tobias</span>" node are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">others</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{age:36,name:"Andres",belt:"white"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match tobias, others where tobias.name='Tobias' and (others.name='Andres' or others.name='Peter') and tobias&lt;--others return others</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-filter-on-patterns-using-not">Filter on patterns using NOT</h4>
<div class="paragraph"><p>The <span class="monospaced">NOT()</span> function can be used to exclude a pattern.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START persons=node(*), peter=node(2)
WHERE not(persons--&gt;peter)
RETURN persons</pre></div>
<div class="paragraph"><p>Nodes that do not have an outgoing relationship to the "<span class="monospaced">Peter</span>" node are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">persons</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:25,name:"Tobias"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"Peter"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 start persons=node(*), peter=node(2) where not(persons--&gt;peter) return persons</strong></span></p>
</div>
<div class="sect3">
<h4 id="where-in-operator">IN operator</h4>
<div class="paragraph"><p>To check if an element exists in a collection, you can use the <span class="monospaced">IN</span> operator.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name IN ["Peter", "Tobias"]
RETURN a</pre></div>
<div class="paragraph"><p>This query shows how to check if a property exists in a literal collection.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{age:25,name:"Tobias"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"Peter"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `belt`:"white", `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match a where a.name IN ["Peter", "Tobias"] return a</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-aggregation">Aggregation</h3>
<div class="sect3">
<h4 id="aggregation-introduction">Introduction</h4>
<div class="paragraph"><p>To calculate aggregated data, Cypher offers aggregation, much like SQL&#8217;s <span class="monospaced">GROUP BY</span>.</p></div>
<div class="paragraph"><p>Aggregate functions take multiple input values and calculate an aggregated value from them. Examples are <span class="monospaced">AVG</span> that
calculate the average of multiple numeric values, or <span class="monospaced">MIN</span> that finds the smallest numeric value in a set of values.</p></div>
<div class="paragraph"><p>Aggregation can be done over all the matching sub graphs, or it can be further divided by introducing key values.
These are non-aggregate expressions, that are used to group the values going into the aggregate functions.</p></div>
<div class="paragraph"><p>So, if the return statement looks something like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">RETURN n, count(*)</pre></div>
<div class="paragraph"><p>We have two return expressions&#8201;&#8212;&#8201;<span class="monospaced">n</span>, and <span class="monospaced">count(*)</span>. The first, <span class="monospaced">n</span>, is no aggregate function, and so it will be the
grouping key. The latter, <span class="monospaced">count(*)</span> is an aggregate expression. So the matching subgraphs will be divided into
different buckets, depending on the grouping key. The aggregate function will then run on these buckets, calculating
the aggregate values.</p></div>
<div class="paragraph"><p>If you want to use aggregations to sort your result set, the aggregation must be included in the <span class="monospaced">RETURN</span> to be used
in your <span class="monospaced">ORDER BY</span>.</p></div>
<div class="paragraph"><p>The last piece of the puzzle is the <span class="monospaced">DISTINCT</span> keyword. It is used to make all values unique before running them through
an aggregate function.</p></div>
<div class="paragraph"><p>An example might be helpful:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH me:Person--&gt;friend:Person--&gt;friend_of_friend:Person
WHERE me.name = 'A'RETURN count(distinct friend_of_friend), count(friend_of_friend)</pre></div>
<div class="paragraph"><p>In this example we are trying to find all our friends of friends, and count them. The first aggregate function, <span class="monospaced">count(distinct friend_of_friend)</span>, will only see a <span class="monospaced">friend_of_friend</span> once&#8201;&#8212;&#8201;<span class="monospaced">DISTINCT</span> removes the duplicates. The latter aggregate function, <span class="monospaced">count(friend_of_friend)</span>, might very well see the same <span class="monospaced">friend_of_friend</span> multiple times. Since there is no real data in this case, an empty result is returned. See the sections below for real data.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">count(distinct friend_of_friend)</td><td align="left" valign="top">count(friend_of_friend)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">0</code></p></td><td align="left" valign="top"><p><code class="literal">0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 MATCH me:Person--&gt;friend:Person--&gt;friend_of_friend:Person WHERE me.name = 'A'RETURN count(distinct friend_of_friend), count(friend_of_friend)</strong></span></p>
<div class="paragraph"><p>The following examples are assuming the example graph structure below.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-aggregation-graph.svg" alt="cypher-aggregation-graph.svg">
</div>
<div class="title">Figure 43. Graph</div>
</div>
</div>
<div class="sect3">
<h4 id="_count">COUNT</h4>
<div class="paragraph"><p><span class="monospaced">COUNT</span> is used to count the number of rows. <span class="monospaced">COUNT</span> can be used in two forms&#8201;&#8212;&#8201;<span class="monospaced">COUNT(*)</span>
which just counts the number of matching rows, and <span class="monospaced">COUNT(&lt;identifier&gt;)</span>, which counts
the number of non-<span class="monospaced">null</span> values in <span class="monospaced">&lt;identifier&gt;</span>.</p></div>
</div>
<div class="sect3">
<h4 id="aggregation-count-nodes">Count nodes</h4>
<div class="paragraph"><p>To count the number of nodes, for example the number of nodes connected to one node, you can use <span class="monospaced">count(*)</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (n)--&gt;(x)
WHERE n.name = 'A'
RETURN n, count(*)</pre></div>
<div class="paragraph"><p>This returns the start node and the count of related nodes.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td><td align="left" valign="top">count(*)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"A",property:13}</code></p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match (n)--&gt;(x) where n.name = 'A' return n, count(*)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-group-count-relationship-types">Group Count Relationship Types</h4>
<div class="paragraph"><p>To count the groups of relationship types, return the types and count them with <span class="monospaced">count(*)</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (n)-[r]-&gt;()
WHERE n.name='A'
RETURN type(r), count(*)</pre></div>
<div class="paragraph"><p>The relationship types and their group count is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">type(r)</td><td align="left" valign="top">count(*)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"KNOWS"</code></p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match (n)-[r]-&gt;() where n.name='A' return type(r), count(*)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-count-entities">Count entities</h4>
<div class="paragraph"><p>Instead of counting the number of results with <span class="monospaced">count(*)</span>, it might be more expressive to include the name of the identifier you care about.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (n)--&gt;(x)
WHERE n.name = 'A'
RETURN count(x)</pre></div>
<div class="paragraph"><p>The example query returns the number of connected nodes from the start node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">count(x)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match (n)--&gt;(x) where n.name = 'A' return count(x)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-count-non-null-values">Count non-null values</h4>
<div class="paragraph"><p>You can count the non-<span class="monospaced">null</span> values by using <span class="monospaced">count(&lt;identifier&gt;)</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
RETURN count(n.property?)</pre></div>
<div class="paragraph"><p>The count of related nodes with the <span class="monospaced">property</span> property set is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">count(n.property?)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person return count(n.property?)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-sum">SUM</h4>
<div class="paragraph"><p>The <span class="monospaced">SUM</span> aggregation function simply sums all the numeric values it encounters. Nulls are silently dropped. This is an example of how you can use <span class="monospaced">SUM</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
WHERE has(n.property)
RETURN sum(n.property)</pre></div>
<div class="paragraph"><p>This returns the sum of all the values in the property <span class="monospaced">property</span>.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">sum(n.property)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">90</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person where has(n.property) return sum(n.property)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-avg">AVG</h4>
<div class="paragraph"><p><span class="monospaced">AVG</span> calculates the average of a numeric column.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
WHERE has(n.property)
RETURN avg(n.property)</pre></div>
<div class="paragraph"><p>The average of all the values in the property <span class="monospaced">property</span> is returned by the example query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">avg(n.property)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">30.0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person where has(n.property) return avg(n.property)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-percentile_disc">PERCENTILE_DISC</h4>
<div class="paragraph"><p><span class="monospaced">PERCENTILE_DISC</span> calculates the percentile of a given value over a group, with a percentile from 0.0 to 1.0. It uses a rounding method, returning the nearest value to the percentile. For interpolated values, see PERCENTILE_CONT.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
WHERE has(n.property)
RETURN percentile_disc(n.property, 0.5)</pre></div>
<div class="paragraph"><p>The 50th percentile of the values in the property <span class="monospaced">property</span> is returned by the example query. In this case, 0.5 is the median, or 50th percentile.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">percentile_disc(n.property, 0.5)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">33</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person where has(n.property) return percentile_disc(n.property, 0.5)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-percentile_cont">PERCENTILE_CONT</h4>
<div class="paragraph"><p><span class="monospaced">PERCENTILE_CONT</span> calculates the percentile of a given value over a group, with a percentile from 0.0 to 1.0. It uses a linear interpolation method, calculating a weighted average between two values, if the desired percentile lies between them. For nearest values using a rounding method, see PERCENTILE_DISC.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
WHERE has(n.property)
RETURN percentile_cont(n.property, 0.4)</pre></div>
<div class="paragraph"><p>The 40th percentile of the values in the property <span class="monospaced">property</span> is returned by the example query, calculated with a weighted average.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">percentile_cont(n.property, 0.4)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">29.0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person where has(n.property) return percentile_cont(n.property, 0.4)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-max">MAX</h4>
<div class="paragraph"><p><span class="monospaced">MAX</span> find the largets value in a numeric column.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
WHERE has(n.property)
RETURN max(n.property)</pre></div>
<div class="paragraph"><p>The largest of all the values in the property <span class="monospaced">property</span> is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">max(n.property)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">44</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person where has(n.property) return max(n.property)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-min">MIN</h4>
<div class="paragraph"><p><span class="monospaced">MIN</span> takes a numeric property as input, and returns the smallest value in that column.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
WHERE has(n.property)
RETURN min(n.property)</pre></div>
<div class="paragraph"><p>This returns the smallest of all the values in the property <span class="monospaced">property</span>.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">min(n.property)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">13</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person where has(n.property) return min(n.property)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-collect">COLLECT</h4>
<div class="paragraph"><p><span class="monospaced">COLLECT</span> collects all the values into a list. It will ignore null values,</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n:Person
RETURN collect(n.property?)</pre></div>
<div class="paragraph"><p>Returns a single row, with all the values collected.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">collect(n.property?)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[13,33,44]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n:Person return collect(n.property?)</strong></span></p>
</div>
<div class="sect3">
<h4 id="aggregation-distinct">DISTINCT</h4>
<div class="paragraph"><p>All aggregation functions also take the <span class="monospaced">DISTINCT</span> modifier, which removes duplicates from the values.
So, to count the number of unique eye colors from nodes related to <span class="monospaced">a</span>, this query can be used:</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a:Person--&gt;b
WHERE a.name = 'A'
RETURN count(distinct b.eyes)</pre></div>
<div class="paragraph"><p>Returns the number of eye colors.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">count(distinct b.eyes)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`eyes`:"brown", `name`:"D"})
create (_2:`Person` {`name`:"A", `property`:13})
create (_3:`Person` {`eyes`:"blue", `name`:"B", `property`:33})
create (_4:`Person` {`eyes`:"blue", `name`:"C", `property`:44})
create _2-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _2-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a:Person--&gt;b where a.name = 'A' return count(distinct b.eyes)</strong></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-write">Writing Clauses</h2>
<div class="sectionbody">
<div class="paragraph"><p>Write data to the database.</p></div>
<div class="sect2">
<h3 id="query-create">Create</h3>
<div class="paragraph"><p>Creating graph elements&#8201;&#8212;&#8201;nodes and relationships, is done with <span class="monospaced">CREATE</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In the <span class="monospaced">CREATE</span> clause, patterns are used a lot.
Read <a href="#introduction-pattern">[introduction-pattern]</a> for an introduction.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="create-create-single-node">Create single node</h4>
<div class="paragraph"><p>Creating a single node is done by issuing the following query.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE (n)</pre></div>
<div class="paragraph"><p>Nothing is returned from this query, except the count of affected nodes.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Nodes created: 1</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create (n)</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-create-single-node-and-set-properties">Create single node and set properties</h4>
<div class="paragraph"><p>The values for the properties can be any scalar expressions.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE (n {name : 'Andres', title : 'Developer'})</pre></div>
<div class="paragraph"><p>Nothing is returned from this query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 2</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create (n {name : 'Andres', title : 'Developer'})</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-create-node-and-add-labels">Create node and add labels</h4>
<div class="paragraph"><p>To add labels to the newly created node, you can either use <span class="monospaced">LABEL</span> followed by an expression,or you can use the labels short form syntax.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE (n:Person)</pre></div>
<div class="paragraph"><p>Nothing is returned from this query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Labels added: 1</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create (n:Person)</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-create-node-and-add-labels-and-properties">Create node and add labels and properties</h4>
<div class="paragraph"><p>When creating a new node with labels, you can add properties using <span class="monospaced">VALUES</span> at the same time</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE (n:Person {name : 'Andres', title : 'Developer'})</pre></div>
<div class="paragraph"><p>Nothing is returned from this query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 2
</th></tr><tr><th align="left" valign="top" colspan="1">Labels added: 1</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create (n:Person {name : 'Andres', title : 'Developer'})</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-return-created-node">Return created node</h4>
<div class="paragraph"><p>Creating a single node is done by issuing the following query.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE (a {name : 'Andres'})
RETURN a</pre></div>
<div class="paragraph"><p>The newly created node is returned. This query uses the alternative syntax for single node creation.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Andres"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create (a {name : 'Andres'}) return a</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-create-a-relationship-between-two-nodes">Create a relationship between two nodes</h4>
<div class="paragraph"><p>To create a relationship between two nodes, we first get the two nodes. Once the nodes are loaded, we simply create a relationship between them.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a:Person, b:Person
WHERE a.name = 'Node A' and b.name = 'Node B'
CREATE a-[r:RELTYPE]-&gt;b
RETURN r</pre></div>
<div class="paragraph"><p>The created relationship is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:RELTYPE[1] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Node A"})
create (_2:`Person` {`name`:"Node B"})
</span><span class="command"><strong>
 match a:Person, b:Person where a.name = 'Node A' and b.name = 'Node B' create a-[r:RELTYPE]-&gt;b return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-create-a-relationship-and-set-properties">Create a relationship and set properties</h4>
<div class="paragraph"><p>Setting properties on relationships is done in a similar manner to how it&#8217;s done when creating nodes. Note that the values can be any expression.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a:Person, b:Person
WHERE a.name = 'Node A' and b.name = 'Node B'
CREATE a-[r:RELTYPE {name : a.name + '&lt;-&gt;' + b.name }]-&gt;b
RETURN r</pre></div>
<div class="paragraph"><p>The newly created relationship is returned by the example query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:RELTYPE[1] {name:"Node A&lt;-&gt;Node B"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Node A"})
create (_2:`Person` {`name`:"Node B"})
</span><span class="command"><strong>
 match a:Person, b:Person where a.name = 'Node A' and b.name = 'Node B' create a-[r:RELTYPE {name : a.name + '&lt;-&gt;' + b.name }]-&gt;b return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-create-a-full-path">Create a full path</h4>
<div class="paragraph"><p>When you use <span class="monospaced">CREATE</span> and a pattern, all parts of the pattern that are not already in scope at this time
will be created.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE p = (andres {name:'Andres'})-[:WORKS_AT]-&gt;neo&lt;-[:WORKS_AT]-(michael {name:'Michael'})
RETURN p</pre></div>
<div class="paragraph"><p>This query creates three nodes and two relationships in one go, assigns it to a path identifier, and returns it.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 3
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 2
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 2</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[4]{name:"Andres"},:WORKS_AT[2] {},Node[5]{},:WORKS_AT[3] {},Node[6]{name:"Michael"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">(0)
</span><span class="command"><strong>create p = (andres {name:'Andres'})-[:WORKS_AT]-&gt;neo&lt;-[:WORKS_AT]-(michael {name:'Michael'}) return p</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-create-single-node-from-map">Create single node from map</h4>
<div class="paragraph"><p>You can also create a graph entity from a <span class="monospaced">Map&lt;String,Object&gt;</span> map. All
the key/value pairs in the map will be set as properties on the created
relationship or node.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">create ({props})</pre></div>
<div class="paragraph"><p>This query can be used in the following fashion:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; props = new HashMap&lt;String, Object&gt;();
props.put( "name", "Andres" );
props.put( "position", "Developer" );

Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put( "props", props );
engine.execute( "create ({props})", params );</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="create-create-multiple-nodes-from-map">Create multiple nodes from maps</h4>
<div class="paragraph"><p>By providing an iterable of maps (<span class="monospaced">Iterable&lt;Map&lt;String,Object&gt;&gt;</span>), Cypher will create a node for each map
in the iterable. When you do this, you can&#8217;t create anything else in the same create statement.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">create (n {props}) return n</pre></div>
<div class="paragraph"><p>This query can be used in the following fashion:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, Object&gt; n1 = new HashMap&lt;String, Object&gt;();
n1.put( "name", "Andres" );
n1.put( "position", "Developer" );

Map&lt;String, Object&gt; n2 = new HashMap&lt;String, Object&gt;();
n2.put( "name", "Michael" );
n2.put( "position", "Developer" );

Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
List&lt;Map&lt;String, Object&gt;&gt; maps = Arrays.asList( n1, n2 );
params.put( "props", maps );
engine.execute( "create (n {props}) return n", params );</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="query-create-unique">Create Unique</h3>
<div class="paragraph"><p><span class="monospaced">CREATE UNIQUE</span> is in the middle of <span class="monospaced">MATCH</span> and <span class="monospaced">CREATE</span>&#8201;&#8212;&#8201;it will match what it can, and create what is missing.
<span class="monospaced">CREATE UNIQUE</span> will always make the least change possible to the graph&#8201;&#8212;&#8201;if it can use parts of the existing graph,
it will.</p></div>
<div class="paragraph"><p>Another difference to <span class="monospaced">MATCH</span> is that <span class="monospaced">CREATE UNIQUE</span> assumes the pattern to be unique. If multiple matching subgraphs
are found an exception will be thrown.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In the <span class="monospaced">CREATE UNIQUE</span> clause, patterns are used a lot.
Read <a href="#introduction-pattern">[introduction-pattern]</a> for an introduction.</td>
</tr></table>
</div>
<div class="paragraph"><p>The examples start out with the following data set:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-createunique-graph.svg" alt="cypher-createunique-graph.svg">
</div>
</div>
<div class="sect3">
<h4 id="create-unique-create-relationship-if-it-is-missing">Create relationship if it is missing</h4>
<div class="paragraph"><p><span class="monospaced">CREATE UNIQUE</span> is used to describe the pattern that should be found or created.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH left, right
WHERE left.name = 'A' and right.name in ['B','C']
CREATE UNIQUE left-[r:KNOWS]-&gt;right
RETURN r</pre></div>
<div class="paragraph"><p>The left node is matched agains the two right nodes. One relationship already exists and can be matched, and the other relationship is created before it is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:KNOWS[5] {}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">:KNOWS[3] {}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 match left, right where left.name = 'A' and right.name in ['B','C'] create unique left-[r:KNOWS]-&gt;right return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-unique-create-node-if-missing">Create node if missing</h4>
<div class="paragraph"><p>If the pattern described needs a node, and it can&#8217;t be matched, a new node will be created.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH root
WHERE root.name! = 'root'
CREATE UNIQUE root-[:LOVES]-someone
RETURN someone</pre></div>
<div class="paragraph"><p>The root node doesn&#8217;t have any <span class="monospaced">LOVES</span> relationships, and so a node is created, and also a relationship to that node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">someone</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[6]{}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 match root where root.name! = 'root' create unique root-[:LOVES]-someone return someone</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-unique-create-nodes-with-values">Create nodes with values</h4>
<div class="paragraph"><p>The pattern described can also contain values on the node. These are given using the following syntax: <span class="monospaced">prop : &lt;expression&gt;</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH root
WHERE root.name = 'root'
CREATE UNIQUE root-[:X]-(leaf {name:'D'} )
RETURN leaf</pre></div>
<div class="paragraph"><p>No node connected with the root node has the name <span class="monospaced">D</span>, and so a new node is created to match the pattern.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">leaf</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[6]{name:"D"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 match root where root.name = 'root' create unique root-[:X]-(leaf {name:'D'} ) return leaf</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-unique-create-labeled-node-if-missing">Create labeled node if missing</h4>
<div class="paragraph"><p>If the pattern described needs a labeled node and there is none with the given labels, Cypher will create a new one</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name! = 'A'
CREATE UNIQUE a-[:KNOWS]-c:blue
RETURN c</pre></div>
<div class="paragraph"><p>The A node is connected in a <span class="monospaced">KNOWS</span> relationship to the c node, but since C doesn&#8217;t have the <span class="monospaced">:blue</span> label, a new node labeled as <span class="monospaced">:blue</span> is created along with a <span class="monospaced">KNOWS</span> relationship from A to it</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">c</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Labels added: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[6]{}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 match a where a.name! = 'A' create unique a-[:KNOWS]-c:blue return c</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-unique-create-relationship-with-values">Create relationship with values</h4>
<div class="paragraph"><p>Relationships to be created can also be matched on values.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH root
WHERE root.name! = 'root'
CREATE UNIQUE root-[r:X {since:'forever'}]-()
RETURN r</pre></div>
<div class="paragraph"><p>In this example, we want the relationship to have a value, and since no such relationship can be found, a new node and relationship are created. Note that since we are not interested in the created node, we don&#8217;t name it.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">:X[5] {since:"forever"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 match root where root.name! = 'root' create unique root-[r:X {since:'forever'}]-() return r</strong></span></p>
</div>
<div class="sect3">
<h4 id="create-unique-describe-complex-pattern">Describe complex pattern</h4>
<div class="paragraph"><p>The pattern described by <span class="monospaced">CREATE UNIQUE</span> can be separated by commas, just like in <span class="monospaced">MATCH</span> and <span class="monospaced">CREATE</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH root
WHERE root.name! = 'root'
CREATE UNIQUE root-[:FOO]-&gt;x, root-[:BAR]-&gt;x
RETURN x</pre></div>
<div class="paragraph"><p>This example pattern uses two paths, separated by a comma.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">x</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships created: 2</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[6]{}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 match root where root.name! = 'root' create unique root-[:FOO]-&gt;x, root-[:BAR]-&gt;x return x</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-merge">Merge</h3>
<div class="sect3">
<h4 id="_introduction_2">Introduction</h4>
<div class="paragraph"><p><span class="monospaced">MERGE</span> either matches existing nodes and binds them, or it creates new data and binds that. For example, you can
search for a user node by id, and if the node does not already exist in the database, it will create it.</p></div>
<div class="paragraph"><p><span class="monospaced">MERGE</span> is not only used for single nodes - just like <span class="monospaced">MATCH</span>, if multiple nodes match, they will all be
bound to the identifier.</p></div>
<div class="paragraph"><p>The following graph is used for the examples below:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-merge-graph.svg" alt="cypher-merge-graph.svg">
</div>
<div class="title">Figure 44. Graph</div>
</div>
</div>
<div class="sect3">
<h4 id="merge-merge-single-node-with-a-label">Merge single node with a label</h4>
<div class="paragraph"><p>Merging a single node with a given label.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">merge (robert:Critic)
RETURN robert, labels(robert)</pre></div>
<div class="paragraph"><p>Because there are no nodes labeled Critic in the database, a new node is created.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">robert</td><td align="left" valign="top">labels(robert)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row
</th></tr><tr><th align="left" valign="top" colspan="2">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="2">Labels added: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[9]{}</code></p></td><td align="left" valign="top"><p><code class="literal">["Critic"]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 merge (robert:Critic) return robert, labels(robert)</strong></span></p>
</div>
<div class="sect3">
<h4 id="merge-merge-single-node-with-properties">Merge single node with properties</h4>
<div class="paragraph"><p>Merging a single node with properties where not all matches any existing node.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">merge (charlie {name:'Charlie Sheen', age:10})
RETURN charlie</pre></div>
<div class="paragraph"><p>A new node with the name Charlie Sheen will be created since not all properties matched the existing Charlie Sheen node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">charlie</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 2</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[9]{age:10,name:"Charlie Sheen"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 merge (charlie {name:'Charlie Sheen', age:10}) return charlie</strong></span></p>
</div>
<div class="sect3">
<h4 id="merge-merge-single-node-specifying-both-label-and-property">Merge single node specifying both label and property</h4>
<div class="paragraph"><p>Merging a single node with both label and property matching an existing node.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">merge (michael:Person {name:'Michael Douglas'})
RETURN michael</pre></div>
<div class="paragraph"><p>Michael Douglas will be matched and returned</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">michael</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 merge (michael:Person {name:'Michael Douglas'}) return michael</strong></span></p>
</div>
<div class="sect3">
<h4 id="merge-merge-with-on-create">Merge with ON CREATE</h4>
<div class="paragraph"><p>Merge a node and set properties if the node needs to be created.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">merge (keanu:Person {name:'Keanu Reeves'}) on
CREATE keanu
SET keanu.created = timestamp()
RETURN keanu</pre></div>
<div class="paragraph"><p>Creates the Keanu node, and sets a timestamp on creation time.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">keanu</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 2
</th></tr><tr><th align="left" valign="top" colspan="1">Labels added: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[9]{created:1366718119419,name:"Keanu Reeves"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 merge (keanu:Person {name:'Keanu Reeves'}) on create keanu set keanu.created = timestamp() return keanu</strong></span></p>
</div>
<div class="sect3">
<h4 id="merge-merge-with-on-match">Merge with ON MATCH</h4>
<div class="paragraph"><p>Merging nodes and setting properties on found nodes.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">merge (person:Person) on
MATCH person
SET person.found = true
RETURN person</pre></div>
<div class="paragraph"><p>Finds all the :Person nodes, sets a property on them, and returns them.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">5 rows
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 5</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"Oliver Stone",found:true}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Charlie Sheen",found:true}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Martin Sheen",found:true}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[6]{name:"Rob Reiner",found:true}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[7]{name:"Michael Douglas",found:true}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 merge (person:Person) on match person set person.found = true return person</strong></span></p>
</div>
<div class="sect3">
<h4 id="merge-merge-with-on-create-and-on-match">Merge with ON CREATE and ON MATCH</h4>
<div class="paragraph"><p>Merge a node and set properties if the node needs to be created.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">merge (keanu:Person {name:'Keanu Reeves'})
on
CREATE keanu
SET keanu.created = timestamp()
on
MATCH keanu
SET keanu.lastSeen = timestamp()
RETURN keanu</pre></div>
<div class="paragraph"><p>Creates the Keanu node, and sets a timestamp on creation time. If Keanu already existed, a different property would be set</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">keanu</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Nodes created: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 2
</th></tr><tr><th align="left" valign="top" colspan="1">Labels added: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[9]{created:1366718120101,name:"Keanu Reeves"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Person` {`name`:"Oliver Stone"})
create (_2:`Person` {`name`:"Charlie Sheen"})
create (_3:`Person` {`name`:"Martin Sheen"})
create (_4:`Movie` {`name`:"TheAmericanPresident", `title`:"The American President"})
create (_5:`Movie` {`name`:"WallStreet", `title`:"Wall Street"})
create (_6:`Person` {`name`:"Rob Reiner"})
create (_7:`Person` {`name`:"Michael Douglas"})
create _1-[:`DIRECTED`]-&gt;_5
create _2-[:`ACTED_IN`]-&gt;_5
create _2-[:`FATHER`]-&gt;_3
create _3-[:`ACTED_IN`]-&gt;_5
create _3-[:`ACTED_IN`]-&gt;_4
create _6-[:`DIRECTED`]-&gt;_4
create _7-[:`ACTED_IN`]-&gt;_5
create _7-[:`ACTED_IN`]-&gt;_4
</span><span class="command"><strong>
 merge (keanu:Person {name:'Keanu Reeves'})
 on create keanu set keanu.created = timestamp()
 on match keanu set keanu.lastSeen = timestamp() return keanu</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-set">Set</h3>
<div class="paragraph"><p>Updating properties and labels on nodes and relationships is done with the <span class="monospaced">SET</span> clause.
<span class="monospaced">SET</span> properties can also be used with maps from parameters.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Setting labels on a node is an idempotent operations - if you try to set a label on a node that already has that label on it, nothing happens. The
query statistics will tell you if something needed to be done or not.</td>
</tr></table>
</div>
<div class="paragraph"><p>The examples use this graph as a starting point:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-set-graph.svg" alt="cypher-set-graph.svg">
</div>
</div>
<div class="sect3">
<h4 id="set-set-a-property">Set a property</h4>
<div class="paragraph"><p>To set a property on a node or relationship, use <span class="monospaced">SET</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='Andres'
SET n.surname = 'Taylor'
RETURN n</pre></div>
<div class="paragraph"><p>The newly changed node is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[4]{awesome:true,age:36,name:"Andres",surname:"Taylor"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Emil"})
create (_2 {`name`:"Stefan"})
create (_3 {`age`:34, `name`:"Peter"})
create (_4:`Swedish` {`age`:36, `awesome`:true, `name`:"Andres"})
create _1-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n where n.name='Andres' set n.surname = 'Taylor' return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="set-remove-a-property">Remove a property</h4>
<div class="paragraph"><p>Normally you remove a property by using delete, but it&#8217;s sometimes handy to do
it using the <span class="monospaced">SET</span> command. One example is if the property comes from a parameter.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='Andres'
SET n.name = null
RETURN n</pre></div>
<div class="paragraph"><p>The node is returned by the query, and the name property is now missing.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[4]{awesome:true,age:36}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Emil"})
create (_2 {`name`:"Stefan"})
create (_3 {`age`:34, `name`:"Peter"})
create (_4:`Swedish` {`age`:36, `awesome`:true, `name`:"Andres"})
create _1-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n where n.name='Andres' set n.name = null return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="set-copying-properties-between-nodes-and-relationships">Copying properties between nodes and relationships</h4>
<div class="paragraph"><p>You can also use SET to copy all properties from one graph element to another. Remember that doing this
will remove all other properties on the receiving graph element.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH at, pn
WHERE at.name='Andres' and pn.name='Peter'
SET at = pn
RETURN at, pn</pre></div>
<div class="paragraph"><p>The Andres node has had all it&#8217;s properties replaced by the properties in the Peter node.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">at</td><td align="left" valign="top">pn</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows
</th></tr><tr><th align="left" valign="top" colspan="2">Properties set: 5</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[4]{age:34,name:"Peter"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[3]{age:34,name:"Peter"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[4]{age:34,name:"Peter"}</code></p></td><td align="left" valign="top"><p><code class="literal">Node[4]{age:34,name:"Peter"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Emil"})
create (_2 {`name`:"Stefan"})
create (_3 {`age`:34, `name`:"Peter"})
create (_4:`Swedish` {`age`:36, `awesome`:true, `name`:"Andres"})
create _1-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match at, pn where at.name='Andres' and pn.name='Peter' set at = pn return at, pn</strong></span></p>
</div>
<div class="sect3">
<h4 id="set-set-a-label-on-a-node">Set a label on a node</h4>
<div class="paragraph"><p>To set a label on a node, use <span class="monospaced">SET</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='Stefan'
SET n :German
RETURN n</pre></div>
<div class="paragraph"><p>The newly labeled node is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Labels added: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{name:"Stefan"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Emil"})
create (_2 {`name`:"Stefan"})
create (_3 {`age`:34, `name`:"Peter"})
create (_4:`Swedish` {`age`:36, `awesome`:true, `name`:"Andres"})
create _1-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n where n.name='Stefan' set n :German return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="set-set-multiple-labels-on-a-node">Set multiple labels on a node</h4>
<div class="paragraph"><p>To set multiple labels on a node, use <span class="monospaced">SET</span> and separate the different labels using <span class="monospaced">:</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='Emil'
SET n :Swedish:Bossman
RETURN n</pre></div>
<div class="paragraph"><p>The newly labeled node is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Labels added: 2</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{name:"Emil"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"Emil"})
create (_2 {`name`:"Stefan"})
create (_3 {`age`:34, `name`:"Peter"})
create (_4:`Swedish` {`age`:36, `awesome`:true, `name`:"Andres"})
create _1-[:`KNOWS`]-&gt;_3
create _2-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_3
</span><span class="command"><strong>
 match n where n.name='Emil' set n :Swedish:Bossman return n</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-delete">Delete</h3>
<div class="paragraph"><p>Deleting graph elements&#8201;&#8212;&#8201;nodes and relationships, is done with <span class="monospaced">DELETE</span>.</p></div>
<div class="paragraph"><p>The examples start out with the following database:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-delete-graph.svg" alt="cypher-delete-graph.svg">
</div>
</div>
<div class="sect3">
<h4 id="delete-delete-single-node">Delete single node</h4>
<div class="paragraph"><p>To delete a node, use the <span class="monospaced">DELETE</span> clause.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='Danny'
DELETE n</pre></div>
<div class="paragraph"><p>Nothing is returned from this query, except the count of affected nodes.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Nodes deleted: 1</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3 {`age`:36, `name`:"Andres"})
create (_4 {`name`:"Danny"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name='Danny' delete n</strong></span></p>
</div>
<div class="sect3">
<h4 id="delete-delete-a-node-and-connected-relationships">Delete a node and connected relationships</h4>
<div class="paragraph"><p>If you are trying to delete a node with relationships on it, you have to delete these as well.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START n = node(3)
MATCH n-[r]-()
DELETE n, r</pre></div>
<div class="paragraph"><p>Nothing is returned from this query, except the count of affected nodes.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Nodes deleted: 1
</th></tr><tr><th align="left" valign="top" colspan="1">Relationships deleted: 2</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:25, `name`:"Tobias"})
create (_2 {`age`:34, `name`:"Peter"})
create (_3 {`age`:36, `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 start n = node(3) match n-[r]-() delete n, r</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-remove">Remove</h3>
<div class="paragraph"><p>Removing properties and labels from graph elements is done using <span class="monospaced">REMOVE</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Removing labels from a node is an idempotent operation - if you try to remove a label from a node that does not have that label on it, nothing happens. The
query statistics will tell you if something needed to be done or not.</td>
</tr></table>
</div>
<div class="paragraph"><p>The examples start out with the following database:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-remove-graph.svg" alt="cypher-remove-graph.svg">
</div>
</div>
<div class="sect3">
<h4 id="remove-remove-a-property">Remove a property</h4>
<div class="paragraph"><p>Neo4j doesn&#8217;t allow storing <span class="monospaced">null</span> in properties. Instead, if no value exists, the property is just not there. So, to remove a property value on a node or a relationship, is also done with <span class="monospaced">REMOVE</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH andres
WHERE andres.name='Andres'
REMOVE andres.age
RETURN andres</pre></div>
<div class="paragraph"><p>The node is returned, and no property <span class="monospaced">age</span> exists on it.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">andres</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Properties set: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[3]{name:"Andres"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Swedish` {`age`:25, `name`:"Tobias"})
create (_2:`Swedish`:`German` {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match andres where andres.name='Andres' remove andres.age return andres</strong></span></p>
</div>
<div class="sect3">
<h4 id="remove-remove-a-label-from-a-node">Remove a label from a node</h4>
<div class="paragraph"><p>To remove labels, you use <span class="monospaced">REMOVE</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='Peter'
REMOVE n:German
RETURN n</pre></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Labels removed: 1</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"Peter"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Swedish` {`age`:25, `name`:"Tobias"})
create (_2:`Swedish`:`German` {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name='Peter' remove n:German return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="remove-removing-multiple-labels">Removing multiple labels</h4>
<div class="paragraph"><p>To remove multiple labels, you use <span class="monospaced">REMOVE</span>.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
WHERE n.name='Peter'
REMOVE n:German:Swedish
RETURN n</pre></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">n</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row
</th></tr><tr><th align="left" valign="top" colspan="1">Labels removed: 2</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:34,name:"Peter"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1:`Swedish` {`age`:25, `name`:"Tobias"})
create (_2:`Swedish`:`German` {`age`:34, `name`:"Peter"})
create (_3:`Swedish` {`age`:36, `name`:"Andres"})
create _3-[:`KNOWS`]-&gt;_1
create _3-[:`KNOWS`]-&gt;_2
</span><span class="command"><strong>
 match n where n.name='Peter' remove n:German:Swedish return n</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-foreach">Foreach</h3>
<div class="paragraph"><p>Collections and paths are key concepts in Cypher. To use them for updating data, you can use the <span class="monospaced">FOREACH</span> construct.
It allows you to do updating commands on elements in a collection&#8201;&#8212;&#8201;a path, or a collection created by aggregation.</p></div>
<div class="paragraph"><p>The identifier context inside of the foreach parenthesis is separate from the one outside it, i.e. if you <span class="monospaced">CREATE</span> a
node identifier inside of a <span class="monospaced">FOREACH</span>, you will not be able to use it outside of the foreach statement, unless you
match to find it.</p></div>
<div class="paragraph"><p>Inside of the <span class="monospaced">FOREACH</span> parentheses, you can do any updating commands&#8201;&#8212;&#8201;<span class="monospaced">CREATE</span>, <span class="monospaced">CREATE UNIQUE</span>, <span class="monospaced">DELETE</span>,
and <span class="monospaced">FOREACH</span>.</p></div>
<div class="sect3">
<h4 id="foreach-mark-all-nodes-along-a-path">Mark all nodes along a path</h4>
<div class="paragraph"><p>This query will set the property <span class="monospaced">marked</span> to true on all nodes along a path.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p = begin -[*]-&gt; end
WHERE begin.name='A' and end.name='D' foreach(n in nodes(p) :
SET n.marked = true)</pre></div>
<div class="paragraph"><p>Nothing is returned from this query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tfoot><tr><th align="left" valign="top" colspan="1">Properties set: 4</th></tr></tfoot><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"D"})
create (_2 {`name`:"A"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _2-[:`KNOWS`]-&gt;_3
create _3-[:`KNOWS`]-&gt;_4
create _4-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p = begin -[*]-&gt; end where begin.name='A' and end.name='D' foreach(n in nodes(p) : set n.marked = true)</strong></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-function">Functions</h2>
<div class="sectionbody">
<div class="paragraph"><p>This chapter contains information on all functions in Cypher.
Note that related information exists in <a href="#query-operators">[query-operators]</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Most functions in Cypher will return <span class="monospaced">null</span> if the input parameter is <span class="monospaced">null</span>.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="query-predicates">Predicates</h3>
<div class="paragraph"><p>Predicates are boolean functions that return true or false for a given set of input.
They are most commonly used to filter out subgraphs in the <span class="monospaced">WHERE</span> part of a query.</p></div>
<div class="paragraph"><p>See also <a href="#query-operators-comparison">[query-operators-comparison]</a>.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-functions-graph.svg" alt="cypher-functions-graph.svg">
</div>
<div class="title">Figure 45. Graph</div>
</div>
<div class="sect3">
<h4 id="functions-all">ALL</h4>
<div class="paragraph"><p>Tests whether a predicate holds for all element of this collection collection.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">ALL(identifier in collection WHERE predicate)</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
<li>
<p>
<em>identifier:</em> This is the identifier that can be used from the predicate.
</p>
</li>
<li>
<p>
<em>predicate:</em> A predicate that is tested against all items in the collection.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=a-[*1..3]-&gt;b
WHERE a.name='Alice' and b.name='Daniel' and all(x in nodes(p)
WHERE x.age &gt; 30)
RETURN p</pre></div>
<div class="paragraph"><p>All nodes in the returned paths will have an <span class="monospaced">age</span> property of at least 30.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{age:38,name:"Alice",eyes:"brown"},:KNOWS[1] {},Node[5]{age:53,name:"Charlie",eyes:"green"},:KNOWS[3] {},Node[1]{age:54,name:"Daniel",eyes:"brown"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=a-[*1..3]-&gt;b where a.name='Alice' and b.name='Daniel' and all(x in nodes(p) WHERE x.age &gt; 30) return p</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-any">ANY</h4>
<div class="paragraph"><p>Tests whether a predicate holds for at least one element in the collection.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">ANY(identifier in collection WHERE predicate)</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
<li>
<p>
<em>identifier:</em> This is the identifier that can be used from the predicate.
</p>
</li>
<li>
<p>
<em>predicate:</em> A predicate that is tested against all items in the collection.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='Eskil' and any(x in a.array
WHERE x = "one")
RETURN a</pre></div>
<div class="paragraph"><p>All nodes in the returned paths has at least one <span class="monospaced">one</span> value set in the array property named <span class="monospaced">array</span>.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{age:41,name:"Eskil",array:["one","two","three"],eyes:"blue"}</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a where a.name='Eskil' and any(x in a.array WHERE x = "one") return a</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-none">NONE</h4>
<div class="paragraph"><p>Returns true if the predicate holds for no element in the collection.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">NONE(identifier in collection WHERE predicate)</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
<li>
<p>
<em>identifier:</em> This is the identifier that can be used from the predicate.
</p>
</li>
<li>
<p>
<em>predicate:</em> A predicate that is tested against all items in the collection.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=n-[*1..3]-&gt;b
WHERE n.name='Alice' and NONE(x in nodes(p)
WHERE x.age = 25)
RETURN p</pre></div>
<div class="paragraph"><p>No nodes in the returned paths has a <span class="monospaced">age</span> property set to <span class="monospaced">25</span>.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{age:38,name:"Alice",eyes:"brown"},:KNOWS[1] {},Node[5]{age:53,name:"Charlie",eyes:"green"}]</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{age:38,name:"Alice",eyes:"brown"},:KNOWS[1] {},Node[5]{age:53,name:"Charlie",eyes:"green"},:KNOWS[3] {},Node[1]{age:54,name:"Daniel",eyes:"brown"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=n-[*1..3]-&gt;b where n.name='Alice' and NONE(x in nodes(p) WHERE x.age = 25) return p</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-single">SINGLE</h4>
<div class="paragraph"><p>Returns true if the predicate holds for exactly one of the elements in the collection.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">SINGLE(identifier in collection WHERE predicate)</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
<li>
<p>
<em>identifier:</em> This is the identifier that can be used from the predicate.
</p>
</li>
<li>
<p>
<em>predicate:</em> A predicate that is tested against all items in the collection.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=n--&gt;b
WHERE n.name='Alice' and SINGLE(var in nodes(p)
WHERE var.eyes = "blue")
RETURN p</pre></div>
<div class="paragraph"><p>Exactly one node in every returned path will have the <span class="monospaced">eyes</span> property set to <span class="monospaced">"blue"</span>.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">p</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{age:38,name:"Alice",eyes:"brown"},:KNOWS[0] {},Node[4]{age:25,name:"Bob",eyes:"blue"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=n--&gt;b where n.name='Alice' and SINGLE(var in nodes(p) WHERE var.eyes = "blue") return p</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-functions-scalar">Scalar functions</h3>
<div class="paragraph"><p>Scalar functions return a single value.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-functions-graph.svg" alt="cypher-functions-graph.svg">
</div>
<div class="title">Figure 46. Graph</div>
</div>
<div class="sect3">
<h4 id="functions-length">LENGTH</h4>
<div class="paragraph"><p>To return or filter on the length of a collection, use the <span class="monospaced">LENGTH()</span> function.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">LENGTH( collection )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=a--&gt;b--&gt;c
WHERE a.name='Alice'
RETURN length(p)</pre></div>
<div class="paragraph"><p>The length of the path <span class="monospaced">p</span> is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">length(p)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=a--&gt;b--&gt;c where a.name='Alice' return length(p)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-type">TYPE</h4>
<div class="paragraph"><p>Returns a string representation of the relationship type.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">TYPE( relationship )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>relationship:</em> A relationship.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH (n)-[r]-&gt;()
WHERE n.name='Alice'
RETURN type(r)</pre></div>
<div class="paragraph"><p>The relationship type of <span class="monospaced">r</span> is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">type(r)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"KNOWS"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"KNOWS"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match (n)-[r]-&gt;() where n.name='Alice' return type(r)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-id">ID</h4>
<div class="paragraph"><p>Returns the id of the relationship or node.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">ID( property-container )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>property-container:</em> A node or a relationship.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
RETURN ID(a)</pre></div>
<div class="paragraph"><p>This returns the node id for three nodes.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">ID(a)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">5 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">4</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">5</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a return ID(a)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-coalesce">COALESCE</h4>
<div class="paragraph"><p>Returns the first non-<span class="monospaced">null</span> value in the list of expressions passed to it.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">COALESCE( expression [, expression]* )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> The expression that might return null.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='Alice'
RETURN coalesce(a.hairColour?, a.eyes?)</pre></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">coalesce(a.hairColour?, a.eyes?)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"brown"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a where a.name='Alice' return coalesce(a.hairColour?, a.eyes?)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-head">HEAD</h4>
<div class="paragraph"><p><span class="monospaced">HEAD</span> returns the first element in a collection.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">HEAD( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> This expression should return a collection of some kind.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='Eskil'
RETURN a.array, head(a.array)</pre></div>
<div class="paragraph"><p>The first node in the path is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a.array</td><td align="left" valign="top">head(a.array)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">["one","two","three"]</code></p></td><td align="left" valign="top"><p><code class="literal">"one"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a where a.name='Eskil' return a.array, head(a.array)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-last">LAST</h4>
<div class="paragraph"><p><span class="monospaced">LAST</span> returns the last element in a collection.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">LAST( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> This expression should return a collection of some kind.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='Eskil'
RETURN a.array, last(a.array)</pre></div>
<div class="paragraph"><p>The last node in the path is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a.array</td><td align="left" valign="top">last(a.array)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">["one","two","three"]</code></p></td><td align="left" valign="top"><p><code class="literal">"three"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a where a.name='Eskil' return a.array, last(a.array)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-timestamp">TIMESTAMP</h4>
<div class="paragraph"><p><span class="monospaced">TIMESTAMP</span> returns the difference, measured in milliseconds, between the current time and midnight, January 1, 1970 UTC. It will return the same value during the whole one query, even if the query is a long running one.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">TIMESTAMP()</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">START n=node(1)
RETURN timestamp()</pre></div>
<div class="paragraph"><p>The time in milliseconds.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">timestamp()</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">1366718097182</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 start n=node(1) return timestamp()</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-functions-collection">Collection functions</h3>
<div class="paragraph"><p>Collection functions return collections of things&#8201;&#8212;&#8201;nodes in a path, and so on.</p></div>
<div class="paragraph"><p>See also <a href="#query-operators-collection">[query-operators-collection]</a>.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-functions-graph.svg" alt="cypher-functions-graph.svg">
</div>
<div class="title">Figure 47. Graph</div>
</div>
<div class="sect3">
<h4 id="functions-nodes">NODES</h4>
<div class="paragraph"><p>Returns all nodes in a path.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">NODES( path )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>path:</em> A path.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=a--&gt;b--&gt;c
WHERE a.name='Alice' and c.name='Eskil'
RETURN NODES(p)</pre></div>
<div class="paragraph"><p>All the nodes in the path <span class="monospaced">p</span> are returned by the example query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">NODES(p)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[Node[3]{age:38,name:"Alice",eyes:"brown"},Node[4]{age:25,name:"Bob",eyes:"blue"},Node[2]{age:41,name:"Eskil",array:["one","two","three"],eyes:"blue"}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=a--&gt;b--&gt;c where a.name='Alice' and c.name='Eskil' return NODES(p)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-relationships">RELATIONSHIPS</h4>
<div class="paragraph"><p>Returns all relationships in a path.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">RELATIONSHIPS( path )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>path:</em> A path.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=a--&gt;b--&gt;c
WHERE a.name='Alice' and c.name='Eskil'
RETURN RELATIONSHIPS(p)</pre></div>
<div class="paragraph"><p>All the relationships in the path <span class="monospaced">p</span> are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">RELATIONSHIPS(p)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[:KNOWS[0] {},:MARRIED[4] {}]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=a--&gt;b--&gt;c where a.name='Alice' and c.name='Eskil' return RELATIONSHIPS(p)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-labels">LABELS</h4>
<div class="paragraph"><p>Returns a collection of string representations for the labels attached to a node.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">LABELS( node )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>node:</em> Any expression that returns a single node
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='Alice'
RETURN labels(a)</pre></div>
<div class="paragraph"><p>The labels of <span class="monospaced">n</span> is returned by the query.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">labels(a)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">["foo","bar"]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a where a.name='Alice' return labels(a)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-extract">EXTRACT</h4>
<div class="paragraph"><p>To return a single property, or the value of a function from a collection of nodes or relationships,
 you can use <span class="monospaced">EXTRACT</span>. It will go through a collection, run an expression on every element, and return the results
 in an collection with these values. It works like the <span class="monospaced">map</span> method in functional languages such as Lisp and Scala.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">EXTRACT( identifier in collection : expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
<li>
<p>
<em>identifier:</em> The closure will have an identifier introduced in it&#8217;s context. Here you decide which identifier to use.
</p>
</li>
<li>
<p>
<em>expression:</em> This expression will run once per value in the collection, and produces the result collection.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=a--&gt;b--&gt;c
WHERE a.name='Alice' and b.name='Bob' and c.name='Daniel'
RETURN extract(n in nodes(p) : n.age)</pre></div>
<div class="paragraph"><p>The age property of all nodes in the path are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">extract(n in nodes(p) : n.age)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[38,25,54]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=a--&gt;b--&gt;c where a.name='Alice' and b.name='Bob' and c.name='Daniel' return extract(n in nodes(p) : n.age)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-filter">FILTER</h4>
<div class="paragraph"><p><span class="monospaced">FILTER</span> returns all the elements in a collection that comply to a predicate.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">FILTER(identifier in collection : predicate)</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
<li>
<p>
<em>identifier:</em> This is the identifier that can be used from the predicate.
</p>
</li>
<li>
<p>
<em>predicate:</em> A predicate that is tested against all items in the collection.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='Eskil'
RETURN a.array, filter(x in a.array : length(x) = 3)</pre></div>
<div class="paragraph"><p>This returns the property named <span class="monospaced">array</span> and a list of values in it, which have the length <span class="monospaced">3</span>.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a.array</td><td align="left" valign="top">filter(x in a.array : length(x) = 3)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">["one","two","three"]</code></p></td><td align="left" valign="top"><p><code class="literal">["one","two"]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a where a.name='Eskil' return a.array, filter(x in a.array : length(x) = 3)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-tail">TAIL</h4>
<div class="paragraph"><p><span class="monospaced">TAIL</span> returns all but the first element in a collection.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">TAIL( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> This expression should return a collection of some kind.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
WHERE a.name='Eskil'
RETURN a.array, tail(a.array)</pre></div>
<div class="paragraph"><p>This returns the property named <span class="monospaced">array</span> and all elements of that property except the first one.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a.array</td><td align="left" valign="top">tail(a.array)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">["one","two","three"]</code></p></td><td align="left" valign="top"><p><code class="literal">["two","three"]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a where a.name='Eskil' return a.array, tail(a.array)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-range">RANGE</h4>
<div class="paragraph"><p>Returns numerical values in a range with a non-zero step value step. Range is inclusive in both ends.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">RANGE( start, end [, step] )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>start:</em> A numerical expression.
</p>
</li>
<li>
<p>
<em>end:</em> A numerical expression.
</p>
</li>
<li>
<p>
<em>step:</em> A numerical expression.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN range(0,10), range(2,18,3)
LIMIT 1</pre></div>
<div class="paragraph"><p>Two lists of numbers are returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">range(0,10)</td><td align="left" valign="top">range(2,18,3)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">[0,1,2,3,4,5,6,7,8,9,10]</code></p></td><td align="left" valign="top"><p><code class="literal">[2,5,8,11,14,17]</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return range(0,10), range(2,18,3) limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-reduce">REDUCE</h4>
<div class="paragraph"><p>To run an expression against individual elements of a collection, and store the result of the expression in
 an accumulator, you can use <span class="monospaced">REDUCE</span>. It will go through a collection, run an expression on every element, storing the partial result
 in the accumulator. It works like the <span class="monospaced">fold</span> or <span class="monospaced">reduce</span> method in functional languages such as Lisp and Scala.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">REDUCE( accumulator = initial,  identifier in collection : expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>accumulator:</em> An identifier that will hold the result and the partial results as the collection is iterated
</p>
</li>
<li>
<p>
<em>initial:</em> An expression that runs once to give a starting value to the accumulator
</p>
</li>
<li>
<p>
<em>collection:</em> An expression that returns a collection
</p>
</li>
<li>
<p>
<em>identifier:</em> The closure will have an identifier introduced in it&#8217;s context. Here you decide which identifier to use.
</p>
</li>
<li>
<p>
<em>expression:</em> This expression will run once per value in the collection, and produces the result value.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH p=a--&gt;b--&gt;c
WHERE a.name='Alice' and b.name='Bob' and c.name='Daniel'
RETURN reduce(totalAge = 0, n in nodes(p) : totalAge + n.age)</pre></div>
<div class="paragraph"><p>The age property of all nodes in the path are summed and returned as a single value.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">reduce(totalAge = 0, n in nodes(p) : totalAge + n.age)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">117</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match p=a--&gt;b--&gt;c where a.name='Alice' and b.name='Bob' and c.name='Daniel' return reduce(totalAge = 0, n in nodes(p) : totalAge + n.age)</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-functions-mathematical">Mathematical functions</h3>
<div class="paragraph"><p>These functions all operate on numerical expressions only, and will return an error if used on any other values.</p></div>
<div class="paragraph"><p>See also <a href="#query-operators-mathematical">[query-operators-mathematical]</a>.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-functions-graph.svg" alt="cypher-functions-graph.svg">
</div>
<div class="title">Figure 48. Graph</div>
</div>
<div class="sect3">
<h4 id="functions-abs">ABS</h4>
<div class="paragraph"><p><span class="monospaced">ABS</span> returns the absolute value of a number.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">ABS( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> A numeric expression.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a, e
WHERE a.name = 'Alice' and e.name = 'Eskil'
RETURN a.age, e.age, abs(a.age - e.age)</pre></div>
<div class="paragraph"><p>The absolute value of the age difference is returned.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">a.age</td><td align="left" valign="top">e.age</td><td align="left" valign="top">abs(a.age - e.age)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="3">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">38</code></p></td><td align="left" valign="top"><p><code class="literal">41</code></p></td><td align="left" valign="top"><p><code class="literal">3.0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a, e where a.name = 'Alice' and e.name = 'Eskil' return a.age, e.age, abs(a.age - e.age)</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-round">ROUND</h4>
<div class="paragraph"><p><span class="monospaced">ROUND</span> returns the numerical expression, rounded to the nearest integer.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">ROUND( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> A numerical expression.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
RETURN round(3.141592)
LIMIT 1</pre></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">round(3.141592)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a return round(3.141592) limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-sqrt">SQRT</h4>
<div class="paragraph"><p><span class="monospaced">SQRT</span> returns the square root of a number.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">SQRT( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> A numerical expression
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN sqrt(256)
LIMIT 1</pre></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">sqrt(256)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">16.0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return sqrt(256) limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-sign">SIGN</h4>
<div class="paragraph"><p><span class="monospaced">SIGN</span> returns the signum of a number&#8201;&#8212;&#8201;zero if the expression is zero, <span class="monospaced">-1</span> for any negative number, and <span class="monospaced">1</span> for any positive number.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">SIGN( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> A numerical expression
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN sign(-17), sign(0.1)
LIMIT 1</pre></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">sign(-17)</td><td align="left" valign="top">sign(0.1)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">-1.0</code></p></td><td align="left" valign="top"><p><code class="literal">1.0</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return sign(-17), sign(0.1) limit 1</strong></span></p>
</div>
</div>
<div class="sect2">
<h3 id="query-functions-string">String functions</h3>
<div class="paragraph"><p>These functions all operate on string expressions only, and will return an error if used on any other values.
Except <span class="monospaced">STR()</span>, which converts to strings.</p></div>
<div class="paragraph"><p>See also <a href="#query-operators-string">[query-operators-string]</a>.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/cypher-functions-graph.svg" alt="cypher-functions-graph.svg">
</div>
<div class="title">Figure 49. Graph</div>
</div>
<div class="sect3">
<h4 id="functions-str">STR</h4>
<div class="paragraph"><p><span class="monospaced">STR</span> returns a string representation of the expression.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">STR( expression )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>expression:</em> An expression that returns anything
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
RETURN str(1)
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">str(1)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"1"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a return str(1) limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-replace">REPLACE</h4>
<div class="paragraph"><p><span class="monospaced">REPLACE</span> returns a string with the search string replaced by the replace string. It replaces all occurrences.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">REPLACE( original, search, replace )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
<li>
<p>
<em>search:</em> An expression that returns a string to search for
</p>
</li>
<li>
<p>
<em>replace:</em> An expression that returns the string to replace the search string with
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
RETURN replace("hello", "l", "w")
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">replace("hello", "l", "w")</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"hewwo"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a return replace("hello", "l", "w") limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-substring">SUBSTRING</h4>
<div class="paragraph"><p><span class="monospaced">SUBSTRING</span> returns a substring of the original, with a 0-based index start and length. If length is omitted, it returns a substring from start until the end of the string.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">SUBSTRING( original, start [, length] )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
<li>
<p>
<em>start:</em> An expression that returns a positive number
</p>
</li>
<li>
<p>
<em>length:</em> An expression that returns a positive number
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN substring("hello", 1, 3), substring("hello", 2)
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">substring("hello", 1, 3)</td><td align="left" valign="top">substring("hello", 2)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"ell"</code></p></td><td align="left" valign="top"><p><code class="literal">"llo"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return substring("hello", 1, 3), substring("hello", 2) limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-left">LEFT</h4>
<div class="paragraph"><p><span class="monospaced">LEFT</span> returns a string containing the left n characters of the original string.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">LEFT( original, length )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
<li>
<p>
<em>n:</em> An expression that returns a positive number
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN left("hello", 3)
LIMIT 1</pre></div>
<div class="paragraph"><p>A String.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">left("hello", 3)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"hel"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return left("hello", 3) limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-right">RIGHT</h4>
<div class="paragraph"><p><span class="monospaced">RIGHT</span> returns a string containing the right n characters of the original string.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">RIGHT( original, length )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
<li>
<p>
<em>n:</em> An expression that returns a positive number
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN right("hello", 3)
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">right("hello", 3)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"llo"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return right("hello", 3) limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-ltrim">LTRIM</h4>
<div class="paragraph"><p><span class="monospaced">LTRIM</span> returns the original string with whitespace removed from the left side.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">LTRIM( original )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN ltrim("   hello")
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">ltrim("   hello")</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"hello"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return ltrim("   hello") limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-rtrim">RTRIM</h4>
<div class="paragraph"><p><span class="monospaced">RTRIM</span> returns the original string with whitespace removed from the right side.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">RTRIM( original )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN rtrim("hello   ")
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">rtrim("hello   ")</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"hello"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return rtrim("hello   ") limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-trim">TRIM</h4>
<div class="paragraph"><p><span class="monospaced">TRIM</span> returns the original string with whitespace removed from both sides.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">TRIM( original )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN trim("   hello   ")
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">trim("   hello   ")</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"hello"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return trim("   hello   ") limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-lower">LOWER</h4>
<div class="paragraph"><p><span class="monospaced">LOWER</span> returns the original string in lowercase.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">LOWER( original )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN lower("HELLO")
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">lower("HELLO")</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"hello"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return lower("HELLO") limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-upper">UPPER</h4>
<div class="paragraph"><p><span class="monospaced">UPPER</span> returns the original string in uppercase.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">UPPER( original )</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>original:</em> An expression that returns a string
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH a
RETURN upper("hello")
LIMIT 1</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">upper("hello")</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"HELLO"</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match a return upper("hello") limit 1</strong></span></p>
</div>
<div class="sect3">
<h4 id="_case_expressions">Case Expressions</h4>
<div class="paragraph"><p>Cypher supports CASE expressions, which is a generic conditional expression, similar to if/else statements in other
languages. Two variants of <span class="monospaced">CASE</span> exist - the simple form and the generic form.</p></div>
</div>
<div class="sect3">
<h4 id="functions-simple-case">Simple CASE</h4>
<div class="paragraph"><p>The expression is calculated, and compared in order with the <span class="monospaced">WHEN</span> clauses until a match is found. If no match is found
the expression in the <span class="monospaced">ELSE</span> clause is used, or null, if no <span class="monospaced">ELSE</span> case exists.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">+CASE+ in
    +WHEN+ value +THEN+ result
    [+WHEN+ ...]
    [+ELSE+ default]
+END+</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>in:</em> A valid expression
</p>
</li>
<li>
<p>
<em>value:</em> An expression whose result will be compared to expression
</p>
</li>
<li>
<p>
<em>result:</em> This is the result expression used if the value expression matches the in expression
</p>
</li>
<li>
<p>
<em>default:</em> The expression to use if no match is found.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN CASE n.eyes
WHEN 'blue'  THEN 1
WHEN 'brown' THEN 2
ELSE 3
END as result</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">result</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">5 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return CASE n.eyes
     WHEN 'blue'  THEN 1
     WHEN 'brown' THEN 2
                  ELSE 3
 END as result</strong></span></p>
</div>
<div class="sect3">
<h4 id="functions-generic-case">Generic CASE</h4>
<div class="paragraph"><p>The predicates are evaluated in order until a true value is found, and the result value is used.If no match is found the expression in the +ELSE + clause is used, or null, if no + ELSE + case exists.</p></div>
<div class="paragraph"><p><strong>Syntax:</strong> <span class="monospaced">+CASE+
     +WHEN+ predicate +THEN+ result
     [+WHEN+ ...]
     [+ELSE+ result]
+END+</span></p></div>
<div class="paragraph"><p><strong>Arguments:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
<em>predicate:</em> A predicate that is tested to find a valid alternative
</p>
</li>
<li>
<p>
<em>result:</em> This is the result expression used if the predicate matches
</p>
</li>
<li>
<p>
<em>default:</em> The expression to use if no match is found.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">MATCH n
RETURN CASE
WHEN n.eyes = 'blue'  THEN 1
WHEN n.age &lt; 40       THEN 2
ELSE 3
END as result</pre></div>
<div class="paragraph"><p>A string.</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">result</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">5 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">3</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`age`:54, `eyes`:"brown", `name`:"Daniel"})
create (_2:`Spouse` {`age`:41, `array`:["one", "two", "three"], `eyes`:"blue", `name`:"Eskil"})
create (_3:`foo`:`bar` {`age`:38, `eyes`:"brown", `name`:"Alice"})
create (_4 {`age`:25, `eyes`:"blue", `name`:"Bob"})
create (_5 {`age`:53, `eyes`:"green", `name`:"Charlie"})
create _3-[:`KNOWS`]-&gt;_4
create _3-[:`KNOWS`]-&gt;_5
create _4-[:`KNOWS`]-&gt;_1
create _4-[:`MARRIED`]-&gt;_2
create _5-[:`KNOWS`]-&gt;_1
</span><span class="command"><strong>
 match n return CASE
     WHEN n.eyes = 'blue'  THEN 1
     WHEN n.age &lt; 40       THEN 2
                           ELSE 3
 END as result</strong></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cypher-schema">Schema and Indexing</h2>
<div class="sectionbody">
<div class="paragraph"><p>Neo4j 2.0 introduced an optional schema for the graph, based around the concept of <span class="monospaced">LABELS</span>.
Cypher allows you to manipulate that schema using the Cypher data definition language (DDL).</p></div>
<div class="paragraph"><p>The currently supported operations are:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<a href="#query-schema-index">Schema based indexes</a>
</p>
</li>
</ol></div>
<div class="sect2">
<h3 id="query-schema-index">Indexes</h3>
<div class="paragraph"><p>Cypher allows the creation of indexes over a property for all nodes that have a given label.
These indexes are automatically managed and kept up to date by the database whenever the graph is changed.</p></div>
<div class="sect3">
<h4 id="schema-index-create-index-on-a-label">Create index on a label</h4>
<div class="paragraph"><p>To create an index on a property for all nodes that have a label, use <span class="monospaced">CREATE</span> <span class="monospaced">INDEX</span> <span class="monospaced">ON</span>. Note that the index is not immediately available, but will be created in the background. See the <a href="#graphdb-neo4j-schema-indexes">indexes</a> section for details.</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">CREATE INDEX ON :Person(name)</pre></div>
<div class="paragraph"><p>Nothing</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 create index on :Person(name)</strong></span></p>
</div>
<div class="sect3">
<h4 id="schema-index-drop-index-on-a-label">Drop index on a label</h4>
<div class="paragraph"><p>To drop an index on all nodes that have a label, use the <span class="monospaced">DROP</span> <span class="monospaced">INDEX</span> clause</p></div>
<div class="listingblock">
<div class="title">Query</div>
<pre class="programlisting brush: cypher">DROP INDEX ON :Person(name)</pre></div>
<div class="paragraph"><p>Nothing</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><tbody><tr><td class="emptyresult" align="left" valign="top" colspan="1"><p><code class="literal">(empty result)</code></p></td></tr></tbody></table></div></div>
 <p class="cypherconsole"><b>Try this query live</b><span class="database">create (_1 {`name`:"A"})
create (_2 {`name`:"root"})
create (_3 {`name`:"B"})
create (_4 {`name`:"C"})
create _1-[:`KNOWS`]-&gt;_4
create _2-[:`X`]-&gt;_1
create _2-[:`X`]-&gt;_3
create _2-[:`X`]-&gt;_4
</span><span class="command"><strong>
 drop index on :Person(name)</strong></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cypher-execution-plans">Execution Plans</h2>
<div class="sectionbody">
<div class="paragraph"><p>Cypher is a declarative language.
To achieve this a query goes through a couple of different phases.
The final product is an execution plan, which is what steps the execution engine will follow to fulfill the query.</p></div>
<div class="paragraph"><p>The first phase is parsing, which turns the query into an object representation of the query.
Next Cypher will build an execution plan.
Parsing and execution plan building are time costly operations.
To save on this work, Cypher will cache all plans it builds.
It does this by creating a cache map with the string query as key and the execution plan as value.
To make full use of this cache, it&#8217;s imperative that users <em>use the same query string every time</em>.
Parameters help make queries easier to re-use for Cypher.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">When Cypher is building execution plans, it looks at the schema to see if it can find useful indexes.
These index decisions are only valid until the schema changes, so adding or removing indexes leads to the execution plan cache to be flushed.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples-from-sql-to-cypher">From SQL to Cypher</h2>
<div class="sectionbody">
<div class="paragraph"><p>This guide is for people who understand SQL. You can use that prior
knowledge to quickly get going with Cypher and start exploring Neo4j.</p></div>
<div class="sect2">
<h3 id="query-sql-start">Start</h3>
<div class="paragraph"><p>SQL starts with the result you want&#8201;&#8212;&#8201;we <span class="monospaced">SELECT</span> what we want and then
declare how to source it. In Cypher, the <span class="monospaced">START</span> clause is quite a
different concept which specifies starting points in the graph from which
the query will execute.</p></div>
<div class="paragraph"><p>From a SQL point of view, the identifiers in <span class="monospaced">START</span> are like table names
that point to a set of nodes or relationships. The set can be listed
literally, come via parameters, or as I show in the following example, be
defined by an index look-up.</p></div>
<div class="paragraph"><p>So in fact rather than being <span class="monospaced">SELECT</span>-like, the <span class="monospaced">START</span> clause is
somewhere between the <span class="monospaced">FROM</span> and the <span class="monospaced">WHERE</span> clause in SQL.</p></div>
<div class="listingblock">
<div class="title">SQL Query</div>
<pre class="programlisting brush: sql">SELECT *
FROM "Person"
WHERE name = 'Anakin'</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">NAME</td><td align="left" valign="top">ID</td><td align="left" valign="top">AGE</td><td align="left" valign="top">HAIR</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="4">1 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Anakin</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td><td align="left" valign="top"><p><code class="literal">20</code></p></td><td align="left" valign="top"><p><code class="literal">blonde</code></p></td></tr></tbody></table></div></div>
<div class="listingblock">
<div class="title">Cypher Query</div>
<pre class="programlisting brush: cypher">START person=node:Person(name = 'Anakin')
RETURN person</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[1]{id:1,age:20,name:"Anakin",hair:"blonde"}</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>Cypher allows multiple starting points. This should not be strange from a SQL perspective&#8201;&#8212;&#8201;every table in the <span class="monospaced">FROM</span> clause is another starting point.</p></div>
</div>
<div class="sect2">
<h3 id="query-sql-match">Match</h3>
<div class="paragraph"><p>Unlike SQL which operates on sets, Cypher predominantly works on sub-graphs.
The relational equivalent is the current set of tuples being evaluated during a <span class="monospaced">SELECT</span> query.</p></div>
<div class="paragraph"><p>The shape of the sub-graph is specified in the <span class="monospaced">MATCH</span> clause.
The <span class="monospaced">MATCH</span> clause is analogous to the <span class="monospaced">JOIN</span> in SQL. A normal a&#8594;b relationship is an
inner join between nodes a and b&#8201;&#8212;&#8201;both sides have to have at least one match, or nothing is returned.</p></div>
<div class="paragraph"><p>We&#8217;ll start with a simple example, where we find all email addresses that are connected to
the person &#8220;Anakin&#8221;. This is an ordinary one-to-many relationship.</p></div>
<div class="listingblock">
<div class="title">SQL Query</div>
<pre class="programlisting brush: sql">SELECT "Email".*
FROM "Person"
JOIN "Email" ON "Person".id = "Email".person_id
WHERE "Person".name = 'Anakin'</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">ADDRESS</td><td align="left" valign="top">COMMENT</td><td align="left" valign="top">PERSON_ID</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="3">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">anakin@example.com</code></p></td><td align="left" valign="top"><p><code class="literal">home</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">anakin@example.org</code></p></td><td align="left" valign="top"><p><code class="literal">work</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
<div class="listingblock">
<div class="title">Cypher Query</div>
<pre class="programlisting brush: cypher">START person=node:Person(name = 'Anakin')
MATCH person-[:email]-&gt;email
RETURN email</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">email</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[7]{address:"anakin@example.com",comment:"home"}</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Node[8]{address:"anakin@example.org",comment:"work"}</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>There is no join table here, but if one is necessary the next example will show how to do that, writing the pattern relationship like so:
<span class="monospaced">-[r:belongs_to]-&gt;</span> will introduce (the equivalent of) join table available as the variable <span class="monospaced">r</span>.
In reality this is a named relationship in Cypher, so we&#8217;re saying &#8220;join <span class="monospaced">Person</span> to <span class="monospaced">Group</span> via <span class="monospaced">belongs_to</span>.&#8221;
To illustrate this, consider this image, comparing the SQL model and Neo4j/Cypher.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/RDBMSvsGraph.svg.png" alt="RDBMSvsGraph.svg.png">
</div>
</div>
<div class="paragraph"><p>And here are example queries:</p></div>
<div class="listingblock">
<div class="title">SQL Query</div>
<pre class="programlisting brush: sql">SELECT "Group".*, "Person_Group".*
FROM "Person"
JOIN "Person_Group" ON "Person".id = "Person_Group".person_id
JOIN "Group" ON "Person_Group".Group_id="Group".id
WHERE "Person".name = 'Bridget'</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">NAME</td><td align="left" valign="top">ID</td><td align="left" valign="top">BELONGS_TO_GROUP_ID</td><td align="left" valign="top">PERSON_ID</td><td align="left" valign="top">GROUP_ID</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="5">1 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Admin</code></p></td><td align="left" valign="top"><p><code class="literal">4</code></p></td><td align="left" valign="top"><p><code class="literal">3</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td><td align="left" valign="top"><p><code class="literal">4</code></p></td></tr></tbody></table></div></div>
<div class="listingblock">
<div class="title">Cypher Query</div>
<pre class="programlisting brush: cypher">START person=node:Person(name = 'Bridget')
MATCH person-[r:belongs_to]-&gt;group
RETURN group, r</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">group</td><td align="left" valign="top">r</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[6]{id:4,name:"Admin"}</code></p></td><td align="left" valign="top"><p><code class="literal">:belongs_to[0] {}</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>An <a href="http://www.codinghorror.com/blog/2007/10/a-visual-explanation-of-sql-joins.html">outer join</a> is just as easy.
Add a question mark <span class="monospaced">-[?:KNOWS]-&gt;</span> and it&#8217;s an optional relationship between nodes&#8201;&#8212;&#8201;the outer join of Cypher.</p></div>
<div class="paragraph"><p>Whether it&#8217;s a left outer join, or a right outer join is defined by which side of the pattern has a starting point.
This example is a left outer join, because the bound node is on the left side:</p></div>
<div class="listingblock">
<div class="title">SQL Query</div>
<pre class="programlisting brush: sql">SELECT "Person".name, "Email".address
FROM "Person" LEFT
JOIN "Email" ON "Person".id = "Email".person_id</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">NAME</td><td align="left" valign="top">ADDRESS</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Anakin</code></p></td><td align="left" valign="top"><p><code class="literal">anakin@example.com</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Anakin</code></p></td><td align="left" valign="top"><p><code class="literal">anakin@example.org</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Bridget</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div></div>
<div class="listingblock">
<div class="title">Cypher Query</div>
<pre class="programlisting brush: cypher">START person=node:Person('name: *')
MATCH person-[?:email]-&gt;email
RETURN person.name, email.address?</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person.name</td><td align="left" valign="top">email.address?</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Anakin"</code></p></td><td align="left" valign="top"><p><code class="literal">"anakin@example.com"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Anakin"</code></p></td><td align="left" valign="top"><p><code class="literal">"anakin@example.org"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Bridget"</code></p></td><td align="left" valign="top"><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>Relationships in Neo4j are first class citizens&#8201;&#8212;&#8201;it&#8217;s like the SQL tables are pre-joined with each other.
So, naturally, Cypher is designed to be able to handle highly connected data easily.</p></div>
<div class="paragraph"><p>One such domain is tree structures&#8201;&#8212;&#8201;anyone that has tried storing tree structures in SQL knows
that you have to work hard to get around the limitations of the relational model.
There are even books on the subject.</p></div>
<div class="paragraph"><p>To find all the groups and sub-groups that Bridget belongs to, this query is enough in Cypher:</p></div>
<div class="listingblock">
<div class="title">Cypher Query</div>
<pre class="programlisting brush: cypher">START person=node:Person('name: Bridget')
MATCH person-[:belongs_to*]-&gt;group
RETURN person.name, group.name</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person.name</td><td align="left" valign="top">group.name</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Bridget"</code></p></td><td align="left" valign="top"><p><code class="literal">"Admin"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Bridget"</code></p></td><td align="left" valign="top"><p><code class="literal">"Technichian"</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Bridget"</code></p></td><td align="left" valign="top"><p><code class="literal">"User"</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>The * after the relationship type means that there can be multiple hops across <span class="monospaced">belongs_to</span> relationships between group and user.
Some SQL dialects have recursive abilities, that allow the expression of queries like this, but you may have a hard time wrapping your head around those.
Expressing something like this in SQL is hugely impractical if not practically impossible.</p></div>
</div>
<div class="sect2">
<h3 id="query-sql-where">Where</h3>
<div class="paragraph"><p>This is the easiest thing to understand&#8201;&#8212;&#8201;it&#8217;s the same animal in both languages.
It filters out result sets/subgraphs.
Not all predicates have an equivalent in the other language, but the concept is the same.</p></div>
<div class="listingblock">
<div class="title">SQL Query</div>
<pre class="programlisting brush: sql">SELECT *
FROM "Person"
WHERE "Person".age &gt; 35 AND "Person".hair = 'blonde'</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">NAME</td><td align="left" valign="top">ID</td><td align="left" valign="top">AGE</td><td align="left" valign="top">HAIR</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="4">1 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Bridget</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td><td align="left" valign="top"><p><code class="literal">40</code></p></td><td align="left" valign="top"><p><code class="literal">blonde</code></p></td></tr></tbody></table></div></div>
<div class="listingblock">
<div class="title">Cypher Query</div>
<pre class="programlisting brush: cypher">START person=node:Person('name: *')
WHERE person.age &gt; 35 AND person.hair = 'blonde'
RETURN person</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="1">1 row</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Node[2]{id:2,age:40,name:"Bridget",hair:"blonde"}</code></p></td></tr></tbody></table></div></div>
</div>
<div class="sect2">
<h3 id="query-sql-return">Return</h3>
<div class="paragraph"><p>This is SQL&#8217;s <span class="monospaced">SELECT</span>.
We just put it in the end because it felt better to have it there&#8201;&#8212;&#8201;you do a lot of matching and filtering, and finally, you return something.</p></div>
<div class="paragraph"><p>Aggregate queries work just like they do in SQL, apart from the fact that there is no explicit <span class="monospaced">GROUP BY</span> clause.
Everything in the return clause that is not an aggregate function will be used as the grouping columns.</p></div>
<div class="listingblock">
<div class="title">SQL Query</div>
<pre class="programlisting brush: sql">SELECT "Person".name, count(*)
FROM "Person"
GROUP BY "Person".name
ORDER BY "Person".name</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">NAME</td><td align="left" valign="top">C2</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Anakin</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Bridget</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
<div class="listingblock">
<div class="title">Cypher Query</div>
<pre class="programlisting brush: cypher">START person=node:Person('name: *')
RETURN person.name, count(*)
ORDER BY person.name</pre></div>
<div class="openblock">
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">person.name</td><td align="left" valign="top">count(*)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">2 rows</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">"Anakin"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">"Bridget"</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
<div class="paragraph"><p>Order by is the same in both languages&#8201;&#8212;&#8201;<span class="monospaced">ORDER BY</span> expression <span class="monospaced">ASC</span>/<span class="monospaced">DESC</span>.
Nothing weird here.</p></div>
</div>
</div>
</div>
<h1 id="reference-documentation">Reference</h1>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>The reference part is the authoritative source for details on Neo4j usage.
It covers details on capabilities, transactions, indexing and queries among other topics.</p></div>
</div></div>
<div class="sect1">
<h2 id="capabilities">Capabilities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="capabilities-data-security">Data Security</h3>
<div class="paragraph"><p>Some data may need to be protected from unauthorized access (e.g., theft, modification).
Neo4j does not deal with data encryption explicitly, but supports all means built into the Java programming language and the JVM to protect data by encrypting it before storing.</p></div>
<div class="paragraph"><p>Furthermore, data can be easily secured by running on an encrypted datastore at the file system level.
Finally, data protection should be considered in the upper layers of the surrounding system in order to prevent problems with scraping, malicious data insertion, and other threats.</p></div>
</div>
<div class="sect2">
<h3 id="capabilities-data-integrity">Data Integrity</h3>
<div class="paragraph"><p>In order to keep data consistent, there needs to be mechanisms and structures that guarantee the integrity of all stored data.
In Neo4j, data integrity is maintained for the core graph engine together with other data sources - see below.</p></div>
<div class="sect3">
<h4 id="capabilities-core-graph-engine">Core Graph Engine</h4>
<div class="paragraph"><p>In Neo4j, the whole data model is stored as a graph on disk and persisted as
part of every committed transaction.
In the storage layer, Relationships, Nodes, and Properties have direct pointers to each other.
This maintains integrity without the need for data duplication between the different backend store files.</p></div>
</div>
<div class="sect3">
<h4 id="capabilities-different-data-sources">Different Data Sources</h4>
<div class="paragraph"><p>In a number of scenarios, the core graph engine is combined with other systems
in order to achieve optimal performance for non-graph lookups.
For example, Apache Lucene is frequently used as an additional index system for text queries that would otherwise be very processing-intensive in the graph layer.</p></div>
<div class="paragraph"><p>To keep these external systems in synchronization with each other, Neo4j provides
full Two Phase Commit transaction management, with rollback support over all data
sources.
Thus, failed index insertions into Lucene can be transparently rolled back in all data sources and thus keep data up-to-date.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="capabilities-data-integration">Data Integration</h3>
<div class="paragraph"><p>Most enterprises rely primarily on relational databases to store their data, but
this may cause performance limitations.
In some of these cases, Neo4j can be used as an extension to supplement search/lookup for faster decision making.
However, in any situation where multiple data repositories contain the same data, synchronization can be an issue.</p></div>
<div class="paragraph"><p>In some applications, it is acceptable for the search platform to be slightly out
of sync with the relational database.
In others, tight data integrity (eg., between Neo4j and RDBMS) is necessary.
Typically, this has to be addressed for data changing in real-time and for bulk data changes happening in the RDBMS.</p></div>
<div class="paragraph"><p>A few strategies for synchronizing integrated data follows.</p></div>
<div class="sect3">
<h4 id="capabilities-event-based-synchronization">Event-based Synchronization</h4>
<div class="paragraph"><p>In this scenario, all data stores, both RDBMS and Neo4j, are fed with domain-specific
events via an event bus.
Thus, the data held in the different backends is not actually synchronized but rather replicated.</p></div>
</div>
<div class="sect3">
<h4 id="capabilities-periodic-synchronization">Periodic Synchronization</h4>
<div class="paragraph"><p>Another viable scenario is the periodic export of the latest changes in the RDBMS to
Neo4j via some form of SQL query.
This allows a small amount of latency in the synchronization, but has the advantage of using the RDBMS as the master for all data purposes.
The same process can be applied with Neo4j as the master data source.</p></div>
</div>
<div class="sect3">
<h4 id="capabilities-full-export">Periodic Full Export/Import of Data</h4>
<div class="paragraph"><p>Using the Batch Inserter tools for Neo4j, even large amounts of data can be imported
into the database in very short times.
Thus, a full export from the RDBMS and import into Neo4j becomes possible.
If the propagation lag between the RDBMS and Neo4j is not a big issue, this is a very viable solution.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="capabilities-availability">Availability and Reliability</h3>
<div class="paragraph"><p>Most mission-critical systems require the database subsystem to be accessible at all
times.
Neo4j ensures availability and reliability through a few different strategies.</p></div>
<div class="sect3">
<h4 id="capabilities-op-availability">Operational Availability</h4>
<div class="paragraph"><p>In order not to create a single point of failure, Neo4j supports different
approaches which provide transparent fallback and/or recovery from failures.</p></div>
<div class="sect4">
<h5 id="_online_backup_cold_spare">Online backup (Cold spare)</h5>
<div class="paragraph"><p>In this approach, a single instance of the master database is used, with Online
Backup enabled.
In case of a failure, the backup files can be mounted onto a new
Neo4j instance and reintegrated into the application.</p></div>
</div>
<div class="sect4">
<h5 id="_online_backup_high_availability_hot_spare">Online Backup High Availability (Hot spare)</h5>
<div class="paragraph"><p>Here, a Neo4j "backup" instance listens to online transfers of changes from the
master.
In the event of a failure of the master, the backup is already running
and can directly take over the load.</p></div>
</div>
<div class="sect4">
<h5 id="_high_availability_cluster">High Availability cluster</h5>
<div class="paragraph"><p>This approach uses a cluster of database instances, with one (read/write) master
and a number of (read-only) slaves.
Failing slaves can simply be restarted and brought back online.
Alternatively, a new slave may be added by cloning an existing one.
Should the master instance fail, a new master will be elected by the remaining
cluster nodes.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="capabilities-disaster">Disaster Recovery/ Resiliency</h4>
<div class="paragraph"><p>In cases of a breakdown of major part of the IT infrastructure, there need to be
mechanisms in place that enable the fast recovery and regrouping of the remaining
services and servers.
In Neo4j, there are different components that are suitable to be part of a disaster recovery strategy.</p></div>
<div class="sect4">
<h5 id="_prevention">Prevention</h5>
<div class="ulist"><ul>
<li>
<p>
Online Backup High Availability to other locations outside the current data center.
</p>
</li>
<li>
<p>
Online Backup to different file system locations: this is a simpler form of backup,
applying changes directly to backup files; it is thus more suited for local backup scenarios.
</p>
</li>
<li>
<p>
Neo4j High Availability cluster: a cluster of one write-master Neo4j server and a number of read-slaves, getting transaction logs from the master.
  Write-master failover is handled by quorum election among the read-slaves for a new master.
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_detection">Detection</h5>
<div class="ulist"><ul>
<li>
<p>
SNMP and JMX monitoring can be used for the Neo4j database.
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_correction">Correction</h5>
<div class="ulist"><ul>
<li>
<p>
Online Backup: A new Neo4j server can be started directly on the backed-up files
and take over new requests.
</p>
</li>
<li>
<p>
Neo4j High Availability cluster: A broken Neo4j read slave can be reinserted into the cluster, getting the latest updates from the master.
  Alternatively, a new server can be inserted by copying an existing server and applying the latest updates to it.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="capabilities-capacity">Capacity</h3>
<div class="sect3">
<h4 id="capabilities-file-sizes">File Sizes</h4>
<div class="paragraph"><p>Neo4j relies on Java&#8217;s Non-blocking I/O subsystem for all file handling.
Furthermore, while the storage file layout is optimized for interconnected data, Neo4j does not require raw devices.
Thus, filesizes are only limited by the underlying operating system&#8217;s capacity to handle large files.
Physically, there is no built-in limit of the file handling capacity in Neo4j.</p></div>
<div class="paragraph"><p>Neo4j tries to memory-map as much of the underlying store files as possible.
If the available RAM is not sufficient to keep all data in RAM, Neo4j will use buffers in some cases, reallocating the memory-mapped high-performance I/O windows to the regions with the most I/O activity dynamically.
Thus, ACID speed degrades gracefully as RAM becomes the limiting factor.</p></div>
</div>
<div class="sect3">
<h4 id="capabilities-read-speed">Read speed</h4>
<div class="paragraph"><p>Enterprises want to optimize the use of hardware to deliver the maximum business value
from available resources.
Neo4j&#8217;s approach to reading data provides the best possible usage of all available hardware resources.
Neo4j does not block or lock any read operations; thus, there is no danger for deadlocks in read operations and no need for read transactions.
With a threaded read access to the database, queries can be run simultaneously on as many processors as may be available.
This provides very good scale-up scenarios with bigger servers.</p></div>
</div>
<div class="sect3">
<h4 id="capabilities-write-speed">Write speed</h4>
<div class="paragraph"><p>Write speed is a consideration for many enterprise applications.
However, there are two different scenarios:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
sustained continuous operation and
</p>
</li>
<li>
<p>
bulk access (e.g., backup, initial or batch loading).
</p>
</li>
</ol></div>
<div class="paragraph"><p>To support the disparate requirements of these scenarios, Neo4j supports two modes of writing to the storage layer.</p></div>
<div class="paragraph"><p>In transactional, ACID-compliant normal operation, isolation level is maintained and
read operations can occur at the same time as the writing process.
At every commit, the data is persisted to disk and can be recovered to a consistent state upon system failures.
This requires disk write access and a real flushing of data.
Thus, the write speed of Neo4j on a single server in continuous mode is limited by the I/O capacity of the hardware.
Consequently, the use of fast SSDs is highly recommended for production scenarios.</p></div>
<div class="paragraph"><p>Neo4j has a Batch Inserter that operates directly on the store files.
This mode does not provide transactional security, so it can only be used when there is a single write thread.
Because data is written sequentially, and never flushed to the logical logs, huge performance boosts are achieved.
The Batch Inserter is optimized for non-transactional bulk import of large amounts of data.</p></div>
</div>
<div class="sect3">
<h4 id="capabilities-data-size">Data size</h4>
<div class="paragraph"><p>In Neo4j, data size is mainly limited by the address space of the primary keys for Nodes, Relationships, Properties and RelationshipTypes.
Currently, the address space is as follows:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">nodes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2<sup>35</sup> (&#8764; 34 billion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">relationships</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2<sup>35</sup> (&#8764; 34 billion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">properties</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2<sup>36</sup> to 2<sup>38</sup> depending on property types (maximum &#8764; 274 billion, always at least &#8764; 68 billion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">relationship types</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2<sup>15</sup> (&#8764; 32 000)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions">Transaction Management</h2>
<div class="sectionbody">
<div class="paragraph"><p>In order to fully maintain data integrity and ensure good transactional behavior, Neo4j supports the ACID properties:</p></div>
<div class="ulist"><ul>
<li>
<p>
atomicity: If any part of a transaction fails, the database state is left unchanged.
</p>
</li>
<li>
<p>
consistency: Any transaction will leave the database in a consistent state.
</p>
</li>
<li>
<p>
isolation: During a transaction, modified data cannot be accessed by other operations.
</p>
</li>
<li>
<p>
durability: The DBMS can always recover the results of a committed transaction.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Specifically:</p></div>
<div class="ulist"><ul>
<li>
<p>
All modifications to Neo4j data must be wrapped in transactions.
</p>
</li>
<li>
<p>
The default isolation level is <span class="monospaced">READ_COMMITTED</span>.
</p>
</li>
<li>
<p>
Data retrieved by traversals is not protected from modification by other transactions.
</p>
</li>
<li>
<p>
Non-repeatable reads may occur (i.e., only write locks are acquired and held until the end of the transaction).
</p>
</li>
<li>
<p>
One can manually acquire write locks on nodes and relationships to achieve higher level of isolation (<span class="monospaced">SERIALIZABLE</span>).
</p>
</li>
<li>
<p>
Locks are acquired at the Node and Relationship level.
</p>
</li>
<li>
<p>
Deadlock detection is built into the core transaction management.
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="transactions-interaction">Interaction cycle</h3>
<div class="paragraph"><p>All write operations that work with the graph must be performed in a transaction.
Transactions are thread confined and can be nested as “flat nested transactions”.
Flat nested transactions means that all nested transactions are added to the scope of the top level transaction.
A nested transaction can mark the top level transaction for rollback, meaning the entire transaction will be rolled back.
To only rollback changes made in a nested transaction is not possible.</p></div>
<div class="paragraph"><p>When working with transactions the interaction cycle looks like this:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Begin a transaction.
</p>
</li>
<li>
<p>
Operate on the graph performing write operations.
</p>
</li>
<li>
<p>
Mark the transaction as successful or not.
</p>
</li>
<li>
<p>
Finish the transaction.
</p>
</li>
</ol></div>
<div class="paragraph"><p><em>It is very important to finish each transaction</em>. The transaction will not release the locks or memory it has acquired until it has been finished.
The idiomatic use of transactions in Neo4j is to use a try-finally block, starting the transaction and then try to perform the write operations.
The last operation in the try block should mark the transaction as successful while the finally block should finish the transaction.
Finishing the transaction will perform commit or rollback depending on the success status.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content"><em>All modifications performed in a transaction are kept in memory.</em>
This means that very large updates have to be split into several top level transactions to avoid running out of memory.
It must be a top level transaction since splitting up the work in many nested transactions will just add all the work to the top level transaction.</td>
</tr></table>
</div>
<div class="paragraph"><p>In an environment that makes use of <em>thread pooling</em> other errors may occur when failing to finish a transaction properly.
Consider a leaked transaction that did not get finished properly.
It will be tied to a thread and when that thread gets scheduled to perform work starting a new (what looks to be a) top level transaction it will actually be a nested transaction.
If the leaked transaction state is “marked for rollback” (which will happen if a deadlock was detected) no more work can be performed on that transaction.
Trying to do so will result in error on each call to a write operation.</p></div>
</div>
<div class="sect2">
<h3 id="transactions-isolation">Isolation levels</h3>
<div class="paragraph"><p>By default a read operation will read the last committed value unless a local modification within the current transaction exist.
The default isolation level is very similar to <span class="monospaced">READ_COMMITTED</span>: reads do not block or take any locks so non-repeatable reads can occur.
It is possible to achieve a stronger isolation level (such as <span class="monospaced">REPETABLE_READ</span> and <span class="monospaced">SERIALIZABLE</span>) by manually acquiring read and write locks.</p></div>
</div>
<div class="sect2">
<h3 id="transactions-locking">Default locking behavior</h3>
<div class="ulist"><ul>
<li>
<p>
When adding, changing or removing a property on a node or relationship a write lock will be taken on the specific node or relationship.
</p>
</li>
<li>
<p>
When creating or deleting a node a write lock will be taken for the specific node.
</p>
</li>
<li>
<p>
When creating or deleting a relationship a write lock will be taken on the specific relationship and both its nodes.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The locks will be added to the transaction and released when the transaction finishes.</p></div>
</div>
<div class="sect2">
<h3 id="transactions-deadlocks">Deadlocks</h3>
<div class="paragraph"><p>Since locks are used it is possible for deadlocks to happen.
Neo4j will however detect any deadlock (caused by acquiring a lock) before they happen and throw an exception.
Before the exception is thrown the transaction is marked for rollback.
All locks acquired by the transaction are still being held but will be released when the transaction is finished (in the finally block as pointed out earlier).
Once the locks are released other transactions that were waiting for locks held by the transaction causing the deadlock can proceed.
The work performed by the transaction causing the deadlock can then be retried by the user if needed.</p></div>
<div class="paragraph"><p>Experiencing frequent deadlocks is an indication of concurrent write requests happening in such a way that it is not possible to execute them while at the same time live up to the intended isolation and consistency.
The solution is to make sure concurrent updates happen in a reasonable way.
For example given two specific nodes (A and B), adding or deleting relationships to both these nodes in random order for each transaction will result in deadlocks when there are two or more transactions doing that concurrently.
One solution is to make sure that updates always happens in the same order (first A then B).
Another solution is to make sure that each thread/transaction does not have any conflicting writes to a node or relationship as some other concurrent transaction.
This can for example be achieved by letting a single thread do all updates of a specific type.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Deadlocks caused by the use of other synchronization than the locks managed by Neo4j can still happen.
Since all operations in the Neo4j API are thread safe unless specified otherwise, there is no need for external synchronization.
Other code that requires synchronization should be synchronized in such a way that it never performs any Neo4j operation in the synchronized block.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="transactions-delete">Delete semantics</h3>
<div class="paragraph"><p>When deleting a node or a relationship all properties for that entity will be automatically removed but the relationships of a node will not be removed.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Neo4j enforces a constraint (upon commit) that all relationships must have a valid start node and end node.
In effect this means that trying to delete a node that still has relationships attached to it will throw an exception upon commit.
It is however possible to choose in which order to delete the node and the attached relationships as long as no relationships exist when the transaction is committed.</td>
</tr></table>
</div>
<div class="paragraph"><p>The delete semantics can be summarized in the following bullets:</p></div>
<div class="ulist"><ul>
<li>
<p>
All properties of a node or relationship will be removed when it is deleted.
</p>
</li>
<li>
<p>
A deleted node can not have any attached relationships when the transaction commits.
</p>
</li>
<li>
<p>
It is possible to acquire a reference to a deleted relationship or node that has not yet been committed.
</p>
</li>
<li>
<p>
Any write operation on a node or relationship after it has been deleted (but not yet committed) will throw an exception
</p>
</li>
<li>
<p>
After commit trying to acquire a new or work with an old reference to a deleted node or relationship will throw an exception.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="transactions-unique-nodes">Creating unique nodes</h3>
<div class="paragraph"><p>In many use cases, a certain level of uniqueness is desired among entities.
You could for instance imagine that only one user with a certain e-mail address may exist in a system.
If multiple concurrent threads naively try to create the user, duplicates will be created.
There are three main strategies for ensuring uniqueness, and they all work across HA and single-instance deployments.</p></div>
<div class="sect3">
<h4 id="_single_thread">Single thread</h4>
<div class="paragraph"><p>By using a single thread, no two threads will even try to create a particular entity simultaneously.
On HA, an external single-threaded client can perform the operations on the cluster.</p></div>
</div>
<div class="sect3">
<h4 id="transactions-get-or-create">Get or create</h4>
<div class="paragraph"><p>By using <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/Index.html#putIfAbsent%28T,%20java.lang.String,%20java.lang.Object%29"><span class="monospaced">put-if-absent</span></a> functionality,
entity uniqueness can be guaranteed using an index.
Here the index acts as the lock and will only lock the smallest part needed to guaranteed uniqueness across threads and transactions.
To get the more high-level <span class="monospaced">get-or-create</span> functionality make use of <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/UniqueFactory.html"><span class="monospaced">UniqueFactory</span></a> as seen in the example below.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public Node getOrCreateUserWithUniqueFactory( String username, GraphDatabaseService graphDb )
{
    UniqueFactory&lt;Node&gt; factory = new UniqueFactory.UniqueNodeFactory( graphDb, "users" )
    {
        @Override
        protected void initialize( Node created, Map&lt;String, Object&gt; properties )
        {
            created.setProperty( "name", properties.get( "name" ) );
        }
    };

    return factory.getOrCreate( "name", username );
}</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_pessimistic_locking">Pessimistic locking</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">While this is a working solution, please consider using the preferred  <a href="#transactions-get-or-create">[transactions-get-or-create]</a> instead.</td>
</tr></table>
</div>
<div class="paragraph"><p>By using explicit, pessimistic locking, unique creation of entities can be achieved in a multi-threaded environment.
It is most commonly done by locking on a single or a set of common nodes.</p></div>
<div class="paragraph"><p>One might be tempted to use Java synchronization for this, but this is dangerous.
By mixing locks in the Neo4j kernel and in the Java runtime, it is easy to produce deadlocks that are not detectable by Neo4j.
As long as all locking is done by Neo4j, all deadlocks will be detected and avoided.
Also, a solution using manual synchronization doesn&#8217;t ensure uniqueness in an HA environment.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public Node getOrCreateUserPessimistically( String username, GraphDatabaseService graphDb,
                                            Node lockNode )
{
    Index&lt;Node&gt; usersIndex = graphDb.index().forNodes( "users" );
    Node userNode = usersIndex.get( "name", username ).getSingle();
    if ( userNode != null ) return userNode;
    Transaction tx = graphDb.beginTx();
    try
    {
        tx.acquireWriteLock( lockNode );
        userNode = usersIndex.get( "name", username ).getSingle();
        if ( userNode == null )
        {
            userNode = graphDb.createNode();
            userNode.setProperty( "name", username );
            usersIndex.add( userNode, "name", username );
        }
        tx.success();
        return userNode;
    }
    finally
    {
        tx.finish();
    }
}</pre>
</div></div>
<div class="paragraph"><p>The passed in <span class="monospaced">lockNode</span> is only used for locking while creating user nodes in this case.
You can for example create a node to use only for this purpose.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="transactions-events">Transaction events</h3>
<div class="paragraph"><p>Transaction event handlers can be registered to receive Neo4j Transaction events.
Once it has been registered at a <span class="monospaced">GraphDatabaseService</span> instance it will receive events about what has happened in each transaction which is about to be committed.
Handlers won&#8217;t get notified about transactions which haven&#8217;t performed any write operation or won&#8217;t be committed (either if <span class="monospaced">Transaction#success()</span> hasn&#8217;t been called or the transaction has been marked as failed <span class="monospaced">Transaction#failure()</span>.
Right before a transaction is about to be committed the <span class="monospaced">beforeCommit</span> method is called with the entire diff of modifications made in the transaction.
At this point the transaction is still running so changes can still be made. However there&#8217;s no guarantee that other handlers will see such changes since the order in which handlers are executed is undefined.
This method can also throw an exception and will, in such a case, prevent the transaction from being committed (where a call to <span class="monospaced">afterRollback</span> will follow).
If <span class="monospaced">beforeCommit</span> is successfully executed the transaction will be committed and the <span class="monospaced">afterCommit</span> method will be called with the same transaction data as well as the object returned from <span class="monospaced">beforeCommit</span>.
This assumes that all other handlers (if more were registered) also executed <span class="monospaced">beforeCommit</span> successfully.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="import">Data Import</h2>
<div class="sectionbody">
<div class="paragraph"><p>For high-performance data import, the batch insert facilities described in this chapter are recommended.</p></div>
<div class="paragraph"><p>Other ways to import data into Neo4j include using the Geoff notation (see <a href="http://nigelsmall.com/geoff">http://nigelsmall.com/geoff</a> ).</p></div>
<div class="sect2">
<h3 id="batchinsert">Batch Insertion</h3>
<div class="paragraph"><p>Neo4j has a batch insertion facility intended for initial imports, which bypasses transactions and other checks in favor of performance.
This is useful when you have a big dataset that needs to be loaded once.</p></div>
<div class="paragraph"><p>Batch insertion is included in the <a href="http://search.maven.org/#search|ga|1|neo4j-kernel">neo4j-kernel</a> component, which is part of all Neo4j distributions and editions.</p></div>
<div class="paragraph"><p>Be aware of the following points when using batch insertion:</p></div>
<div class="ulist"><ul>
<li>
<p>
The intended use is for initial import of data.
</p>
</li>
<li>
<p>
Batch insertion is <em>not thread safe.</em>
</p>
</li>
<li>
<p>
Batch insertion is <em>non-transactional.</em>
</p>
</li>
<li>
<p>
Batch insertion will re-populate all existing schema indexes and schema indexes created during batch insertion
  on shutdown.
</p>
</li>
<li>
<p>
Unless <span class="monospaced">shutdown</span> is successfully invoked at the end of the import, the database files <em>will</em> be corrupt.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Always perform batch insertion in a <em>single thread</em> (or use synchronization to make only one thread at a time access the batch inserter) and invoke <span class="monospaced">shutdown</span> when finished.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="batchinsert-examples">Batch Inserter Examples</h4>
<div class="paragraph"><p>Creating a batch inserter is similar to how you normally create data in the database, but in this case the low-level <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/unsafe/batchinsert/BatchInserter.html"><span class="monospaced">BatchInserter</span></a> interface is used.
As we have already pointed out, you can&#8217;t have multiple threads using the batch inserter concurrently without external synchronization.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of the examples is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/kernel/src/test/java/examples/BatchInsertDocTest.java">BatchInsertDocTest.java</a></td>
</tr></table>
</div>
<div class="paragraph"><p>To get hold of a <span class="monospaced">BatchInseter</span>, use <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/unsafe/batchinsert/BatchInserters.html"><span class="monospaced">BatchInserters</span></a> and then go from there:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">BatchInserter inserter = BatchInserters.inserter( "target/batchinserter-example", fileSystem );
Label personLabel = DynamicLabel.label( "Person" );
inserter.createDeferredSchemaIndex( personLabel ).on( "name" );
Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
properties.put( "name", "Mattias" );
long mattiasNode = inserter.createNode( properties, personLabel );
properties.put( "name", "Chris" );
long chrisNode = inserter.createNode( properties, personLabel );
RelationshipType knows = DynamicRelationshipType.withName( "KNOWS" );
// To set properties on the relationship, use a properties map
// instead of null as the last parameter.
inserter.createRelationship( mattiasNode, chrisNode, knows, null );
inserter.shutdown();</pre>
</div></div>
<div class="paragraph"><p>To gain good performance you probably want to set some configuration settings for the batch inserter.
Read <a href="#configuration-batchinsert">[configuration-batchinsert]</a> for information on configuring a batch inserter.
This is how to start a batch inserter with configuration options:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Map&lt;String, String&gt; config = new HashMap&lt;String, String&gt;();
config.put( "neostore.nodestore.db.mapped_memory", "90M" );
BatchInserter inserter = BatchInserters.inserter(
        "target/batchinserter-example-config", fileSystem, config );
// Insert data here ... and then shut down:
inserter.shutdown();</pre>
</div></div>
<div class="paragraph"><p>In case you have stored the configuration in a file, you can load it like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">InputStream input = fileSystem.openAsInputStream(
        new File( "target/batchinsert-config" ) );
Map&lt;String, String&gt; config = MapUtil.load( input );
BatchInserter inserter = BatchInserters.inserter(
        "target/batchinserter-example-config", fileSystem, config );
// Insert data here ... and then shut down:
inserter.shutdown();</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="batchinsert-db">Batch Graph Database</h4>
<div class="paragraph"><p>In case you already have code for data import written against the normal Neo4j API, you could consider using a batch inserter exposing that API.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This will not perform as good as using the <span class="monospaced">BatchInserter</span> API directly.</td>
</tr></table>
</div>
<div class="paragraph"><p>Also be aware of the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
Starting a transaction or invoking <span class="monospaced">Transaction.finish()</span> or <span class="monospaced">Transaction.success()</span> will do nothing.
</p>
</li>
<li>
<p>
Invoking the <span class="monospaced">Transaction.failure()</span> method will generate a <span class="monospaced">NotInTransaction</span> exception.
</p>
</li>
<li>
<p>
<span class="monospaced">Node.delete()</span> and <span class="monospaced">Node.traverse()</span> are not supported.
</p>
</li>
<li>
<p>
<span class="monospaced">Relationship.delete()</span> is not supported.
</p>
</li>
<li>
<p>
Event handlers and indexes are not supported.
</p>
</li>
<li>
<p>
<span class="monospaced">GraphDatabaseService.getRelationshipTypes()</span>, <span class="monospaced">getAllNodes()</span> and <span class="monospaced">getAllRelationships()</span> are not supported.
</p>
</li>
</ul></div>
<div class="paragraph"><p>With these precautions in mind, this is how to do it:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">GraphDatabaseService batchDb =
        BatchInserters.batchDatabase( "target/batchdb-example", fileSystem );
Label personLabel = DynamicLabel.label( "Person" );
Node mattiasNode = batchDb.createNode( personLabel );
mattiasNode.setProperty( "name", "Mattias" );
Node chrisNode = batchDb.createNode();
chrisNode.setProperty( "name", "Chris" );
chrisNode.addLabel( personLabel );
RelationshipType knows = DynamicRelationshipType.withName( "KNOWS" );
mattiasNode.createRelationshipTo( chrisNode, knows );
batchDb.shutdown();</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The source code of the example is found here:
<a href="https://github.com/neo4j/neo4j/blob/master/community/kernel/src/test/java/examples/BatchInsertDocTest.java">BatchInsertDocTest.java</a></td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="indexing-batchinsert">Index Batch Insertion</h4>
<div class="paragraph"><p>For general notes on batch insertion, see <a href="#batchinsert">[batchinsert]</a>.</p></div>
<div class="paragraph"><p>Indexing during batch insertion is done using <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/unsafe/batchinsert/BatchInserterIndex.html">BatchInserterIndex</a> which are provided via <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/unsafe/batchinsert/BatchInserterIndexProvider.html">BatchInserterIndexProvider</a>.
An example:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">BatchInserter inserter = BatchInserters.inserter( "target/neo4jdb-batchinsert" );
BatchInserterIndexProvider indexProvider =
        new LuceneBatchInserterIndexProvider( inserter );
BatchInserterIndex actors =
        indexProvider.nodeIndex( "actors", MapUtil.stringMap( "type", "exact" ) );
actors.setCacheCapacity( "name", 100000 );

Map&lt;String, Object&gt; properties = MapUtil.map( "name", "Keanu Reeves" );
long node = inserter.createNode( properties );
actors.add( node, properties );

//make the changes visible for reading, use this sparsely, requires IO!
actors.flush();

// Make sure to shut down the index provider as well
indexProvider.shutdown();
inserter.shutdown();</pre>
</div></div>
<div class="paragraph"><p>The configuration parameters are the same as mentioned in <a href="#indexing-create-advanced">[indexing-create-advanced]</a>.</p></div>
<div class="sect4">
<h5 id="indexing-batchinsert-best-practices">Best practices</h5>
<div class="paragraph"><p>Here are some pointers to get the most performance out of <span class="monospaced">BatchInserterIndex</span>:</p></div>
<div class="ulist"><ul>
<li>
<p>
Try to avoid <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/unsafe/batchinsert/BatchInserterIndex.html#flush%28%29">flushing</a> too often because each flush will result in all additions (since last flush) to be visible to the querying methods, and publishing those changes can be a performance penalty.
</p>
</li>
<li>
<p>
Have (as big as possible) phases where one phase is either only writes or only reads, and don&#8217;t forget to flush after a write phase so that those changes becomes visible to the querying methods.
</p>
</li>
<li>
<p>
Enable <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/unsafe/batchinsert/BatchInserterIndex.html#setCacheCapacity%28java.lang.String,%20int%29">caching</a> for keys you know you&#8217;re going to do lookups for later on to increase performance significantly (though insertion performance may degrade slightly).
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Changes to the index are available for reading first after they are flushed to disk.
Thus, for optimal performance, read and lookup operations should be kept to a minimum during batchinsertion since they
involve IO and impact speed negatively.</td>
</tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexing">Legacy Indexing</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This is not the same as <a href="#graphdb-neo4j-schema">indexes defined in the schema</a>, the documentation below is for the legacy indexing in Neo4j.</td>
</tr></table>
</div>
<div class="paragraph"><p>This chapter focuses on how to use the Manual Indexes and Autoindexes.
As of Neo4j 2.0, this is not  the favored method of indexing data in Neo4j, instead we recommend defining indexes in the database schema.</p></div>
<div class="paragraph"><p>However, support for legacy indexes remains, because certain features, such as uniqueness constraints, are not yet handled by the new indexes.</p></div>
<div class="sect2">
<h3 id="indexing-introduction">Introduction</h3>
<div class="paragraph"><p>Legacy Indexing operations are part of the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/package-summary.html">Neo4j index API</a>.</p></div>
<div class="paragraph"><p>Each index is tied to a unique, user-specified name (for example "first_name" or "books") and can index either <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Node.html">nodes</a> or <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Relationship.html">relationships</a>.</p></div>
<div class="paragraph"><p>The default index implementation is provided by the <span class="monospaced">neo4j-lucene-index</span> component, which is included in the standard Neo4j download.
It can also be downloaded separately from <a href="http://repo1.maven.org/maven2/org/neo4j/neo4j-lucene-index/">http://repo1.maven.org/maven2/org/neo4j/neo4j-lucene-index/</a> .
For Maven users, the <span class="monospaced">neo4j-lucene-index</span> component has the coordinates <span class="monospaced">org.neo4j:neo4j-lucene-index</span> and should be used with the same version of <span class="monospaced">org.neo4j:neo4j-kernel</span>.
Different versions of the index and kernel components are not compatible in the general case.
Both components are included transitively by the <span class="monospaced">org.neo4j:neo4j:pom</span> artifact which makes it simple to keep the versions in sync.</p></div>
<div class="paragraph"><p>For initial import of data using indexes, see <a href="#indexing-batchinsert">[indexing-batchinsert]</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Transactions</div>All modifying index operations must be performed inside a transaction, as with any modifying operation in Neo4j.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="indexing-create">Create</h3>
<div class="paragraph"><p>An index is created if it doesn&#8217;t exist when you ask for it.
Unless you give it a custom configuration, it will be created with default configuration and backend.</p></div>
<div class="paragraph"><p>To set the stage for our examples, let&#8217;s create some indexes to begin with:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">IndexManager index = graphDb.index();
Index&lt;Node&gt; actors = index.forNodes( "actors" );
Index&lt;Node&gt; movies = index.forNodes( "movies" );
RelationshipIndex roles = index.forRelationships( "roles" );</pre>
</div></div>
<div class="paragraph"><p>This will create two node indexes and one relationship index with default configuration.
See <a href="#indexing-relationships">[indexing-relationships]</a> for more information specific to relationship indexes.</p></div>
<div class="paragraph"><p>See <a href="#indexing-create-advanced">[indexing-create-advanced]</a> for how to create <em>fulltext</em> indexes.</p></div>
<div class="paragraph"><p>You can also check if an index exists like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">IndexManager index = graphDb.index();
boolean indexExists = index.existsForNodes( "actors" );</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="indexing-delete">Delete</h3>
<div class="paragraph"><p>Indexes can be deleted.
When deleting, the entire contents of the index will be removed as well as its associated configuration.
A new index can be created with the same name at a later point in time.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">IndexManager index = graphDb.index();
Index&lt;Node&gt; actors = index.forNodes( "actors" );
actors.delete();</pre>
</div></div>
<div class="paragraph"><p>Note that the actual deletion of the index is made during the commit of <em>the surrounding transaction</em>.
Calls made to such an index instance after <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/Index.html#delete%28%29">delete()</a> has been called are invalid inside that transaction as well as outside (if the transaction is successful), but will become valid again if the transaction is rolled back.</p></div>
</div>
<div class="sect2">
<h3 id="indexing-add">Add</h3>
<div class="paragraph"><p>Each index supports associating any number of key-value pairs with any number of entities (nodes or relationships), where each association between entity and key-value pair is performed individually.
To begin with, let&#8217;s add a few nodes to the indexes:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// Actors
Node reeves = graphDb.createNode();
reeves.setProperty( "name", "Keanu Reeves" );
actors.add( reeves, "name", reeves.getProperty( "name" ) );
Node bellucci = graphDb.createNode();
bellucci.setProperty( "name", "Monica Bellucci" );
actors.add( bellucci, "name", bellucci.getProperty( "name" ) );
// multiple values for a field, in this case for search only
// and not stored as a property.
actors.add( bellucci, "name", "La Bellucci" );
// Movies
Node theMatrix = graphDb.createNode();
theMatrix.setProperty( "title", "The Matrix" );
theMatrix.setProperty( "year", 1999 );
movies.add( theMatrix, "title", theMatrix.getProperty( "title" ) );
movies.add( theMatrix, "year", theMatrix.getProperty( "year" ) );
Node theMatrixReloaded = graphDb.createNode();
theMatrixReloaded.setProperty( "title", "The Matrix Reloaded" );
theMatrixReloaded.setProperty( "year", 2003 );
movies.add( theMatrixReloaded, "title", theMatrixReloaded.getProperty( "title" ) );
movies.add( theMatrixReloaded, "year", 2003 );
Node malena = graphDb.createNode();
malena.setProperty( "title", "Malèna" );
malena.setProperty( "year", 2000 );
movies.add( malena, "title", malena.getProperty( "title" ) );
movies.add( malena, "year", malena.getProperty( "year" ) );</pre>
</div></div>
<div class="paragraph"><p>Note that there can be multiple values associated with the same entity and key.</p></div>
<div class="paragraph"><p>Next up, we&#8217;ll create relationships and index them as well:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// we need a relationship type
DynamicRelationshipType ACTS_IN = DynamicRelationshipType.withName( "ACTS_IN" );
// create relationships
Relationship role1 = reeves.createRelationshipTo( theMatrix, ACTS_IN );
role1.setProperty( "name", "Neo" );
roles.add( role1, "name", role1.getProperty( "name" ) );
Relationship role2 = reeves.createRelationshipTo( theMatrixReloaded, ACTS_IN );
role2.setProperty( "name", "Neo" );
roles.add( role2, "name", role2.getProperty( "name" ) );
Relationship role3 = bellucci.createRelationshipTo( theMatrixReloaded, ACTS_IN );
role3.setProperty( "name", "Persephone" );
roles.add( role3, "name", role3.getProperty( "name" ) );
Relationship role4 = bellucci.createRelationshipTo( malena, ACTS_IN );
role4.setProperty( "name", "Malèna Scordia" );
roles.add( role4, "name", role4.getProperty( "name" ) );</pre>
</div></div>
<div class="paragraph"><p>After these operations, our example graph looks like this:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Movie-and-Actor-Graph-initial.svg" alt="Movie-and-Actor-Graph-initial.svg">
</div>
<div class="title">Figure 50. Movie and Actor Graph</div>
</div>
</div>
<div class="sect2">
<h3 id="indexing-remove">Remove</h3>
<div class="paragraph"><p><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/Index.html#remove%28T,%20java.lang.String,%20java.lang.Object%29">Removing</a> from an index is similar to adding, but can be done by supplying one of the following combinations of arguments:</p></div>
<div class="ulist"><ul>
<li>
<p>
entity
</p>
</li>
<li>
<p>
entity, key
</p>
</li>
<li>
<p>
entity, key, value
</p>
</li>
</ul></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// completely remove bellucci from the actors index
actors.remove( bellucci );
// remove any "name" entry of bellucci from the actors index
actors.remove( bellucci, "name" );
// remove the "name" -&gt; "La Bellucci" entry of bellucci
actors.remove( bellucci, "name", "La Bellucci" );</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="indexing-update">Update</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">To update an index entry, the old one must be removed and a new one added.
For details on removing index entries, see <a href="#indexing-remove">[indexing-remove]</a>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Remember that a node or relationship can be associated with any number of key-value pairs in an index.
This means that you can index a node or relationship with many key-value pairs that have the same key.
In the case where a property value changes and you&#8217;d like to update the index, it&#8217;s not enough to just index the new value&#8201;&#8212;&#8201;you&#8217;ll have to remove the old value as well.</p></div>
<div class="paragraph"><p>Here&#8217;s a code example that demonstrates how it&#8217;s done:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// create a node with a property
// so we have something to update later on
Node fishburn = graphDb.createNode();
fishburn.setProperty( "name", "Fishburn" );
// index it
actors.add( fishburn, "name", fishburn.getProperty( "name" ) );
// update the index entry
// when the property value changes
actors.remove( fishburn, "name", fishburn.getProperty( "name" ) );
fishburn.setProperty( "name", "Laurence Fishburn" );
actors.add( fishburn, "name", fishburn.getProperty( "name" ) );</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="indexing-search">Search</h3>
<div class="paragraph"><p>An index can be searched in two ways, <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/Index.html#get%28java.lang.String,%20java.lang.Object%29">get</a> and <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/Index.html#query%28java.lang.String,%20java.lang.Object%29">query</a>.
The <span class="monospaced">get</span> method will return exact matches to the given key-value pair, whereas <span class="monospaced">query</span> exposes querying capabilities directly from the backend used by the index.
For example the <a href="http://lucene.apache.org/java/3_6_2/queryparsersyntax.html">Lucene query syntax</a> can be used directly with the default indexing backend.</p></div>
<div class="sect3">
<h4 id="indexing-search-get">Get</h4>
<div class="paragraph"><p>This is how to search for a single exact match:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">IndexHits&lt;Node&gt; hits = actors.get( "name", "Keanu Reeves" );
Node reeves = hits.getSingle();</pre>
</div></div>
<div class="paragraph"><p><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/IndexHits.html">IndexHits</a> is an <span class="monospaced">Iterable</span> with some additional useful methods. For example <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/IndexHits.html#getSingle%28%29">getSingle()</a> returns the first and only item from the result iterator, or <span class="monospaced">null</span> if there isn&#8217;t any hit.</p></div>
<div class="paragraph"><p>Here&#8217;s how to get a single relationship by exact matching and retrieve its start and end nodes:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Relationship persephone = roles.get( "name", "Persephone" ).getSingle();
Node actor = persephone.getStartNode();
Node movie = persephone.getEndNode();</pre>
</div></div>
<div class="paragraph"><p>Finally, we can iterate over all exact matches from a relationship index:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Relationship role : roles.get( "name", "Neo" ) )
{
    // this will give us Reeves twice
    Node reeves = role.getStartNode();
}</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">In case you don&#8217;t iterate through all the hits, <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/IndexHits.html#close%28%29">IndexHits.close()</a> must be called explicitly.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="indexing-search-query">Query</h4>
<div class="paragraph"><p>There are two query methods, one which uses a key-value signature where the value represents a query for values with the given key only.
The other method is more generic and supports querying for more than one key-value pair in the same query.</p></div>
<div class="paragraph"><p>Here&#8217;s an example using the key-query option:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Node actor : actors.query( "name", "*e*" ) )
{
    // This will return Reeves and Bellucci
}</pre>
</div></div>
<div class="paragraph"><p>In the following example the query uses multiple keys:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">for ( Node movie : movies.query( "title:*Matrix* AND year:1999" ) )
{
    // This will return "The Matrix" from 1999 only.
}</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Beginning a wildcard search with "*" or "?" is discouraged by Lucene, but will nevertheless work.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">You can&#8217;t have <em>any whitespace</em> in the search term with this syntax.
  See <a href="#indexing-lucene-query-objects">[indexing-lucene-query-objects]</a> for how to do that.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="indexing-relationships">Relationship indexes</h3>
<div class="paragraph"><p>An index for relationships is just like an index for nodes, extended by providing support to constrain a search to relationships with a specific start and/or end nodes
These extra methods reside in the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/RelationshipIndex.html">RelationshipIndex</a> interface which extends <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/Index.html">Index&lt;Relationship&gt;</a>.</p></div>
<div class="paragraph"><p>Example of querying a relationship index:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// find relationships filtering on start node
// using exact matches
IndexHits&lt;Relationship&gt; reevesAsNeoHits;
reevesAsNeoHits = roles.get( "name", "Neo", reeves, null );
Relationship reevesAsNeo = reevesAsNeoHits.iterator().next();
reevesAsNeoHits.close();
// find relationships filtering on end node
// using a query
IndexHits&lt;Relationship&gt; matrixNeoHits;
matrixNeoHits = roles.query( "name", "*eo", null, theMatrix );
Relationship matrixNeo = matrixNeoHits.iterator().next();
matrixNeoHits.close();</pre>
</div></div>
<div class="paragraph"><p>And here&#8217;s an example for the special case of searching for a specific relationship type:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// find relationships filtering on end node
// using a relationship type.
// this is how to add it to the index:
roles.add( reevesAsNeo, "type", reevesAsNeo.getType().name() );
// Note that to use a compound query, we can't combine committed
// and uncommitted index entries, so we'll commit before querying:
tx.success();
tx.finish();
// and now we can search for it:
IndexHits&lt;Relationship&gt; typeHits;
typeHits = roles.query( "type:ACTS_IN AND name:Neo", null, theMatrix );
Relationship typeNeo = typeHits.iterator().next();
typeHits.close();</pre>
</div></div>
<div class="paragraph"><p>Such an index can be useful if your domain has nodes with a very large number of relationships between them, since it reduces the search time for a relationship between two nodes.
A good example where this approach pays dividends is in time series data, where we have readings represented as a relationship per occurrence.</p></div>
</div>
<div class="sect2">
<h3 id="indexing-scores">Scores</h3>
<div class="paragraph"><p>The <span class="monospaced">IndexHits</span> interface exposes <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/IndexHits.html#currentScore%28%29">scoring</a> so that the index can communicate scores for the hits.
Note that the result is not sorted by the score unless you explicitly specify that.
See <a href="#indexing-lucene-sort">[indexing-lucene-sort]</a> for how to sort by score.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">IndexHits&lt;Node&gt; hits = movies.query( "title", "The*" );
for ( Node movie : hits )
{
    System.out.println( movie.getProperty( "title" ) + " " + hits.currentScore() );
}</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="indexing-create-advanced">Configuration and fulltext indexes</h3>
<div class="paragraph"><p>At the time of creation extra configuration can be specified to control the behavior of the index and which backend to use.
For example to create a Lucene fulltext index:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">IndexManager index = graphDb.index();
Index&lt;Node&gt; fulltextMovies = index.forNodes( "movies-fulltext",
        MapUtil.stringMap( IndexManager.PROVIDER, "lucene", "type", "fulltext" ) );
fulltextMovies.add( theMatrix, "title", "The Matrix" );
fulltextMovies.add( theMatrixReloaded, "title", "The Matrix Reloaded" );
// search in the fulltext index
Node found = fulltextMovies.query( "title", "reloAdEd" ).getSingle();</pre>
</div></div>
<div class="paragraph"><p>Here&#8217;s an example of how to create an exact index which is case-insensitive:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Index&lt;Node&gt; index = graphDb.index().forNodes( "exact-case-insensitive",
        stringMap( "type", "exact", "to_lower_case", "true" ) );
Node node = graphDb.createNode();
index.add( node, "name", "Thomas Anderson" );
assertContains( index.query( "name", "\"Thomas Anderson\"" ), node );
assertContains( index.query( "name", "\"thoMas ANDerson\"" ), node );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In order to search for tokenized words, the <span class="monospaced">query</span> method has to be used.
  The <span class="monospaced">get</span> method will only match the full string value, not the tokens.</td>
</tr></table>
</div>
<div class="paragraph"><p>The configuration of the index is persisted once the index has been created.
The <span class="monospaced">provider</span> configuration key is interpreted by Neo4j, but any other configuration is passed onto the backend index (e.g. Lucene) to interpret.</p></div>
<table class="tableblock frame-none grid-all"
style="
width:100%;
">
<caption class="title">Table 3. Lucene indexing configuration parameters</caption>
<col style="width:20%;">
<col style="width:30%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Parameter                 </th>
<th class="tableblock halign-left valign-top" > Possible values   </th>
<th class="tableblock halign-left valign-top" > Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">type</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">exact</span>, <span class="monospaced">fulltext</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">exact</span> is the default and uses a Lucene <a href="http://lucene.apache.org/core/old_versioned_docs/versions/3_6_2/api/core/org/apache/lucene/analysis/KeywordAnalyzer.html">keyword analyzer</a>.
  <span class="monospaced">fulltext</span> uses a white-space tokenizer in its analyzer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">to_lower_case</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">true</span>, <span class="monospaced">false</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">This parameter goes together with <span class="monospaced">type</span>: <span class="monospaced">fulltext</span> and converts values to lower case during both additions and querying, making the index case insensitive. Defaults to <span class="monospaced">true</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">analyzer</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the full class name of an <a href="http://lucene.apache.org/core/old_versioned_docs/versions/3_6_2/api/core/org/apache/lucene/analysis/Analyzer.html">Analyzer</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Overrides the <span class="monospaced">type</span> so that a custom analyzer can be used.
  Note: <span class="monospaced">to_lower_case</span> still affects lowercasing of string queries.
  If the custom analyzer uppercases the indexed tokens, string queries will not match as expected.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="indexing-lucene-extras">Extra features for Lucene indexes</h3>
<div class="sect3">
<h4 id="indexing-lucene-numeric-ranges">Numeric ranges</h4>
<div class="paragraph"><p>Lucene supports smart indexing of numbers, querying for ranges and sorting such results, and so does its backend for Neo4j.
To mark a value so that it is indexed as a numeric value, we can make use of the <a href="http://components.neo4j.org/neo4j-lucene-index/2.0-SNAPSHOT/apidocs/org/neo4j/index/lucene/ValueContext.html">ValueContext</a> class, like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">movies.add( theMatrix, "year-numeric", new ValueContext( 1999 ).indexNumeric() );
movies.add( theMatrixReloaded, "year-numeric", new ValueContext( 2003 ).indexNumeric() );
movies.add( malena, "year-numeric", new ValueContext( 2000 ).indexNumeric() );

int from = 1997;
int to = 1999;
hits = movies.query( QueryContext.numericRange( "year-numeric", from, to ) );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The same type must be used for indexing and querying.
That is, you can&#8217;t index a value as a Long and then query the index using an Integer.</td>
</tr></table>
</div>
<div class="paragraph"><p>By giving <span class="monospaced">null</span> as from/to argument, an open ended query is created.
In the following example we are doing that, and have added sorting to the query as well:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">hits = movies.query(
        QueryContext.numericRange( "year-numeric", from, null )
                .sortNumeric( "year-numeric", false ) );</pre>
</div></div>
<div class="paragraph"><p>From/to in the ranges defaults to be <em>inclusive</em>, but you can change this behavior by using two extra parameters:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">movies.add( theMatrix, "score", new ValueContext( 8.7 ).indexNumeric() );
movies.add( theMatrixReloaded, "score", new ValueContext( 7.1 ).indexNumeric() );
movies.add( malena, "score", new ValueContext( 7.4 ).indexNumeric() );

// include 8.0, exclude 9.0
hits = movies.query( QueryContext.numericRange( "score", 8.0, 9.0, true, false ) );</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="indexing-lucene-sort">Sorting</h4>
<div class="paragraph"><p>Lucene performs sorting very well, and that is also exposed in the index backend, through the <a href="http://components.neo4j.org/neo4j-lucene-index/2.0-SNAPSHOT/apidocs/org/neo4j/index/lucene/QueryContext.html">QueryContext</a> class:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">hits = movies.query( "title", new QueryContext( "*" ).sort( "title" ) );
for ( Node hit : hits )
{
    // all movies with a title in the index, ordered by title
}
// or
hits = movies.query( new QueryContext( "title:*" ).sort( "year", "title" ) );
for ( Node hit : hits )
{
    // all movies with a title in the index, ordered by year, then title
}</pre>
</div></div>
<div class="paragraph"><p>We sort the results by relevance (score) like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">hits = movies.query( "title", new QueryContext( "The*" ).sortByScore() );
for ( Node movie : hits )
{
    // hits sorted by relevance (score)
}</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="indexing-lucene-query-objects">Querying with Lucene Query objects</h4>
<div class="paragraph"><p>Instead of passing in Lucene query syntax queries, you can instantiate such queries programmatically and pass in as argument, for example:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// a TermQuery will give exact matches
Node actor = actors.query( new TermQuery( new Term( "name", "Keanu Reeves" ) ) ).getSingle();</pre>
</div></div>
<div class="paragraph"><p>Note that the <a href="http://lucene.apache.org/core/old_versioned_docs/versions/3_6_2/api/core/org/apache/lucene/search/TermQuery.html">TermQuery</a> is basically the same thing as using the <span class="monospaced">get</span> method on the index.</p></div>
<div class="paragraph"><p>This is how to perform <em>wildcard</em> searches using Lucene Query Objects:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">hits = movies.query( new WildcardQuery( new Term( "title", "The Matrix*" ) ) );
for ( Node movie : hits )
{
    System.out.println( movie.getProperty( "title" ) );
}</pre>
</div></div>
<div class="paragraph"><p>Note that this allows for whitespace in the search string.</p></div>
</div>
<div class="sect3">
<h4 id="indexing-lucene-compound">Compound queries</h4>
<div class="paragraph"><p>Lucene supports querying for multiple terms in the same query, like so:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">hits = movies.query( "title:*Matrix* AND year:1999" );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Compound queries can&#8217;t search across committed index entries and those who haven&#8217;t got committed yet at the same time.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="indexing-lucene-default-operator">Default operator</h4>
<div class="paragraph"><p>The default operator (that is whether <span class="monospaced">AND</span> or <span class="monospaced">OR</span> is used in between different terms) in a query is <span class="monospaced">OR</span>. Changing that behavior is also done via the <a href="http://components.neo4j.org/neo4j-lucene-index/2.0-SNAPSHOT/apidocs/org/neo4j/index/lucene/QueryContext.html">QueryContext</a> class:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">QueryContext query = new QueryContext( "title:*Matrix* year:1999" )
        .defaultOperator( Operator.AND );
hits = movies.query( query );</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="indexing-lucene-caching">Caching</h4>
<div class="paragraph"><p>If your index lookups becomes a performance bottle neck, caching can be enabled for certain keys in certain indexes (key locations) to speed up get requests.
The caching is implemented with an <a href="http://en.wikipedia.org/wiki/Cache_algorithms#Least_Recently_Used">LRU</a> cache so that only the most recently accessed results are cached (with "results" meaning a query result of a get request, not a single entity).
You can control the size of the cache (the maximum number of results) per index key.</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">Index&lt;Node&gt; index = graphDb.index().forNodes( "actors" );
((LuceneIndex&lt;Node&gt;) index).setCacheCapacity( "name", 300000 );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">This setting is not persisted after shutting down the database.
  This means: set this value after each startup of the database if you want to keep it.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="auto-indexing">Automatic Indexing</h3>
<div class="paragraph"><p>Neo4j provides a single index for nodes and one for relationships in each database that automatically follow property values as they are added, deleted and changed on database primitives.
This functionality is called <em>auto indexing</em> and is controlled both from the database configuration Map and through its own API.</p></div>
<div class="sect3">
<h4 id="auto-indexing-config">Configuration</h4>
<div class="paragraph"><p>By default Auto Indexing is off for both Nodes and Relationships.
To configure this in the <em>neo4j.properties</em> file, use the configuration keys <span class="monospaced">node_auto_indexing</span> and <span class="monospaced">relationship_auto_indexing</span>.
For embedded mode, use the configuration options <span class="monospaced">GraphDatabaseSettings.node_auto_indexing</span>
and <span class="monospaced">GraphDatabaseSettings.relationship_auto_indexing</span>.
In both cases, set the value to <span class="monospaced">true</span>.
This will enable automatic indexing on startup.
Just note that we&#8217;re not done yet, see below!</p></div>
<div class="paragraph"><p>To actually auto index something, you have to set which properties should get indexed.
You do this by listing the property keys to index on.
In the configuration file, use the <span class="monospaced">node_keys_indexable</span> and <span class="monospaced">relationship_keys_indexable</span> configuration keys.
When using embedded mode, use the <span class="monospaced">GraphDatabaseSettings.node_keys_indexable</span> and <span class="monospaced">GraphDatabaseSettings.relationship_keys_indexable</span> configuration keys.
In all cases, the value should be a comma separated list of property keys to index on.</p></div>
<div class="paragraph"><p>When coding in Java, it&#8217;s done like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">/*
 * Creating the configuration, adding nodeProp1 and nodeProp2 as
 * auto indexed properties for Nodes and relProp1 and relProp2 as
 * auto indexed properties for Relationships. Only those will be
 * indexed. We also have to enable auto indexing for both these
 * primitives explicitly.
 */
GraphDatabaseService graphDb = new GraphDatabaseFactory().
    newEmbeddedDatabaseBuilder( storeDirectory ).
    setConfig( GraphDatabaseSettings.node_keys_indexable, "nodeProp1,nodeProp2" ).
    setConfig( GraphDatabaseSettings.relationship_keys_indexable, "relProp1,relProp2" ).
    setConfig( GraphDatabaseSettings.node_auto_indexing, "true" ).
    setConfig( GraphDatabaseSettings.relationship_auto_indexing, "true" ).
    newGraphDatabase();

Transaction tx = graphDb.beginTx();
Node node1 = null, node2 = null;
Relationship rel = null;
try
{
    // Create the primitives
    node1 = graphDb.createNode();
    node2 = graphDb.createNode();
    rel = node1.createRelationshipTo( node2,
            DynamicRelationshipType.withName( "DYNAMIC" ) );

    // Add indexable and non-indexable properties
    node1.setProperty( "nodeProp1", "nodeProp1Value" );
    node2.setProperty( "nodeProp2", "nodeProp2Value" );
    node1.setProperty( "nonIndexed", "nodeProp2NonIndexedValue" );
    rel.setProperty( "relProp1", "relProp1Value" );
    rel.setProperty( "relPropNonIndexed", "relPropValueNonIndexed" );

    // Make things persistent
    tx.success();
}
catch ( Exception e )
{
    tx.failure();
}
finally
{
    tx.finish();
}</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="auto-indexing-api">Search</h4>
<div class="paragraph"><p>The usefulness of the auto indexing functionality comes of course from the ability to actually query the index and retrieve results.
To that end, you can acquire a <span class="monospaced">ReadableIndex</span> object from the <span class="monospaced">AutoIndexer</span> that exposes all the query and get methods of a full
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/Index.html"><span class="monospaced">Index</span></a> with exactly the same functionality.
Continuing from the previous example, accessing the index is done like this:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// Get the Node auto index
ReadableIndex&lt;Node&gt; autoNodeIndex = graphDb.index()
        .getNodeAutoIndexer()
        .getAutoIndex();
// node1 and node2 both had auto indexed properties, get them
assertEquals( node1,
        autoNodeIndex.get( "nodeProp1", "nodeProp1Value" ).getSingle() );
assertEquals( node2,
        autoNodeIndex.get( "nodeProp2", "nodeProp2Value" ).getSingle() );
// node2 also had a property that should be ignored.
assertFalse( autoNodeIndex.get( "nonIndexed",
        "nodeProp2NonIndexedValue" ).hasNext() );

// Get the relationship auto index
ReadableIndex&lt;Relationship&gt; autoRelIndex = graphDb.index()
        .getRelationshipAutoIndexer()
        .getAutoIndex();
// One property was set for auto indexing
assertEquals( rel,
        autoRelIndex.get( "relProp1", "relProp1Value" ).getSingle() );
// The rest should be ignored
assertFalse( autoRelIndex.get( "relPropNonIndexed",
        "relPropValueNonIndexed" ).hasNext() );</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="auto-indexing-config-api">Runtime Configuration</h4>
<div class="paragraph"><p>The same options that are available during database creation via the configuration can also be set during runtime via the <span class="monospaced">AutoIndexer</span> API.</p></div>
<div class="paragraph"><p>Gaining access to the <span class="monospaced">AutoIndexer</span> API and adding two <span class="monospaced">Node</span> and one <span class="monospaced">Relationship</span> properties to auto index is done like so:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// Start without any configuration
GraphDatabaseService graphDb = new GraphDatabaseFactory().
        newEmbeddedDatabase( storeDirectory );

// Get the Node AutoIndexer, set nodeProp1 and nodeProp2 as auto
// indexed.
AutoIndexer&lt;Node&gt; nodeAutoIndexer = graphDb.index()
        .getNodeAutoIndexer();
nodeAutoIndexer.startAutoIndexingProperty( "nodeProp1" );
nodeAutoIndexer.startAutoIndexingProperty( "nodeProp2" );

// Get the Relationship AutoIndexer
AutoIndexer&lt;Relationship&gt; relAutoIndexer = graphDb.index()
        .getRelationshipAutoIndexer();
relAutoIndexer.startAutoIndexingProperty( "relProp1" );

// None of the AutoIndexers are enabled so far. Do that now
nodeAutoIndexer.setEnabled( true );
relAutoIndexer.setEnabled( true );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Parameters to the AutoIndexers passed through the Configuration and settings made through the API are cumulative.
So you can set some beforehand known settings, do runtime checks to augment the initial configuration and then enable the desired auto indexers -
the final configuration is the same regardless of the method used to reach it.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="auto-indexing-update-removal">Updating the Automatic Index</h4>
<div class="paragraph"><p>Updates to the auto indexed properties happen of course automatically as you update them. Removal of properties from the auto index happens for two reasons.
One is that you actually removed the property. The other is that you stopped autoindexing on a property. When the latter happens, any primitive you touch and
it has that property, it is removed from the auto index, regardless of any operations on the property.
When you start or stop auto indexing on a property, no auto update operation happens currently. If you need to change the set of auto indexed properties and
have them re-indexed, you currently have to do this by hand. An example will illustrate the above better:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">/*
 * Creating the configuration
 */
GraphDatabaseService graphDb = new GraphDatabaseFactory().
    newEmbeddedDatabaseBuilder( storeDirectory ).
    setConfig( GraphDatabaseSettings.node_keys_indexable, "nodeProp1,nodeProp2" ).
    setConfig( GraphDatabaseSettings.node_auto_indexing, "true" ).
    newGraphDatabase();

Transaction tx = graphDb.beginTx();
Node node1 = null, node2 = null, node3 = null, node4 = null;
try
{
    // Create the primitives
    node1 = graphDb.createNode();
    node2 = graphDb.createNode();
    node3 = graphDb.createNode();
    node4 = graphDb.createNode();

    // Add indexable and non-indexable properties
    node1.setProperty( "nodeProp1", "nodeProp1Value" );
    node2.setProperty( "nodeProp2", "nodeProp2Value" );
    node3.setProperty( "nodeProp1", "nodeProp3Value" );
    node4.setProperty( "nodeProp2", "nodeProp4Value" );

    // Make things persistent
    tx.success();
}
catch ( Exception e )
{
    tx.failure();
}
finally
{
    tx.finish();
}

/*
 *  Here both nodes are indexed. To demonstrate removal, we stop
 *  autoindexing nodeProp1.
 */
AutoIndexer&lt;Node&gt; nodeAutoIndexer = graphDb.index().getNodeAutoIndexer();
nodeAutoIndexer.stopAutoIndexingProperty( "nodeProp1" );

tx = graphDb.beginTx();
try
{
    /*
     * nodeProp1 is no longer auto indexed. It will be
     * removed regardless. Note that node3 will remain.
     */
    node1.setProperty( "nodeProp1", "nodeProp1Value2" );
    /*
     * node2 will be auto updated
     */
    node2.setProperty( "nodeProp2", "nodeProp2Value2" );
    /*
     * remove node4 property nodeProp2 from index.
     */
    node4.removeProperty( "nodeProp2" );
    // Make things persistent
    tx.success();
}
catch ( Exception e )
{
    tx.failure();
}
finally
{
    tx.finish();
}

// Verify
ReadableIndex&lt;Node&gt; nodeAutoIndex = nodeAutoIndexer.getAutoIndex();
// node1 is completely gone
assertFalse( nodeAutoIndex.get( "nodeProp1", "nodeProp1Value" ).hasNext() );
assertFalse( nodeAutoIndex.get( "nodeProp1", "nodeProp1Value2" ).hasNext() );
// node2 is updated
assertFalse( nodeAutoIndex.get( "nodeProp2", "nodeProp2Value" ).hasNext() );
assertEquals( node2,
        nodeAutoIndex.get( "nodeProp2", "nodeProp2Value2" ).getSingle() );
/*
 * node3 is still there, despite its nodeProp1 property not being monitored
 * any more because it was not touched, in contrast with node1.
 */
assertEquals( node3,
        nodeAutoIndex.get( "nodeProp1", "nodeProp3Value" ).getSingle() );
// Finally, node4 is removed because the property was removed.
assertFalse( nodeAutoIndex.get( "nodeProp2", "nodeProp4Value" ).hasNext() );</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">If you start the database with auto indexing enabled but different auto indexed properties than the last run, then already auto-indexed properties will be deleted from the index when a value is written to them (assuming the property isn&#8217;t present in the new configuration).
Make sure that the monitored set is what you want before enabling the functionality.</td>
</tr></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graph-algo">Graph Algorithms</h2>
<div class="sectionbody">
<div class="paragraph"><p>Neo4j graph algorithms is a component that contains Neo4j implementations of some common algorithms for graphs.
It includes algorithms like:</p></div>
<div class="ulist"><ul>
<li>
<p>
Shortest paths,
</p>
</li>
<li>
<p>
all paths,
</p>
</li>
<li>
<p>
all simple paths,
</p>
</li>
<li>
<p>
Dijkstra and
</p>
</li>
<li>
<p>
A*.
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="graph-algo-introduction">Introduction</h3>
<div class="paragraph"><p>The graph algorithms are found in the <span class="monospaced">neo4j-graph-algo</span> component, which is included in the standard Neo4j download.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphalgo/package-summary.html">Javadocs</a>
</p>
</li>
<li>
<p>
<a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.neo4j%22%20AND%20a%3A%22neo4j-graph-algo%22">Download</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/neo4j/neo4j/tree/master/community/graph-algo">Source code</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>For information on how to use neo4j-graph-algo as a dependency with Maven and other dependency management tools, see <span class="monospaced"><a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.neo4j%22%20AND%20a%3A%22neo4j-graph-algo%22">org.neo4j:neo4j-graph-algo</a></span>
Note that it should be used with the same version of <span class="monospaced"><a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.neo4j%22%20AND%20a%3A%22neo4j-kernel%22">org.neo4j:neo4j-kernel</a></span>.
Different versions of the graph-algo and kernel components are not compatible in the general case.
Both components are included transitively by the <span class="monospaced"><a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.neo4j%22%20AND%20a%3A%22neo4j%22">org.neo4j:neo4j</a></span> artifact which makes it simple to keep the versions in sync.</p></div>
<div class="paragraph"><p>The starting point to find and use graph algorithms is <span class="monospaced"><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphalgo/GraphAlgoFactory.html">GraphAlgoFactory</a></span>.</p></div>
<div class="paragraph"><p>For examples, see <a href="#tutorials-java-embedded-graph-algo">[tutorials-java-embedded-graph-algo]</a> (embedded database) and <a href="#rest-api-graph-algos">[rest-api-graph-algos]</a> (REST API).</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server">Neo4j Server</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="server-installation">Server Installation</h3>
<div class="paragraph"><p>Neo4j can be installed as a server, running either as a headless application or system service.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Download the latest release from <a href="http://neo4j.org/download">http://neo4j.org/download</a>
</p>
<div class="ulist"><ul>
<li>
<p>
select the appropriate version for your platform
</p>
</li>
</ul></div>
</li>
<li>
<p>
Extract the contents of the archive
</p>
<div class="ulist"><ul>
<li>
<p>
refer to the top-level extracted directory as <span class="monospaced">NEO4J_HOME</span>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Use the scripts in the <em>bin</em> directory
</p>
<div class="ulist"><ul>
<li>
<p>
for Linux/MacOS, run <span class="monospaced">$NEO4J_HOME/bin/neo4j start</span>
</p>
</li>
<li>
<p>
for Windows, double-click on <span class="monospaced">%NEO4J_HOME%\bin\Neo4j.bat</span>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Refer to the packaged information in the <em>doc</em> directory for details
</p>
</li>
</ol></div>
<div class="paragraph"><p>For information on High Availability, please refer to <a href="#ha">[ha]</a>.</p></div>
<div class="sect3">
<h4 id="_as_a_windows_service">As a Windows service</h4>
<div class="paragraph"><p>With administrative rights, Neo4j can be installed as a Windows service.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Click Start &#8594; All Programs &#8594; Accessories
</p>
</li>
<li>
<p>
Right click Command Prompt &#8594; Run as Administrator
</p>
</li>
<li>
<p>
Provide authorization and/or the Administrator password
</p>
</li>
<li>
<p>
Navigate to <span class="monospaced">%NEO4J_HOME%</span>
</p>
</li>
<li>
<p>
Run <span class="monospaced">bin\Neo4j.bat install</span>
</p>
</li>
</ol></div>
<div class="paragraph"><p>To uninstall, run <span class="monospaced">bin\Neo4j.bat remove</span> as Administrator.</p></div>
<div class="paragraph"><p>To query the status of the service, run <span class="monospaced">bin\Neo4j.bat status</span></p></div>
<div class="paragraph"><p>To start the service from the command prompt, run <span class="monospaced">bin\Neo4j.bat start</span></p></div>
<div class="paragraph"><p>To stop the service from the command prompt, run <span class="monospaced">bin\Neo4j.bat stop</span></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Some users have reported problems on Windows when using the ZoneAlarm firewall.
If you are having problems getting large responses from the server, or if Webadmin does not work, try disabling ZoneAlarm.
Contact ZoneAlarm support to get information on how to resolve this.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_linux_service">Linux Service</h4>
<div class="paragraph"><p>Neo4j can participate in the normal system startup and shutdown process.
The following procedure should work on most popular Linux distributions:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">cd $NEO4J_HOME</span>
</p>
</li>
<li>
<p>
<span class="monospaced">sudo ./bin/neo4j install</span>
</p>
<div class="paragraph"><p>if asked, enter your password to gain super-user privileges</p></div>
</li>
<li>
<p>
<span class="monospaced">service neo4j-service status</span>
</p>
<div class="paragraph"><p>should indicate that the server is not running</p></div>
</li>
<li>
<p>
<span class="monospaced">service neo4j-service start</span>
</p>
<div class="paragraph"><p>will start the server</p></div>
</li>
</ol></div>
<div class="paragraph"><p>During installation you will be given the option to select the user Neo4j will run as.
You will be asked to supply a username (defaulting to <span class="monospaced">neo4j</span>) and if that user is not present on the system it will be created as a system account and the <em>$NEO4J_HOME/data</em> directory will be <span class="monospaced">chown</span>'ed to that user.</p></div>
<div class="paragraph"><p>You are encouraged to create a dedicated user for running the service and for that reason it is suggested that you unpack the distribution package under <em>/opt</em> or your site specific optional packages directory.</p></div>
<div class="paragraph"><p>After installation you may have to do some platform specific configuration and performance tuning.
For that, refer to  <a href="#configuration-linux-notes">[configuration-linux-notes]</a>.</p></div>
<div class="paragraph"><p>To remove the server from the set of startup services, the proper command is</p></div>
<div class="paragraph"><p><span class="monospaced">service neo4j-service remove</span></p></div>
<div class="paragraph"><p>+
which will stop the server, if running, and remove it.</p></div>
<div class="paragraph"><p>Note that if you chose to create a new user account, on uninstall you will be prompted to remove it from the system.</p></div>
</div>
<div class="sect3">
<h4 id="_mac_osx">Mac OSX</h4>
<div class="sect4">
<h5 id="_via_homebrew">via Homebrew</h5>
<div class="paragraph"><p>Using <a href="http://mxcl.github.com/homebrew/">Homebrew</a>, to install the latest stable version of Neo4j Server, issue the following command:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">brew install neo4j &amp;&amp; neo4j start</pre></div>
<div class="paragraph"><p>This will get a Neo4j instance running on <a href="http://localhost:7474">http://localhost:7474</a>.
The installation files will reside in <span class="monospaced">ls /usr/local/Cellar/neo4j/community-{NEO4J_VERSION}/libexec/</span>&#8201;&#8212;&#8201;to tweak settings and symlink the database directory if desired.</p></div>
</div>
<div class="sect4">
<h5 id="_as_a_service">as a Service</h5>
<div class="paragraph"><p>Neo4j can be installed as a Mac launchd job:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">cd $NEO4J_HOME</span>
</p>
</li>
<li>
<p>
<span class="monospaced">./bin/neo4j install</span>
</p>
</li>
<li>
<p>
<span class="monospaced">launchctl list | grep neo</span>
</p>
<div class="paragraph"><p>should reveal the launchd "org.neo4j.server.7474" job for running the Neo4j Server</p></div>
</li>
<li>
<p>
<span class="monospaced">./bin/neo4j status</span>
</p>
<div class="paragraph"><p>should indicate that the server is running</p></div>
</li>
<li>
<p>
<span class="monospaced">launchctl stop org.neo4j.server.7474</span>
</p>
<div class="paragraph"><p>should stop the server.</p></div>
</li>
<li>
<p>
<span class="monospaced">launchctl start org.neo4j.server.7474</span>
</p>
<div class="paragraph"><p>should start the server again.</p></div>
</li>
</ol></div>
<div class="paragraph"><p>To remove the launchctl service, issue the command</p></div>
<div class="paragraph"><p><span class="monospaced">./bin/neo4j remove</span></p></div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_server_instances_on_one_machine">Multiple Server instances on one machine</h4>
<div class="paragraph"><p>Neo4j can be set up to run as several instances on one machine, providing for instance several databases for development.
To configure, install two instances of the Neo4j Server in two different directories following the steps outlined below.</p></div>
<div class="sect4">
<h5 id="_first_instance">First instance</h5>
<div class="paragraph"><p>First, create a directory to hold both database instances, and unpack the development instance:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">cd $INSTANCE_ROOT</span>
</p>
</li>
<li>
<p>
<span class="monospaced">mkdir -p neo4j</span>
</p>
</li>
<li>
<p>
<span class="monospaced">cd neo4j</span>
</p>
</li>
<li>
<p>
<span class="monospaced">tar -xvzf /path/to/neo4j-community.tar.gz</span>
</p>
</li>
<li>
<p>
<span class="monospaced">mv neo4j-community dev</span>
</p>
</li>
</ol></div>
<div class="paragraph"><p>Next, configure the instance by changing the following values in <em>dev/conf/neo4j-server.properties</em>, see even <a href="#security-server">[security-server]</a>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">org.neo4j.server.webserver.port=7474

# Uncomment the following if the instance will be accessed from a host other than localhost.
org.neo4j.server.webserver.address=0.0.0.0</pre></div>
<div class="paragraph"><p>Before running the Windows install or startup, change in <em>dev/conf/neo4j-wrapper.properties</em></p></div>
<div class="listingblock">
<pre class="programlisting brush: shell"># Name of the service for the first instance
wrapper.name=neo4j_1</pre></div>
<div class="paragraph"><p>Start the instance:</p></div>
<div class="paragraph"><p><span class="monospaced">dev/bin/neo4j start</span></p></div>
<div class="paragraph"><p>Check that instance is available by browsing to <a href="http://localhost:7474/webadmin/">http://localhost:7474/webadmin/</a></p></div>
</div>
<div class="sect4">
<h5 id="_second_instance_testing_development">Second instance (testing, development)</h5>
<div class="paragraph"><p>In many cases during application development, it is desirable to have one development database set up, and another against which to run unit tests.
For the following example, we are assuming that both databases will run on the same host.</p></div>
<div class="paragraph"><p>Now create the unit testing second instance:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">cd $INSTANCE_ROOT/neo4j</span>
</p>
</li>
<li>
<p>
<span class="monospaced">tar -xvzf /path/to/neo4j-community.tar.gz</span>
</p>
</li>
<li>
<p>
<span class="monospaced">mv neo4j-community test</span>
</p>
</li>
</ol></div>
<div class="paragraph"><p>Next, configure the instance by changing the following values in <em>test/conf/neo4j-server.properties</em> to</p></div>
<div class="ulist"><ul>
<li>
<p>
change the server port for HTTP to <span class="monospaced">7475</span> (and HTTPS to a port other than default if you are using it)
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: shell"># Note the different HTTP port number from the development instance
org.neo4j.server.webserver.port=7475

# Assign a different port number for HTTPS
org.neo4j.server.webserver.https.port=7464

# Uncomment the following if the instance will be accessed from a host other than localhost
org.neo4j.server.webserver.address=0.0.0.0</pre></div>
<div class="paragraph"><p>Differentiate the instance from the development instance by modifying <em>test/conf/neo4j-wrapper.properties</em>.</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">wrapper.name=neo4j-test</pre></div>
<div class="paragraph"><p>On Windows, you even need to change the name of the service in <em>bin\neo4j.bat</em> to be able to run it together with the first instance.</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">set serviceName=Neo4j-Server-test
set serviceDisplayName=Neo4j-Server-test</pre></div>
<div class="paragraph"><p>Start the instance:</p></div>
<div class="paragraph"><p><span class="monospaced">test/bin/neo4j start</span></p></div>
<div class="paragraph"><p>Check that instance is available by browsing to <a href="http://localhost:7475/webadmin/">http://localhost:7475/webadmin/</a></p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-configuration">Server Configuration</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick info</div>
<div class="ulist"><ul>
<li>
<p>
The server&#8217;s primary configuration file is found under <em>conf/neo4j-server.properties</em>
</p>
</li>
<li>
<p>
The <em>conf/log4j.properties</em> file contains the default server logging configuration
</p>
</li>
<li>
<p>
Low-level performance tuning parameters are found in <em>conf/neo4j.properties</em>
</p>
</li>
<li>
<p>
Configuraion of the deamonizing wrapper are found in <em>conf/neo4j-wrapper.properties</em>
</p>
</li>
<li>
<p>
HTTP logging configuration is found in <em>conf/neo4j-http-logging.xml</em>
</p>
</li>
</ul></div>
</div></div>
<div class="sect3">
<h4 id="_important_server_configurations_parameters">Important server configurations parameters</h4>
<div class="paragraph"><p>The main configuration file for the server can be found at <em>conf/neo4j-server.properties</em>.
This file contains several important settings, and although the defaults are sensible
administrators might choose to make changes (especially to the port settings).</p></div>
<div class="paragraph"><p>Set the location on disk of the database directory like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.database.location=data/graph.db</pre></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">On Windows systems, absolute locations including drive letters need to read <em>"c:/data/db"</em>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Specify the HTTP server port supporting data, administrative, and UI access:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.webserver.port=7474</pre></div>
<div class="paragraph"><p>Specify the client accept pattern for the webserver (default is <span class="monospaced">127.0.0.1</span>, localhost only):</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">#allow any client to connect
org.neo4j.server.webserver.address=0.0.0.0</pre></div>
<div class="paragraph"><p>For securing the Neo4j Server, see also <a href="#security-server">[security-server]</a></p></div>
<div class="paragraph"><p>Set the location of the round-robin database directory which gathers metrics on the running server instance:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.webadmin.rrdb.location=data/graph.db/../rrd</pre></div>
<div class="paragraph"><p>Set the URI path for the REST data API through which the database is accessed. This should be a relative path.</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.webadmin.data.uri=/db/data/</pre></div>
<div class="paragraph"><p>Setting the management URI for the administration API that the Webadmin tool uses. This should be a relative path.</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.webadmin.management.uri=/db/manage</pre></div>
<div class="paragraph"><p>Force the server to use IPv4 network addresses, in <em>conf/neo4j-wrapper.conf</em> under the section <em>Java Additional Parameters</em> add a new paramter:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">wrapper.java.additional.3=-Djava.net.preferIPv4Stack=true</pre></div>
<div class="paragraph"><p>Specify the number of threads used by the Neo4j Web server to control the level of concurrent HTTP requests that the server will service.</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.webserver.maxthreads=200</pre></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The default value is 10 times the number of CPUs reported available by the JVM.</td>
</tr></table>
</div>
<div class="paragraph"><p>Low-level performance tuning parameters can be explicitly set by referring
to the following property:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.db.tuning.properties=neo4j.properties</pre></div>
<div class="paragraph"><p>If this property isn&#8217;t set, the server will look for a file called <em>neo4j.properties</em> in
the same directory as the <em>neo4j-server.properties</em> file.</p></div>
<div class="paragraph"><p>If this property isn&#8217;t set, and there is no <em>neo4j.properties</em> file in the default
configuration directory, then the server will log a warning. Subsequently at runtime the
database engine will attempt tune itself based on the prevailing conditions.</p></div>
</div>
<div class="sect3">
<h4 id="_neo4j_database_performance_configuration">Neo4j Database performance configuration</h4>
<div class="paragraph"><p>The fine-tuning of the low-level Neo4j graph database engine is specified in a separate
properties file, <em>conf/neo4j.properties</em>.</p></div>
<div class="paragraph"><p>The graph database engine has a range of performance tuning options which are enumerated in
<a href="#server-performance">[server-performance]</a>. Note that other factors than Neo4j tuning should be considered
when performance tuning a server, including general server load, memory and file contention,
and even garbage collection penalties on the JVM, though such considerations are beyond the scope
of this configuration document.</p></div>
</div>
<div class="sect3">
<h4 id="_server_logging_configuration">Server logging configuration</h4>
<div class="paragraph"><p>Application events within Neo4j server are processed with
 <span class="monospaced"><a href="http://download.oracle.com/javase/6/docs/technotes/guides/logging/overview.html">java.util.logging</a></span> and
 configured in the file <em>conf/logging.properties</em>.</p></div>
<div class="paragraph"><p>By default it is setup to print <span class="monospaced">INFO</span> level messages both on screen and in a rolling file in <em>data/log</em>.
Most deployments will choose to use their own configuration here to meet local standards.
During development, much useful information can be found in the logs so some form of logging to disk is well worth keeping.
On the other hand, if you want to completely silence the console output, set:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">java.util.logging.ConsoleHandler.level=OFF</pre></div>
<div class="paragraph"><p>By default log files are rotated at approximately 10Mb and named consecutively neo4j.&lt;id&gt;.&lt;rotation sequence #&gt;.log
To change the naming scheme, rotation frequency and backlog size modify</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">java.util.logging.FileHandler.pattern
java.util.logging.FileHandler.limit
java.util.logging.FileHandler.count</pre></div>
<div class="paragraph"><p>respectively to your needs. Details are available at the Javadoc for <span class="monospaced"><a href="http://download.oracle.com/javase/6/docs/api/java/util/logging/FileHandler.html">java.util.logging.FileHandler</a></span>.</p></div>
<div class="paragraph"><p>Apart from log statements originating from the Neo4j server, other libraries report their messages
through various frameworks.</p></div>
<div class="paragraph"><p>Zookeeper is hardwired to use the log4j logging framework. The bundled <em>conf/log4j.properties</em> applies for this use only and uses a rolling appender and outputs logs by default to the
<em>data/log</em> directory.</p></div>
</div>
<div class="sect3">
<h4 id="_http_logging_configuration">HTTP logging configuration</h4>
<div class="paragraph"><p>As well as logging events happening within the Neo4j server, it is possible to log the HTTP requests and responses
that the server consumes and produces. Configuring HTTP logging requires operators to enable and configure the
logger and where it will log; and then to optionally configure the log format.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">By default the HTTP logger uses <span class="monospaced"><a href="http://en.wikipedia.org/wiki/Common_Log_Format">Common Log Format</a></span>
meaning that most Web server tooling can automtically consume such logs. In general users should only enable HTTP logging,
select an output directory, and if necessary alter the rollover and retention policies.</td>
</tr></table>
</div>
<div class="paragraph"><p>To enable HTTP logging, edit the <em>conf/neo4j-server.properties</em> file to resemble the following:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.http.log.enabled=true
org.neo4j.server.http.log.config=conf/neo4j-http-logging.xml</pre></div>
<div class="paragraph"><p><em>org.neo4j.server.http.log.enabled=true</em> tells the server that HTTP logging is enabled. HTTP logging can be totally
disabled by setting this property to <em>false</em>.
<em>org.neo4j.server.http.log.config=conf/neo4j-http-logging.xml</em> specifies the logging format and rollover policy file
that governs how HTTP log output is presented and archived. The defaults provided with Neo4j server uses an hourly log
rotation and <span class="monospaced"><a href="http://en.wikipedia.org/wiki/Common_Log_Format">Common Log Format</a></span>.</p></div>
<div class="paragraph"><p>If logging is set up to use log files then the server will check that the log file directory exists and is writable. If
this check fails, then the server will not startup and wil report the failure another available channel like standard out.</p></div>
</div>
<div class="sect3">
<h4 id="_using_x_forwarded_proto_and_x_forwarded_host_to_parameterize_the_base_uri_for_rest_responses">Using X-Forwarded-Proto and X-Forwarded-Host to parameterize the base URI for REST responses</h4>
<div class="paragraph"><p>There are occasions, for example when you want to host Neo4j server behind a proxy (e.g. one that handles HTTPS traffic),
and still have Neo4j respect the base URI of that externally visible proxy.</p></div>
<div class="paragraph"><p>Ordinarily Neo4j uses the <span class="monospaced">HOST</span> header of the HTTP request to construct URIs in its responses. Where a proxy is involved
however, this is often undesirable. Instead Neo4j, uses the
<span class="monospaced">X-Forwarded-Host</span> and <span class="monospaced">X-Forwarded-Proto</span> headers provided by proxies to parameterize the URIs in the responses from
the databases&#8217;s REST API. From the outside it looks as if the proxy generated that payload. If an <span class="monospaced">X-Forwarded-Host</span>
header value contains more than one address (<span class="monospaced">X-Forwarded-Host</span> allows comma-and-space separated lists of addresses),
Neo4j picks the first, which represents the client request.</p></div>
<div class="paragraph"><p>In order to take advantage of this functionality, your proxy server must be configured to transmit these headers to the
Neo4j server. Failure to transmit both <span class="monospaced">X-Forwarded-Host</span> and <span class="monospaced">X-Forwarded-Proto</span> headers will result in the original
base URI being used.</p></div>
</div>
<div class="sect3">
<h4 id="_other_configuration_options">Other configuration options</h4>
<div class="sect4">
<h5 id="_enabling_logging_from_the_garbage_collector">Enabling logging from the garbage collector</h5>
<div class="paragraph"><p>To get garbage collection logging output you have to pass the corresponding option to the server JVM
executable by setting in <em>conf/neo4j-wrapper.conf</em> the value</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">wrapper.java.additional.3=-Xloggc:data/log/neo4j-gc.log</pre></div>
<div class="paragraph"><p>This line is already present and needs uncommenting. Note also that logging is not directed to console ;
You will find the logging statements in <em>data/log/ne4j-gc.log</em> or whatever directory you set at the option.</p></div>
</div>
<div class="sect4">
<h5 id="_disabling_console_types_in_webadmin">Disabling console types in Webadmin</h5>
<div class="paragraph"><p>You may, for security reasons, want to disable the the Neo4j Shell in Webadmin.
Shells allow arbitrary code execution, and so they could constitute a security risk if you do not trust all users of your Neo4j Server.</p></div>
<div class="paragraph"><p>In the <em>conf/neo4j-server.properties</em> file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"># To disable all shells:
org.neo4j.server.manage.console_engines=

# To enable only the Neo4j Shell:
org.neo4j.server.manage.console_engines=shell</pre></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-debugging">Setup for remote debugging</h3>
<div class="paragraph"><p>In order to configure the Neo4j server for remote debugging sessions, the Java debugging
parameters need to be passed to the Java process through the configuration.
They live in the <em>conf/neo4j-wrapper.properties</em> file.</p></div>
<div class="paragraph"><p>In order to specify the parameters, add a line for the additional Java arguments like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell"># Java Additional Parameters
wrapper.java.additional.1=-Dorg.neo4j.server.properties=conf/neo4j-server.properties
wrapper.java.additional.2=-Dlog4j.configuration=file:conf/log4j.properties
wrapper.java.additional.3=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 \
   -Xdebug-Xnoagent-Djava.compiler=NONE\
   -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005</pre></div>
<div class="paragraph"><p>This configuration will start a Neo4j server ready for remote debugging attachement at localhost and port <span class="monospaced">5005</span>.
Use these parameters to attach to the process from Eclipse, IntelliJ or your remote debugger of choice after starting the server.</p></div>
</div>
<div class="sect2">
<h3 id="server-performance">Server Performance Tuning</h3>
<div class="paragraph"><p>At the heart of the Neo4j server is a regular Neo4j storage engine instance.
That engine can be tuned in the same way as the other embedded configurations, using the same file format.
The only difference is that the server must be told where to find the fine-tuning configuration.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick info</div>
<div class="ulist"><ul>
<li>
<p>
The neo4j.properties file is a standard configuration file that databases load in order to tune their memory use and caching strategies.
</p>
</li>
<li>
<p>
See <a href="#configuration-caches">[configuration-caches]</a> for more information.
</p>
</li>
</ul></div>
</div></div>
<div class="sect3">
<h4 id="_specifying_neo4j_tuning_properties">Specifying Neo4j tuning properties</h4>
<div class="paragraph"><p>The <span class="monospaced">conf/neo4j-server.properties</span> file in the server distribution, is the main configuration file for the server.
In this file we can specify a second properties file that contains the database tuning settings (that is, the <span class="monospaced">neo4j.properties</span> file).
This is done by setting a single property to point to a valid <span class="monospaced">neo4j.properties</span> file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.db.tuning.properties={neo4j.properties file}</pre></div>
<div class="paragraph"><p>On restarting the server the tuning enhancements specified in the <span class="monospaced">neo4j.properties</span> file will be loaded and configured into the underlying database engine.</p></div>
</div>
<div class="sect3">
<h4 id="_specifying_jvm_tuning_properties">Specifying JVM tuning properties</h4>
<div class="paragraph"><p>Tuning the standalone server is achieved by editing the <span class="monospaced">neo4j-wrapper.conf</span> file in the <span class="monospaced">conf</span> directory of <span class="monospaced">NEO4J_HOME</span>.</p></div>
<div class="paragraph"><p>Edit the following properties:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 4. neo4j-wrapper.conf JVM tuning properties</caption>
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Property Name             </th>
<th class="tableblock halign-left valign-top" > Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">wrapper.java.initmemory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">initial heap size (in MB)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">wrapper.java.maxmemory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">maximum heap size (in MB)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">wrapper.java.additional.N</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">additional literal JVM parameter, where N is a number for each</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>For more information on the tuning properties, see <a href="#configuration-jvm">[configuration-jvm]</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="server-installation-cloud">Server Installation in the Cloud</h3>
<div class="paragraph"><p>Neo4j on various cloud services either by a user, or as a managed instance on the Neo Technology cloud fabric. Below are instructions for some of these.</p></div>
<div class="sect3">
<h4 id="_heroku">Heroku</h4>
<div class="paragraph"><p>For the basic setup, please see the <a href="https://devcenter.heroku.com/articles/quickstart">Heroku Quickstart tutorial</a>.</p></div>
<div class="paragraph"><p>To add Neo4j to your Heroku app, do:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">heroku addons:add neo4j</pre></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rest-api">REST API</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Neo4j REST API is designed with discoverability in mind, so that you can start with a <span class="monospaced">GET</span> on the <a href="#rest-api-service-root">[rest-api-service-root]</a> and from there discover URIs to perform other requests.
The examples below uses URIs in the examples; they are subject to change in the future, so for future-proofness <em>discover URIs where possible</em>, instead of relying on the current layout.
The default representation is <a href="http://www.json.org/">json</a>, both for responses and for data sent with <span class="monospaced">POST</span>/<span class="monospaced">PUT</span> requests.</p></div>
<div class="paragraph"><p>Below follows a listing of ways to interact with the REST API. For language bindings to the REST API, see <a href="#tutorials-rest">[tutorials-rest]</a>.</p></div>
<div class="paragraph"><p>To interact with the JSON interface you must explicitly set the request header <span class="monospaced">Accept:application/json</span> for those requests that responds with data.
You should also set the header <span class="monospaced">Content-Type:application/json</span> if your request sends data, for example when you&#8217;re creating a relationship.
The examples include the relevant request and response headers.</p></div>
<div class="paragraph"><p>The server supports streaming results, with better performance and lower memory overhead.
See <a href="#rest-api-streaming">[rest-api-streaming]</a> for more information.</p></div>
<div class="sect2">
<h3 id="rest-api-transactional">Transactional HTTP endpoint</h3>
<div class="paragraph"><p>The Neo4j transactional HTTP endpoint allows you to execute a series of Cypher statements within the scope of a
transaction. The transaction may be kept open across multiple HTTP requests, until the client chooses to commit or roll
back. Each HTTP request can include a list of statements, and for convenience you can include statements along with a
request to begin or commit a transaction.</p></div>
<div class="paragraph"><p>The server guards against orphaned transactions by using a timeout. If there are no requests for a given transaction
within the timeout period, the server will roll it back. You can configure the timeout in the server configuration, by
setting <em>org.neo4j.server.transaction.timeout</em> to the number of seconds before timeout. The default timeout is 60
seconds.</p></div>
<div class="paragraph"><p>The key difference between the transactional HTTP endpoint and the <a href="#rest-api-cypher">cypher endpoint</a> is the ability to
use the same transaction across multiple HTTP requests. The cypher endpoint always attempts to commit a transaction at
the end of each HTTP request.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This is a new feature in the API, and is still experimental. Expect this API to change without notice, until this note
is removed.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The serialization format for cypher results is mostly the same as the <a href="#rest-api-cypher">cypher endpoint</a>.
However, the format for raw entities is slightly less verbose and does not include hypermedia links.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Open transactions are not shared among members of an HA cluster. Therefore, if you use this endpoint in an HA cluster,
you must ensure that all requests for a given transaction are sent to the same Neo4j instance.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In order to speed up queries in repeated scenarios, try not to use literals but replace them with parameters wherever
possible in order to let the server cache query plans.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="rest-api-begin-a-transaction">Begin a transaction</h4>
<div class="paragraph"><p>You begin a new transaction by posting zero or more cypher statements
to the transaction endpoint. The server will respond with the result of
your statements, as well as the location of your open transaction.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/transaction</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "statements" : [ {
    "statement" : "CREATE (n {props}) RETURN n",
    "parameters" : {
      "props" : {
        "name" : "My Node"
      }
    }
  } ]
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/transaction/4</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "commit" : "http://localhost:7474/db/data/transaction/4/commit",
  "results" : [ {
    "columns" : [ "n" ],
    "data" : [ [ {
      "name" : "My Node"
    } ] ]
  } ],
  "errors" : [ ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-execute-statements-in-an-open-transaction">Execute statements in an open transaction</h4>
<div class="paragraph"><p>Given that you have an open transaction, you can make a number of requests, each of which executes additional
statements, and keeps the transaction open.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/transaction/6</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "statements" : [ {
    "statement" : "CREATE n RETURN n"
  } ]
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "commit" : "http://localhost:7474/db/data/transaction/6/commit",
  "results" : [ {
    "columns" : [ "n" ],
    "data" : [ [ {
    } ] ]
  } ],
  "errors" : [ ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-commit-an-open-transaction">Commit an open transaction</h4>
<div class="paragraph"><p>Given you have an open transaction, you can send a commit request. Optionally, you submit additional statements
along with the request that will be executed before committing the transaction.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/transaction/2/commit</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "statements" : [ {
    "statement" : "CREATE n RETURN id(n)"
  } ]
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "results" : [ {
    "columns" : [ "id(n)" ],
    "data" : [ [ 2 ] ]
  } ],
  "errors" : [ ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-rollback-an-open-transaction">Rollback an open transaction</h4>
<div class="paragraph"><p>Given that you have an open transaction, you can send a roll back request. The server will roll back the
transaction.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/transaction/1</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "results" : [ ],
  "errors" : [ ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-begin-and-commit-a-transaction-in-one-request">Begin and commit a transaction in one request</h4>
<div class="paragraph"><p>If there is no need to keep a transaction open across multiple HTTP requests, you can begin a transaction,
execute statements, and commit with just a single HTTP request.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/transaction/commit</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "statements" : [ {
    "statement" : "CREATE n RETURN id(n)"
  } ]
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "results" : [ {
    "columns" : [ "id(n)" ],
    "data" : [ [ 3 ] ]
  } ],
  "errors" : [ ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-handling-errors">Handling errors</h4>
<div class="paragraph"><p>The result of any request against the transaction endpoint is streamed back to the client.
Therefore the server does not know whether the request will be successful or not when it sends the HTTP status
code.</p></div>
<div class="paragraph"><p>Because of this, all requests against the transactional endpoint will return 200 or 201 status code, regardless
of whether statements were successfully executed. At the end of the response payload, the server includes a list
of errors that occurred while executing statements. If this list is empty, the request completed successfully.</p></div>
<div class="paragraph"><p>If any errors occur while executing statements, the server will roll back the transaction.</p></div>
<div class="paragraph"><p>In this example, we send the server an invalid statement to demonstrate error handling.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/transaction/5/commit</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "statements" : [ {
    "statement" : "This is not a valid Cypher Statement."
  } ]
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "results" : [ ],
  "errors" : [ {
    "code" : 42001,
    "status" : "STATEMENT_SYNTAX_ERROR",
    "message" : "Syntax error in statement. Cause: invalid start of query\n\"This is not a valid Cypher Statement.\"\n ^"
  } ]
}</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-service-root">Service root</h3>
<div class="sect3">
<h4 id="rest-api-get-service-root">Get service root</h4>
<div class="paragraph"><p>The service root is your starting point to discover the REST API. It
contains the basic starting points for the database, and some version and
extension information. The <span class="monospaced">reference_node</span> entry will only be present if
there is a reference node set and that node actually exists in the
database.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-service-root.svg" alt="Final-Graph-Get-service-root.svg">
</div>
<div class="title">Figure 51. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "node" : "http://localhost:7474/db/data/node",
  "reference_node" : "http://localhost:7474/db/data/node/367",
  "node_index" : "http://localhost:7474/db/data/index/node",
  "relationship_index" : "http://localhost:7474/db/data/index/relationship",
  "extensions_info" : "http://localhost:7474/db/data/ext",
  "relationship_types" : "http://localhost:7474/db/data/relationship/types",
  "batch" : "http://localhost:7474/db/data/batch",
  "cypher" : "http://localhost:7474/db/data/cypher",
  "transaction" : "http://localhost:7474/db/data/transaction",
  "neo4j_version" : "1.9.M02-1087-g4c7dcab"
}</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-streaming">Streaming</h3>
<div class="paragraph"><p>The whole REST API can be transmitted as JSON streams, resulting in
better performance and lower memory overhead on the server side. To use
it, adjust the request headers for every call, see the example below for
details.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">This feature is new, and you should make yourself comfortable
with the streamed response style versus the non-streamed API where
results are delivered in a single large response. Expect future releases
to have streaming enabled by default since it is a far more efficient
mechanism for both client and server.</td>
</tr></table>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-streaming.svg" alt="Final-Graph-streaming.svg">
</div>
<div class="title">Figure 52. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">X-Stream:</span></strong> <span class="monospaced">true</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json; stream=true</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "node" : "http://localhost:7474/db/data/node",
  "reference_node" : "http://localhost:7474/db/data/node/369",
  "node_index" : "http://localhost:7474/db/data/index/node",
  "relationship_index" : "http://localhost:7474/db/data/index/relationship",
  "extensions_info" : "http://localhost:7474/db/data/ext",
  "relationship_types" : "http://localhost:7474/db/data/relationship/types",
  "batch" : "http://localhost:7474/db/data/batch",
  "cypher" : "http://localhost:7474/db/data/cypher",
  "transaction" : "http://localhost:7474/db/data/transaction",
  "neo4j_version" : "1.9.M02-1087-g4c7dcab"
}</pre></div>
</div>
<div class="sect2">
<h3 id="rest-api-cypher">Cypher queries</h3>
<div class="paragraph"><p>The Neo4j REST API allows querying with Cypher, see <a href="#cypher-query-lang">[cypher-query-lang]</a>.
The results are returned as a list of string headers (<span class="monospaced">columns</span>), and a <span class="monospaced">data</span> part,
consisting of a list of all rows, every row consisting of a list of REST representations
of the field value&#8201;&#8212;&#8201;<span class="monospaced">Node</span>, <span class="monospaced">Relationship</span>, <span class="monospaced">Path</span> or any simple value like <span class="monospaced">String</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In order to speed up queries in repeated scenarios, try not to use literals but replace them with parameters wherever possible in order to let the server cache query plans, see <a href="#rest-api-send-queries-with-parameters">[rest-api-send-queries-with-parameters]</a> for details.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="rest-api-send-queries-with-parameters">Send queries with parameters</h4>
<div class="paragraph"><p>Cypher supports queries with parameters
which are submitted as a JSON map.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START x  = node:node_auto_index(name={startName})
MATCH path = (x-[r]-friend)
WHERE friend.name = {name}
RETURN TYPE(r)</pre></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-send-queries-with-parameters.svg" alt="Final-Graph-send-queries-with-parameters.svg">
</div>
<div class="title">Figure 53. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/cypher</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "query" : "start x  = node:node_auto_index(name={startName}) match path = (x-[r]-friend) where friend.name = {name} return TYPE(r)",
  "params" : {
    "startName" : "I",
    "name" : "you"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "columns" : [ "TYPE(r)" ],
  "data" : [ [ "know" ] ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-send-a-query">Send a Query</h4>
<div class="paragraph"><p>A simple query returning all nodes connected to node 1, returning the
node and the name property, if it exists, otherwise <span class="monospaced">null</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START x  = node(339)
MATCH x -[r]-&gt; n
RETURN type(r), n.name?, n.age?</pre></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Send-a-Query.svg" alt="Final-Graph-Send-a-Query.svg">
</div>
<div class="title">Figure 54. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/cypher</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "query" : "start x  = node(339) match x -[r]-&gt; n return type(r), n.name?, n.age?",
  "params" : {
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "columns" : [ "type(r)", "n.name?", "n.age?" ],
  "data" : [ [ "know", "him", 25 ], [ "know", "you", null ] ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-return-paths">Return paths</h4>
<div class="paragraph"><p>Paths can be returned
together with other return types by just
specifying returns.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START x  = node(344)
MATCH path = (x--friend)
RETURN path, friend.name</pre></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-return-paths.svg" alt="Final-Graph-return-paths.svg">
</div>
<div class="title">Figure 55. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/cypher</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "query" : "start x  = node(344) match path = (x--friend) return path, friend.name",
  "params" : {
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "columns" : [ "path", "friend.name" ],
  "data" : [ [ {
    "start" : "http://localhost:7474/db/data/node/344",
    "nodes" : [ "http://localhost:7474/db/data/node/344", "http://localhost:7474/db/data/node/343" ],
    "length" : 1,
    "relationships" : [ "http://localhost:7474/db/data/relationship/198" ],
    "end" : "http://localhost:7474/db/data/node/343"
  }, "you" ] ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-nested-results">Nested results</h4>
<div class="paragraph"><p>When sending queries that
return nested results like list and maps,
these will get serialized into nested JSON representations
according to their types.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n = node(341,340)
RETURN collect(n.name)</pre></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-nested-results.svg" alt="Final-Graph-nested-results.svg">
</div>
<div class="title">Figure 56. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/cypher</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "query" : "start n = node(341,340) return collect(n.name)",
  "params" : {
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "columns" : [ "collect(n.name)" ],
  "data" : [ [ [ "I", "you" ] ] ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-retrieve-query-meta-data">Retrieve query meta data</h4>
<div class="paragraph"><p>By passing in an additional GET header when you execute cypher queries, meta data about the query will
be returned, such as how many labels were added or removed by the query.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n = node(342)
SET n:foo
REMOVE n:bar
RETURN labels(n)</pre></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Retrieve-query-meta-data.svg" alt="Final-Graph-Retrieve-query-meta-data.svg">
</div>
<div class="title">Figure 57. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/cypher?includeStats=true</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "query" : "start n = node(342) set n:foo remove n:bar return labels(n)",
  "params" : {
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "columns" : [ "labels(n)" ],
  "data" : [ [ [ "foo" ] ] ],
  "stats" : {
    "relationships_created" : 0,
    "nodes_deleted" : 0,
    "relationship_deleted" : 0,
    "properties_set" : 0,
    "labels_removed" : 1,
    "labels_added" : 1,
    "nodes_created" : 0,
    "contains_updates" : true
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-profile-a-query">Profile a query</h4>
<div class="paragraph"><p>By passing in an extra parameter, you can ask the cypher executor to return a profile of the query
as it is executed. This can help in locating bottlenecks.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START x  = node(334)
MATCH x -[r]-&gt; n
RETURN type(r), n.name?, n.age?</pre></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Profile-a-query.svg" alt="Final-Graph-Profile-a-query.svg">
</div>
<div class="title">Figure 58. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/cypher?profile=true</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "query" : "start x  = node(334) match x -[r]-&gt; n return type(r), n.name?, n.age?",
  "params" : {
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "columns" : [ "type(r)", "n.name?", "n.age?" ],
  "data" : [ [ "know", "him", 25 ], [ "know", "you", null ] ],
  "plan" : {
    "args" : {
      "returnItemNames" : [ "type(r)", "n.name?", "n.age?" ],
      "_rows" : 2,
      "_db_hits" : 0,
      "symKeys" : [ "x", "n", "n.name?", "n.age?", "type(r)", "r" ]
    },
    "dbHits" : 0,
    "name" : "ColumnFilter",
    "children" : [ {
      "args" : {
        "_rows" : 2,
        "_db_hits" : 4,
        "exprKeys" : [ "type(r)", "n.name?", "n.age?" ],
        "symKeys" : [ "n", "x", "r" ]
      },
      "dbHits" : 4,
      "name" : "Extract",
      "children" : [ {
        "args" : {
          "trail" : "(x)-[r WHERE true AND true]-&gt;(n)",
          "_rows" : 2,
          "_db_hits" : 3
        },
        "dbHits" : 3,
        "name" : "TraversalMatcher",
        "children" : [ ],
        "rows" : 2
      } ],
      "rows" : 2
    } ],
    "rows" : 2
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-server-errors">Server errors</h4>
<div class="paragraph"><p>Errors on the server will be reported as a JSON-formatted stacktrace and
message.</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START x = node(324)
RETURN x.dummy</pre></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Server-errors.svg" alt="Final-Graph-Server-errors.svg">
</div>
<div class="title">Figure 59. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/cypher</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "query" : "start x = node(324) return x.dummy",
  "params" : {
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">400:</span></strong> <span class="monospaced">Bad Request</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "message": "The property \u0027dummy\u0027 does not exist on Node[324]",
  "exception": "EntityNotFoundException",
  "fullname": "org.neo4j.cypher.EntityNotFoundException",
  "stacktrace": [
    "org.neo4j.cypher.internal.helpers.MapSupport$PropertyContainerMap$$anonfun$apply$1.apply(MapSupport.scala:67)",
    "org.neo4j.cypher.internal.helpers.MapSupport$PropertyContainerMap$$anonfun$apply$1.apply(MapSupport.scala:67)",
    "scala.Option.getOrElse(Option.scala:120)",
    "org.neo4j.cypher.internal.helpers.MapSupport$PropertyContainerMap.apply(MapSupport.scala:67)",
    "org.neo4j.cypher.internal.helpers.MapSupport$PropertyContainerMap.apply(MapSupport.scala:52)",
    "org.neo4j.cypher.internal.commands.expressions.Property.apply(Property.scala:31)",
    "org.neo4j.cypher.internal.pipes.ExtractPipe$$anonfun$internalCreateResults$1$$anonfun$apply$1.apply(ExtractPipe.scala:47)",
    "org.neo4j.cypher.internal.pipes.ExtractPipe$$anonfun$internalCreateResults$1$$anonfun$apply$1.apply(ExtractPipe.scala:45)",
    "scala.collection.immutable.Map$Map1.foreach(Map.scala:109)",
    "org.neo4j.cypher.internal.pipes.ExtractPipe$$anonfun$internalCreateResults$1.apply(ExtractPipe.scala:45)",
    "org.neo4j.cypher.internal.pipes.ExtractPipe$$anonfun$internalCreateResults$1.apply(ExtractPipe.scala:44)",
    "scala.collection.Iterator$$anon$11.next(Iterator.scala:328)",
    "scala.collection.Iterator$$anon$11.next(Iterator.scala:328)",
    "org.neo4j.cypher.internal.ClosingIterator$$anonfun$next$1.apply(ClosingIterator.scala:44)",
    "org.neo4j.cypher.internal.ClosingIterator.failIfThrows(ClosingIterator.scala:84)",
    "org.neo4j.cypher.internal.ClosingIterator.next(ClosingIterator.scala:43)",
    "org.neo4j.cypher.PipeExecutionResult.next(PipeExecutionResult.scala:135)",
    "org.neo4j.cypher.PipeExecutionResult.next(PipeExecutionResult.scala:32)",
    "scala.collection.Iterator$$anon$11.next(Iterator.scala:328)",
    "scala.collection.convert.Wrappers$IteratorWrapper.next(Wrappers.scala:30)",
    "org.neo4j.helpers.collection.ExceptionHandlingIterable$1.next(ExceptionHandlingIterable.java:67)",
    "org.neo4j.helpers.collection.IteratorWrapper.next(IteratorWrapper.java:47)",
    "org.neo4j.server.rest.repr.ListRepresentation.serialize(ListRepresentation.java:58)",
    "org.neo4j.server.rest.repr.Serializer.serialize(Serializer.java:75)",
    "org.neo4j.server.rest.repr.MappingSerializer.putList(MappingSerializer.java:61)",
    "org.neo4j.server.rest.repr.CypherResultRepresentation.serialize(CypherResultRepresentation.java:79)",
    "org.neo4j.server.rest.repr.MappingRepresentation.serialize(MappingRepresentation.java:42)",
    "org.neo4j.server.rest.repr.OutputFormat.assemble(OutputFormat.java:179)",
    "org.neo4j.server.rest.repr.OutputFormat.formatRepresentation(OutputFormat.java:131)",
    "org.neo4j.server.rest.repr.OutputFormat.response(OutputFormat.java:117)",
    "org.neo4j.server.rest.repr.OutputFormat.ok(OutputFormat.java:55)",
    "org.neo4j.server.rest.web.CypherService.cypher(CypherService.java:95)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-property-values">Property values</h3>
<div class="paragraph"><p>The REST API allows setting properties on nodes and relationships through direct RESTful operations. However, there are
restrictions as to what types of values can be used as property values. Allowed value types are as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
Numbers: Both integer values, with capacity as Java&#8217;s Long type, and floating points, with capacity as Java&#8217;s Double.
</p>
</li>
<li>
<p>
Booleans
</p>
</li>
<li>
<p>
Strings
</p>
</li>
<li>
<p>
Arrays: Of the above basic types
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_arrays">Arrays</h4>
<div class="paragraph"><p>There are two important points to be made about array values. First, all values in the array must be of the same type.
That means either all integers, all floats, all booleans or all strings. Mixing types is not currently
supported.</p></div>
<div class="paragraph"><p>Second, storing empty arrays is only possible given certain preconditions. Because the JSON transfer format does not
contain type information for arrays, type is inferred from the values in the array. If the array is empty, the Neo4j
Server cannot determine the type. In these cases, it will check if an array is already stored for the given property,
and will use the stored arrays type when storing the empty array. If no array exists already, the server will reject
the request.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-nodes">Nodes</h3>
<div class="sect3">
<h4 id="rest-api-create-node">Create node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-create-node.svg" alt="Final-Graph-create-node.svg">
</div>
<div class="title">Figure 60. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/node/9</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/9/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/9/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/9/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/9/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/9",
  "property" : "http://localhost:7474/db/data/node/9/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/9/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/9/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/9/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/9/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/9/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/9/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/9/relationships/in/{-list|&amp;|types}",
  "data" : {
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-node-with-properties">Create node with properties</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-create-node-with-properties.svg" alt="Final-Graph-create-node-with-properties.svg">
</div>
<div class="title">Figure 61. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "foo" : "bar"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Length:</span></strong> <span class="monospaced">1156</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/node/5</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/5/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/5/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/5/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/5/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/5",
  "property" : "http://localhost:7474/db/data/node/5/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/5/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/5/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/5/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/5/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/5/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/5/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/5/relationships/in/{-list|&amp;|types}",
  "data" : {
    "foo" : "bar"
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-node">Get node</h4>
<div class="paragraph"><p>Note that the response contains URI/templates for the available
operations for getting properties and relationships.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-node.svg" alt="Final-Graph-Get-node.svg">
</div>
<div class="title">Figure 62. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/372</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/372/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/372/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/372/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/372/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/372",
  "property" : "http://localhost:7474/db/data/node/372/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/372/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/372/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/372/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/372/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/372/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/372/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/372/relationships/in/{-list|&amp;|types}",
  "data" : {
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-non-existent-node">Get non-existent node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-non-existent-node.svg" alt="Final-Graph-Get-non-existent-node.svg">
</div>
<div class="title">Figure 63. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/37600000</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">404:</span></strong> <span class="monospaced">Not Found</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "message": "Cannot find node with id [37600000] in database.",
  "exception": "NodeNotFoundException",
  "fullname": "org.neo4j.server.rest.web.NodeNotFoundException",
  "stacktrace": [
    "org.neo4j.server.rest.web.DatabaseActions.node(DatabaseActions.java:167)",
    "org.neo4j.server.rest.web.DatabaseActions.getNode(DatabaseActions.java:228)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.getNode(RestfulGraphDatabase.java:255)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-delete-node">Delete node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Delete-node.svg" alt="Final-Graph-Delete-node.svg">
</div>
<div class="title">Figure 64. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/6</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-nodes-with-relationships-can-not-be-deleted">Nodes with relationships can not be deleted</h4>
<div class="paragraph"><p>The relationships on a node has to be deleted before the node can be
deleted.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Nodes-with-relationships-can-not-be-deleted.svg" alt="Final-Graph-Nodes-with-relationships-can-not-be-deleted.svg">
</div>
<div class="title">Figure 65. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/13</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">409:</span></strong> <span class="monospaced">Conflict</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "message": "The node with id 13 cannot be deleted. Check that the node is orphaned before deletion.",
  "exception": "OperationFailureException",
  "fullname": "org.neo4j.server.rest.web.OperationFailureException",
  "stacktrace": [
    "org.neo4j.server.rest.web.DatabaseActions.deleteNode(DatabaseActions.java:249)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.deleteNode(RestfulGraphDatabase.java:269)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-relationships">Relationships</h3>
<div class="paragraph"><p>Relationships are a first class citizen in the Neo4j REST API. They can be accessed either
stand-alone or through the nodes they are attached to.</p></div>
<div class="paragraph"><p>The general pattern to get relationships from a node is:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">GET http://localhost:7474/db/data/node/123/relationships/{dir}/{-list|&amp;|types}</pre></div>
<div class="paragraph"><p>Where <span class="monospaced">dir</span> is one of <span class="monospaced">all</span>, <span class="monospaced">in</span>, <span class="monospaced">out</span> and <span class="monospaced">types</span> is an ampersand-separated list of types.
See the examples below for more information.</p></div>
<div class="sect3">
<h4 id="rest-api-get-relationship-by-id">Get Relationship by ID</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-get-Relationship-by-ID.svg" alt="Final-Graph-get-Relationship-by-ID.svg">
</div>
<div class="title">Figure 66. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/9</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/20",
  "property" : "http://localhost:7474/db/data/relationship/9/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/9",
  "properties" : "http://localhost:7474/db/data/relationship/9/properties",
  "type" : "know",
  "end" : "http://localhost:7474/db/data/node/19",
  "data" : {
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-relationship">Create relationship</h4>
<div class="paragraph"><p>Upon successful creation of a relationship, the new relationship is
returned.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Create-relationship.svg" alt="Final-Graph-Create-relationship.svg">
</div>
<div class="title">Figure 67. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/7/relationships</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "to" : "http://localhost:7474/db/data/node/6",
  "type" : "LOVES"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/relationship/1</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/7",
  "property" : "http://localhost:7474/db/data/relationship/1/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/1",
  "properties" : "http://localhost:7474/db/data/relationship/1/properties",
  "type" : "LOVES",
  "end" : "http://localhost:7474/db/data/node/6",
  "data" : {
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-a-relationship-with-properties">Create a relationship with properties</h4>
<div class="paragraph"><p>Upon successful creation of a relationship, the new relationship is
returned.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Starting-Graph-Add-relationship-with-properties-before.svg" alt="Starting-Graph-Add-relationship-with-properties-before.svg">
</div>
<div class="title">Figure 68. Starting Graph</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Create-a-relationship-with-properties.svg" alt="Final-Graph-Create-a-relationship-with-properties.svg">
</div>
<div class="title">Figure 69. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/17/relationships</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "to" : "http://localhost:7474/db/data/node/16",
  "type" : "LOVES",
  "data" : {
    "foo" : "bar"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/relationship/8</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/17",
  "property" : "http://localhost:7474/db/data/relationship/8/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/8",
  "properties" : "http://localhost:7474/db/data/relationship/8/properties",
  "type" : "LOVES",
  "end" : "http://localhost:7474/db/data/node/16",
  "data" : {
    "foo" : "bar"
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-delete-relationship">Delete relationship</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Starting-Graph-Delete-relationship1.svg" alt="Starting-Graph-Delete-relationship1.svg">
</div>
<div class="title">Figure 70. Starting Graph</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Delete-relationship.svg" alt="Final-Graph-Delete-relationship.svg">
</div>
<div class="title">Figure 71. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/2</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-all-properties-on-a-relationship">Get all properties on a relationship</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-get-all-properties-on-a-relationship.svg" alt="Final-Graph-get-all-properties-on-a-relationship.svg">
</div>
<div class="title">Figure 72. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/5/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "since" : "1day",
  "cost" : "high"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-set-all-properties-on-a-relationship">Set all properties on a relationship</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Starting-Graph-Set-relationship-property1.svg" alt="Starting-Graph-Set-relationship-property1.svg">
</div>
<div class="title">Figure 73. Starting Graph</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-set-all-properties-on-a-relationship.svg" alt="Final-Graph-set-all-properties-on-a-relationship.svg">
</div>
<div class="title">Figure 74. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">PUT</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/10/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "happy" : false
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-single-property-on-a-relationship">Get single property on a relationship</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-get-single-property-on-a-relationship.svg" alt="Final-Graph-get-single-property-on-a-relationship.svg">
</div>
<div class="title">Figure 75. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/6/properties/cost</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">"high"</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-set-single-property-on-a-relationship">Set single property on a relationship</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Starting-Graph-Set-relationship-property1.svg" alt="Starting-Graph-Set-relationship-property1.svg">
</div>
<div class="title">Figure 76. Starting Graph</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-set-single-property-on-a-relationship.svg" alt="Final-Graph-set-single-property-on-a-relationship.svg">
</div>
<div class="title">Figure 77. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">PUT</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/4/properties/cost</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">"deadly"</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-all-relationships">Get all relationships</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-all-relationships.svg" alt="Final-Graph-Get-all-relationships.svg">
</div>
<div class="title">Figure 78. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/260/relationships/all</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "start" : "http://localhost:7474/db/data/node/260",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/156",
  "property" : "http://localhost:7474/db/data/relationship/156/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/156/properties",
  "type" : "LIKES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/261"
}, {
  "start" : "http://localhost:7474/db/data/node/262",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/157",
  "property" : "http://localhost:7474/db/data/relationship/157/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/157/properties",
  "type" : "LIKES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/260"
}, {
  "start" : "http://localhost:7474/db/data/node/260",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/158",
  "property" : "http://localhost:7474/db/data/relationship/158/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/158/properties",
  "type" : "HATES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/263"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-incoming-relationships">Get incoming relationships</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-incoming-relationships.svg" alt="Final-Graph-Get-incoming-relationships.svg">
</div>
<div class="title">Figure 79. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/279/relationships/in</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "start" : "http://localhost:7474/db/data/node/281",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/168",
  "property" : "http://localhost:7474/db/data/relationship/168/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/168/properties",
  "type" : "LIKES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/279"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-outgoing-relationships">Get outgoing relationships</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-outgoing-relationships.svg" alt="Final-Graph-Get-outgoing-relationships.svg">
</div>
<div class="title">Figure 80. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/304/relationships/out</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "start" : "http://localhost:7474/db/data/node/304",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/182",
  "property" : "http://localhost:7474/db/data/relationship/182/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/182/properties",
  "type" : "LIKES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/305"
}, {
  "start" : "http://localhost:7474/db/data/node/304",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/184",
  "property" : "http://localhost:7474/db/data/relationship/184/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/184/properties",
  "type" : "HATES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/307"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-typed-relationships">Get typed relationships</h4>
<div class="paragraph"><p>Note that the "<span class="monospaced">&amp;</span>" needs to be encoded like "<span class="monospaced">%26</span>" for example when
using <a href="http://curl.haxx.se/">cURL</a> from the terminal.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-typed-relationships.svg" alt="Final-Graph-Get-typed-relationships.svg">
</div>
<div class="title">Figure 81. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/235/relationships/all/LIKES&amp;HATES</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "start" : "http://localhost:7474/db/data/node/235",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/141",
  "property" : "http://localhost:7474/db/data/relationship/141/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/141/properties",
  "type" : "LIKES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/236"
}, {
  "start" : "http://localhost:7474/db/data/node/237",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/142",
  "property" : "http://localhost:7474/db/data/relationship/142/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/142/properties",
  "type" : "LIKES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/235"
}, {
  "start" : "http://localhost:7474/db/data/node/235",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/143",
  "property" : "http://localhost:7474/db/data/relationship/143/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/143/properties",
  "type" : "HATES",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/238"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-relationships-on-a-node-without-relationships">Get relationships on a node without relationships</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-relationships-on-a-node-without-relationships.svg" alt="Final-Graph-Get-relationships-on-a-node-without-relationships.svg">
</div>
<div class="title">Figure 82. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/293/relationships/all</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ ]</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-relationship-types">Relationship types</h3>
<div class="sect3">
<h4 id="rest-api-get-relationship-types">Get relationship types</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-relationship-types.svg" alt="Final-Graph-Get-relationship-types.svg">
</div>
<div class="title">Figure 83. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/types</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ "KNOWS", "LOVES", "to", "foo", "bar" ]</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-node-properties">Node properties</h3>
<div class="sect3">
<h4 id="rest-api-set-property-on-node">Set property on node</h4>
<div class="paragraph"><p>Setting different properties will retain the existing ones for this node.
Note that a single value are submitted not as a map but just as a value
(which is valid JSON) like in the example
below.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Set-property-on-node.svg" alt="Final-Graph-Set-property-on-node.svg">
</div>
<div class="title">Figure 84. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">PUT</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/195/properties/foo</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">"bar"</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-update-node-properties">Update node properties</h4>
<div class="paragraph"><p>This will replace all existing properties on the node with the new set
of attributes.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Update-node-properties.svg" alt="Final-Graph-Update-node-properties.svg">
</div>
<div class="title">Figure 85. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">PUT</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/193/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "age" : "18"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-properties-for-node">Get properties for node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-properties-for-node.svg" alt="Final-Graph-Get-properties-for-node.svg">
</div>
<div class="title">Figure 86. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/310/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "foo" : "bar"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-property-values-can-not-be-null">Property values can not be null</h4>
<div class="paragraph"><p>This example shows the response you get when trying to set a property to
<span class="monospaced">null</span>.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "foo" : null
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">400:</span></strong> <span class="monospaced">Bad Request</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "message": "Could not set property \"foo\", unsupported type: null",
  "exception": "PropertyValueException",
  "fullname": "org.neo4j.server.rest.web.PropertyValueException",
  "stacktrace": [
    "org.neo4j.server.rest.domain.PropertySettingStrategy.setProperty(PropertySettingStrategy.java:151)",
    "org.neo4j.server.rest.domain.PropertySettingStrategy.setProperties(PropertySettingStrategy.java:92)",
    "org.neo4j.server.rest.web.DatabaseActions.createNode(DatabaseActions.java:202)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.createNode(RestfulGraphDatabase.java:225)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-property-values-can-not-be-nested">Property values can not be nested</h4>
<div class="paragraph"><p>Nesting properties is not supported. You could for example store the
nested JSON as a string instead.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "foo" : {
    "bar" : "baz"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">400:</span></strong> <span class="monospaced">Bad Request</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "message": "Could not set property \"foo\", unsupported type: {bar\u003dbaz}",
  "exception": "PropertyValueException",
  "fullname": "org.neo4j.server.rest.web.PropertyValueException",
  "stacktrace": [
    "org.neo4j.server.rest.domain.PropertySettingStrategy.setProperty(PropertySettingStrategy.java:151)",
    "org.neo4j.server.rest.domain.PropertySettingStrategy.setProperties(PropertySettingStrategy.java:92)",
    "org.neo4j.server.rest.web.DatabaseActions.createNode(DatabaseActions.java:202)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.createNode(RestfulGraphDatabase.java:225)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-delete-all-properties-from-node">Delete all properties from node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Delete-all-properties-from-node.svg" alt="Final-Graph-Delete-all-properties-from-node.svg">
</div>
<div class="title">Figure 87. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/347/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-delete-a-named-property-from-a-node">Delete a named property from a node</h4>
<div class="paragraph"><p>To delete a single property
from a node, see the example below.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Starting-Graph-delete-named-property-start.svg" alt="Starting-Graph-delete-named-property-start.svg">
</div>
<div class="title">Figure 88. Starting Graph</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-delete-a-named-property-from-a-node.svg" alt="Final-Graph-delete-a-named-property-from-a-node.svg">
</div>
<div class="title">Figure 89. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/346/properties/name</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-relationship-properties">Relationship properties</h3>
<div class="sect3">
<h4 id="rest-api-update-relationship-properties">Update relationship properties</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Update-relationship-properties.svg" alt="Final-Graph-Update-relationship-properties.svg">
</div>
<div class="title">Figure 90. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">PUT</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/251/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "jim" : "tobias"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-properties-from-a-relationship">Remove properties from a relationship</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Remove-properties-from-a-relationship.svg" alt="Final-Graph-Remove-properties-from-a-relationship.svg">
</div>
<div class="title">Figure 91. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/0/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-property-from-a-relationship">Remove property from a relationship</h4>
<div class="paragraph"><p>See the example request below.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Starting-Graph-Remove-property-from-a-relationship1.svg" alt="Starting-Graph-Remove-property-from-a-relationship1.svg">
</div>
<div class="title">Figure 92. Starting Graph</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Remove-property-from-a-relationship.svg" alt="Final-Graph-Remove-property-from-a-relationship.svg">
</div>
<div class="title">Figure 93. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/3/properties/cost</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-non-existent-property-from-a-relationship">Remove non-existent property from a relationship</h4>
<div class="paragraph"><p>Attempting to remove a property that doesn&#8217;t exist results in
an error.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Remove-non-existent-property-from-a-relationship.svg" alt="Final-Graph-Remove-non-existent-property-from-a-relationship.svg">
</div>
<div class="title">Figure 94. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/1/properties/non-existent</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">404:</span></strong> <span class="monospaced">Not Found</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "message": "Relationship[1] does not have a property \"non-existent\"",
  "exception": "NoSuchPropertyException",
  "fullname": "org.neo4j.server.rest.web.NoSuchPropertyException",
  "stacktrace": [
    "org.neo4j.server.rest.web.DatabaseActions.removeRelationshipProperty(DatabaseActions.java:745)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.deleteRelationshipProperty(RestfulGraphDatabase.java:757)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-properties-from-a-non-existing-relationship">Remove properties from a non-existing relationship</h4>
<div class="paragraph"><p>Attempting to remove all properties from a relationship which doesn&#8217;t
exist results in an error.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Remove-properties-from-a-non-existing-relationship.svg" alt="Final-Graph-Remove-properties-from-a-non-existing-relationship.svg">
</div>
<div class="title">Figure 95. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/1234/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">404:</span></strong> <span class="monospaced">Not Found</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "exception": "RelationshipNotFoundException",
  "fullname": "org.neo4j.server.rest.web.RelationshipNotFoundException",
  "stacktrace": [
    "org.neo4j.server.rest.web.DatabaseActions.relationship(DatabaseActions.java:181)",
    "org.neo4j.server.rest.web.DatabaseActions.removeAllRelationshipProperties(DatabaseActions.java:733)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.deleteAllRelationshipProperties(RestfulGraphDatabase.java:737)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-property-from-a-non-existing-relationship">Remove property from a non-existing relationship</h4>
<div class="paragraph"><p>Attempting to remove a property from a relationship which doesn&#8217;t exist
results in an error.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Remove-property-from-a-non-existing-relationship.svg" alt="Final-Graph-Remove-property-from-a-non-existing-relationship.svg">
</div>
<div class="title">Figure 96. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/relationship/1234/properties/cost</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">404:</span></strong> <span class="monospaced">Not Found</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "exception": "RelationshipNotFoundException",
  "fullname": "org.neo4j.server.rest.web.RelationshipNotFoundException",
  "stacktrace": [
    "org.neo4j.server.rest.web.DatabaseActions.relationship(DatabaseActions.java:181)",
    "org.neo4j.server.rest.web.DatabaseActions.removeRelationshipProperty(DatabaseActions.java:739)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.deleteRelationshipProperty(RestfulGraphDatabase.java:757)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ]
}</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-node-labels">Node labels</h3>
<div class="sect3">
<h4 id="rest-api-adding-a-label-to-a-node">Adding a label to a node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Adding-a-label-to-a-node.svg" alt="Final-Graph-Adding-a-label-to-a-node.svg">
</div>
<div class="title">Figure 97. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/65/labels</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">"MyLabel"</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-adding-multiple-labels-to-a-node">Adding multiple labels to a node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Adding-multiple-labels-to-a-node.svg" alt="Final-Graph-Adding-multiple-labels-to-a-node.svg">
</div>
<div class="title">Figure 98. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/70/labels</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ "MyLabel", "MyOtherLabel" ]</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-adding-a-label-with-an-invalid-name">Adding a label with an invalid name</h4>
<div class="paragraph"><p>Labels with empty names are not allowed, however, all other valid strings are accepted as label names.
Adding an invalid label to a node will lead to a HTTP 400 response.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Adding-a-label-with-an-invalid-name.svg" alt="Final-Graph-Adding-a-label-with-an-invalid-name.svg">
</div>
<div class="title">Figure 99. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/77/labels</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">""</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">400:</span></strong> <span class="monospaced">Bad Request</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "message": "Unable to add label, see nested exception.",
  "exception": "BadInputException",
  "fullname": "org.neo4j.server.rest.repr.BadInputException",
  "stacktrace": [
    "org.neo4j.server.rest.web.DatabaseActions.addLabelToNode(DatabaseActions.java:343)",
    "org.neo4j.server.rest.web.RestfulGraphDatabase.addNodeLabel(RestfulGraphDatabase.java:427)",
    "java.lang.reflect.Method.invoke(Method.java:597)"
  ],
  "cause": {
    "message": "Unable to add label.",
    "cause": {
      "message": "\u0027\u0027 is not a valid label name. Only non-empty strings are allowed.",
      "exception": "ConstraintViolationKernelException",
      "stacktrace": [
        "org.neo4j.kernel.impl.api.ConstraintEvaluatingStatementContext.getOrCreateLabelId(ConstraintEvaluatingStatementContext.java:57)",
        "org.neo4j.kernel.impl.api.CompositeStatementContext.getOrCreateLabelId(CompositeStatementContext.java:399)",
        "org.neo4j.kernel.impl.api.CompositeStatementContext.getOrCreateLabelId(CompositeStatementContext.java:399)",
        "org.neo4j.kernel.impl.core.NodeProxy.addLabel(NodeProxy.java:424)",
        "org.neo4j.server.rest.web.DatabaseActions.addLabelToNode(DatabaseActions.java:337)",
        "org.neo4j.server.rest.web.RestfulGraphDatabase.addNodeLabel(RestfulGraphDatabase.java:427)",
        "java.lang.reflect.Method.invoke(Method.java:597)"
      ],
      "fullname": "org.neo4j.kernel.api.ConstraintViolationKernelException"
    },
    "exception": "ConstraintViolationException",
    "stacktrace": [
      "org.neo4j.kernel.impl.core.NodeProxy.addLabel(NodeProxy.java:428)",
      "org.neo4j.server.rest.web.DatabaseActions.addLabelToNode(DatabaseActions.java:337)",
      "org.neo4j.server.rest.web.RestfulGraphDatabase.addNodeLabel(RestfulGraphDatabase.java:427)",
      "java.lang.reflect.Method.invoke(Method.java:597)"
    ],
    "fullname": "org.neo4j.graphdb.ConstraintViolationException"
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-replacing-labels-on-a-node">Replacing labels on a node</h4>
<div class="paragraph"><p>This removes any labels currently on a node, and replaces them with the labels passed in as the
request body.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Replacing-labels-on-a-node.svg" alt="Final-Graph-Replacing-labels-on-a-node.svg">
</div>
<div class="title">Figure 100. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">PUT</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/66/labels</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ "MyOtherLabel", "MyThirdLabel" ]</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-removing-a-label-from-a-node">Removing a label from a node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Removing-a-label-from-a-node.svg" alt="Final-Graph-Removing-a-label-from-a-node.svg">
</div>
<div class="title">Figure 101. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/67/labels/MyLabel</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-listing-labels-for-a-node">Listing labels for a node</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Listing-labels-for-a-node.svg" alt="Final-Graph-Listing-labels-for-a-node.svg">
</div>
<div class="title">Figure 102. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/69/labels</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ "Me", "You" ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-all-nodes-with-a-label">Get all nodes with a label</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-all-nodes-with-a-label.svg" alt="Final-Graph-Get-all-nodes-with-a-label.svg">
</div>
<div class="title">Figure 103. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/label/first/nodes</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/71/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/71/labels",
  "data" : {
    "name" : "b"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/71/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/71/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/71",
  "property" : "http://localhost:7474/db/data/node/71/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/71/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/71/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/71/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/71/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/71/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/71/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/71/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/73/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/73/labels",
  "data" : {
    "name" : "a"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/73/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/73/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/73",
  "property" : "http://localhost:7474/db/data/node/73/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/73/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/73/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/73/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/73/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/73/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/73/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/73/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-nodes-by-label-and-property">Get nodes by label and property</h4>
<div class="paragraph"><p>You can retrieve all nodes with a given label and property by passing one property as a query parameter.
Currently, it is not possible to specify multiple properties to search by.</p></div>
<div class="paragraph"><p>If there is an index available on the label/property combination you send, that index will be used. If no
index is available, all nodes with the given label will be filtered through to find matching nodes.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Get-nodes-by-label-and-property.svg" alt="Final-Graph-Get-nodes-by-label-and-property.svg">
</div>
<div class="title">Figure 104. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/label/Person/nodes?name=%22bob+ross%22</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/74/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/74/labels",
  "data" : {
    "name" : "bob ross"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/74/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/74/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/74",
  "property" : "http://localhost:7474/db/data/node/74/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/74/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/74/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/74/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/74/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/74/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/74/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/74/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-schema-indexes">Indexing</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This documents schema based indexes, a feature that was introduced in Neo4j 2.0, see <a href="#rest-api-indexes">[rest-api-indexes]</a> for legacy indexing.</td>
</tr></table>
</div>
<div class="paragraph"><p>For more details about schema based indexes and the optional schema in Neo4j, see <a href="#graphdb-neo4j-schema">[graphdb-neo4j-schema]</a>.</p></div>
<div class="sect3">
<h4 id="rest-api-create-schema-index">Create schema index</h4>
<div class="paragraph"><p>This will start a background job in the database that will create and populate the new index.
You can check the status of your index by listing all the indexes for the relevant label.
The new index will show up, but have a state of "POPULATING" until the index is ready.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Create-schema-index.svg" alt="Final-Graph-Create-schema-index.svg">
</div>
<div class="title">Figure 105. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/schema/index/person</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "property_keys" : [ "name" ]
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "label" : "person",
  "property-keys" : [ "name" ]
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-list-indexes-for-a-label">List indexes for a label</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-List-indexes-for-a-label.svg" alt="Final-Graph-List-indexes-for-a-label.svg">
</div>
<div class="title">Figure 106. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/schema/index/user</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "label" : "user",
  "property-keys" : [ "name" ]
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-drop-schema-index">Drop schema index</h4>
<div class="paragraph"><p>Drop schema index</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-drop-schema-index.svg" alt="Final-Graph-drop-schema-index.svg">
</div>
<div class="title">Figure 107. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/schema/index/SomeLabel/name</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-traverse">Traversals</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">The Traversal REST Endpoint executes arbitrary Groovy code under the hood as part of the evaluators definitions. In hosted and open environments, this can constitute a security risk.
In these case, consider using declarative approaches like <a href="#cypher-query-lang">[cypher-query-lang]</a> or write your own server side plugin executing the
interesting traversals with the Java API ( see <a href="#server-plugins">[server-plugins]</a> ) or secure your server, see <a href="#security-server">[security-server]</a>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Traversals are performed from a start node.
The traversal is controlled by the URI and the body sent with the request.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
returnType
</dt>
<dd>
<p>
The kind of objects in the response is determined by <em>traverse/{returnType}</em> in the URL.
 <span class="monospaced">returnType</span> can have one of these values:
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">node</span>
</p>
</li>
<li>
<p>
<span class="monospaced">relationship</span>
</p>
</li>
<li>
<p>
<span class="monospaced">path</span>: contains full representations of start and end node, the rest are URIs.
</p>
</li>
<li>
<p>
<span class="monospaced">fullpath</span>: contains full representations of all nodes and relationships.
</p>
</li>
</ul></div>
</dd>
</dl></div>
<div class="paragraph"><p>To decide how the graph should be traversed you can use these parameters in the request body:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
order
</dt>
<dd>
<p>
Decides in which order to visit nodes. Possible values:
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">breadth_first</span>: see <a href="http://en.wikipedia.org/wiki/Breadth-first_search">Breadth-first search</a>.
</p>
</li>
<li>
<p>
<span class="monospaced">depth_first</span>: see <a href="http://en.wikipedia.org/wiki/Depth-first_search">Depth-first search</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
relationships
</dt>
<dd>
<p>
Decides which relationship types and directions should be followed.
 The direction can be one of:
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">all</span>
</p>
</li>
<li>
<p>
<span class="monospaced">in</span>
</p>
</li>
<li>
<p>
<span class="monospaced">out</span>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
uniqueness
</dt>
<dd>
<p>
Decides how uniqueness should be calculated.
 For details on different uniqueness values see the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/Uniqueness.html">Java API on Uniqueness</a>.
 Possible values:
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">node_global</span>
</p>
</li>
<li>
<p>
<span class="monospaced">none</span>
</p>
</li>
<li>
<p>
<span class="monospaced">relationship_global</span>
</p>
</li>
<li>
<p>
<span class="monospaced">node_path</span>
</p>
</li>
<li>
<p>
<span class="monospaced">relationship_path</span>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
prune_evaluator
</dt>
<dd>
<p>
Decides whether the traverser should continue down that path or if it should be pruned so that the traverser won&#8217;t continue down that path.
 You can write your own prune evaluator as (see <a href="#rest-api-traversal-using-a-return-filter">[rest-api-traversal-using-a-return-filter]</a> or use the <span class="monospaced">built-in</span> <span class="monospaced">none</span> prune evaluator.
</p>
</dd>
<dt class="hdlist1">
return_filter
</dt>
<dd>
<p>
Decides whether the current position should be included in the result.
 You can provide your own code for this (see <a href="#rest-api-traversal-using-a-return-filter">[rest-api-traversal-using-a-return-filter]</a>), or use one of the built-in filters:
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">all</span>
</p>
</li>
<li>
<p>
<span class="monospaced">all_but_start_node</span>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
max_depth
</dt>
<dd>
<p>
Is a short-hand way of specifying a prune evaluator which prunes after a certain depth.
 If not specified a max depth of 1 is used and if a <span class="monospaced">prune_evaluator</span> is specified instead of a <span class="monospaced">max_depth</span>, no max depth limit is set.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The <span class="monospaced">position</span> object in the body of the <span class="monospaced">return_filter</span> and <span class="monospaced">prune_evaluator</span> is a
<span class="monospaced"><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/Path.html">Path</a></span>
object representing the path from the start node to the current traversal position.</p></div>
<div class="paragraph"><p>Out of the box, the REST API supports JavaScript code in filters and evaluators.
The script body will be executed in a Java context which has access to the full Neo4j <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/">Java API</a>.
See the examples for the exact syntax of the request.</p></div>
<div class="sect3">
<h4 id="rest-api-traversal-using-a-return-filter">Traversal using a return filter</h4>
<div class="paragraph"><p>In this example, the <span class="monospaced">none</span> prune evaluator is used and a return filter
is supplied in order to return all names containing "t".
The result is to be returned as nodes and the max depth is
set to 3.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Traversal-using-a-return-filter.svg" alt="Final-Graph-Traversal-using-a-return-filter.svg">
</div>
<div class="title">Figure 108. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/405/traverse/node</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "order" : "breadth_first",
  "return_filter" : {
    "body" : "position.endNode().getProperty('name').toLowerCase().contains('t')",
    "language" : "javascript"
  },
  "prune_evaluator" : {
    "body" : "position.length() &gt; 10",
    "language" : "javascript"
  },
  "uniqueness" : "node_global",
  "relationships" : [ {
    "direction" : "all",
    "type" : "knows"
  }, {
    "direction" : "all",
    "type" : "loves"
  } ],
  "max_depth" : 3
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/405/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/405/labels",
  "data" : {
    "name" : "Root"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/405/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/405/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/405",
  "property" : "http://localhost:7474/db/data/node/405/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/405/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/405/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/405/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/405/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/405/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/405/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/405/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/408/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/408/labels",
  "data" : {
    "name" : "Mattias"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/408/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/408/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/408",
  "property" : "http://localhost:7474/db/data/node/408/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/408/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/408/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/408/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/408/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/408/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/408/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/408/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/407/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/407/labels",
  "data" : {
    "name" : "Peter"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/407/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/407/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/407",
  "property" : "http://localhost:7474/db/data/node/407/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/407/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/407/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/407/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/407/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/407/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/407/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/407/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/406/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/406/labels",
  "data" : {
    "name" : "Tobias"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/406/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/406/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/406",
  "property" : "http://localhost:7474/db/data/node/406/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/406/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/406/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/406/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/406/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/406/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/406/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/406/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-return-relationships-from-a-traversal">Return relationships from a traversal</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-return-relationships-from-a-traversal.svg" alt="Final-Graph-return-relationships-from-a-traversal.svg">
</div>
<div class="title">Figure 109. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/399/traverse/relationship</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "order" : "breadth_first",
  "uniqueness" : "none",
  "return_filter" : {
    "language" : "builtin",
    "name" : "all"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "start" : "http://localhost:7474/db/data/node/399",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/223",
  "property" : "http://localhost:7474/db/data/relationship/223/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/223/properties",
  "type" : "know",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/398"
}, {
  "start" : "http://localhost:7474/db/data/node/399",
  "data" : {
  },
  "self" : "http://localhost:7474/db/data/relationship/224",
  "property" : "http://localhost:7474/db/data/relationship/224/properties/{key}",
  "properties" : "http://localhost:7474/db/data/relationship/224/properties",
  "type" : "own",
  "extensions" : {
  },
  "end" : "http://localhost:7474/db/data/node/397"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-return-paths-from-a-traversal">Return paths from a traversal</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-return-paths-from-a-traversal.svg" alt="Final-Graph-return-paths-from-a-traversal.svg">
</div>
<div class="title">Figure 110. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/389/traverse/path</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "order" : "breadth_first",
  "uniqueness" : "none",
  "return_filter" : {
    "language" : "builtin",
    "name" : "all"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "start" : "http://localhost:7474/db/data/node/389",
  "nodes" : [ "http://localhost:7474/db/data/node/389" ],
  "length" : 0,
  "relationships" : [ ],
  "end" : "http://localhost:7474/db/data/node/389"
}, {
  "start" : "http://localhost:7474/db/data/node/389",
  "nodes" : [ "http://localhost:7474/db/data/node/389", "http://localhost:7474/db/data/node/388" ],
  "length" : 1,
  "relationships" : [ "http://localhost:7474/db/data/relationship/215" ],
  "end" : "http://localhost:7474/db/data/node/388"
}, {
  "start" : "http://localhost:7474/db/data/node/389",
  "nodes" : [ "http://localhost:7474/db/data/node/389", "http://localhost:7474/db/data/node/387" ],
  "length" : 1,
  "relationships" : [ "http://localhost:7474/db/data/relationship/216" ],
  "end" : "http://localhost:7474/db/data/node/387"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-traversal-returning-nodes-below-a-certain-depth">Traversal returning nodes below a certain depth</h4>
<div class="paragraph"><p>Here, all nodes at a traversal depth below 3 are returned.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Traversal-returning-nodes-below-a-certain-depth.svg" alt="Final-Graph-Traversal-returning-nodes-below-a-certain-depth.svg">
</div>
<div class="title">Figure 111. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/393/traverse/node</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "return_filter" : {
    "body" : "position.length()&lt;3;",
    "language" : "javascript"
  },
  "prune_evaluator" : {
    "name" : "none",
    "language" : "builtin"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/393/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/393/labels",
  "data" : {
    "name" : "Root"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/393/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/393/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/393",
  "property" : "http://localhost:7474/db/data/node/393/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/393/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/393/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/393/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/393/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/393/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/393/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/393/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/396/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/396/labels",
  "data" : {
    "name" : "Mattias"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/396/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/396/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/396",
  "property" : "http://localhost:7474/db/data/node/396/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/396/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/396/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/396/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/396/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/396/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/396/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/396/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/391/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/391/labels",
  "data" : {
    "name" : "Johan"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/391/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/391/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/391",
  "property" : "http://localhost:7474/db/data/node/391/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/391/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/391/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/391/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/391/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/391/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/391/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/391/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/392/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/392/labels",
  "data" : {
    "name" : "Emil"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/392/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/392/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/392",
  "property" : "http://localhost:7474/db/data/node/392/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/392/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/392/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/392/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/392/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/392/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/392/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/392/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-creating-a-paged-traverser">Creating a paged traverser</h4>
<div class="paragraph"><p>Paged traversers are created by <span class="monospaced">POST</span>-ing a
traversal description to the link identified by the <span class="monospaced">paged_traverser</span> key
in a node representation. When creating a paged traverser, the same
options apply as for a regular traverser, meaning that <span class="monospaced">node</span>, <span class="monospaced">path</span>,
or <span class="monospaced">fullpath</span>, can be targeted.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/232/paged/traverse/node</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "prune_evaluator" : {
    "language" : "builtin",
    "name" : "none"
  },
  "return_filter" : {
    "language" : "javascript",
    "body" : "position.endNode().getProperty('name').contains('1');"
  },
  "order" : "depth_first",
  "relationships" : {
    "type" : "NEXT",
    "direction" : "out"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/node/232/paged/traverse/node/0ce467662433437c9eba0eeeaefd0a01</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/233/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/233/labels",
  "data" : {
    "name" : "1"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/233/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/233/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/233",
  "property" : "http://localhost:7474/db/data/node/233/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/233/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/233/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/233/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/233/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/233/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/233/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/233/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/242/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/242/labels",
  "data" : {
    "name" : "10"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/242/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/242/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/242",
  "property" : "http://localhost:7474/db/data/node/242/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/242/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/242/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/242/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/242/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/242/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/242/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/242/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/243/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/243/labels",
  "data" : {
    "name" : "11"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/243/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/243/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/243",
  "property" : "http://localhost:7474/db/data/node/243/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/243/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/243/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/243/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/243/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/243/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/243/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/243/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/244/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/244/labels",
  "data" : {
    "name" : "12"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/244/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/244/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/244",
  "property" : "http://localhost:7474/db/data/node/244/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/244/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/244/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/244/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/244/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/244/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/244/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/244/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/245/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/245/labels",
  "data" : {
    "name" : "13"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/245/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/245/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/245",
  "property" : "http://localhost:7474/db/data/node/245/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/245/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/245/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/245/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/245/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/245/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/245/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/245/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/246/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/246/labels",
  "data" : {
    "name" : "14"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/246/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/246/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/246",
  "property" : "http://localhost:7474/db/data/node/246/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/246/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/246/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/246/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/246/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/246/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/246/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/246/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/247/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/247/labels",
  "data" : {
    "name" : "15"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/247/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/247/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/247",
  "property" : "http://localhost:7474/db/data/node/247/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/247/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/247/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/247/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/247/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/247/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/247/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/247/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/248/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/248/labels",
  "data" : {
    "name" : "16"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/248/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/248/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/248",
  "property" : "http://localhost:7474/db/data/node/248/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/248/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/248/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/248/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/248/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/248/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/248/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/248/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/249/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/249/labels",
  "data" : {
    "name" : "17"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/249/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/249/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/249",
  "property" : "http://localhost:7474/db/data/node/249/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/249/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/249/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/249/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/249/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/249/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/249/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/249/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/250/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/250/labels",
  "data" : {
    "name" : "18"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/250/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/250/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/250",
  "property" : "http://localhost:7474/db/data/node/250/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/250/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/250/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/250/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/250/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/250/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/250/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/250/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/251/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/251/labels",
  "data" : {
    "name" : "19"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/251/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/251/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/251",
  "property" : "http://localhost:7474/db/data/node/251/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/251/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/251/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/251/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/251/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/251/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/251/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/251/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/253/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/253/labels",
  "data" : {
    "name" : "21"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/253/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/253/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/253",
  "property" : "http://localhost:7474/db/data/node/253/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/253/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/253/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/253/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/253/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/253/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/253/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/253/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/263/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/263/labels",
  "data" : {
    "name" : "31"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/263/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/263/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/263",
  "property" : "http://localhost:7474/db/data/node/263/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/263/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/263/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/263/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/263/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/263/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/263/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/263/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-paging-through-the-results-of-a-paged-traverser">Paging through the results of a paged traverser</h4>
<div class="paragraph"><p>Paged traversers hold
state on the server, and allow clients to page through the results of a
traversal. To progress to the next page of traversal results, the client
issues a HTTP GET request on the paged traversal URI which causes the
traversal to fill the next page (or partially fill it if insufficient
results are available).</p></div>
<div class="paragraph"><p>Note that if a traverser expires through inactivity it will cause a 404
response on the next <span class="monospaced">GET</span> request. Traversers' leases are renewed on
every successful access for the same amount of time as originally
specified.</p></div>
<div class="paragraph"><p>When the paged traverser reaches the end of its results, the client can
expect a 404 response as the traverser is disposed by the server.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/265/paged/traverse/node/5b39a2a2e74c45959fcef256f6a6d5e6</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/596/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/596/labels",
  "data" : {
    "name" : "331"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/596/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/596/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/596",
  "property" : "http://localhost:7474/db/data/node/596/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/596/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/596/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/596/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/596/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/596/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/596/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/596/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/606/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/606/labels",
  "data" : {
    "name" : "341"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/606/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/606/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/606",
  "property" : "http://localhost:7474/db/data/node/606/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/606/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/606/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/606/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/606/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/606/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/606/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/606/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/616/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/616/labels",
  "data" : {
    "name" : "351"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/616/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/616/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/616",
  "property" : "http://localhost:7474/db/data/node/616/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/616/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/616/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/616/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/616/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/616/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/616/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/616/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/626/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/626/labels",
  "data" : {
    "name" : "361"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/626/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/626/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/626",
  "property" : "http://localhost:7474/db/data/node/626/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/626/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/626/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/626/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/626/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/626/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/626/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/626/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/636/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/636/labels",
  "data" : {
    "name" : "371"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/636/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/636/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/636",
  "property" : "http://localhost:7474/db/data/node/636/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/636/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/636/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/636/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/636/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/636/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/636/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/636/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/646/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/646/labels",
  "data" : {
    "name" : "381"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/646/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/646/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/646",
  "property" : "http://localhost:7474/db/data/node/646/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/646/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/646/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/646/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/646/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/646/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/646/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/646/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/656/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/656/labels",
  "data" : {
    "name" : "391"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/656/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/656/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/656",
  "property" : "http://localhost:7474/db/data/node/656/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/656/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/656/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/656/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/656/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/656/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/656/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/656/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/666/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/666/labels",
  "data" : {
    "name" : "401"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/666/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/666/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/666",
  "property" : "http://localhost:7474/db/data/node/666/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/666/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/666/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/666/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/666/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/666/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/666/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/666/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/675/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/675/labels",
  "data" : {
    "name" : "410"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/675/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/675/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/675",
  "property" : "http://localhost:7474/db/data/node/675/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/675/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/675/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/675/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/675/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/675/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/675/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/675/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/676/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/676/labels",
  "data" : {
    "name" : "411"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/676/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/676/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/676",
  "property" : "http://localhost:7474/db/data/node/676/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/676/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/676/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/676/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/676/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/676/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/676/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/676/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/677/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/677/labels",
  "data" : {
    "name" : "412"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/677/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/677/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/677",
  "property" : "http://localhost:7474/db/data/node/677/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/677/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/677/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/677/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/677/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/677/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/677/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/677/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/678/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/678/labels",
  "data" : {
    "name" : "413"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/678/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/678/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/678",
  "property" : "http://localhost:7474/db/data/node/678/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/678/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/678/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/678/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/678/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/678/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/678/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/678/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/679/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/679/labels",
  "data" : {
    "name" : "414"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/679/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/679/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/679",
  "property" : "http://localhost:7474/db/data/node/679/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/679/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/679/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/679/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/679/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/679/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/679/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/679/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/680/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/680/labels",
  "data" : {
    "name" : "415"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/680/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/680/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/680",
  "property" : "http://localhost:7474/db/data/node/680/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/680/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/680/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/680/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/680/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/680/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/680/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/680/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/681/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/681/labels",
  "data" : {
    "name" : "416"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/681/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/681/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/681",
  "property" : "http://localhost:7474/db/data/node/681/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/681/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/681/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/681/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/681/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/681/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/681/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/681/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/682/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/682/labels",
  "data" : {
    "name" : "417"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/682/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/682/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/682",
  "property" : "http://localhost:7474/db/data/node/682/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/682/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/682/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/682/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/682/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/682/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/682/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/682/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/683/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/683/labels",
  "data" : {
    "name" : "418"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/683/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/683/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/683",
  "property" : "http://localhost:7474/db/data/node/683/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/683/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/683/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/683/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/683/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/683/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/683/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/683/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/684/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/684/labels",
  "data" : {
    "name" : "419"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/684/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/684/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/684",
  "property" : "http://localhost:7474/db/data/node/684/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/684/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/684/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/684/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/684/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/684/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/684/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/684/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/686/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/686/labels",
  "data" : {
    "name" : "421"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/686/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/686/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/686",
  "property" : "http://localhost:7474/db/data/node/686/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/686/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/686/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/686/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/686/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/686/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/686/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/686/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/696/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/696/labels",
  "data" : {
    "name" : "431"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/696/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/696/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/696",
  "property" : "http://localhost:7474/db/data/node/696/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/696/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/696/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/696/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/696/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/696/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/696/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/696/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/706/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/706/labels",
  "data" : {
    "name" : "441"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/706/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/706/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/706",
  "property" : "http://localhost:7474/db/data/node/706/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/706/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/706/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/706/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/706/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/706/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/706/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/706/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-paged-traverser-page-size">Paged traverser page size</h4>
<div class="paragraph"><p>The default page size is 50 items, but
depending on the application larger or smaller pages sizes might be
appropriate. This can be set by adding a <span class="monospaced">pageSize</span> query parameter.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/34/paged/traverse/node?pageSize=1</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "prune_evaluator" : {
    "language" : "builtin",
    "name" : "none"
  },
  "return_filter" : {
    "language" : "javascript",
    "body" : "position.endNode().getProperty('name').contains('1');"
  },
  "order" : "depth_first",
  "relationships" : {
    "type" : "NEXT",
    "direction" : "out"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/node/34/paged/traverse/node/4ddbe5adf4964f4a9488f843a14f97ff</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/35/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/35/labels",
  "data" : {
    "name" : "1"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/35/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/35/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/35",
  "property" : "http://localhost:7474/db/data/node/35/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/35/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/35/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/35/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/35/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/35/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/35/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/35/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-paged-traverser-timeout">Paged traverser timeout</h4>
<div class="paragraph"><p>The default timeout for a paged traverser is 60
seconds, but depending on the application larger or smaller timeouts
might be appropriate. This can be set by adding a <span class="monospaced">leaseTime</span> query
parameter with the number of seconds the paged traverser should last.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/709/paged/traverse/node?leaseTime=10</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "prune_evaluator" : {
    "language" : "builtin",
    "name" : "none"
  },
  "return_filter" : {
    "language" : "javascript",
    "body" : "position.endNode().getProperty('name').contains('1');"
  },
  "order" : "depth_first",
  "relationships" : {
    "type" : "NEXT",
    "direction" : "out"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/node/709/paged/traverse/node/891ee9cd8d124145a5dcf730f65d6725</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/710/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/710/labels",
  "data" : {
    "name" : "1"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/710/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/710/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/710",
  "property" : "http://localhost:7474/db/data/node/710/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/710/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/710/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/710/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/710/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/710/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/710/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/710/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/719/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/719/labels",
  "data" : {
    "name" : "10"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/719/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/719/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/719",
  "property" : "http://localhost:7474/db/data/node/719/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/719/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/719/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/719/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/719/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/719/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/719/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/719/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/720/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/720/labels",
  "data" : {
    "name" : "11"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/720/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/720/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/720",
  "property" : "http://localhost:7474/db/data/node/720/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/720/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/720/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/720/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/720/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/720/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/720/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/720/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/721/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/721/labels",
  "data" : {
    "name" : "12"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/721/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/721/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/721",
  "property" : "http://localhost:7474/db/data/node/721/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/721/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/721/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/721/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/721/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/721/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/721/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/721/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/722/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/722/labels",
  "data" : {
    "name" : "13"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/722/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/722/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/722",
  "property" : "http://localhost:7474/db/data/node/722/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/722/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/722/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/722/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/722/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/722/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/722/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/722/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/723/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/723/labels",
  "data" : {
    "name" : "14"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/723/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/723/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/723",
  "property" : "http://localhost:7474/db/data/node/723/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/723/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/723/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/723/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/723/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/723/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/723/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/723/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/724/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/724/labels",
  "data" : {
    "name" : "15"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/724/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/724/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/724",
  "property" : "http://localhost:7474/db/data/node/724/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/724/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/724/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/724/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/724/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/724/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/724/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/724/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/725/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/725/labels",
  "data" : {
    "name" : "16"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/725/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/725/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/725",
  "property" : "http://localhost:7474/db/data/node/725/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/725/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/725/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/725/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/725/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/725/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/725/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/725/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/726/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/726/labels",
  "data" : {
    "name" : "17"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/726/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/726/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/726",
  "property" : "http://localhost:7474/db/data/node/726/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/726/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/726/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/726/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/726/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/726/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/726/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/726/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/727/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/727/labels",
  "data" : {
    "name" : "18"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/727/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/727/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/727",
  "property" : "http://localhost:7474/db/data/node/727/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/727/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/727/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/727/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/727/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/727/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/727/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/727/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/728/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/728/labels",
  "data" : {
    "name" : "19"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/728/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/728/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/728",
  "property" : "http://localhost:7474/db/data/node/728/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/728/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/728/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/728/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/728/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/728/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/728/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/728/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/730/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/730/labels",
  "data" : {
    "name" : "21"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/730/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/730/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/730",
  "property" : "http://localhost:7474/db/data/node/730/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/730/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/730/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/730/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/730/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/730/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/730/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/730/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/740/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/740/labels",
  "data" : {
    "name" : "31"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/740/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/740/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/740",
  "property" : "http://localhost:7474/db/data/node/740/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/740/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/740/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/740/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/740/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/740/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/740/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/740/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-graph-algos">Built-in Graph Algorithms</h3>
<div class="paragraph"><p>Neo4j comes with a number of built-in graph algorithms.
They are performed from a start node.
The traversal is controlled by the URI and the body sent with the request.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
algorithm
</dt>
<dd>
<p>
The algorithm to choose. If not set, default is <span class="monospaced">shortestPath</span>.
 <span class="monospaced">algorithm</span> can have one of these values:
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">shortestPath</span>
</p>
</li>
<li>
<p>
<span class="monospaced">allSimplePaths</span>
</p>
</li>
<li>
<p>
<span class="monospaced">allPaths</span>
</p>
</li>
<li>
<p>
<span class="monospaced">dijkstra</span> (optional with <span class="monospaced">cost_property</span> and <span class="monospaced">default_cost</span> parameters)
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
max_depth
</dt>
<dd>
<p>
The maximum depth as an integer for the algorithms like ShortestPath, where applicable.
Default is <span class="monospaced">1</span>.
</p>
</dd>
</dl></div>
<div class="sect3">
<h4 id="rest-api-find-all-shortest-paths">Find all shortest paths</h4>
<div class="paragraph"><p>The <span class="monospaced">shortestPath</span> algorithm can find multiple paths between the same
nodes, like in this example.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Find-all-shortest-paths.svg" alt="Final-Graph-Find-all-shortest-paths.svg">
</div>
<div class="title">Figure 112. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/60/paths</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "to" : "http://localhost:7474/db/data/node/55",
  "max_depth" : 3,
  "relationships" : {
    "type" : "to",
    "direction" : "out"
  },
  "algorithm" : "shortestPath"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "start" : "http://localhost:7474/db/data/node/60",
  "nodes" : [ "http://localhost:7474/db/data/node/60", "http://localhost:7474/db/data/node/59", "http://localhost:7474/db/data/node/55" ],
  "length" : 2,
  "relationships" : [ "http://localhost:7474/db/data/relationship/74", "http://localhost:7474/db/data/relationship/83" ],
  "end" : "http://localhost:7474/db/data/node/55"
}, {
  "start" : "http://localhost:7474/db/data/node/60",
  "nodes" : [ "http://localhost:7474/db/data/node/60", "http://localhost:7474/db/data/node/56", "http://localhost:7474/db/data/node/55" ],
  "length" : 2,
  "relationships" : [ "http://localhost:7474/db/data/relationship/75", "http://localhost:7474/db/data/relationship/81" ],
  "end" : "http://localhost:7474/db/data/node/55"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-find-one-of-the-shortest-paths-between-nodes">Find one of the shortest paths between nodes</h4>
<div class="paragraph"><p>If no path algorithm is specified, a <span class="monospaced">ShortestPath</span> algorithm with a max
depth of 1 will be chosen. In this example, the <span class="monospaced">max_depth</span> is set to <span class="monospaced">3</span>
in order to find the shortest path between 3 linked nodes.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Find-one-of-the-shortest-paths-between-nodes.svg" alt="Final-Graph-Find-one-of-the-shortest-paths-between-nodes.svg">
</div>
<div class="title">Figure 113. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/44/path</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "to" : "http://localhost:7474/db/data/node/39",
  "max_depth" : 3,
  "relationships" : {
    "type" : "to",
    "direction" : "out"
  },
  "algorithm" : "shortestPath"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "start" : "http://localhost:7474/db/data/node/44",
  "nodes" : [ "http://localhost:7474/db/data/node/44", "http://localhost:7474/db/data/node/40", "http://localhost:7474/db/data/node/39" ],
  "length" : 2,
  "relationships" : [ "http://localhost:7474/db/data/relationship/52", "http://localhost:7474/db/data/relationship/58" ],
  "end" : "http://localhost:7474/db/data/node/39"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-execute-a-dijkstra-algorithm-with-similar-weights-on-relationships">Execute a Dijkstra algorithm with similar weights on relationships</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Execute-a-Dijkstra-algorithm-with-similar-weights-on-relationships.svg" alt="Final-Graph-Execute-a-Dijkstra-algorithm-with-similar-weights-on-relationships.svg">
</div>
<div class="title">Figure 114. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/50/path</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "to" : "http://localhost:7474/db/data/node/53",
  "cost_property" : "cost",
  "relationships" : {
    "type" : "to",
    "direction" : "out"
  },
  "algorithm" : "dijkstra"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "weight" : 2.0,
  "start" : "http://localhost:7474/db/data/node/50",
  "nodes" : [ "http://localhost:7474/db/data/node/50", "http://localhost:7474/db/data/node/51", "http://localhost:7474/db/data/node/53" ],
  "length" : 2,
  "relationships" : [ "http://localhost:7474/db/data/relationship/61", "http://localhost:7474/db/data/relationship/62" ],
  "end" : "http://localhost:7474/db/data/node/53"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-execute-a-dijkstra-algorithm-with-weights-on-relationships">Execute a Dijkstra algorithm with weights on relationships</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Execute-a-Dijkstra-algorithm-with-weights-on-relationships.svg" alt="Final-Graph-Execute-a-Dijkstra-algorithm-with-weights-on-relationships.svg">
</div>
<div class="title">Figure 115. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node/34/path</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "to" : "http://localhost:7474/db/data/node/37",
  "cost_property" : "cost",
  "relationships" : {
    "type" : "to",
    "direction" : "out"
  },
  "algorithm" : "dijkstra"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "weight" : 6.0,
  "start" : "http://localhost:7474/db/data/node/34",
  "nodes" : [ "http://localhost:7474/db/data/node/34", "http://localhost:7474/db/data/node/35", "http://localhost:7474/db/data/node/32", "http://localhost:7474/db/data/node/33", "http://localhost:7474/db/data/node/30", "http://localhost:7474/db/data/node/31", "http://localhost:7474/db/data/node/37" ],
  "length" : 6,
  "relationships" : [ "http://localhost:7474/db/data/relationship/38", "http://localhost:7474/db/data/relationship/40", "http://localhost:7474/db/data/relationship/42", "http://localhost:7474/db/data/relationship/45", "http://localhost:7474/db/data/relationship/47", "http://localhost:7474/db/data/relationship/48" ],
  "end" : "http://localhost:7474/db/data/node/37"
}</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-batch-ops">Batch operations</h3>
<div class="sect3">
<h4 id="rest-api-execute-multiple-operations-in-batch">Execute multiple operations in batch</h4>
<div class="paragraph"><p>This lets you execute multiple API calls through a single HTTP call,
significantly improving performance for large insert and update
operations.</p></div>
<div class="paragraph"><p>The batch service expects an array of job descriptions as input, each job
description describing an action to be performed via the normal server
API.</p></div>
<div class="paragraph"><p>This service is transactional. If any of the operations performed fails
(returns a non-2xx HTTP status code), the transaction will be rolled back
and all changes will be undone.</p></div>
<div class="paragraph"><p>Each job description should contain a <span class="monospaced">to</span> attribute, with a value
relative to the data API root (so <a href="http://localhost:7474/db/data/node">http://localhost:7474/db/data/node</a> becomes
just /node), and a <span class="monospaced">method</span> attribute containing HTTP verb to use.</p></div>
<div class="paragraph"><p>Optionally you may provide a <span class="monospaced">body</span> attribute, and an <span class="monospaced">id</span> attribute to
help you keep track of responses, although responses are guaranteed to be
returned in the same order the job descriptions are received.</p></div>
<div class="paragraph"><p>The following figure outlines the different parts of the job
descriptions:</p></div>
<div class="imageblock">
<div class="content">
<img src="images/batch-request-api.png" alt="batch-request-api.png">
</div>
</div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Execute-multiple-operations-in-batch.svg" alt="Final-Graph-Execute-multiple-operations-in-batch.svg">
</div>
<div class="title">Figure 116. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/batch</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "method" : "PUT",
  "to" : "/node/211/properties",
  "body" : {
    "age" : 1
  },
  "id" : 0
}, {
  "method" : "GET",
  "to" : "/node/211",
  "id" : 1
}, {
  "method" : "POST",
  "to" : "/node",
  "body" : {
    "age" : 1
  },
  "id" : 2
}, {
  "method" : "POST",
  "to" : "/node",
  "body" : {
    "age" : 1
  },
  "id" : 3
} ]</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "id" : 0,
  "from" : "/node/211/properties"
}, {
  "id" : 1,
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/211/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/211/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/211/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/211/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/211",
    "property" : "http://localhost:7474/db/data/node/211/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/211/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/211/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/211/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/211/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/211/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/211/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/211/relationships/in/{-list|&amp;|types}",
    "data" : {
      "age" : 1
    }
  },
  "from" : "/node/211"
}, {
  "id" : 2,
  "location" : "http://localhost:7474/db/data/node/212",
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/212/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/212/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/212/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/212/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/212",
    "property" : "http://localhost:7474/db/data/node/212/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/212/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/212/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/212/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/212/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/212/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/212/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/212/relationships/in/{-list|&amp;|types}",
    "data" : {
      "age" : 1
    }
  },
  "from" : "/node"
}, {
  "id" : 3,
  "location" : "http://localhost:7474/db/data/node/213",
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/213/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/213/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/213/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/213/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/213",
    "property" : "http://localhost:7474/db/data/node/213/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/213/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/213/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/213/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/213/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/213/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/213/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/213/relationships/in/{-list|&amp;|types}",
    "data" : {
      "age" : 1
    }
  },
  "from" : "/node"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-refer-to-items-created-earlier-in-the-same-batch-job">Refer to items created earlier in the same batch job</h4>
<div class="paragraph"><p>The batch operation API allows you to refer to the URI returned from a
created resource in subsequent job descriptions, within the same batch
call.</p></div>
<div class="paragraph"><p>Use the <span class="monospaced">{[JOB ID]}</span> special syntax to inject URIs from created resources
into JSON strings in subsequent job descriptions.</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-Refer-to-items-created-earlier-in-the-same-batch-job.svg" alt="Final-Graph-Refer-to-items-created-earlier-in-the-same-batch-job.svg">
</div>
<div class="title">Figure 117. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/batch</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "method" : "POST",
  "to" : "/node",
  "id" : 0,
  "body" : {
    "name" : "bob"
  }
}, {
  "method" : "POST",
  "to" : "/node",
  "id" : 1,
  "body" : {
    "age" : 12
  }
}, {
  "method" : "POST",
  "to" : "{0}/relationships",
  "id" : 3,
  "body" : {
    "to" : "{1}",
    "data" : {
      "since" : "2010"
    },
    "type" : "KNOWS"
  }
}, {
  "method" : "POST",
  "to" : "/index/relationship/my_rels",
  "id" : 4,
  "body" : {
    "key" : "since",
    "value" : "2010",
    "uri" : "{3}"
  }
} ]</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "id" : 0,
  "location" : "http://localhost:7474/db/data/node/204",
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/204/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/204/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/204/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/204/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/204",
    "property" : "http://localhost:7474/db/data/node/204/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/204/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/204/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/204/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/204/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/204/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/204/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/204/relationships/in/{-list|&amp;|types}",
    "data" : {
      "name" : "bob"
    }
  },
  "from" : "/node"
}, {
  "id" : 1,
  "location" : "http://localhost:7474/db/data/node/205",
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/205/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/205/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/205/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/205/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/205",
    "property" : "http://localhost:7474/db/data/node/205/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/205/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/205/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/205/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/205/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/205/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/205/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/205/relationships/in/{-list|&amp;|types}",
    "data" : {
      "age" : 12
    }
  },
  "from" : "/node"
}, {
  "id" : 3,
  "location" : "http://localhost:7474/db/data/relationship/125",
  "body" : {
    "extensions" : {
    },
    "start" : "http://localhost:7474/db/data/node/204",
    "property" : "http://localhost:7474/db/data/relationship/125/properties/{key}",
    "self" : "http://localhost:7474/db/data/relationship/125",
    "properties" : "http://localhost:7474/db/data/relationship/125/properties",
    "type" : "KNOWS",
    "end" : "http://localhost:7474/db/data/node/205",
    "data" : {
      "since" : "2010"
    }
  },
  "from" : "http://localhost:7474/db/data/node/204/relationships"
}, {
  "id" : 4,
  "location" : "http://localhost:7474/db/data/index/relationship/my_rels/since/2010/125",
  "body" : {
    "extensions" : {
    },
    "start" : "http://localhost:7474/db/data/node/204",
    "property" : "http://localhost:7474/db/data/relationship/125/properties/{key}",
    "self" : "http://localhost:7474/db/data/relationship/125",
    "properties" : "http://localhost:7474/db/data/relationship/125/properties",
    "type" : "KNOWS",
    "end" : "http://localhost:7474/db/data/node/205",
    "data" : {
      "since" : "2010"
    },
    "indexed" : "http://localhost:7474/db/data/index/relationship/my_rels/since/2010/125"
  },
  "from" : "/index/relationship/my_rels"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-execute-multiple-operations-in-batch-streaming">Execute multiple operations in batch streaming</h4>
<div class="imageblock dot">
<div class="content">
<img src="images/Final-Graph-execute-multiple-operations-in-batch-streaming.svg" alt="Final-Graph-execute-multiple-operations-in-batch-streaming.svg">
</div>
<div class="title">Figure 118. Final Graph</div>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/batch</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">X-Stream:</span></strong> <span class="monospaced">true</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "method" : "PUT",
  "to" : "/node/32/properties",
  "body" : {
    "age" : 1
  },
  "id" : 0
}, {
  "method" : "GET",
  "to" : "/node/32",
  "id" : 1
}, {
  "method" : "POST",
  "to" : "/node",
  "body" : {
    "age" : 1
  },
  "id" : 2
}, {
  "method" : "POST",
  "to" : "/node",
  "body" : {
    "age" : 1
  },
  "id" : 3
} ]</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "id" : 0,
  "from" : "/node/32/properties",
  "body" : null,
  "status" : 204
}, {
  "id" : 1,
  "from" : "/node/32",
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/32/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/32/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/32/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/32/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/32",
    "property" : "http://localhost:7474/db/data/node/32/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/32/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/32/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/32/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/32/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/32/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/32/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/32/relationships/in/{-list|&amp;|types}",
    "data" : {
      "age" : 1
    }
  },
  "status" : 200
}, {
  "id" : 2,
  "from" : "/node",
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/33/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/33/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/33/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/33/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/33",
    "property" : "http://localhost:7474/db/data/node/33/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/33/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/33/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/33/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/33/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/33/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/33/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/33/relationships/in/{-list|&amp;|types}",
    "data" : {
      "age" : 1
    }
  },
  "location" : "http://localhost:7474/db/data/node/33",
  "status" : 201
}, {
  "id" : 3,
  "from" : "/node",
  "body" : {
    "extensions" : {
    },
    "outgoing_relationships" : "http://localhost:7474/db/data/node/34/relationships/out",
    "labels" : "http://localhost:7474/db/data/node/34/labels",
    "all_typed_relationships" : "http://localhost:7474/db/data/node/34/relationships/all/{-list|&amp;|types}",
    "traverse" : "http://localhost:7474/db/data/node/34/traverse/{returnType}",
    "self" : "http://localhost:7474/db/data/node/34",
    "property" : "http://localhost:7474/db/data/node/34/properties/{key}",
    "properties" : "http://localhost:7474/db/data/node/34/properties",
    "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/34/relationships/out/{-list|&amp;|types}",
    "incoming_relationships" : "http://localhost:7474/db/data/node/34/relationships/in",
    "create_relationship" : "http://localhost:7474/db/data/node/34/relationships",
    "paged_traverse" : "http://localhost:7474/db/data/node/34/paged/traverse/{returnType}{?pageSize,leaseTime}",
    "all_relationships" : "http://localhost:7474/db/data/node/34/relationships/all",
    "incoming_typed_relationships" : "http://localhost:7474/db/data/node/34/relationships/in/{-list|&amp;|types}",
    "data" : {
      "age" : 1
    }
  },
  "location" : "http://localhost:7474/db/data/node/34",
  "status" : 201
} ]</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-indexes">Legacy indexing</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This documents the legacy indexing in Neo4j, which is no longer the preferred way to handle indexes. Consider looking at <a href="#rest-api-schema-indexes">[rest-api-schema-indexes]</a> schema based indexes.</td>
</tr></table>
</div>
<div class="paragraph"><p>An index can contain either nodes or relationships.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">To create an index with default configuration, simply start using it by adding nodes/relationships to it. It will then be automatically created for you.</td>
</tr></table>
</div>
<div class="paragraph"><p>What default configuration means depends on how you have configured your database.
If you haven&#8217;t changed any indexing configuration, it means the indexes will be using a Lucene-based backend.</p></div>
<div class="paragraph"><p>All the examples below show you how to do operations on node indexes, but all of them are just as applicable
to relationship indexes. Simple change the "node" part of the URL to "relationship".</p></div>
<div class="paragraph"><p>If you want to customize the index settings, see <a href="#rest-api-create-node-index-with-configuration">[rest-api-create-node-index-with-configuration]</a>.</p></div>
<div class="sect3">
<h4 id="rest-api-create-node-index">Create node index</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Instead of creating the index this way, you can simply start to use
it, and it will be created automatically with default configuration.</td>
</tr></table>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "name" : "favorites"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/node/favorites/</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "template" : "http://localhost:7474/db/data/index/node/favorites/{key}/{value}"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-node-index-with-configuration">Create node index with configuration</h4>
<div class="paragraph"><p>This request is only necessary if
you want to customize the index settings. If you are happy with the
defaults, you can just start indexing nodes/relationships, as
non-existent indexes will automatically be created as you do. See
<a href="#indexing-create-advanced">[indexing-create-advanced]</a> for more information on index configuration.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "name" : "fulltext",
  "config" : {
    "type" : "fulltext",
    "provider" : "lucene"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/node/fulltext/</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "template" : "http://localhost:7474/db/data/index/node/fulltext/{key}/{value}",
  "type" : "fulltext",
  "provider" : "lucene"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-delete-node-index">Delete node index</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/kvnode</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-list-node-indexes">List node indexes</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "favorites" : {
    "template" : "http://localhost:7474/db/data/index/node/favorites/{key}/{value}",
    "provider" : "lucene",
    "type" : "exact"
  }
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-add-node-to-index">Add node to index</h4>
<div class="paragraph"><p>Associates a node with the given key/value pair in the given index.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Spaces in the URI have to be encoded as <span class="monospaced">%20</span>.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">This does <strong>not</strong> overwrite previous entries. If you index the
same key/value/item combination twice, two index entries are created. To
do update-type operations, you need to delete the old entry before adding
a new one.</td>
</tr></table>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/favorites</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "value" : "some value",
  "uri" : "http://localhost:7474/db/data/node/8",
  "key" : "some-key"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/node/favorites/some-key/some%20value/8</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/8/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/8/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/8/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/8/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/8",
  "property" : "http://localhost:7474/db/data/node/8/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/8/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/8/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/8/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/8/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/8/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/8/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/8/relationships/in/{-list|&amp;|types}",
  "data" : {
  },
  "indexed" : "http://localhost:7474/db/data/index/node/favorites/some-key/some%20value/8"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-all-entries-with-a-given-node-from-an-index">Remove all entries with a given node from an index</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/kvnode/13</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-all-entries-with-a-given-node-and-key-from-an-index">Remove all entries with a given node and key from an index</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/kvnode/kvkey2/14</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-all-entries-with-a-given-node">Remove all entries with a given node, key and value from an index</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/kvnode/kvkey1/value1/9</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-find-node-by-exact-match">Find node by exact match</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Spaces in the URI have to be encoded as <span class="monospaced">%20</span>.</td>
</tr></table>
</div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/favorites/key/the%2520value</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "indexed" : "http://localhost:7474/db/data/index/node/favorites/key/the%2520value/19",
  "outgoing_relationships" : "http://localhost:7474/db/data/node/19/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/19/labels",
  "data" : {
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/19/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/19/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/19",
  "property" : "http://localhost:7474/db/data/node/19/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/19/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/19/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/19/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/19/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/19/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/19/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/19/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-find-node-by-query">Find node by query</h4>
<div class="paragraph"><p>The query language used here depends on what type of index you are
querying. The default index type is Lucene, in which case you should use
the Lucene query language here. Below an example of a fuzzy search over
multiple keys.</p></div>
<div class="paragraph"><p>See: <a href="http://lucene.apache.org/core/old_versioned_docs/versions/3_6_2/queryparsersyntax.html">http://lucene.apache.org/core/old_versioned_docs/versions/3_6_2/queryparsersyntax.html</a></p></div>
<div class="paragraph"><p>Getting the results with a predefined ordering requires adding the
parameter</p></div>
<div class="paragraph"><p><span class="monospaced">order=ordering</span></p></div>
<div class="paragraph"><p>where ordering is one of index, relevance or score. In this case an
additional field will be added to each result, named score, that holds
the float value that is the score reported by the query result.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/bobTheIndex?query=Name:Build~0.1%20AND%20Gender:Male</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/18/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/18/labels",
  "data" : {
    "Name" : "Builder"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/18/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/18/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/18",
  "property" : "http://localhost:7474/db/data/node/18/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/18/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/18/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/18/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/18/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/18/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/18/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/18/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-unique-indexes">Unique Indexing</h3>
<div class="paragraph"><p>For uniqueness enforcements, there are two modes:</p></div>
<div class="ulist"><ul>
<li>
<p>
URL Parameter <span class="monospaced">unique=get_or_create</span>: Create a new node/relationship and index it if no existing one can be found. If an existing node/relationship is found, discard the sent data and return the existing node/relationship.
</p>
</li>
<li>
<p>
URL Parameter <span class="monospaced">unique=create_or_fail</span>: Create a new node/relationship if no existing one can be found in the index. If an existing node/relationship is found, return a conflict error.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For more information, see <a href="#transactions-unique-nodes">[transactions-unique-nodes]</a>.</p></div>
<div class="sect3">
<h4 id="rest-api-get-or-create-unique-node-create">Get or create unique node (create)</h4>
<div class="paragraph"><p>The node is created if it doesn&#8217;t exist in the unique index already.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/people?uniqueness=get_or_create</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Tobias",
  "properties" : {
    "name" : "Tobias",
    "sequence" : 1
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/node/people/name/Tobias/17</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/17/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/17/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/17/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/17/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/17",
  "property" : "http://localhost:7474/db/data/node/17/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/17/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/17/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/17/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/17/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/17/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/17/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/17/relationships/in/{-list|&amp;|types}",
  "data" : {
    "sequence" : 1,
    "name" : "Tobias"
  },
  "indexed" : "http://localhost:7474/db/data/index/node/people/name/Tobias/17"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-or-create-unique-node-existing">Get or create unique node (existing)</h4>
<div class="paragraph"><p>Here,
a node is not created but the existing unique node returned, since another node
is indexed with the same data already. The node data returned is then that of the
already existing node.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/people?uniqueness=get_or_create</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Peter",
  "properties" : {
    "name" : "Peter",
    "sequence" : 2
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/node/people/name/Peter/12</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/12/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/12/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/12/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/12/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/12",
  "property" : "http://localhost:7474/db/data/node/12/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/12/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/12/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/12/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/12/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/12/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/12/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/12/relationships/in/{-list|&amp;|types}",
  "data" : {
    "sequence" : 1,
    "name" : "Peter"
  },
  "indexed" : "http://localhost:7474/db/data/index/node/people/name/Peter/12"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-a-unique-node-or-return-fail-create">Create a unique node or return fail (create)</h4>
<div class="paragraph"><p>Here, in case
of an already existing node, an error should be returned. In this
example, no existing indexed node is found and a new node is created.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/people?uniqueness=create_or_fail</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Tobias",
  "properties" : {
    "name" : "Tobias",
    "sequence" : 1
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/node/people/name/Tobias/16</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/16/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/16/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/16/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/16/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/16",
  "property" : "http://localhost:7474/db/data/node/16/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/16/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/16/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/16/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/16/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/16/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/16/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/16/relationships/in/{-list|&amp;|types}",
  "data" : {
    "sequence" : 1,
    "name" : "Tobias"
  },
  "indexed" : "http://localhost:7474/db/data/index/node/people/name/Tobias/16"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-a-unique-node-or-return-fail-fail">Create a unique node or return fail (fail)</h4>
<div class="paragraph"><p>Here, in case
of an already existing node, an error should be returned. In this
example, an existing node indexed with the same data
is found and an error is returned.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/people?uniqueness=create_or_fail</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Peter",
  "properties" : {
    "name" : "Peter",
    "sequence" : 2
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">409:</span></strong> <span class="monospaced">Conflict</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "outgoing_relationships" : "http://localhost:7474/db/data/node/6/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/6/labels",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/6/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/6/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/6",
  "property" : "http://localhost:7474/db/data/node/6/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/6/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/6/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/6/relationships/in",
  "create_relationship" : "http://localhost:7474/db/data/node/6/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/6/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/6/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/6/relationships/in/{-list|&amp;|types}",
  "data" : {
    "sequence" : 1,
    "name" : "Peter"
  },
  "indexed" : "http://localhost:7474/db/data/index/node/people/name/Peter/6"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-or-create-unique-relationship-create">Get or create unique relationship (create)</h4>
<div class="paragraph"><p>Create a unique relationship in an index.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/relationship/knowledge/?uniqueness=get_or_create</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Tobias",
  "start" : "http://localhost:7474/db/data/node/425",
  "end" : "http://localhost:7474/db/data/node/426",
  "type" : "knowledge"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/relationship/knowledge/name/Tobias/239</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/425",
  "property" : "http://localhost:7474/db/data/relationship/239/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/239",
  "properties" : "http://localhost:7474/db/data/relationship/239/properties",
  "type" : "knowledge",
  "end" : "http://localhost:7474/db/data/node/426",
  "data" : {
    "name" : "Tobias"
  },
  "indexed" : "http://localhost:7474/db/data/index/relationship/knowledge/name/Tobias/239"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-or-create-unique-relationship-existing">Get or create unique relationship (existing)</h4>
<div class="paragraph"><p>Here, in case
of an already existing relationship, the sent data is ignored and the
existing relationship returned.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/relationship/rels?uniqueness=get_or_create</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Peter",
  "start" : "http://localhost:7474/db/data/node/429",
  "end" : "http://localhost:7474/db/data/node/430",
  "type" : "KNOWS"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/427",
  "property" : "http://localhost:7474/db/data/relationship/240/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/240",
  "properties" : "http://localhost:7474/db/data/relationship/240/properties",
  "type" : "KNOWS",
  "end" : "http://localhost:7474/db/data/node/428",
  "data" : {
  },
  "indexed" : "http://localhost:7474/db/data/index/relationship/rels/name/Peter/240"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-a-unique-relationship-or-return-fail-create">Create a unique relationship or return fail (create)</h4>
<div class="paragraph"><p>Here, in case
of an already existing relationship, an error should be returned. In this
example, no existing relationship is found and a new relationship is created.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/relationship/rels?uniqueness=create_or_fail</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Tobias",
  "start" : "http://localhost:7474/db/data/node/437",
  "end" : "http://localhost:7474/db/data/node/438",
  "type" : "KNOWS"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/relationship/rels/name/Tobias/243</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/437",
  "property" : "http://localhost:7474/db/data/relationship/243/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/243",
  "properties" : "http://localhost:7474/db/data/relationship/243/properties",
  "type" : "KNOWS",
  "end" : "http://localhost:7474/db/data/node/438",
  "data" : {
    "name" : "Tobias"
  },
  "indexed" : "http://localhost:7474/db/data/index/relationship/rels/name/Tobias/243"
}</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-a-unique-relationship-or-return-fail-fail">Create a unique relationship or return fail (fail)</h4>
<div class="paragraph"><p>Here, in case
of an already existing relationship, an error should be returned. In this
example, an existing relationship is found and an error is returned.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/relationship/rels?uniqueness=create_or_fail</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "key" : "name",
  "value" : "Peter",
  "start" : "http://localhost:7474/db/data/node/419",
  "end" : "http://localhost:7474/db/data/node/420",
  "type" : "KNOWS"
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">409:</span></strong> <span class="monospaced">Conflict</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/417",
  "property" : "http://localhost:7474/db/data/relationship/236/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/236",
  "properties" : "http://localhost:7474/db/data/relationship/236/properties",
  "type" : "KNOWS",
  "end" : "http://localhost:7474/db/data/node/418",
  "data" : {
  },
  "indexed" : "http://localhost:7474/db/data/index/relationship/rels/name/Peter/236"
}</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-auto-indexes">Legacy Automatic Indexes</h3>
<div class="paragraph"><p>To enable automatic indexes in neo4j, set up the database for that, see <a href="#auto-indexing-config">[auto-indexing-config]</a>. With this feature enabled, you can then index and query nodes in these indexes.</p></div>
<div class="sect3">
<h4 id="rest-api-find-node-by-exact-match-from-an-automatic-index">Find node by exact match from an automatic index</h4>
<div class="paragraph"><p>Automatic index nodes can be found via exact lookups with normal Index
REST syntax.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/auto/node/name/I</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/358/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/358/labels",
  "data" : {
    "name" : "I"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/358/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/358/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/358",
  "property" : "http://localhost:7474/db/data/node/358/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/358/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/358/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/358/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/358/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/358/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/358/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/358/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-find-node-by-query-from-an-automatic-index">Find node by query from an automatic index</h4>
<div class="paragraph"><p>See Find node by query for the actual query syntax.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/auto/node/?query=name:I</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/349/relationships/out",
  "labels" : "http://localhost:7474/db/data/node/349/labels",
  "data" : {
    "name" : "I"
  },
  "all_typed_relationships" : "http://localhost:7474/db/data/node/349/relationships/all/{-list|&amp;|types}",
  "traverse" : "http://localhost:7474/db/data/node/349/traverse/{returnType}",
  "self" : "http://localhost:7474/db/data/node/349",
  "property" : "http://localhost:7474/db/data/node/349/properties/{key}",
  "properties" : "http://localhost:7474/db/data/node/349/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/349/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/349/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/349/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/349/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/349/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/349/relationships/in/{-list|&amp;|types}"
} ]</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-configurable-auto-indexes">Configurable Legacy Automatic Indexing</h3>
<div class="paragraph"><p>Out of the box auto-indexing supports exact matches since they are created with the default configuration (see <a href="#auto-indexing">[auto-indexing]</a>) the first time you access them. However it is possible to intervene in the lifecycle of the server before any auto indexes are created to change their configuration.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">This approach <em>cannot</em> be used on databases that already have auto-indexes established. To change the auto-index configuration existing indexes would have to be deleted first, so be careful!</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">This technique works, but it is not particularly pleasant. Future versions of Neo4j may remove this loophole in favour of a better structured feature for managing auto-indexing configurations.</td>
</tr></table>
</div>
<div class="paragraph"><p>Auto-indexing must be enabled through configuration before we can create or configure them. Firstly ensure that you&#8217;ve added some config like this into your server&#8217;s <span class="monospaced">neo4j.properties</span> file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">node_auto_indexing=true
relationship_auto_indexing=true
node_keys_indexable=name,phone
relationship_keys_indexable=since</pre></div>
<div class="paragraph"><p>The <span class="monospaced">node_auto_indexing</span> and <span class="monospaced">relationship_auto_indexing</span> settings turn auto-indexing on for nodes and relationships respectively. The <span class="monospaced">node_keys_indexable</span> key allows you to specify a comma-separated list of node property keys to be indexed. The <span class="monospaced">relationship_keys_indexable</span> does the same for relationship property keys.</p></div>
<div class="paragraph"><p>Next start the server as usual by invoking the start script as described in <a href="#server-installation">[server-installation]</a>.</p></div>
<div class="paragraph"><p>Next we have to pre-empt the creation of an auto-index, by telling the server to create an apparently manual index which has the same name as the node (or relationship) auto-index. For example, in this case we&#8217;ll create a node auto index whose name is <span class="monospaced">node_auto_index</span>, like so:</p></div>
<div class="sect3">
<h4 id="rest-api-create-an-auto-index-for-nodes-with-specific-configuration">Create an auto index for nodes with specific configuration</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/node/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "name" : "node_auto_index",
  "config" : {
    "type" : "fulltext",
    "provider" : "lucene"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/node/node_auto_index/</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "template" : "http://localhost:7474/db/data/index/node/node_auto_index/{key}/{value}",
  "type" : "fulltext",
  "provider" : "lucene"
}</pre></div>
<div class="paragraph"><p>If you require configured auto-indexes for relationships, the approach is similar:</p></div>
</div>
<div class="sect3">
<h4 id="rest-api-create-an-auto-index-for-relationships-with-specific-configuration">Create an auto index for relationships with specific configuration</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/relationship/</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "name" : "relationship_auto_index",
  "config" : {
    "type" : "fulltext",
    "provider" : "lucene"
  }
}</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">201:</span></strong> <span class="monospaced">Created</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Location:</span></strong> <span class="monospaced">http://localhost:7474/db/data/index/relationship/relationship_auto_index/</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">{
  "template" : "http://localhost:7474/db/data/index/relationship/relationship_auto_index/{key}/{value}",
  "type" : "fulltext",
  "provider" : "lucene"
}</pre></div>
<div class="paragraph"><p>In case you&#8217;re curious how this works, on the server side it triggers the creation of an index which happens to have the same name as the auto index that the database would create for itself. Now when we interact with the database, the index thinks the index is already created so the state machine skips over that step and just gets on with normal day-to-day auto-indexing.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">You have to do this early in your server lifecycle, before any normal auto indexes are created.</td>
</tr></table>
</div>
<div class="paragraph"><p>There are a few REST calls providing a REST interface to the <a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/index/AutoIndexer.html">AutoIndexer</a> component. The following REST calls work both, for <span class="monospaced">node</span> and <span class="monospaced">relationship</span> by simply changing the respective part of the URL.</p></div>
</div>
<div class="sect3">
<h4 id="rest-api-get-current-status-for-autoindexing-on-nodes">Get current status for autoindexing on nodes</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/auto/node/status</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">false</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-enable-node-autoindexing">Enable node autoindexing</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">PUT</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/auto/node/status</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">true</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-lookup-list-of-properties-being-autoindexed">Lookup list of properties being autoindexed</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/auto/node/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">200:</span></strong> <span class="monospaced">OK</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">[ "some-property" ]</pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-add-a-property-for-autoindexing-on-nodes">Add a property for autoindexing on nodes</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/auto/node/properties</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Content-Type:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript">myProperty1</pre></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect3">
<h4 id="rest-api-remove-a-property-for-autoindexing-on-nodes">Remove a property for autoindexing on nodes</h4>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">DELETE</span></strong>  <span class="monospaced">http://localhost:7474/db/data/index/auto/node/properties/myProperty1</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">204:</span></strong> <span class="monospaced">No Content</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="rest-api-wadl-support">WADL Support</h3>
<div class="paragraph"><p>The Neo4j REST API is a truly RESTful interface relying on hypermedia controls (links) to advertise permissible
actions to users. Hypermedia is a dynamic interface style where declarative constructs (semantic markup) are used
to inform clients of their next legal choices just in time.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">RESTful APIs cannot be modelled by static interface description languages like WSDL or WADL.</td>
</tr></table>
</div>
<div class="paragraph"><p>However for some use cases, developers may wish to expose WADL descriptions of the Neo4j REST API, particularly when
using tooling that expects such.</p></div>
<div class="paragraph"><p>In those cases WADL generation may be enabled by adding to your server&#8217;s <span class="monospaced">neo4j.properties</span> file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">unsupported_wadl_generation_enabled=true</pre></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">WADL is not an officially supported part of the Neo4j server API because WADL is insufficiently expressive to capture
the set of potential interactions a client can drive with Neo4j server. Expect the WADL description to be incomplete,
and in some cases contradictory to the real API. In any cases where the WADL description disagrees with the REST API,
the REST API should be considered authoritative. WADL generation may be withdrawn at any point in the Neo4j release
cycle.</td>
</tr></table>
</div>
</div>
</div>
</div>
<h1 id="operations">Operations</h1>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>This part describes how to install and maintain a Neo4j installation.
This includes topics such as backing up the database and monitoring the health of the database as well as diagnosing issues.</p></div>
</div></div>
<div class="sect1">
<h2 id="deployment">Installation &amp; Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="deployment-scenarios">Deployment Scenarios</h3>
<div class="paragraph"><p>Neo4j can be embedded into your application, run as a standalone server or deployed on several machines to provide high availability.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 5. Neo4j deployment options</caption>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >            </th>
<th class="tableblock halign-left valign-top" > Single Instance       </th>
<th class="tableblock halign-left valign-top" > Multiple Instances</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock header">Embedded</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">EmbeddedGraphDatabase</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HighlyAvailableGraphDatabase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock header">Standalone</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Neo4j Server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Neo4j Server high availability mode</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_server">Server</h4>
<div class="paragraph"><p>Neo4j is normally accessed as a standalone server, either directly through a REST interface or through a language-specific driver.
More information about Neo4j server is found in <a href="#server">[server]</a>.
For running the server and embedded installations in high availability mode, see <a href="#ha">[ha]</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_embedded">Embedded</h4>
<div class="paragraph"><p>Neo4j can be embedded directly in a server application by including the appropriate Java libraries.
When programming, you can refer to the <span class="monospaced"><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/graphdb/GraphDatabaseService.html">GraphDatabaseService</a></span> API.
To switch from a single instance to multiple highly available instances, simply switch from the concrete <span class="monospaced"><a href="http://components.neo4j.org/neo4j/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/EmbeddedGraphDatabase.html">EmbeddedGraphDatabase</a></span> to the <span class="monospaced"><a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/HighlyAvailableGraphDatabase.html">HighlyAvailableGraphDatabase</a></span>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="deployment-requirements">System Requirements</h3>
<div class="paragraph"><p>Memory constrains graph size, disk I/O constrains read/write performance, as always.</p></div>
<div class="sect3">
<h4 id="_cpu">CPU</h4>
<div class="paragraph"><p>Performance is generally memory or I/O bound for large graphs, and compute bound for graphs which fit in memory.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Minimum
</dt>
<dd>
<p>
Intel Core i3
</p>
</dd>
<dt class="hdlist1">
Recommended
</dt>
<dd>
<p>
Intel Core i7
</p>
</dd>
</dl></div>
</div>
<div class="sect3">
<h4 id="_memory">Memory</h4>
<div class="paragraph"><p>More memory allows even larger graphs, but runs the risk of inducing larger Garbage Collection operations.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Minimum
</dt>
<dd>
<p>
2GB
</p>
</dd>
<dt class="hdlist1">
Recommended
</dt>
<dd>
<p>
16&#8212;32GB or more
</p>
</dd>
</dl></div>
</div>
<div class="sect3">
<h4 id="_disk">Disk</h4>
<div class="paragraph"><p>Aside from capacity, the performance characteristics of the disk are the most important when selecting storage.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Minimum
</dt>
<dd>
<p>
10GB SATA
</p>
</dd>
<dt class="hdlist1">
Recommended
</dt>
<dd>
<p>
SSD w/ SATA
</p>
</dd>
</dl></div>
</div>
<div class="sect3">
<h4 id="_filesystem">Filesystem</h4>
<div class="paragraph"><p>For proper ACID behavior, the filesystem must support flush (fsync, fdatasync).</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Minimum
</dt>
<dd>
<p>
ext4 (or similar)
</p>
</dd>
<dt class="hdlist1">
Recommended
</dt>
<dd>
<p>
ext4, ZFS
</p>
</dd>
</dl></div>
</div>
<div class="sect3">
<h4 id="_software">Software</h4>
<div class="paragraph"><p>Neo4j is Java-based.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Java
</dt>
<dd>
<p>
<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java 7</a>
</p>
</dd>
<dt class="hdlist1">
Operating Systems
</dt>
<dd>
<p>
Linux, HP UX, Windows 2008 for production; additionally Windows XP, Mac OS X for development.
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect2">
<h3 id="deployment-installation">Installation</h3>
<div class="paragraph"><p>Neo4j can be installed as a server, running either as a headless application or system service.
For Java developers, it is also possible to use Neo4j as a library, embedded in your application.</p></div>
<div class="paragraph"><p>For information on installing Neo4j as a server, see <a href="#server-installation">[server-installation]</a>.</p></div>
<div class="paragraph"><p>The following table outlines the available editions and their names for use with dependency management tools.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Follow the links in the table for details on dependency configuration with Apache Maven, Apache Buildr, Apache Ivy and Groovy Grape!</td>
</tr></table>
</div>
<table class="tableblock frame-all grid-all" id="editions"
style="
width:100%;
">
<caption class="title">Table 6. Neo4j editions</caption>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Edition     </th>
<th class="tableblock halign-left valign-top" >Dependency      </th>
<th class="tableblock halign-left valign-top" >Description  </th>
<th class="tableblock halign-left valign-top" >License</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Community</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="http://search.maven.org/#search|gav|1|g%3A%22org.neo4j%22%20AND%20a%3A%22neo4j%22">org.neo4j:neo4j</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a high performance, fully ACID transactional graph database</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">GPLv3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Advanced</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="http://search.maven.org/#search|gav|1|g%3A%22org.neo4j%22%20AND%20a%3A%22neo4j-advanced%22">org.neo4j:neo4j-advanced</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">adding advanced monitoring</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">AGPLv3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Enterprise</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="http://search.maven.org/#search|gav|1|g%3A%22org.neo4j%22%20AND%20a%3A%22neo4j-enterprise%22">org.neo4j:neo4j-enterprise</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">adding online backup and High Availability clustering</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">AGPLv3</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The listed dependencies do not contain the implementation, but pulls it in transitively.</td>
</tr></table>
</div>
<div class="paragraph"><p>For more information regarding licensing, see the <a href="http://www.neo4j.org/learn/licensing">Licensing Guide</a>.</p></div>
<div class="sect3">
<h4 id="_embedded_installation">Embedded Installation</h4>
<div class="paragraph"><p>The latest release is always available from <a href="http://neo4j.org/download">http://neo4j.org/download</a>, included as part of the Neo4j download packages.
After selecting the appropriate version for your platform, embed Neo4j in your Java application by including the Neo4j library jars in your build.
Either take the jar files from the <em>lib/</em> directory of the download, or directly use the artifacts available from Maven Central Repository <span class="footnote"><br>[<a href="http://repo1.maven.org/maven2/org/neo4j/">http://repo1.maven.org/maven2/org/neo4j/</a>]<br></span>. Stable and milestone releases are available there.</p></div>
<div class="listingblock">
<div class="title">Maven dependency</div>
<pre class="programlisting brush: xml">&lt;project&gt;
...
 &lt;dependencies&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
   &lt;artifactId&gt;neo4j&lt;/artifactId&gt;
   &lt;version&gt;2.0-SNAPSHOT&lt;/version&gt;
  &lt;/dependency&gt;
  ...
 &lt;/dependencies&gt;
...
&lt;/project&gt;</pre></div>
<div class="paragraph"><p><em>Where the <span class="monospaced">artifactId</span> is one of <span class="monospaced">neo4j</span>, <span class="monospaced">neo4j-advanced</span>, <span class="monospaced">neo4j-enterprise</span>.</em></p></div>
</div>
<div class="sect3">
<h4 id="_server_installation">Server Installation</h4>
<div class="paragraph"><p>please refer to <a href="#server">[server]</a> and <a href="#server-installation">[server-installation]</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="deployment-upgrading">Upgrading</h3>
<div class="paragraph"><p>A database can be upgraded from a minor version to the next, e.g. 1.1 &#8594; 1.2, and 1.2 &#8594; 1.3,
but you can not jump directly from 1.1 &#8594; 1.3. For version 1.8 in particular, it is possible to
upgrade directly from version 1.5.3 and later, as an explicit upgrade.
The upgrade process is a one way step; databases cannot be downgraded.</p></div>
<div class="paragraph"><p>For most upgrades, only small changes are required to the database store, and these changes proceed
automatically when you start up the database using the newer version of Neo4j.</p></div>
<div class="paragraph"><p>However, some upgrades require more significant changes to the database store.
In these cases, Neo4j will refuse to start without explicit configuration to allow the upgrade.</p></div>
<div class="paragraph"><p>The table below lists recent Neo4j versions, and the type of upgrade required.</p></div>
<table class="tableblock frame-topbot grid-none"
style="
width:50%;
">
<caption class="title">Table 7. Upgrade process for Neo4j version</caption>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >From Version</th>
<th class="tableblock halign-left valign-top" >To Version</th>
<th class="tableblock halign-left valign-top" >Upgrade Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Automatic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Explicit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Explicit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.7</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Automatic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.7</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Automatic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1.9.M02</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Automatic</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Downgrade is supported only between versions which do not have incompatible store layouts.
That means that if you did an upgrade where you didn&#8217;t have to explicitly set the <span class="monospaced">allow_store_upgrade</span> flag to false then you can downgrade without any problems to the previous version used.
Otherwise downgrading is not supported.
In any case, downgrading currently cannot be done in a rolling fashion, even in HA deployments.
Instead, the whole cluster must be shutdown and each machine downgraded individually and then service can be resumed.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_automatic_upgrade">Automatic Upgrade</h4>
<div class="paragraph"><p>To perform a normal upgrade (for minor changes to the database store):</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
download the newer version of Neo4j
</p>
</li>
<li>
<p>
cleanly shutdown the database to upgrade, if it is running
</p>
</li>
<li>
<p>
startup the database with the newer version of Neo4j
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_explicit_upgrade">Explicit Upgrade</h4>
<div class="paragraph"><p>To perform a special upgrade (for significant changes to the database store):</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
make sure the database you are upgrading has been cleanly shut down
</p>
</li>
<li>
<p>
set the Neo4j configuration parameter "<span class="monospaced">allow_store_upgrade=true</span>" in your <em>neo4j.properties</em> or embedded configuration
</p>
</li>
<li>
<p>
start the database
</p>
</li>
<li>
<p>
the upgrade will happen during startup and the process is done when the database has been successfully started
</p>
</li>
<li>
<p>
"<span class="monospaced">allow_store_upgrade=true</span>" configuration parameter should be removed, set to "<span class="monospaced">false</span>" or commented out
</p>
</li>
<li>
<p>
information about the upgrade and progress indicator is printed in <span class="monospaced">messages.log</span>
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="deployment-upgrading-one-nine">Upgrade 1.8 &#8594; 1.9.M02</h4>
<div class="paragraph"><p>There are no store format changes between these versions so upgrading standalone instances simply consists of starting the database with the newer version.
In the case of High Availability (HA) installations, the communication protocol and the master election algorithm have changed and a new "rolling upgrade"
feature has been added, removing the need to shut down the entire cluster. For more information, refer to the "Upgrading a Neo4j HA Cluster" chapter
of the HA section of the Neo4j manual.</p></div>
</div>
<div class="sect3">
<h4 id="deployment-upgrading-one-eight">Upgrade 1.7 &#8594; 1.8</h4>
<div class="paragraph"><p>There are no store format changes between these versions so upgrading standalone instances simply consists of starting the database with the newer version.
In the case of High Availability (HA) installations, the communication protocol and the master election algorithm have changed and a new "rolling upgrade"
feature has been added, removing the need to shut down the entire cluster. For more information, refer to the "Upgrading a Neo4j HA Cluster" chapter
of the HA section of the Neo4j manual.</p></div>
</div>
<div class="sect3">
<h4 id="deployment-upgrading-one-seven">Upgrade 1.6 &#8594; 1.7</h4>
<div class="paragraph"><p>There are no store format changes between these versions, which means there is no particular procedure you need to upgrade a single instance.</p></div>
<div class="paragraph"><p>In an HA environment these steps need to be performed:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
shut down all the databases in the cluster
</p>
</li>
<li>
<p>
shut down the ZooKeeper cluster and clear the <em>version-2</em> directories on all the ZooKeeper instances
</p>
</li>
<li>
<p>
start the ZooKeeper cluster again
</p>
</li>
<li>
<p>
remove the databases except the master and start the master database with 1.7
</p>
</li>
<li>
<p>
start up the other databases so that they get a copy from the master
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="deployment-upgrading-one-six">Upgrade 1.5 &#8594; 1.6</h4>
<div class="paragraph"><p>This upgrade changes lucene version from 3.1 to 3.5. The upgrade itself is done by Lucene by loading an index.</p></div>
<div class="paragraph"><p>In an HA environment these steps need to be performed:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
shut down all the databases in the cluster
</p>
</li>
<li>
<p>
shut down the ZooKeeper cluster and clear the <em>version-2</em> directories on all the ZooKeeper instances
</p>
</li>
<li>
<p>
start the ZooKeeper cluster again
</p>
</li>
<li>
<p>
start up the other databases so that they get a copy from the master
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="deployment-upgrading-one-five">Upgrade 1.4 &#8594; 1.5</h4>
<div class="paragraph"><p>This upgrade includes a significant change to the layout of property store files, which reduces their size on disk,
and improves IO performance.  To achieve this layout change, the upgrade process takes some time to process the
whole of the existing database.  You should budget for several minutes per gigabyte of data as part of your upgrade planning.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">The upgrade process for this upgrade temporarily requires additional disk space, for the period while the
upgrade is in progress.  Before starting the upgrade to Neo4j 1.5, you should ensure that the machine performing the
upgrade has free space equal to the current size of of the database on disk.  You can find the current space occupied
by the database by inspecting the store file directory (<em>data/graph.db</em> is the default location in Neo4j server).
Once the upgrade is complete, this additional space is no longer required.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="usage-data-collector">Usage Data Collector</h3>
<div class="paragraph"><p>The Neo4j Usage Data Collector is a sub-system that gathers usage data, reporting it to the UDC-server at udc.neo4j.org.
It is easy to disable, and does not collect any data that is confidential. For more information about what is being sent, see below.</p></div>
<div class="paragraph"><p>The Neo4j team uses this information as a form of automatic, effortless feedback from the Neo4j community.
We want to verify that we are doing the right thing by matching download statistics with usage statistics.
After each release, we can see if there is a larger retention span of the server software.</p></div>
<div class="paragraph"><p>The data collected is clearly stated here.
If any future versions of this system collect additional data, we will clearly announce those changes.</p></div>
<div class="paragraph"><p>The Neo4j team is very concerned about your privacy. We do not disclose any personally identifiable information.</p></div>
<div class="sect3">
<h4 id="_technical_information">Technical Information</h4>
<div class="paragraph"><p>To gather good statistics about Neo4j usage, UDC collects this information:</p></div>
<div class="ulist"><ul>
<li>
<p>
Kernel version: The build number, and if there are any modifications to the kernel.
</p>
</li>
<li>
<p>
Store id: A randomized globally unique id created at the same time a database is created.
</p>
</li>
<li>
<p>
Ping count: UDC holds an internal counter which is incremented for every ping, and reset for every restart of the kernel.
</p>
</li>
<li>
<p>
Source: This is either "neo4j" or "maven". If you downloaded Neo4j from the Neo4j website, it&#8217;s "neo4j", if you are using Maven to get Neo4j, it will be "maven".
</p>
</li>
<li>
<p>
Java version: The referrer string shows which version of Java is being used.
</p>
</li>
<li>
<p>
MAC address to uniquely identify instances behind firewalls.
</p>
</li>
<li>
<p>
Registration id: For registered server instances.
</p>
</li>
<li>
<p>
Tags about the execution context (e.g. test, language, web-container, app-container, spring, ejb).
</p>
</li>
<li>
<p>
Neo4j Edition (community, advanced, enterprise).
</p>
</li>
<li>
<p>
A hash of the current cluster name (if any).
</p>
</li>
<li>
<p>
Distribution information for Linux (rpm, dpkg, unknown).
</p>
</li>
<li>
<p>
User-Agent header for tracking usage of REST client drivers
</p>
</li>
</ul></div>
<div class="paragraph"><p>After startup, UDC waits for ten minutes before sending the first ping. It does this for two reasons; first, we don&#8217;t want the startup to be slower because of UDC, and secondly, we want to keep pings from automatic tests to a minimum. The ping to the UDC servers is done with a HTTP GET.</p></div>
</div>
<div class="sect3">
<h4 id="_how_to_disable_udc">How to disable UDC</h4>
<div class="paragraph"><p>We&#8217;ve tried to make it extremely easy to disable UDC. In fact, the code for UDC is not even included in the kernel jar but as a completely separate component.</p></div>
<div class="paragraph"><p>There are three ways you can disable UDC:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The easiest way is to just remove the neo4j-udc-*.jar file. By doing this, the kernel will not load UDC, and no pings will be sent.
</p>
</li>
<li>
<p>
If you are using Maven, and want to make sure that UDC is never installed in your system, a dependency element like this will do that:
</p>
<div class="listingblock">
<pre class="programlisting brush: xml"> &lt;dependency&gt;
   &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
   &lt;artifactId&gt;neo4j&lt;/artifactId&gt;
   &lt;version&gt;${neo4j-version}&lt;/version&gt;
   &lt;exclusions&gt;
     &lt;exclusion&gt;
       &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
       &lt;artifactId&gt;neo4j-udc&lt;/artifactId&gt;
     &lt;/exclusion&gt;
   &lt;/exclusions&gt;
 &lt;/dependency&gt;</pre></div>
<div class="paragraph"><p><em>Where ${neo4j-version} is the Neo4j version in use.</em></p></div>
</li>
<li>
<p>
Lastly, if you are using a packaged version of Neo4j, and do not want to make any change to the jars, a system property setting like this will also make sure that UDC is never activated: <span class="monospaced">-Dneo4j.ext.udc.disable=true</span>.
</p>
</li>
</ol></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="embedded-configuration">Configuration &amp; Performance</h2>
<div class="sectionbody">
<div class="paragraph"><p>In order to get optimum performance out of Neo4j for your application there are a few parameters that can be tweaked.
The two main components that can be configured are the Neo4j caches and the JVM that Neo4j runs in.
The following sections describe how to tune these.</p></div>
<div class="sect2">
<h3 id="configuration-introduction">Introduction</h3>
<div class="paragraph"><p>To gain good performance, these are the things to look into first:</p></div>
<div class="ulist"><ul>
<li>
<p>
Make sure the JVM is not spending too much time performing garbage collection.
  Monitoring heap usage on an application that uses Neo4j can be a bit confusing since Neo4j will increase the size of caches if there is available memory and decrease if the heap is getting full.
  The goal is to have a large enough heap to make sure that heavy/peak load will not result in so called GC trashing (performance can drop as much as two orders of magnitude when GC trashing happens).
</p>
</li>
<li>
<p>
Start the JVM with the -server flag and a good sized heap (see <a href="#configuration-jvm">[configuration-jvm]</a>). Having too large heap may also hurt performance so you may have to try some different heap sizes.
</p>
</li>
<li>
<p>
Use the parallel/concurrent garbage collector (we found that <span class="monospaced">-XX:+UseConcMarkSweepGC</span> works well in most use-cases)
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_how_to_add_configuration_settings">How to add configuration settings</h4>
<div class="paragraph"><p>When creating the embedded Neo4j instance it is possible to pass in parameters contained in a map where keys and values are strings, see <a href="#tutorials-java-embedded-setup-config">[tutorials-java-embedded-setup-config]</a> for an example.</p></div>
<div class="paragraph"><p>If no configuration is provided, the Database Kernel will try to determine suitable settings from the information available via the JVM settings and the underlying operating system.</p></div>
<div class="paragraph"><p>The JVM is configured by passing command line flags when starting the JVM.
The most important configuration parameters for Neo4j are the ones that control the memory and garbage collector, but some of the parameters for configuring the Just In Time compiler are also of interest.</p></div>
<div class="paragraph"><p>This is an example of starting up your applications main class using 64-bit server VM mode and a heap space of 1GB:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">java -d64 -server -Xmx1024m -cp /path/to/neo4j-kernel.jar:/path/to/jta.jar:/path/to/your-application.jar com.example.yourapp.MainClass</pre></div>
<div class="paragraph"><p>Looking at the example above you will also notice one of the most basic command line parameters: the one for specifying the classpath. The classpath is the path in which the JVM searches for your classes. It is usually a list of jar-files. Specifying the classpath is done by specifying the flag <span class="monospaced">-cp</span> (or <span class="monospaced">-classpath</span>) and then the value of the classpath. For Neo4j applications this should at least include the path to the Neo4j <span class="monospaced">neo4j-kernel.jar</span> and the Java Transaction API (<span class="monospaced">jta.jar</span>) as well as the path where the classes for your application are located.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">On Linux, Unix and Mac OS X each element in the path list are separated by a colon symbol (<span class="monospaced">:</span>), on Windows the path elements are separated by a semicolon (<span class="monospaced">;</span>).</td>
</tr></table>
</div>
<div class="paragraph"><p>When using the Neo4j REST server, see <a href="#server-configuration">[server-configuration]</a> for how to add configuration settings for the database to the server.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="performance-guide">Performance Guide</h3>
<div class="paragraph"><p>This is the Neo4j performance guide. It will attempt to guide you in how to use Neo4j to achieve maximum performance.</p></div>
<div class="sect3">
<h4 id="_try_this_first">Try this first</h4>
<div class="paragraph"><p>The first thing is to make sure the JVM is running well and not spending to much
time in garbage collection. Monitoring heap usage on an application that uses Neo4j
can be a bit confusing since Neo4j will increase the size of caches if there is
available memory and decrease if the heap is getting full. The goal is to have a
large enough heap so heavy/peak load will not result in so called GC trashing
(performance can drop as much as two orders of magnitude when this happens).</p></div>
<div class="paragraph"><p>Start the JVM with <span class="monospaced">-server</span> flag and <span class="monospaced">-Xmx&lt;good sized heap&gt;</span>
(f.ex. -Xmx512M for 512Mb memory or -Xmx3G for 3Gb memory). Having too large heap
may also hurt performance so you may have to try some different heap sizes.
Make sure parallel/concurrent garbage collector is running (<span class="monospaced">-XX:+UseConcMarkSweepGC</span> works well in most use-cases).</p></div>
<div class="paragraph"><p>Finally make sure the OS has some memory to manage proper file system
caches meaning if your server has 8GB of RAM don&#8217;t use all of that RAM for
heap (unless you turned off memory mapped buffers) but leave a good size of it to the OS.
For more information on this see <a href="#embedded-configuration">[embedded-configuration]</a>.</p></div>
<div class="paragraph"><p>For Linux specific tweaks, see <a href="#linux-performance-guide">[linux-performance-guide]</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_neo4j_primitives_lifecycle">Neo4j primitives' lifecycle</h4>
<div class="paragraph"><p>Neo4j manages its primitives (nodes, relationships and properties)
different depending on how you use Neo4j. For example if you never get a
property from a certain node or relationship that node or relationship will
not have its properties loaded into memory. The first time, after loading a node or relationship,
any property is accessed all the properties are loaded for that entity. If any of those properties
contain an array larger than a few elements or a long string such values are loaded
on demand when requesting them individually. Similarly, relationships of a node will
only be loaded the first time they are requested for that node.</p></div>
<div class="paragraph"><p>Nodes and relationships are cached using LRU caches. If you (for some strange reason)
only work with nodes the relationship cache will become smaller and smaller while the
node cache is allowed to grow (if needed). Working with many relationships and few nodes
results in bigger relationship cache and smaller node cache.</p></div>
<div class="paragraph"><p>The Neo4j API specification does not say anything about order regarding
relationships so invoking</p></div>
<div class="listingblock">
<pre class="programlisting brush: java">Node.getRelationships()</pre></div>
<div class="paragraph"><p>may return the relationships in a different order than the previous invocation.
This allows us to make even heavier optimizations returning the relationships
that are most commonly traversed.</p></div>
<div class="paragraph"><p>All in all Neo4j has been designed to be very adaptive depending on how it
is used. The (unachievable) overall goal is to be able to handle any incoming
operation without having to go down and work with the file/disk I/O layer.</p></div>
</div>
<div class="sect3">
<h4 id="_configuring_neo4j">Configuring Neo4j</h4>
<div class="paragraph"><p>In <a href="#embedded-configuration">[embedded-configuration]</a> page there&#8217;s information on how to configure Neo4j and the JVM.
These settings have a lot impact on performance.</p></div>
<div class="sect4">
<h5 id="_disks_ram_and_other_tips">Disks, RAM and other tips</h5>
<div class="paragraph"><p>As always, as with any persistence solution, performance is very much depending on the
persistence media used. Better disks equals better performance.</p></div>
<div class="paragraph"><p>If you have multiple disks or persistence media available it may be a
good idea to split the store files and transaction logs across those disks.
Having the store files running on disks with low seek time can do wonders for
non cached read operations. Today a typical mechanical drive has an average
seek time of about 5ms, this can cause a query or traversal to be very slow
when available RAM is too low or caches and memory mapped settings are badly
configured. A new good SATA enabled SSD has an average seek time of &lt;100 microseconds
meaning those scenarios will execute at least 50 times faster.</p></div>
<div class="paragraph"><p>To avoid hitting disk you need more RAM. On a standard mechanical drive you
can handle graphs with a few tens of millions of primitives with 1-2GB of RAM.
4-8GB of RAM can handle graphs with hundreds of millions of primitives while you
need a good server with 16-32GB to handle billions of primitives. However, if you
invest in a good SSD you will be able to handle much larger graphs on less RAM.</p></div>
<div class="paragraph"><p>Neo4j likes Java 1.6 JVMs and running in server mode so consider upgrading
to that if you haven&#8217;t yet (or at least give the -server flag). Use tools like <span class="monospaced">vmstat</span> or
equivalent to gather info when your application is running. If you have high I/O
waits and not that many blocks going out/in to disks when running write/read
transactions its a sign that you need to tweak your Java heap, Neo4j cache
and memory mapped settings (maybe even get more RAM or better disks).</p></div>
</div>
<div class="sect4">
<h5 id="_write_performance">Write performance</h5>
<div class="paragraph"><p>If you are experiencing poor write performance after writing some data
(initially fast, then massive slowdown) it may be the operating system
writing out dirty pages from the memory mapped regions of the store files.
These regions do not need to be written out to maintain consistency so to
achieve highest possible write speed that type of behavior should be avoided.</p></div>
<div class="paragraph"><p>Another source of writes slow down can be the transaction size. Many small
transactions result in a lot of I/O writes to disc and should be avoided.
Too big transactions can result in OutOfMemory errors, since the uncommitted
transaction data is held on the Java Heap in memory. On details about transaction
management in Neo4j, please read the <a href="#transactions">[transactions]</a> guidelines.</p></div>
<div class="paragraph"><p>The Neo4j kernel makes use of several store files and a logical log file
to store the graph on disk. The store files contain the actual graph and the
log contains modifying operations. All writes to the logical log are append-only
and when a transaction is committed changes to the logical log will be forced
(<span class="monospaced">fdatasync</span>) down to disk. The store files are however not flushed to disk and
writes to them are not append-only either. They will be written to in a more or
less random pattern (depending on graph layout) and writes will not be forced to
disk until the log is rotated or the Neo4j kernel is shut down.</p></div>
<div class="paragraph"><p>Since random writes to memory mapped regions for the store files may
happen it is very important that the data does not get written out to disk unless
needed. Some operating systems have very aggressive settings regarding when to write
out these dirty pages to disk. If the OS decides to start writing out dirty pages
of these memory mapped regions, write access to disk will stop being sequential and
become random. That hurts performance a lot, so to get maximum write performance when
using Neo4j make sure the OS is configured not to write out any of the dirty pages
caused by writes to the memory mapped regions of the store files. As an example,
if the machine has 8GB of RAM and the total size of the store files is 4GB (fully
memory mapped) the OS has to be configured to accept at least 50% dirty pages in
virtual memory to make sure we do not get random disk writes.</p></div>
<div class="paragraph"><p>Note: make sure to read the <a href="#linux-performance-guide">[linux-performance-guide]</a> as well for more specific information.</p></div>
</div>
<div class="sect4">
<h5 id="_second_level_caching">Second level caching</h5>
<div class="paragraph"><p>While normally building applications and "always assume the graph is in memory",
sometimes it is necessary to optimize certain performance critical sections.
Neo4j adds a small overhead even if the node, relationship or property in question
is cached when you compare to in memory data structures. If this becomes an
issue use a profiler to find these hot spots and then add your own second-level
caching. We believe second-level caching should be avoided to greatest extend
possible since it will force you to take care of invalidation which sometimes
can be hard. But when everything else fails you have to use it so here is an
example of how it can be done.</p></div>
<div class="paragraph"><p>We have some POJO that wrapps a node holding its state. In this particular
POJO we&#8217;ve overridden the equals implementation.</p></div>
<div class="listingblock">
<pre class="programlisting brush: java">   public boolean equals( Object obj )
   {
       return underlyingNode.getProperty( "some_property" ).equals( obj );
   }

   public int hashCode()
   {
       return underlyingNode.getProperty( "some_property" ).hashCode();
   }</pre></div>
<div class="paragraph"><p>This works fine in most scenarios but in this particular scenario many instances of that POJO is being worked with in nested loops adding/removing/getting/finding to collection classes. Profiling the applications will show that the equals implementation is being called many times and can be viewed as a hot spot. Adding second-level caching for the equals override will in this particular scenario increase performance.</p></div>
<div class="listingblock">
<pre class="programlisting brush: java">    private Object cachedProperty = null;

    public boolean equals( Object obj )
    {
       if ( cachedProperty == null )
       {
           cachedProperty = underlyingNode.getProperty( "some_property" );
       }
       return cachedProperty.equals( obj );
    }

    public int hashCode()
    {
       if ( cachedPropety == null )
       {
           cachedProperty = underlyingNode.getProperty( "some_property" );
       }
       return cachedProperty.hashCode();
    }</pre></div>
<div class="paragraph"><p>The problem now is that we need to invalidate the cached property whenever the <span class="monospaced">some_property</span>
is changed (may not be a problem in this scenario since the state picked for equals and hash
code computation often won&#8217;t change).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">To sum up, avoid second-level caching if possible and only add it when you really need it.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kernel-configuration">Kernel configuration</h3>
<div class="paragraph"><p>These are the configuration options you can pass to the neo4j kernel. They
can either be passed as a map when using the embedded database, or in the
neo4j.properties file when using the Neo4j Server.</p></div>
<table id="all_stores_total_mapped_memory_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>All stores total mapped memory size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 524288000
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">all_stores_total_mapped_memory_size</code></p><p class="configsetting-desc">The size to allocate for a memory mapping pool to be shared between all stores.</p></td></tr></tbody></table>
<table id="allow_store_upgrade" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Allow store upgrade</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">allow_store_upgrade</code></p><p class="configsetting-desc">Whether to allow a store upgrade in case the current version of the database starts against an older store version. Setting this to true does not guarantee successful upgrade, just that it allows an attempt at it.</p></td></tr></tbody></table>
<table id="array_block_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Array block size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 120
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">array_block_size</code></p><p class="configsetting-desc">Specifies the block size for storing arrays. This parameter is only honored when the store is created, otherwise it is ignored. The default block size is 120 bytes, and the overhead of each block is the same as for string blocks, i.e., 8 bytes.</p></td></tr></tbody></table>
<table id="backup_slave" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Backup slave</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">backup_slave</code></p><p class="configsetting-desc">Mark this database as a backup slave.</p></td></tr></tbody></table>
<table id="cache_type" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Cache type</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> soft
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">cache_type</code></p><p class="configsetting-desc">The type of cache to use for nodes and relationships. Note that the Neo4j Enterprise Edition has the additional 'gcr' cache type. See the chapter on caches in the manual for more information.</p></td></tr></tbody></table>
<table id="cypher_parser_version
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Cypher parser version</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">cypher_parser_version
</code></p><p class="configsetting-desc">Enable this to specify a parser other than the default one.</p></td></tr></tbody></table>
<table id="dump_configuration" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Dump configuration</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">dump_configuration</code></p><p class="configsetting-desc">Print out the effective Neo4j configuration after startup.</p></td></tr></tbody></table>
<table id="forced_kernel_id
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Forced kernel id</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">forced_kernel_id
</code></p><p class="configsetting-desc">An identifier that uniquely identifies this graph database instance within this JVM. Defaults to an auto-generated number depending on how many instance are started in this JVM.</p></td></tr></tbody></table>
<table id="gc_monitor_threshold" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Gc monitor threshold</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 200
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">gc_monitor_threshold</code></p><p class="configsetting-desc">The amount of time in ms the monitor thread has to be blocked before logging a message it was blocked.</p></td></tr></tbody></table>
<table id="gc_monitor_wait_time" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Gc monitor wait time</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 100
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">gc_monitor_wait_time</code></p><p class="configsetting-desc">Amount of time in ms the GC monitor thread will wait before taking another measurement.</p></td></tr></tbody></table>
<table id="gcr_cache_min_log_interval" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Gcr cache min log interval</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 60s
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">gcr_cache_min_log_interval</code></p><p class="configsetting-desc">The minimal time that must pass in between logging statistics from the cache (when using the 'gcr' cache).</p></td></tr></tbody></table>
<table id="grab_file_lock" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Grab file lock</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> true
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">grab_file_lock</code></p><p class="configsetting-desc">Whether to grab locks on files or not.</p></td></tr></tbody></table>
<table id="intercept_committing_transactions" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Intercept committing transactions</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">intercept_committing_transactions</code></p><p class="configsetting-desc">Determines whether any TransactionInterceptors loaded will intercept prepared transactions before they reach the logical log.</p></td></tr></tbody></table>
<table id="intercept_deserialized_transactions" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Intercept deserialized transactions</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">intercept_deserialized_transactions</code></p><p class="configsetting-desc">Determines whether any TransactionInterceptors loaded will intercept externally received transactions (e.g. in HA) before they reach the logical log and are applied to the store.</p></td></tr></tbody></table>
<table id="keep_logical_logs" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Keep logical logs</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> true
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">keep_logical_logs</code></p><p class="configsetting-desc">Make Neo4j keep the logical transaction logs for being able to backup the database.Can be used for specifying the threshold to prune logical logs after. For example "10 days" will prune logical logs that only contains transactions older than 10 days from the current time, or "100k txs" will keep the 100k latest transactions and prune any older transactions.</p></td></tr></tbody></table>
<table id="label_block_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Label block size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 60
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">label_block_size</code></p><p class="configsetting-desc">Specifies the block size for storing labels exceeding in-lined space in node record. This parameter is only honored when the store is created, otherwise it is ignored. The default block size is 60 bytes, and the overhead of each block is the same as for string blocks, i.e., 8 bytes.</p></td></tr></tbody></table>
<table id="load_kernel_extensions" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Load kernel extensions</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> true
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">load_kernel_extensions</code></p><p class="configsetting-desc">Enable loading kernel extensions</p></td></tr></tbody></table>
<table id="log_mapped_memory_stats" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Log mapped memory stats</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">log_mapped_memory_stats</code></p><p class="configsetting-desc">Tell Neo4j to regularly log memory mapping statistics.</p></td></tr></tbody></table>
<table id="log_mapped_memory_stats_filename" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Log mapped memory stats filename</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> mapped_memory_stats.log
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">log_mapped_memory_stats_filename</code></p><p class="configsetting-desc">The file where Neo4j will record memory mapping statistics.</p></td></tr></tbody></table>
<table id="log_mapped_memory_stats_interval" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Log mapped memory stats interval</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 1000000
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">log_mapped_memory_stats_interval</code></p><p class="configsetting-desc">The number of records to be loaded between regular logging of memory mapping statistics.</p></td></tr></tbody></table>
<table id="logging.threshold_for_rotation" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Logging.threshold for rotation</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 104857600
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">logging.threshold_for_rotation</code></p><p class="configsetting-desc">Threshold in bytes for when database logs (text logs, for debugging, that is) are rotated.</p></td></tr></tbody></table>
<table id="logical_log" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Logical log</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> nioneo_logical.log
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">logical_log</code></p><p class="configsetting-desc">The base name for the logical log files, either an absolute path or relative to the store_dir setting. This should generally not be changed.</p></td></tr></tbody></table>
<table id="lucene_searcher_cache_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Lucene searcher cache size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 2147483647
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">lucene_searcher_cache_size</code></p><p class="configsetting-desc">Integer value that sets the maximum number of open lucene index searchers.</p></td></tr></tbody></table>
<table id="lucene_writer_cache_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Lucene writer cache size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 2147483647
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">lucene_writer_cache_size</code></p><p class="configsetting-desc">NOTE: This no longer has any effect. Integer value that sets the maximum number of open lucene index writers.</p></td></tr></tbody></table>
<table id="mapped_memory_page_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Mapped memory page size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 1048576
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">mapped_memory_page_size</code></p><p class="configsetting-desc">Target size for pages of mapped memory.</p></td></tr></tbody></table>
<table id="neo_store" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neo store</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> neostore
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neo_store</code></p><p class="configsetting-desc">The base name for the Neo4j Store files, either an absolute path or relative to the store_dir setting. This should generally not be changed.</p></td></tr></tbody></table>
<table id="neostore.nodestore.db.mapped_memory" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neostore.nodestore.db.mapped memory</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 20971520
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neostore.nodestore.db.mapped_memory</code></p><p class="configsetting-desc">The size to allocate for memory mapping the node store.</p></td></tr></tbody></table>
<table id="neostore.propertystore.db.arrays.mapped_memory" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neostore.propertystore.db.arrays.mapped memory</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 136314880
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neostore.propertystore.db.arrays.mapped_memory</code></p><p class="configsetting-desc">The size to allocate for memory mapping the array property store.</p></td></tr></tbody></table>
<table id="neostore.propertystore.db.index.keys.mapped_memory" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neostore.propertystore.db.index.keys.mapped memory</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 1048576
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neostore.propertystore.db.index.keys.mapped_memory</code></p><p class="configsetting-desc">The size to allocate for memory mapping the store for property key strings.</p></td></tr></tbody></table>
<table id="neostore.propertystore.db.index.mapped_memory" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neostore.propertystore.db.index.mapped memory</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 1048576
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neostore.propertystore.db.index.mapped_memory</code></p><p class="configsetting-desc">The size to allocate for memory mapping the store for property key indexes.</p></td></tr></tbody></table>
<table id="neostore.propertystore.db.mapped_memory" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neostore.propertystore.db.mapped memory</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 94371840
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neostore.propertystore.db.mapped_memory</code></p><p class="configsetting-desc">The size to allocate for memory mapping the property value store.</p></td></tr></tbody></table>
<table id="neostore.propertystore.db.strings.mapped_memory" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neostore.propertystore.db.strings.mapped memory</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 136314880
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neostore.propertystore.db.strings.mapped_memory</code></p><p class="configsetting-desc">The size to allocate for memory mapping the string property store.</p></td></tr></tbody></table>
<table id="neostore.relationshipstore.db.mapped_memory" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Neostore.relationshipstore.db.mapped memory</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 104857600
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">neostore.relationshipstore.db.mapped_memory</code></p><p class="configsetting-desc">The size to allocate for memory mapping the relationship store.</p></td></tr></tbody></table>
<table id="node_auto_indexing" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Node auto indexing</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">node_auto_indexing</code></p><p class="configsetting-desc">Controls the auto indexing feature for nodes. Setting to false shuts it down, while true enables it by default for properties listed in the node_keys_indexable setting.</p></td></tr></tbody></table>
<table id="node_cache_array_fraction" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Node cache array fraction</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 1.0
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">node_cache_array_fraction</code></p><p class="configsetting-desc">The fraction of the heap (1%-10%) to use for the base array in the node cache (when using the 'gcr' cache).</p></td></tr></tbody></table>
<table id="node_cache_size
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Node cache size</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">node_cache_size
</code></p><p class="configsetting-desc">The amount of memory to use for the node cache (when using the 'gcr' cache).</p></td></tr></tbody></table>
<table id="node_keys_indexable
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Node keys indexable</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">node_keys_indexable
</code></p><p class="configsetting-desc">A list of property names (comma separated) that will be indexed by default. This applies to Nodes only.</p></td></tr></tbody></table>
<table id="query_cache_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Query cache size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 100
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">query_cache_size</code></p><p class="configsetting-desc">Used to set the number of Cypher query execution plans that are cached.</p></td></tr></tbody></table>
<table id="read_only" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Read only database</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">read_only</code></p><p class="configsetting-desc">Only allow read operations from this Neo4j instance.</p></td></tr></tbody></table>
<table id="rebuild_idgenerators_fast" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Rebuild idgenerators fast</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> true
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">rebuild_idgenerators_fast</code></p><p class="configsetting-desc">Use a quick approach for rebuilding the ID generators. This give quicker recovery time, but will limit the ability to reuse the space of deleted entities.</p></td></tr></tbody></table>
<table id="relationship_auto_indexing" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Relationship auto indexing</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">relationship_auto_indexing</code></p><p class="configsetting-desc">Controls the auto indexing feature for relationships. Setting to false shuts it down, while true enables it by default for properties listed in the relationship_keys_indexable setting.</p></td></tr></tbody></table>
<table id="relationship_cache_array_fraction" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Relationship cache array fraction</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 1.0
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">relationship_cache_array_fraction</code></p><p class="configsetting-desc">The fraction of the heap (1%-10%) to use for the base array in the relationship cache (when using the 'gcr' cache).</p></td></tr></tbody></table>
<table id="relationship_cache_size
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Relationship cache size</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">relationship_cache_size
</code></p><p class="configsetting-desc">The amount of memory to use for the relationship cache (when using the 'gcr' cache).</p></td></tr></tbody></table>
<table id="relationship_grab_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Relationship grab size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 100
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">relationship_grab_size</code></p><p class="configsetting-desc">How many relationships to read at a time during iteration</p></td></tr></tbody></table>
<table id="relationship_keys_indexable
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Relationship keys indexable</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">relationship_keys_indexable
</code></p><p class="configsetting-desc"> A list of property names (comma separated) that will be indexed by default. This applies to Relationships only.</p></td></tr></tbody></table>
<table id="remote_logging_enabled" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Remote logging enabled</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> false
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">remote_logging_enabled</code></p><p class="configsetting-desc">Whether to enable logging to a remote server or not.</p></td></tr></tbody></table>
<table id="remote_logging_host" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Remote logging host</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 127.0.0.1
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">remote_logging_host</code></p><p class="configsetting-desc">Host for remote logging using LogBack SocketAppender.</p></td></tr></tbody></table>
<table id="remote_logging_port" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Remote logging port</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 4560
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">remote_logging_port</code></p><p class="configsetting-desc">Port for remote logging using LogBack SocketAppender.</p></td></tr></tbody></table>
<table id="store_dir
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Store dir</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">store_dir
</code></p><p class="configsetting-desc">The directory where the database files are located.</p></td></tr></tbody></table>
<table id="string_block_size" class="configsetting"  cellspacing="0" cellpadding="0"><caption>String block size</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> 120
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">string_block_size</code></p><p class="configsetting-desc">Specifies the block size for storing strings. This parameter is only honored when the store is created, otherwise it is ignored. Note that each character in a string occupies two bytes, meaning that a block size of 120 (the default size) will hold a 60 character long string before overflowing into a second block. Also note that each block carries an overhead of 8 bytes. This means that if the block size is 120, the size of the stored records will be 128 bytes.</p></td></tr></tbody></table>
<table id="tx_manager_impl" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Tx manager impl</caption><tfoot><tr><td class="configsetting-default" align="left" valign="top" colspan="1">Default value: <code class="literal"> native
</code></td></tr></tfoot><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">tx_manager_impl</code></p><p class="configsetting-desc">The name of the Transaction Manager service to use as defined in the TM service provider constructor.</p></td></tr></tbody></table>
<table id="use_memory_mapped_buffers
" class="configsetting"  cellspacing="0" cellpadding="0"><caption>Use memory mapped buffers</caption><tbody><tr><td align="left" valign="top" colspan="1"><p class="configsetting-key"><code class="literal">use_memory_mapped_buffers
</code></p><p class="configsetting-desc">Tell Neo4j to use memory mapped buffers for accessing the native storage layer.</p></td></tr></tbody></table>
</div>
<div class="sect2">
<h3 id="configuration-caches">Caches in Neo4j</h3>
<div class="paragraph"><p>For how to provide custom configuration to Neo4j, see <a href="#configuration-introduction">[configuration-introduction]</a>.</p></div>
<div class="paragraph"><p>Neo4j utilizes two different types of caches:
A file buffer cache and an object cache.
The file buffer cache caches the storage file data in the same format as it is stored on the durable storage media.
The object cache caches the nodes, relationships and properties in a format that is optimized for high traversal speeds and transactional writes.</p></div>
<div class="sect3">
<h4 id="_file_buffer_cache">File buffer cache</h4>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick info</div>
<div class="ulist"><ul>
<li>
<p>
The file buffer cache is sometimes called <em>low level cache</em> or <em>file system cache</em>.
</p>
</li>
<li>
<p>
It caches the Neo4j data as stored on the durable media.
</p>
</li>
<li>
<p>
It uses the operating system memory mapping features when possible.
</p>
</li>
<li>
<p>
Neo4j will configure the cache automatically as long as the heap size of the JVM is configured properly.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>The file buffer cache caches the Neo4j data in the same format as it is represented on the durable storage media.
The purpose of this cache layer is to improve both read and write performance.
The file buffer cache improves write performance by writing to the cache and deferring durable write until the logical log is rotated.
This behavior is safe since all transactions are always durably written to the logical log, which can be used to recover the store files in the event of a crash.</p></div>
<div class="paragraph"><p>Since the operation of the cache is tightly related to the data it stores, a short description of the Neo4j durable representation format is necessary background.
Neo4j stores data in multiple files and relies on the underlying file system to handle this efficiently.
Each Neo4j storage file contains uniform fixed size records of a particular type:</p></div>
<table class="tableblock frame-none grid-none"
style="
width:50%;
">
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Store file         </th>
<th class="tableblock halign-right valign-top" > Record size </th>
<th class="tableblock halign-left valign-top" > Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">nodestore</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">9 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">relstore</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">33 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Relationships</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">propstore</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">41 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Properties for nodes and relationships</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">stringstore</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">128 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Values of string properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">arraystore</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">128 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Values of array properties</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>For strings and arrays, where data can be of variable length, data is stored in one or more 120B chunks, with 8B record overhead.
The sizes of these blocks can actually be configured when the store is created using the <span class="monospaced">string_block_size</span> and <span class="monospaced">array_block_size</span> parameters.
The size of each record type can also be used to calculate the storage requirements of a Neo4j graph or the appropriate cache size for each file buffer cache.
Note that some strings and arrays can be stored without using the string store or the array store respectively, see <a href="#short-strings">[short-strings]</a> and <a href="#short-arrays">[short-arrays]</a>.</p></div>
<div class="paragraph"><p>Neo4j uses multiple file buffer caches, one for each different storage file.
Each file buffer cache divides its storage file into a number of equally sized windows.
Each cache window contains an even number of storage records.
The cache holds the most active cache windows in memory and tracks hit vs. miss ratio for the windows.
When the hit ratio of an uncached window gets higher than the miss ratio of a cached window, the cached window gets evicted and the previously uncached window is cached instead.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Note that the block sizes can only be configured at store creation time.</td>
</tr></table>
</div>
<div class="sect4">
<h5 id="_configuration">Configuration</h5>
<table class="tableblock frame-none grid-all"
style="
width:100%;
">
<col style="width:35%;">
<col style="width:30%;">
<col style="width:35%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Parameter                 </th>
<th class="tableblock halign-left valign-top" > Possible values   </th>
<th class="tableblock halign-left valign-top" > Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">use_memory_mapped_buffers</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">true</span> or <span class="monospaced">false</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">If set to <span class="monospaced">true</span> Neo4j will use the operating systems memory mapping functionality for the file buffer cache windows.
  If set to <span class="monospaced">false</span> Neo4j will use its own buffer implementation.
  In this case the buffers will reside in the JVM heap which needs to be increased accordingly.
  The default value for this parameter is <span class="monospaced">true</span>, except on Windows.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.nodestore.db.mapped_memory</p></td>
<td class="tableblock halign-center valign-middle" rowspan="7" ><p class="tableblock">The maximum amount of memory to use for memory mapped buffers for this file buffer cache.
  The default unit is <span class="monospaced">MiB</span>, for other units use any of the following suffixes: <span class="monospaced">B</span>, <span class="monospaced">k</span>, <span class="monospaced">M</span> or <span class="monospaced">G</span>.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The maximum amount of memory to use for the file buffer cache of the node storage file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.relationshipstore.db.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The maximum amount of memory to use for the file buffer cache of the relationship store file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.index.keys.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The maximum amount of memory to use for the file buffer cache of the something-something file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.index.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The maximum amount of memory to use for the file buffer cache of the something-something file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The maximum amount of memory to use for the file buffer cache of the property storage file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.strings.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The maximum amount of memory to use for the file buffer cache of the string property storage file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.arrays.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The maximum amount of memory to use for the file buffer cache of the array property storage file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">string_block_size</p></td>
<td class="tableblock halign-center valign-middle" rowspan="2" ><p class="tableblock">The number of bytes per block.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Specifies the block size for storing strings.
  This parameter is only honored when the store is created, otherwise it is ignored.
  Note that each character in a string occupies two bytes, meaning that a block size of 120 (the default size) will hold a 60 character long string before overflowing into a second block.
  Also note that each block carries an overhead of 8 bytes.
  This means that if the block size is 120, the size of the stored records will be 128 bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">array_block_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Specifies the block size for storing arrays.
  This parameter is only honored when the store is created, otherwise it is ignored.
  The default block size is 120 bytes, and the overhead of each block is the same as for string blocks, i.e., 8 bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">dump_configuration</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">true</span> or <span class="monospaced">false</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">If set to <span class="monospaced">true</span> the current configuration settings will be written to the default system output, mostly the console or the logfiles.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>When memory mapped buffers are used (<span class="monospaced">use_memory_mapped_buffers = true</span>) the heap size of the JVM must be smaller than the total available memory of the computer, minus the total amount of memory used for the buffers.
When heap buffers are used (<span class="monospaced">use_memory_mapped_buffers = false</span>) the heap size of the JVM must be large enough to contain all the buffers, plus the runtime heap memory requirements of the application and the object cache.</p></div>
<div class="paragraph"><p>When reading the configuration parameters on startup Neo4j will automatically configure the parameters that are not specified.
The cache sizes will be configured based on the available memory on the computer, how much is used by the JVM heap, and how large the storage files are.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_object_cache">Object cache</h4>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick info</div>
<div class="ulist"><ul>
<li>
<p>
The object cache is sometimes called <em>high level cache</em>.
</p>
</li>
<li>
<p>
It caches the Neo4j data in a form optimized for fast traversal.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>The object cache caches individual nodes and relationships and their properties in a form that is optimized for fast traversal of the graph.
There are two different categories of object caches in Neo4j.</p></div>
<div class="paragraph"><p>There is the reference caches.
Here Neo4j will utilize as much as it can out of the allocated heap memory for the JVM for object caching and relies on garbage collection for eviction from the cache in an LRU manner.
Note however that Neo4j is "competing" for the heap space with other objects in the same JVM, such as a your application, if deployed in embedded mode, and Neo4j will let the application "win" by using less memory if the application needs more.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The GC resistant cache described below is only available in the Neo4j Enterprise Edition.</td>
</tr></table>
</div>
<div class="paragraph"><p>The other is the <em>GC resistant cache</em> which gets assigned a certain amount of space in the JVM heap and will purge objects whenever it grows bigger than that.
It is assigned a maximum amount of memory which the sum of all cached objects in it will not exceed.
Objects will be evicted from cache when the maximum size is about to be reached, instead of relying on garbage collection (GC) to make that decision.
Here the competition with other objects in the heap as well as GC-pauses can be better controlled since the cache gets assigned a maximum heap space usage.
The overhead of the GC resistant cache is also much smaller as well as insert/lookup times faster than for reference caches.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The use of heap memory is subject to the java garbage collector&#8201;&#8212;&#8201;depending on the cache type some tuning might be needed to play well with the GC at large heap sizes.
Therefore, assigning a large heap for Neo4j&#8217;s sake isn&#8217;t always the best strategy as it may lead to long GC-pauses.
Instead leave some space for Neo4j&#8217;s filesystem caches.
These are outside of the heap and under under the kernel&#8217;s direct control, thus more efficiently managed.</td>
</tr></table>
</div>
<div class="paragraph"><p>The content of this cache are objects with a representation geared towards supporting the Neo4j object API and graph traversals.
Reading from this cache is 5 to 10 times faster than reading from the file buffer cache.
This cache is contained in the heap of the JVM and the size is adapted to the current amount of available heap memory.</p></div>
<div class="paragraph"><p>Nodes and relationships are added to the object cache as soon as they are accessed.
The cached objects are however populated lazily.
The properties for a node or relationship are not loaded until properties are accessed for that node or relationship.
String (and array) properties are not loaded until that particular property is accessed.
The relationships for a particular node is also not loaded until the relationships are accessed for that node.</p></div>
<div class="sect4">
<h5 id="_configuration_2">Configuration</h5>
<div class="paragraph"><p>The main configuration parameter for the object cache is the <span class="monospaced">cache_type</span> parameter.
This specifies which cache implementation to use for the object cache.
Note that there will exist two cache instances, one for nodes and one for relationships.
The available cache types are:</p></div>
<table class="tableblock frame-none grid-all"
style="
width:100%;
">
<col style="width:15%;">
<col style="width:85%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > <span class="monospaced">cache_type</span> </th>
<th class="tableblock halign-left valign-top" > Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">none</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Do not use a high level cache. No objects will be cached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">soft</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Provides optimal utilization of the available memory.
                 Suitable for high performance traversal.
                 May run into GC issues under high load if the frequently accessed parts of the graph does not fit in the cache.</p>
<p class="tableblock">                 This is the default cache implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">weak</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Provides short life span for cached objects.
                 Suitable for high throughput applications where a larger portion of the graph than what can fit into memory is frequently accessed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">strong</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">This cache will hold on to <strong>all data</strong> that gets loaded to never release it again.
                 Provides good performance if your graph is small enough to fit in memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">gcr</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Provides means of assigning a specific amount of memory to dedicate to caching loaded nodes and relationships.
                 Small footprint and fast insert/lookup. Should be the best option for most scenarios. See below on how to configure it.
                 Note that this option is only available in the Neo4j Enterprise Edition.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_gc_resistant_cache_configuration">GC resistant cache configuration</h5>
<div class="paragraph"><p>Since the GC resistant cache operates with a maximum size in the JVM it may be configured per use case for optimal performance.
There are two aspects of the cache size.</p></div>
<div class="paragraph"><p>One is the size of the array referencing the objects that are put in the cache.
It is specified as a fraction of the heap, for example specifying <span class="monospaced">5</span> will let that array itself take up 5% out of the entire heap.
Increasing this figure (up to a maximum of 10) will reduce the chance of hash collisions at the expense of more heap used for it.
More collisions means more redundant loading of objects from the low level cache.</p></div>
<table class="tableblock frame-none grid-all"
style="
width:100%;
">
<col style="width:15%;">
<col style="width:70%;">
<col style="width:15%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > <span class="monospaced">configuration option</span>            </th>
<th class="tableblock halign-left valign-top" > Description (what it controls)                                                                 </th>
<th class="tableblock halign-left valign-top" > Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">node_cache_array_fraction</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Fraction of the heap to dedicate to the array holding the nodes in the cache (max 10).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">relationship_cache_array_fraction</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Fraction of the heap to dedicate to the array holding the relationships in the cache (max 10).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">5</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The other aspect is the maximum size of all the objects in the cache. It is specified as size in bytes, for example <span class="monospaced">500M</span> for 500 megabytes or <span class="monospaced">2G</span> for two gigabytes.
Right before the maximum size is reached a <span class="monospaced">purge</span> is performed where (currently) random objects are evicted from the cache until the cache size gets below 90% of the maximum size.
Optimal settings for the maximum size depends on the size of your graph.
The configured maximum size should leave enough room for other objects to coexist in the same JVM, but at the same time large enough to keep loading from the low level cache at a minimum.
Predicted load on the JVM as well as layout of domain level objects should also be take into consideration.</p></div>
<table class="tableblock frame-none grid-all"
style="
width:100%;
">
<col style="width:15%;">
<col style="width:70%;">
<col style="width:15%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > <span class="monospaced">configuration option</span>   </th>
<th class="tableblock halign-left valign-top" > Description (what it controls)                                           </th>
<th class="tableblock halign-left valign-top" > Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">node_cache_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Maximum size of the heap memory to dedicate to the cached nodes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">2G</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">relationship_cache_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Maximum size of the heap memory to dedicate to the cached relationships.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">800M</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>You can read about references and relevant JVM settings for Sun HotSpot here:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://weblogs.java.net/blog/enicholas/archive/2006/05/understanding_w.html">Understanding soft/weak references</a>
</p>
</li>
<li>
<p>
<a href="http://jeremymanson.blogspot.com/2009/07/how-hotspot-decides-to-clear_07.html">How Hotspot Decides to Clear SoftReferences</a>
</p>
</li>
<li>
<p>
<a href="http://www.oracle.com/technetwork/java/hotspotfaq-138619.html#gc_softrefs">HotSpot FAQ</a>
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_heap_memory_usage">Heap memory usage</h5>
<div class="paragraph"><p>This table can be used to calculate how much memory the data in the object cache will occupy on a 64bit JVM:</p></div>
<table class="tableblock frame-none grid-all"
style="
width:100%;
">
<col style="width:15%;">
<col style="width:15%;">
<col style="width:70%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Object           </th>
<th class="tableblock halign-left valign-top" > Size  </th>
<th class="tableblock halign-left valign-top" > Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5" ><p class="tableblock">Node</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">344 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Size for each node (not counting its relationships or properties).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">48 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Object overhead.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">136 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Property storage (ArrayMap <span class="monospaced">48B</span>, HashMap <span class="monospaced">88B</span>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">136 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Relationship storage (ArrayMap <span class="monospaced">48B</span>, HashMap <span class="monospaced">88B</span>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">24 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Location of first / next set of relationships.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3" ><p class="tableblock">Relationship</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">208 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Size for each relationship (not counting its properties).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">48 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Object overhead.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">136 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Property storage (ArrayMap <span class="monospaced">48B</span>, HashMap <span class="monospaced">88B</span>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5" ><p class="tableblock">Property</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">116 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Size for each property of a node or relationship.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">32 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Data element&#8201;&#8212;&#8201;allows for transactional modification and keeps track of on disk location.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">48 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Entry in the hash table where it is stored.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">12 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Space used in hash table, accounts for normal fill ratio.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">24 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Property key index.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4" ><p class="tableblock">Relationships</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">108 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Size for each relationship type for a node that has a relationship of that type.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">48 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Collection of the relationships of this type.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">48 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Entry in the hash table where it is stored.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">12 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Space used in hash table, accounts for normal fill ratio.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Relationships</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">8 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Space used by each relationship related to a particular node (both incoming and outgoing).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Primitive</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">24 B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Size of a primitive property value.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">String</p></td>
<td class="tableblock halign-right valign-top" ><p class="tableblock monospaced">64+B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>Size of a string property value. <span class="monospaced">64 + 2*len(string) B</span> (64 bytes, plus two bytes for each character in the string).</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-logical-logs">Logical logs</h3>
<div class="paragraph"><p>Logical logs in Neo4j are the journal of which operations happens and are the source of truth in scenarios where the database needs to be recovered after a crash or similar.
Logs are rotated every now and then (defaults to when they surpass 25 Mb in size) and the amount of legacy logs to keep can be configured.
Purpose of keeping a history of logical logs include being able to serve incremental backups as well as keeping an HA cluster running.</p></div>
<div class="paragraph"><p>For any given configuration at least the latest non-empty logical log will be kept, but configuration can be supplied to control how much more to keep.
There are several different means of controlling it and the format in which configuration is supplied is:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">keep_logical_logs=&lt;true/false&gt;
keep_logical_logs=&lt;amount&gt; &lt;type&gt;</pre></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"># Will keep logical logs indefinitely
keep_logical_logs=true

# Will keep only the most recent non-empty log
keep_logical_logs=false

# Will keep logical logs which contains any transaction committed within 30 days
keep_logical_logs=30 days

# Will keep logical logs which contains any of the most recent 500 000 transactions
keep_logical_logs=500k txs</pre></div>
<div class="paragraph"><p>Full list:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<col style="width:15%;">
<col style="width:60%;">
<col style="width:25%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Type      </th>
<th class="tableblock halign-left valign-top" > Description </th>
<th class="tableblock halign-left valign-top" > Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">files</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Number of most recent logical log files to keep</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"10 files"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Max disk size to allow log files to occupy</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"300M size" or "1G size"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">txs</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Number of latest transactions to keep Keep</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"250k txs" or "5M txs"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hours</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Keep logs which contains any transaction committed within N hours from current time</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"10 hours"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">days</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Keep logs which contains any transaction committed within N days from current time</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"50 days"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="configuration-jvm">JVM Settings</h3>
<div class="paragraph"><p>There are two main memory parameters for the JVM, one controls the heap space and the other controls the stack space. The heap space parameter is the most important one for Neo4j, since this governs how many objects you can allocate. The stack space parameter governs the how deep the call stack of your application is allowed to get.</p></div>
<div class="paragraph"><p>When it comes to heap space the general rule is: the larger heap space you have the better, but make sure the heap fits in the RAM memory of the computer. If the heap is paged out to disk performance will degrade rapidly. Having a heap that is much larger than what your application needs is not good either, since this means that the JVM will accumulate a lot of dead objects before the garbage collector is executed, this leads to long garbage collection pauses and undesired performance behavior.</p></div>
<div class="paragraph"><p>Having a larger heap space will mean that Neo4j can handle larger transactions and more concurrent transactions. A large heap space will also make Neo4j run faster since it means Neo4j can fit a larger portion of the graph in its caches, meaning that the nodes and relationships your application uses frequently are always available quickly. The default heap size for a 32bit JVM is 64MB (and 30% larger for 64bit), which is too small for most real applications.</p></div>
<div class="paragraph"><p>Neo4j works fine with the default stack space configuration, but if your application implements some recursive behavior it is a good idea to increment the stack size. Note that the stack size is shared for all threads, so if you application is running a lot of concurrent threads it is a good idea to increase the stack size.</p></div>
<div class="ulist"><ul>
<li>
<p>
The heap size is set by specifying the <span class="monospaced">-Xmx???m</span> parameter to hotspot, where <span class="monospaced">???</span> is the heap size in megabytes. Default heap size is 64MB for 32bit JVMs, 30% larger (appr. 83MB) for 64bit JVMs.
</p>
</li>
<li>
<p>
The stack size is set by specifying the <span class="monospaced">-Xss???m</span> parameter to hotspot, where <span class="monospaced">???</span> is the stack size in megabytes. Default stack size is 512kB for 32bit JVMs on Solaris, 320kB for 32bit JVMs on Linux (and Windows), and 1024kB for 64bit JVMs.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Most modern CPUs implement a <a href="http://en.wikipedia.org/wiki/Non-Uniform_Memory_Access">Non-Uniform Memory Access (NUMA) architecture</a>, where different parts of the memory have different access speeds. Suns Hotspot JVM is able to allocate objects with awareness of the NUMA structure as of version 1.6.0 update 18. When enabled this can give up to 40% performance improvements. To enabled the NUMA awareness, specify the <span class="monospaced">-XX:+UseNUMA</span> parameter (works only when using the Parallel Scavenger garbage collector (default or <span class="monospaced">-XX:+UseParallelGC</span> not the concurrent mark and sweep one).</p></div>
<div class="paragraph"><p>Properly configuring memory utilization of the JVM is crucial for optimal performance.
As an example, a poorly configured JVM could spend all CPU time performing garbage collection (blocking all threads from performing any work).
Requirements such as latency, total throughput and available hardware have to be considered to find the right setup.
In production, Neo4j should run on a multi core/CPU platform with the JVM in server mode.</p></div>
<div class="sect3">
<h4 id="_configuring_heap_size_and_gc">Configuring heap size and GC</h4>
<div class="paragraph"><p>A large heap allows for larger node and relationship caches&#8201;&#8212;&#8201;which is a good thing&#8201;&#8212;&#8201;but large heaps can also lead to latency problems caused by full garbage collection.
The different high level cache implementations available in Neo4j together with a suitable JVM configuration of heap size and garbage collection (GC) should be able to handle most workloads.</p></div>
<div class="paragraph"><p>The default cache (soft reference based LRU cache) works best with a heap that never gets full: a graph where the most used nodes and relationships can be cached.
If the heap gets too full there is a risk that a full GC will be triggered; the larger the heap, the longer it can take to determine what soft references should be cleared.</p></div>
<div class="paragraph"><p>Using the strong reference cache means that <em>all</em> the nodes and relationships being used must fit in the available heap.
Otherwise there is a risk of getting out-of-memory exceptions.
The soft reference and strong reference caches are well suited for applications were the overal throughput is important.</p></div>
<div class="paragraph"><p>The weak reference cache basically needs enough heap to handle the peak load of the application&#8201;&#8212;&#8201;peak load multiplied by the average memory required per request.
It is well suited for low latency requirements were GC interuptions are not acceptable.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">When running Neo4j on Windows, keep in mind that the memory mapped buffers are allocated on heap by default, so they need to be taken into account when determining heap size.</td>
</tr></table>
</div>
<table class="tableblock frame-topbot grid-none"
style="
width:75%;
">
<caption class="title">Table 8. Guidelines for heap size</caption>
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Number of primitives</th>
<th class="tableblock halign-left valign-top" >RAM size</th>
<th class="tableblock halign-left valign-top" >Heap configuration</th>
<th class="tableblock halign-left valign-top" >Reserved RAM for the OS</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2GB</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">512MB</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the rest</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">100M</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8GB+</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1-4GB</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1-2GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1B+</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16GB-32GB+</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4GB+</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1-2GB</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The recommended garbage collector to use when running Neo4j in production is the Concurrent Mark and Sweep Compactor turned on by supplying <span class="monospaced">-XX:+UseConcMarkSweepGC</span> as a JVM parameter.</td>
</tr></table>
</div>
<div class="paragraph"><p>When having made sure that the heap size is well configured the second thing to tune in order to tune the garbage collector for your application is to specify the sizes of the different generations of the heap. The default settings are well tuned for "normal" applications, and work quite well for most applications, but if you have an application with either really high allocation rate, or a lot of long lived objects you might want to consider tuning the sizes of the heap generation. The ratio between the young and tenured generation of the heap is specified by using the <span class="monospaced">-XX:NewRatio=#</span> command line option (where <span class="monospaced">#</span> is replaced by a number). The default ratio is 1:12 for client mode JVM, and 1:8 for server mode JVM. You can also specify the size of the young generation explicitly using the <span class="monospaced">-Xmn</span> command line option, which works just like the <span class="monospaced">-Xmx</span> option that specifies the total heap space.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >GC shortname </th>
<th class="tableblock halign-left valign-top" >Generation </th>
<th class="tableblock halign-left valign-top" > Command line parameter </th>
<th class="tableblock halign-left valign-top" >Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Copy</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Young</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">-XX:+UseSerialGC</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The Copying collector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">MarkSweepCompact</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tenured</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">-XX:+UseSerialGC</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The Mark and Sweep Compactor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">ConcurrentMarkSweep</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tenured</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">-XX:+UseConcMarkSweepGC</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The Concurrent Mark and Sweep Compactor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">ParNew</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Young</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">-XX:+UseParNewGC</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The parallel Young Generation Collector&#8201;&#8212;&#8201;can only be used with the Concurrent mark and sweep compactor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PS Scavenge</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Young</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">-XX:+UseParallelGC</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The parallel object scavenger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PS MarkSweep</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tenured</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">-XX:+UseParallelGC</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The parallel mark and sweep collector</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>These are the default configurations on some platforms according to our non-exhaustive research:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >JVM </th>
<th class="tableblock halign-left valign-top" >-d32 -client </th>
<th class="tableblock halign-left valign-top" >-d32 -server </th>
<th class="tableblock halign-left valign-top" >-d64 -client </th>
<th class="tableblock halign-left valign-top" >-d64 -server</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mac OS X Snow Leopard, 64-bit, Hotspot 1.6.0_17</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ParNew</span> and <span class="monospaced">ConcurrentMarkSweep</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">PS Scavenge</span> and <span class="monospaced">PS MarkSweep</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ParNew</span> and <span class="monospaced">ConcurrentMarkSweep</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">PS Scavenge</span> and <span class="monospaced">PS MarkSweep</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Ubuntu, 32-bit, Hotspot 1.6.0_16</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Copy</span> and <span class="monospaced">MarkSweepCompact</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Copy</span> and <span class="monospaced">MarkSweepCompact</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="short-strings">Compressed storage of short strings</h3>
<div class="paragraph"><p>Neo4j will try to classify your strings in a short string class and if it manages that it will treat it accordingly.
In that case, it will be stored without indirection in the property store, inlining it instead in the property record,
meaning that the dynamic string store will not be involved in storing that value, leading to reduced disk footprint.
Additionally, when no string record is needed to store the property, it can be read and written in a single lookup,
leading to performance improvements and less disk space required.</p></div>
<div class="paragraph"><p>The various classes for short strings are:</p></div>
<div class="ulist"><ul>
<li>
<p>
Numerical, consisting of digits 0..9 and the punctuation space, period, dash, plus, comma and apostrophe.
</p>
</li>
<li>
<p>
Date, consisting of digits 0..9 and the punctuation space dash, colon, slash, plus and comma.
</p>
</li>
<li>
<p>
Hex (lower case), consisting of digits 0..9 and lower case letters a..f
</p>
</li>
<li>
<p>
Hex (upper case), consisting of digits 0..9 and upper case letters a..f
</p>
</li>
<li>
<p>
Upper case, consisting of upper case letters A..Z, and the punctuation space, underscore, period, dash, colon and slash.
</p>
</li>
<li>
<p>
Lower case, like upper but with lower case letters a..z instead of upper case
</p>
</li>
<li>
<p>
E-mail, consisting of lower case letters a..z and the punctuation comma, underscore, period, dash, plus and the at sign (@).
</p>
</li>
<li>
<p>
URI, consisting of lower case letters a..z, digits 0..9 and most punctuation available.
</p>
</li>
<li>
<p>
Alpha-numerical, consisting of both upper and lower case letters a..zA..z, digits 0..9 and punctuation space and underscore.
</p>
</li>
<li>
<p>
Alpha-symbolical, consisting of both upper and lower case letters a..zA..Z and the punctuation space, underscore, period, dash, colon, slash, plus, comma, apostrophe, at sign, pipe and semicolon.
</p>
</li>
<li>
<p>
European, consisting of most accented european characters and digits plus punctuation space, dash, underscore and period&#8201;&#8212;&#8201;like latin1 but with less punctuation.
</p>
</li>
<li>
<p>
Latin 1.
</p>
</li>
<li>
<p>
UTF-8.
</p>
</li>
</ul></div>
<div class="paragraph"><p>In addition to the string&#8217;s contents, the number of characters also determines if the string can be inlined or not. Each class has its own character count limits, which are</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<caption class="title">Table 9. Character count limits</caption>
<col style="width:76%;">
<col style="width:23%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > String class </th>
<th class="tableblock halign-left valign-top" > Character count limit</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Numerical, Date and Hex</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">54</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Uppercase, Lowercase and E-mail</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">43</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">URI, Alphanumerical and Alphasymbolical</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">36</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">European</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Latin1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">27</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">UTF-8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">14</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>That means that the largest inline-able string is 54 characters long and must be of the Numerical class and also that all Strings of size 14 or less will always be inlined.</p></div>
<div class="paragraph"><p>Also note that the above limits are for the default 41 byte PropertyRecord layout&#8201;&#8212;&#8201;if that parameter is changed via editing the source and recompiling, the above have to be recalculated.</p></div>
</div>
<div class="sect2">
<h3 id="short-arrays">Compressed storage of short arrays</h3>
<div class="paragraph"><p>Neo4j will try to store your primitive arrays in a compressed way, so as to save disk space and possibly an I/O operation.
To do that, it employs a "bit-shaving" algorithm that tries to reduce the number of bits required for storing the members
of the array. In particular:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
For each member of the array, it determines the position of leftmost set bit.
</p>
</li>
<li>
<p>
Determines the largest such position among all members of the array
</p>
</li>
<li>
<p>
It reduces all members to that number of bits
</p>
</li>
<li>
<p>
Stores those values, prefixed by a small header.
</p>
</li>
</ol></div>
<div class="paragraph"><p>That means that when even a single negative value is included in the array then the natural size of the primitives will be used.</p></div>
<div class="paragraph"><p>There is a possibility that the result can be inlined in the property record if:</p></div>
<div class="ulist"><ul>
<li>
<p>
It is less than 24 bytes after compression
</p>
</li>
<li>
<p>
It has less than 64 members
</p>
</li>
</ul></div>
<div class="paragraph"><p>For example, an array long[] {0L, 1L, 2L, 4L} will be inlined, as the largest entry (4) will require 3 bits to store so the whole array will be stored in 4*3=12 bits. The array long[] {-1L, 1L, 2L, 4L}
however will require the whole 64 bits for the -1 entry so it needs 64*4 = 32 bytes and it will end up in the dynamic store.</p></div>
</div>
<div class="sect2">
<h3 id="configuration-io-examples">Memory mapped IO settings</h3>
<div class="paragraph"><p>Each file in the Neo4j store can use memory mapped I/O for reading/writing.
Best performance is achieved if the full file can be memory mapped but if
there isn&#8217;t enough memory for that Neo4j will try and make the best use of
the memory it gets (regions of the file that get accessed often will more
likely be memory mapped).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Neo4j makes heavy use of the <span class="monospaced">java.nio</span> package. Native I/O will result in
memory being allocated outside the normal Java heap so  that memory usage
needs to be taken into consideration. Other processes running on the OS will
impact the availability of such memory. Neo4j will require all of the heap
memory of the JVM plus the memory to be used for memory mapping to be available
as physical memory. Other processes may thus not use more than what is
available after the configured memory allocation is made for Neo4j.</td>
</tr></table>
</div>
<div class="paragraph"><p>A well configured OS
with large disk caches will help a lot once we get cache misses in the node
and relationship caches. Therefore it is not a good idea to use all available memory as Java heap.</p></div>
<div class="paragraph"><p>If you look into the directory of your Neo4j database, you will find its store files, all prefixed by <span class="monospaced">neostore</span>:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">nodestore</span> stores information about nodes
</p>
</li>
<li>
<p>
<span class="monospaced">relationshipstore</span> holds all the relationships
</p>
</li>
<li>
<p>
<span class="monospaced">propertystore</span> stores information of properties and all simple properties such as primitive types (both for relationships and nodes)
</p>
</li>
<li>
<p>
<span class="monospaced">propertystore strings</span> stores all string properties
</p>
</li>
<li>
<p>
<span class="monospaced">propertystore arrays</span> stores all array properties
</p>
</li>
</ul></div>
<div class="paragraph"><p>There are other files there as well, but they are normally not interesting in this context.</p></div>
<div class="paragraph"><p>This is how the default memory mapping configuration looks:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">neostore.nodestore.db.mapped_memory=25M
neostore.relationshipstore.db.mapped_memory=50M
neostore.propertystore.db.mapped_memory=90M
neostore.propertystore.db.strings.mapped_memory=130M
neostore.propertystore.db.arrays.mapped_memory=130M</pre></div>
<div class="sect3">
<h4 id="_optimizing_for_traversal_speed_example">Optimizing for traversal speed example</h4>
<div class="paragraph"><p>To tune the memory mapping settings start by investigating the size of the different store files found in the directory of your Neo4j database. Here is an example of some of the files and sizes in a Neo4j database:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">14M neostore.nodestore.db
510M neostore.propertystore.db
1.2G neostore.propertystore.db.strings
304M neostore.relationshipstore.db</pre></div>
<div class="paragraph"><p>In this example the application is running on a machine with 4GB of RAM. We&#8217;ve reserved about 2GB for the OS and other programs. The Java heap is set to 1.5GB, that leaves about 500MB of RAM that can be used for memory mapping.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If traversal speed is the highest priority it is good to memory map as much as possible of the node- and relationship stores.</td>
</tr></table>
</div>
<div class="paragraph"><p>An example configuration on the example machine focusing on traversal speed would then look something like:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">neostore.nodestore.db.mapped_memory=15M
neostore.relationshipstore.db.mapped_memory=285M
neostore.propertystore.db.mapped_memory=100M
neostore.propertystore.db.strings.mapped_memory=100M
neostore.propertystore.db.arrays.mapped_memory=0M</pre></div>
</div>
<div class="sect3">
<h4 id="configuration-batchinsert">Batch insert example</h4>
<div class="paragraph"><p>Read general information on batch insertion in <a href="#batchinsert">[batchinsert]</a>.</p></div>
<div class="paragraph"><p>The configuration should suit the data set you are about to inject using BatchInsert. Lets say we have a random-like graph with 10M nodes and 100M relationships. Each node (and maybe some relationships) have different properties of string and Java primitive types (but no arrays). The important thing with a random graph will be to give lots of memory to the relationship and node store:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">neostore.nodestore.db.mapped_memory=90M
neostore.relationshipstore.db.mapped_memory=3G
neostore.propertystore.db.mapped_memory=50M
neostore.propertystore.db.strings.mapped_memory=100M
neostore.propertystore.db.arrays.mapped_memory=0M</pre></div>
<div class="paragraph"><p>The configuration above will fit the entire graph (with exception to properties) in memory.</p></div>
<div class="paragraph"><p>A rough formula to calculate the memory needed for the nodes:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">number_of_nodes * 9 bytes</pre></div>
<div class="paragraph"><p>and for relationships:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">number_of_relationships * 33 bytes</pre></div>
<div class="paragraph"><p>Properties will typically only be injected once and never read so a few megabytes for the property store and string store is usually enough. If you have very large strings or arrays you may want to increase the amount of memory assigned to the string and array store files.</p></div>
<div class="paragraph"><p>An important thing to remember is that the above configuration will need a Java heap of 3.3G+ since in batch inserter mode normal Java buffers that gets allocated on the heap will be used instead of memory mapped ones.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="linux-performance-guide">Linux Performance Guide</h3>
<div class="paragraph"><p>The key to achieve good performance on reads and writes is to have lots of RAM since disks are so slow. This guide will focus on achieving good write performance on a Linux kernel based operating system.</p></div>
<div class="paragraph"><p>If you have not already read the information available in <a href="#embedded-configuration">[embedded-configuration]</a> do that now to get some basic knowledge on memory mapping and store files with Neo4j.</p></div>
<div class="paragraph"><p>This section will guide you through how to set up a file system benchmark and use it to configure your system in a better way.</p></div>
<div class="sect3">
<h4 id="_setup">Setup</h4>
<div class="paragraph"><p>Create a large file with random data. The file should fit in RAM so if your machine has 4GB of RAM a 1-2GB file with random data will be enough. After the file has been created we will read the file sequentially a few times to make sure it is cached.</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ dd if=/dev/urandom of=store bs=1M count=1000
1000+0 records in
1000+0 records out
1048576000 bytes (1.0 GB) copied, 263.53 s, 4.0 MB/s
$
$ dd if=store of=/dev/null bs=100M
10+0 records in
10+0 records out
1048576000 bytes (1.0 GB) copied, 38.6809 s, 27.1 MB/s
$
$ dd if=store of=/dev/null bs=100M
10+0 records in
10+0 records out
1048576000 bytes (1.0 GB) copied, 1.52365 s, 688 MB/s
$ dd if=store of=/dev/null bs=100M
10+0 records in
10+0 records out
1048576000 bytes (1.0 GB) copied, 0.776044 s, 1.4 GB/s</pre></div>
<div class="paragraph"><p>If you have a standard hard drive in the machine you may know that it is not capable of transfer speeds as high as 1.4GB/s. What is measured is how fast we can read a file that is cached for us by the operating system.</p></div>
<div class="paragraph"><p>Next we will use a small utility that simulates the Neo4j kernel behavior to benchmark write speed of the system.</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ git clone git@github.com:neo4j/tooling.git
...
$ cd tooling/write-test/
$ mvn compile
[INFO] Scanning for projects...
...
$ ./run
Usage: &lt;large file&gt; &lt;log file&gt; &lt;[record size] [min tx size] [max tx size] [tx count] &lt;[--nosync | --nowritelog | --nowritestore | --noread | --nomemorymap]&gt;&gt;</pre></div>
<div class="paragraph"><p>The utility will be given a store file (large file we just created) and a name of a log file. Then a record size in bytes, min tx size, max tx size and transaction count must be set. When started the utility will map the large store file entirely in memory and read (transaction size) records from it randomly and then write them sequentially to the log file. The log file will then force changes to disk and finally the records will be written back to the store file.</p></div>
</div>
<div class="sect3">
<h4 id="_running_the_benchmark">Running the benchmark</h4>
<div class="paragraph"><p>Lets try to benchmark 100 transactions of size 100-500 with a record size of 33 bytes (same record size used by the relationship store).</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ ./run store logfile 33 100 500 100
tx_count[100] records[30759] fdatasyncs[100] read[0.96802425 MB] wrote[1.9360485 MB]
Time was: 4.973
20.108585 tx/s, 6185.2 records/s, 20.108585 fdatasyncs/s, 199.32773 kB/s on reads, 398.65546 kB/s on writes</pre></div>
<div class="paragraph"><p>We see that we get about 6185 record updates/s and 20 transactions/s with the current transaction size. We can change the transaction size to be bigger, for example writing 10 transactions of size 1000-5000 records:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ ./run store logfile 33 1000 5000 10
tx_count[10] records[24511] fdatasyncs[10] read[0.77139187 MB] wrote[1.5427837 MB]
Time was: 0.792
12.626263 tx/s, 30948.232 records/s, 12.626263 fdatasyncs/s, 997.35516 kB/s on reads, 1994.7103 kB/s on writes</pre></div>
<div class="paragraph"><p>With larger transaction we will do fewer of them per second but record throughput will increase. Lets see if it scales, 10 transactions in under 1s then 100 of them should execute in about 10s:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ ./run store logfile 33 1000 5000 100
tx_count[100] records[308814] fdatasyncs[100] read[9.718763 MB] wrote[19.437527 MB]
Time was: 65.115
1.5357445 tx/s, 4742.594 records/s, 1.5357445 fdatasyncs/s, 152.83751 kB/s on reads, 305.67502 kB/s on writes</pre></div>
<div class="paragraph"><p>This is not very linear scaling. We modified a bit more than 10x records in total but the time jumped up almost 100x. Running the benchmark watching vmstat output will reveal that something is not as it should be:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ vmstat 3
procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa
 0  1  47660 298884 136036 2650324    0    0     0 10239 1167 2268  5  7 46 42
 0  1  47660 302728 136044 2646060    0    0     0  7389 1267 2627  6  7 47 40
 0  1  47660 302408 136044 2646024    0    0     0 11707 1861 2016  8  5 48 39
 0  2  47660 302472 136060 2646432    0    0     0 10011 1704 1878  4  7 49 40
 0  1  47660 303420 136068 2645788    0    0     0 13807 1406 1601  4  5 44 47</pre></div>
<div class="paragraph"><p>There are a lot of blocks going out to IO, way more than expected for the write speed we are seeing in the benchmark. Another observation that can be made is that the Linux kernel has spawned a process called "flush-x:x" (run top) that seems to be consuming a lot of resources.</p></div>
<div class="paragraph"><p>The problem here is that the Linux kernel is trying to be smart and write out dirty pages from the virtual memory. As the benchmark will memory map a 1GB file and do random writes it is likely that this will result in 1/4 of the memory pages available on the system to be marked as dirty. The Neo4j kernel is not sending any system calls to the Linux kernel to write out these pages to disk however the Linux kernel decided to start doing so and it is a very bad decision. The result is that instead of doing sequential like writes down to disk (the logical log file) we are now doing random writes writing regions of the memory mapped file to disk.</p></div>
<div class="paragraph"><p>It is possible to observe this behavior in more detail by looking at /proc/vmstat "nr_dirty" and "nr_writeback" values. By default the Linux kernel will start writing out pages at a very low ratio of dirty pages (10%).</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ sync
$ watch grep -A 1 dirty /proc/vmstat
...
nr_dirty 22
nr_writeback 0</pre></div>
<div class="paragraph"><p>The "sync" command will write out all data (that needs writing) from memory to disk. The second command will watch the "nr_dirty" and "nr_writeback" count from vmstat. Now start the benchmark again and observe the numbers:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">nr_dirty 124947
nr_writeback 232</pre></div>
<div class="paragraph"><p>The "nr_dirty" pages will quickly start to rise and after a while the "nr_writeback" will also increase meaning the Linux kernel is scheduling a lot of pages to write out to disk.</p></div>
</div>
<div class="sect3">
<h4 id="_fixing_the_problem">Fixing the problem</h4>
<div class="paragraph"><p>As we have 4GB RAM on the machine and memory map a 1GB file that does not need its content written to disk (until we tell it to do so because of logical log rotation or Neo4j kernel shutdown) it should be possible to do endless random writes to that memory with high throughput. All we have to do is to tell the Linux kernel to stop trying to be smart. Edit the /etc/sysctl.conf (need root access) and add the following lines:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">vm.dirty_background_ratio = 50
vm.dirty_ratio = 80</pre></div>
<div class="paragraph"><p>Then (as root) execute:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell"># sysctl -p</pre></div>
<div class="paragraph"><p>The "vm.dirty_background_ratio" tells at what ratio should the linux kernel start the background task of writing out dirty pages. We increased this from the default 10% to 50% and that should cover the 1GB memory mapped file.
The "vm.dirty_ratio" tells at what ratio all IO writes become synchronous,
meaning that we can not do IO calls without waiting for the underlying
device to complete them (which is something you never want to happen).</p></div>
<div class="paragraph"><p>Rerun the benchmark:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$ ./run store logfile 33 1000 5000 100
tx_count[100] records[265624] fdatasyncs[100] read[8.35952 MB] wrote[16.71904 MB]
Time was: 6.781
14.7470875 tx/s, 39171.805 records/s, 14.7470875 fdatasyncs/s, 1262.3726 kB/s on reads, 2524.745 kB/s on writes</pre></div>
<div class="paragraph"><p>Results are now more in line with what can be expected, 10x more records modified results in 10x longer execution time. The vmstat utility will not report any absurd amount of IO blocks going out (it reports the ones caused by the fdatasync to the logical log) and Linux kernel will not spawn a "flush-x:x" background process writing out dirty pages caused by writes to the memory mapped store file.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-linux-notes">Linux specific notes</h3>
<div class="sect3">
<h4 id="_file_system_tuning_for_high_io">File system tuning for high IO</h4>
<div class="paragraph"><p>In order to support the high IO load of small transactions from a database, the underlying file system should be tuned.
Symptoms for this are low CPU load with high iowait.
In this case, there are a couple of tweaks possible on Linux systems:</p></div>
<div class="ulist"><ul>
<li>
<p>
Disable access-time updates: <span class="monospaced">noatime,nodiratime</span> flags for disk mount command or in the <em>/etc/fstab</em> for the database disk volume mount.
</p>
</li>
<li>
<p>
Tune the IO scheduler for high disk IO on the database disk.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_setting_the_number_of_open_files">Setting the number of open files</h4>
<div class="paragraph"><p>Linux platforms impose an upper limit on the number of concurrent files a user may have open. This number is reported for the current user and session with the command</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">user@localhost:~$ ulimit -n
1024</pre></div>
<div class="paragraph"><p>The usual default of 1024 is often not enough, especially when many indexes are used or a server installation sees too many connections (network sockets count against that limit as well).
Users are therefore encouraged to increase that limit to a healthy value of 40000 or more, depending on usage patterns.
Setting this value via the <span class="monospaced">ulimit</span> command is possible only for the root user and that for that session only.
To set the value system wide you have to follow the instructions for your platform.</p></div>
<div class="paragraph"><p>What follows is the procedure to set the open file descriptor limit to 40k for user neo4j under Ubuntu 10.04 and later.
If you opted to run the neo4j service as a different user, change the first field in step 2 accordingly.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Become root since all operations that follow require editing protected system files.
</p>
<div class="listingblock">
<pre class="programlisting brush: shell">user@localhost:~$ sudo su -
Password:
root@localhost:~$</pre></div>
</li>
<li>
<p>
Edit <span class="monospaced">/etc/security/limits.conf</span> and add these two lines:
</p>
<div class="listingblock">
<pre class="programlisting brush: shell">neo4j   soft    nofile  40000
neo4j   hard    nofile  40000</pre></div>
</li>
<li>
<p>
Edit <span class="monospaced">/etc/pam.d/su</span> and uncomment or add the following line:
</p>
<div class="listingblock">
<pre class="programlisting brush: shell">session    required   pam_limits.so</pre></div>
</li>
<li>
<p>
A restart is required for the settings to take effect.
</p>
<div class="paragraph"><p>After the above procedure, the neo4j user will have a limit of 40000 simultaneous open files. If you continue experiencing exceptions on <span class="monospaced">Too many open files</span> or <span class="monospaced">Could not stat() directory</span> then you may have to raise that limit further.</p></div>
</li>
</ol></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ha">High Availability</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The High Availability features are only available in the Neo4j Enterprise Edition.</td>
</tr></table>
</div>
<div class="paragraph"><p>Neo4j High Availability or “Neo4j HA” provides the following two main features:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
It enables a <em>fault-tolerant database architecture</em>, where several Neo4j slave databases can be configured to be exact replicas of a single Neo4j master database.
  This allows the end-user system to be fully functional and both read and write to the database in the event of hardware failure.
</p>
</li>
<li>
<p>
It enables a <em>horizontally scaling read-mostly architecture</em> that enables the system to handle more read load than a single Neo4j database instance can handle.
</p>
</li>
</ol></div>
<div class="sect2">
<h3 id="ha-architecture">Architecture</h3>
<div class="paragraph"><p>Neo4j HA has been designed to make the transition from single machine to multi machine operation simple, by not having to change the already existing application.</p></div>
<div class="paragraph"><p>Consider an existing application with Neo4j embedded and running on a single machine.
To deploy such an application in a multi machine setup the only required change is to switch the creation of the <span class="monospaced">GraphDatabaseService</span> from <span class="monospaced">GraphDatabaseFactory</span> to <span class="monospaced">HighlyAvailableGraphDatabaseFactory</span>.
Since both implement the same interface, no additional changes are required.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/ha-architecture.svg" alt="Neo4j Highly Available Cluster">
</div>
<div class="title">Figure 119. Multiple Neo4j instances in HA mode</div>
</div>
<div class="paragraph"><p>When running Neo4j in HA mode there is always a single master and zero or more slaves.
Compared to other master-slave replication setups Neo4j HA can handle write requests on all machines so there is no need to redirect those to the master specifically.</p></div>
<div class="paragraph"><p>A slave will handle writes by synchronizing with the master to preserve consistency.
Writes to master can be configured to be optimistically pushed to 0 or more slaves.
By optimistically we mean the master will try to push to slaves before the transaction completes but if it fails the transaction will still be successful (different from normal replication factor).
All updates will however propagate from the master to other slaves eventually so a write from one slave may not be immediately visible on all other slaves.
This is the only difference between multiple machines running in HA mode compared to single machine operation.
All other ACID characteristics are the same.</p></div>
</div>
<div class="sect2">
<h3 id="ha-configuration">Setup and configuration</h3>
<div class="paragraph"><p>Neo4j HA can be set up to accommodate differing requirements for load, fault tolerance and available hardware.</p></div>
<div class="paragraph"><p>Within a cluster, Neo4j HA uses its own Paxos implementation for all cluster membership related tasks, from instances joining/leaving a cluster to master election and availability information propagation.
Read operations through the <span class="monospaced">GraphDatabaseService</span> API will always work, whereas write operations requires an available master.</p></div>
<div class="paragraph"><p>For reaching quorum among the members in the cluster the number of members should be odd.</p></div>
<div class="sect3">
<h4 id="_installation_notes">Installation Notes</h4>
<div class="paragraph"><p>For installation instructions of a High Availability cluster see <a href="#ha-setup-tutorial">[ha-setup-tutorial]</a>.</p></div>
<div class="paragraph"><p>Note that while the HA version of Neo4j supports the same API as the single instance embedded version, it does have additional configuration parameters.
Although there are many parameters, most of them have defaults that should work in most cases.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 10. HA configuration parameters</caption>
<col style="width:32%;">
<col style="width:24%;">
<col style="width:24%;">
<col style="width:19%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Parameter Name        </th>
<th class="tableblock halign-left valign-top" > Description                                     </th>
<th class="tableblock halign-left valign-top" > Example value  </th>
<th class="tableblock halign-left valign-top" > Required?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.server_id</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer &gt;= 0 and has to be unique in the cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(auto-discovered) host &amp; port to bind when acting as master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">my-domain.com:6001</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.discovery.enabled</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">whether or not to use the resource of ha.discovery.url to define the cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">true</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.discovery.url</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">if ha.discovery.enabled is true, used to define the cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="file://my.server:8080/my-cluster">file://my.server:8080/my-cluster</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.initial_hosts</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">if ha.discovery.enabled is false, a comma-separated list of other members of the cluster to join. If no members are reachable a new cluster will be created.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">my-server:5001</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.cluster_server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(auto-discovered) host &amp; port to bind the cluster management communication</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.pull_interval</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">interval for, as slave, pulling updates from the master. Default is to not pull updates regularly, only during write transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">30s or 1500ms</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.read_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">how long a slave will wait for response from master before giving up (default 20)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">20</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.lock_read_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">how long a slave lock acquisition request will wait for response from master before giving up (defaults to what ha.read_timeout is, or its default if absent)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">40</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.state_switch_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">how long max time to gracefully await a slave/master role switch</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">20s</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.max_concurrent_channels_per_slave</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">max number of concurrent communication channels each slave has to its master. Increase if there&#8217;s high contention on few nodes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">100</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.branched_data_policy</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">what to do with the db that is considered branched and will be replaced with a fresh copy from the master {keep_all(default),keep_last,keep_none,shutdown}</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">keep_none</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.tx_push_factor</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">amount of slaves the master will push each committed transaction to</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">1 (default)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.tx_push_strategy</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the strategy for selecting which slaves to push committed transactions to. "fixed" (default) will push to slaves with descending server_id order; "round_robin" will have slaves take turn receiving the transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">fixed</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.slave_only</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">whether this instance should only participate as slave in cluster; if enabled it will never be elected as master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">false</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Note that the <span class="monospaced">org.neo4j.server.database.mode</span> setting in the <em>neo4j-server.properties</em> file has to be set to <span class="monospaced">HA</span> to run Neo4j in High Availability mode.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_different_methods_for_participating_in_a_cluster">Different methods for participating in a cluster</h4>
<div class="paragraph"><p>There are currently multiple ways of telling your database instance which cluster to create/join, different ways for different occasions.</p></div>
<div class="sect4">
<h5 id="_knowing_at_least_one_other_member">Knowing at least one other member</h5>
<div class="paragraph"><p>A database instance can join a cluster by supplying <span class="monospaced">ha.initial_hosts</span> a comma-separated list of URLs to at least one other cluster member of the cluster to join.
It&#8217;s called initial hosts since it&#8217;s only for joining the cluster. After an instance joins it gets aware of all the members of the cluster.
It will take turn contacting each one in the list until it gets a response, where it will await a decision by the existing cluster members to have it join.
If it cannot contact any of the members in the URL list it will create a new cluster with itself as master.
This option requires <span class="monospaced">ha.discovery.enabled</span> be set to <span class="monospaced">false</span>.</p></div>
</div>
<div class="sect4">
<h5 id="_discovery">Discovery</h5>
<div class="paragraph"><p>A database instance can point to URL acting as a live list of members in a cluster, by setting <span class="monospaced">ha.discovery.url</span> to a valid and accessible URL.
If the resource pointed out by that URL exists it will take turn contacting each member in that list until it gets a response, where it will await a decision by the existing cluster members to have it join.
If the resource pointed out by the discovery URL doesn&#8217;t exist it will create it and with it a cluster having itself as initial master.
This option requires <span class="monospaced">ha.discovery.enabled</span> be set to <span class="monospaced">true</span>.</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ha-how">How Neo4j HA operates</h3>
<div class="paragraph"><p>A Neo4j HA cluster operates cooperatively&#8201;&#8212;&#8201;each database instance contains the logic needed in order to coordinate with the other members of the cluster.
On startup a Neo4j HA database instance will try to connect to an existing cluster specified by configuration.
If the cluster exists, the instance will join it as a slave.
Otherwise the cluster will be created and the instance will become its master.</p></div>
<div class="paragraph"><p>When performing a write transaction on a slave each write operation will be synchronized with the master (locks will be acquired on both master and slave).
When the transaction commits it will first be committed on the master and then, if successful, on the slave.
To ensure consistency, a slave has to be up to date with the master before performing a write operation.
This is built into the communication protocol between the slave and master, so that updates will be applied to a slave communicating with its master automatically.</p></div>
<div class="paragraph"><p>Write transactions performed directly through the master will execute in the same way as running in normal non-HA mode.
On success the transaction will be pushed out to a configurable number of slaves (default one slave).
This is done optimistically meaning if the push fails the transaction will still be successful.
It&#8217;s also possible to configure push factor to 0 for higher write performance when writing directly through the master, although increasing the risk of losing any transaction not yet pulled by another slave if the master goes down.</p></div>
<div class="paragraph"><p>Slaves can also be configured to pull updates asynchronously by setting the <span class="monospaced">ha.pull_interval</span> option.</p></div>
<div class="paragraph"><p>Whenever a Neo4j database becomes unavailable, by means of for example hardware failure or network outages, the other database instances in the cluster will detect that and mark it as temporarily failed.
A database instance that becomes available after being unavailable will automatically catch up with the cluster.
If the master goes down another (best suited) member will be elected and have its role switched from slave to master after a quorum has been reached within the cluster.
When the new master has performed its role switch it will broadcast its availability to all the other members of the cluster.
Normally a new master is elected and started within just a few seconds and during this time no writes can take place (the writes will block or in rare cases throw an exception).
The only time this is not true is when an old master had changes that did not get replicated to any other member before becoming unavailable.
If the new master is elected and performs changes before the old master recovers, there will be two "branches" of the database after the point where the old master became unavailable.
The old master will move away its database (its "branch") and download a full copy from the new master, to become available as a slave in the cluster.</p></div>
<div class="paragraph"><p>All this can be summarized as:</p></div>
<div class="ulist"><ul>
<li>
<p>
Write transactions can be performed on any database instance in a cluster.
</p>
</li>
<li>
<p>
Neo4j HA is fault tolerant and can continue to operate from any number of machines down to a single machine.
</p>
</li>
<li>
<p>
Slaves will be automatically synchronized with the master on write operations.
</p>
</li>
<li>
<p>
If the master fails a new master will be elected automatically.
</p>
</li>
<li>
<p>
The cluster automatically handles instances becoming unavailable (for example due to network issues), and also makes sure to accept them as members in the cluster when they are available again.
</p>
</li>
<li>
<p>
Transactions are atomic, consistent and durable but eventually propagated out to other slaves.
</p>
</li>
<li>
<p>
Updates to slaves are eventual consistent by nature but can be configured to be pushed optimistically from master during commit.
</p>
</li>
<li>
<p>
If the master goes down any running write transaction will be rolled back and new transactions will block or fail until a new master has become available.
</p>
</li>
<li>
<p>
Reads are highly available and the ability to handle read load scales with more database instances in the cluster.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="arbiter-instances">Arbiter Instances</h3>
<div class="paragraph"><p>A typical deployment of Neo4j will use a cluster of 3 machines to provide fault-tolerance and read scalability.
This setup is described in <a href="#ha-setup-tutorial">[ha-setup-tutorial]</a>.</p></div>
<div class="paragraph"><p>While having at least 3 instances is necessary for failover to happen in case the master becomes unavailable, it is not required for all instances to run the full Neo4j stack, which includes the database engine.
Instead, what is called arbiter instances can be deployed.
They can be regarded as cluster participants in that their role is to take part in master elections with the single purpose of breaking ties in the election process.
That makes possible a scenario where you have a cluster of 2 Neo4j database instances and an additional arbiter instance and still enjoy tolerance of a single failure of either of the 3 instances.</p></div>
<div class="paragraph"><p>Arbiter instances are configured in the same way as Neo4j HA members are&#8201;&#8212;&#8201;through the <em>neo4j.properties</em> file in the installation&#8217;s <em>conf/</em> directory.
Settings that are not cluster specific are of course ignored, so you can easily start up an arbiter instance in place of a properly configured Neo4j instance.</p></div>
<div class="paragraph"><p>To start an arbiter instance, call</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">neo4j_home$ ./bin/neo4j-arbiter start</pre></div>
<div class="paragraph"><p>You can also stop, install and remove it as a service and ask for it&#8217;s status in exactly the same way as for Neo4j instances.
See also <a href="#server-installation">[server-installation]</a>.</p></div>
</div>
<div class="sect2">
<h3 id="upgrade-guide">Upgrading a Neo4j HA Cluster</h3>
<div class="paragraph"><p>This document describes the steps required to upgrade a Neo4j cluster from a previous version to 1.9 without disrupting its operation, a process referred to as a rolling upgrade.
The starting assumptions are that there exists a cluster running Neo4j version 1.8 or newer with the corresponding ZooKeeper instances and that the machine which is currently the master is known.
It is also assumed that on each machine the Neo4j service and the neo4j coordinator service is installed under a directory which from here on is assumed to be /opt/old-neo4j</p></div>
<div class="sect3">
<h4 id="_overview">Overview</h4>
<div class="paragraph"><p>The process consists of upgrading each machine in turn by removing it from the cluster, moving over the database and starting it back up again.
Configuration settings also have to be transferred. It is important to note that the last machine to be upgraded must be the master.
In general, the "cluster version" is defined by the version of the master, providing the master is of the older version the cluster
as a whole can operate (the 1.9 instances running in compatibility mode). When a 1.9 instance is elected master however, the older
 instances are not capable of communicating with it, so we have to make sure that the last machine upgraded is the old master.
 The upgrade process is detected automatically from the joining 1.9 instances and they will not participate in a master election while even a single old instance is part of the cluster.</p></div>
</div>
<div class="sect3">
<h4 id="_step_1_on_each_slave_perform_the_upgrade">Step 1: On each slave perform the upgrade</h4>
<div class="paragraph"><p>Download and unpack the new version. Copy over any configuration settings you run your instances with, taking care for deprecated settings and API changes that can occur between versions.
Also, ensure that newly introduced settings have proper values (see <a href="#ha-configuration">[ha-configuration]</a>).
The most important thing about the settings setup is the <span class="monospaced">ha.coordinators</span> setting in neo4j.properties which must be set to the value the existing 1.8 instances are using.
You also have to make sure that all but one instance have the <span class="monospaced">ha.allow_init_cluster</span> setting to <span class="monospaced">false</span> - the machine that has it set to true should be the one that is to become
 the new master.
In addition, it is necessary that the last machine to be upgraded (the 1.8 master) does not have the <span class="monospaced">ha.coordinators</span> setting present in its configuration file.
Finally, don&#8217;t forget to copy over any server plugins you may have.
First, shutdown the neo4j instance with</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">service neo4j-service stop</pre></div>
<div class="paragraph"><p>Next, uninstall it</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">service neo4j-service remove</pre></div>
<div class="paragraph"><p>Now you can copy over the database. Assuming the old instance is at /opt/old-neo4j and the newly unpacked under /opt/neo4j-enterprise-1.9 the proper command would be</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">cp -R /opt/old-neo4j/data/graph.db /opt/neo4j-enterprise-1.9/data/</pre></div>
<div class="paragraph"><p>Next install the neo4j service, which also starts it</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">/opt/neo4j-enterprise-1.9/bin/neo4j install</pre></div>
<div class="paragraph"><p>Done. Now check that the services are running and that webadmin reports the version 1.9. Transactions should also be applied from the master as usual.</p></div>
</div>
<div class="sect3">
<h4 id="_step_2_upgrade_the_master_complete_the_procedure">Step 2:  Upgrade the master, complete the procedure</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Make sure that the installation that will replace the current master instance does not have <span class="monospaced">ha.coordinators</span> setting present in the <span class="monospaced">neo4j.properties</span> file.</td>
</tr></table>
</div>
<div class="paragraph"><p>Go to the current master and execute step 1 The moment it will be stopped another instance will take over (the one with the allow_init_cluster setting set to true), transitioning the cluster to 1.9. Finish Step 1 on this machine as well and you will have completed the process.</p></div>
</div>
<div class="sect3">
<h4 id="_step_3_cleanup_removing_the_coordinator_services">Step 3:  Cleanup, removing the coordinator services</h4>
<div class="paragraph"><p>Each 1.8 installation still has a coordinator service installed and running. To have those removed you need to execute at every upgraded instance</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">service neo4j-coordinator stop
service neo4j-coordinator remove</pre></div>
<div class="paragraph"><p>After that, the 1.8 instances are no longer active or needed and can be removed or archived.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="ha-setup-tutorial">High Availability setup tutorial</h3>
<div class="paragraph"><p>This guide will help you understand the ways to configure and deploy a Neo4j High Availability cluster.
Two scenarios will be considered:
The first will be configuring 3 instances to be deployed on 3 separate machines, in a setting similar to what might be encountered in a production environment.
The second will modify the former to make it possible to run a cluster of 3 instances on the same physical machine, a setup most useful during development of applications on top of Neo4j.</p></div>
<div class="sect3">
<h4 id="_background">Background</h4>
<div class="paragraph"><p>A Neo4j HA cluster consists of a set of running Neo4j Enterprise instances.
Each instance must be assigned an integer ID, which serves as its identifier in the cluster.</p></div>
<div class="paragraph"><p>At startup, a Neo4j instance contacts the other instances specified in the <span class="monospaced">ha.initial_hosts</span> configuration option.
When it establishes a connection to any one of these, it determines the current state of the cluster and ensures that it is eligible to join the cluster.
To be eligible the Neo4j instance must be hosting the same database store as other members of the cluster (although it is allowed to be in an older state), or be a new deployment without a database store.</p></div>
<div class="paragraph"><p>First, let&#8217;s explain what settings exist and what values they accept.</p></div>
<div class="sect4">
<h5 id="_ha_server_id">ha.server_id</h5>
<div class="paragraph"><p><span class="monospaced">ha.server_id</span> is the cluster identification for each instance. It must be a positive integer, unique among all
Neo4j instances in the cluster.</p></div>
</div>
<div class="sect4">
<h5 id="_ha_cluster_server">ha.cluster_server</h5>
<div class="paragraph"><p><span class="monospaced">ha.cluster_server</span> is an address/port setting that specifies where the Neo4j instance will listen for cluster
communications. This is related with the <span class="monospaced">ha.initial_hosts</span> setting. The default is <span class="monospaced">0.0.0.0:5001</span>, which is
suitable for most deployments.</p></div>
</div>
<div class="sect4">
<h5 id="_ha_server">ha.server</h5>
<div class="paragraph"><p><span class="monospaced">ha.server</span> is an additional address/port setting that specifies where the Neo4j instance will listen for content. It
must be different from ha.cluster_server, typically with a different port. The default is <span class="monospaced">0.0.0.0:6361</span>, which is
suitable for most deployments.</p></div>
</div>
<div class="sect4">
<h5 id="_ha_initial_hosts">ha.initial_hosts</h5>
<div class="paragraph"><p><span class="monospaced">ha.initial_hosts</span> is a comma separated list of hostname/port pairs, which specify how to reach other Neo4j instances
in the cluster (as configured via their <span class="monospaced">ha.cluster_server</span> option). These hostname/ports will be used when the Neo4j
instances starts, to allow it up to find and join the cluster. Note the specifying the instances own address is
permitted.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Address/port format</div>
<div class="paragraph"><p>The options <span class="monospaced">ha.cluster_server</span> and <span class="monospaced">ha.server</span> are specified as <span class="monospaced">&lt;IP address&gt;:&lt;port&gt;</span>. The IP address MUST be the
address assigned to one of the servers network interfaces, or the value <span class="monospaced">0.0.0.0</span>, which will cause Neo4j to listen
on every network interface.</p></div>
<div class="paragraph"><p>Either the address or the port can be omitted, in which case the default for that part will be used. If the address
is omitted, then the port must be preceeded with a colon (eg. <span class="monospaced">:5001</span>).</p></div>
<div class="paragraph"><p>The port can also be configured as a range, like so: <span class="monospaced">&lt;hostname&gt;:&lt;first port&gt;[-&lt;second port&gt;]</span>. In this case, Neo4j
will test each port in sequence, and select the first that is unused. Note that this usage is not permitted when the
hostname is specified as <span class="monospaced">0.0.0.0</span> (the "all interfaces" address).</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getting_started_setting_up_a_production_cluster">Getting started: Setting up a production cluster</h4>
<div class="sect4">
<h5 id="package-download">Download and unpack Neo4j Enterprise</h5>
<div class="paragraph"><p>Download Neo4j Enterprise from <a href="http://neo4j.org/download">the Neo4j download site</a>, and unpack on 3 separate machines.</p></div>
</div>
<div class="sect4">
<h5 id="_configure_ha_related_settings_for_each_installation">Configure HA related settings for each installation</h5>
<div class="paragraph"><p>The following settings should be configured for each Neo4j installation.
Note that all 3 installations have the same configuration, except for the <span class="monospaced">ha.server_id</span> property.</p></div>
<div class="paragraph"><p><strong>Neo4j instance #1&#8201;&#8212;&#8201;neo4j-01.local</strong></p></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j.properties</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Unique server id for this Neo4j instance
# can not be negative id and must be unique
ha.server_id = 1

# List of other known instances in this cluster
ha.initial_hosts = neo4j-01.local:5001,neo4j-01.local:5001,neo4j-01.local:5001
# Alternatively, use IP addresses:
#ha.initial_hosts = 192.168.0.20:5001,192.168.0.21:5001,192.168.0.22:5001</pre></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j-server.properties</span></p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Let the webserver only listen on the specified IP.
org.neo4j.server.webserver.address=0.0.0.0

# HA - High Availability
# SINGLE - Single mode, default.
org.neo4j.server.database.mode=HA</pre></div>
<div class="paragraph"><p><strong>Neo4j instance #2&#8201;&#8212;&#8201;neo4j-02.local</strong></p></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j.properties</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Unique server id for this Neo4j instance
# can not be negative id and must be unique
ha.server_id = 2

# List of other known instances in this cluster
ha.initial_hosts = neo4j-01.local:5001,neo4j-01.local:5001,neo4j-01.local:5001
# Alternatively, use IP addresses:
#ha.initial_hosts = 192.168.0.20:5001,192.168.0.21:5001,192.168.0.22:5001</pre></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j-server.properties</span></p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Let the webserver only listen on the specified IP.
org.neo4j.server.webserver.address=0.0.0.0

# HA - High Availability
# SINGLE - Single mode, default.
org.neo4j.server.database.mode=HA</pre></div>
<div class="paragraph"><p><strong>Neo4j instance #3&#8201;&#8212;&#8201;neo4j-03.local</strong></p></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j.properties</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Unique server id for this Neo4j instance
# can not be negative id and must be unique
ha.server_id = 3

# List of other known instances in this cluster
ha.initial_hosts = neo4j-01.local:5001,neo4j-01.local:5001,neo4j-01.local:5001
# Alternatively, use IP addresses:
#ha.initial_hosts = 192.168.0.20:5001,192.168.0.21:5001,192.168.0.22:5001</pre></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j-server.properties</span></p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Let the webserver only listen on the specified IP.
org.neo4j.server.webserver.address=0.0.0.0

# HA - High Availability
# SINGLE - Single mode, default.
org.neo4j.server.database.mode=HA</pre></div>
</div>
<div class="sect4">
<h5 id="_start_the_neo4j_servers">Start the Neo4j Servers</h5>
<div class="paragraph"><p>Start the Neo4j servers as normal. Note the startup order does not matter.</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">neo4j-01$ ./bin/neo4j start</pre></div>
<div class="listingblock">
<pre class="programlisting brush: shell">neo4j-02$ ./bin/neo4j start</pre></div>
<div class="listingblock">
<pre class="programlisting brush: shell">neo4j-03$ ./bin/neo4j start</pre></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Startup Time</div>
<div class="paragraph"><p>When running in HA mode, the startup script returns immediately instead of waiting for the server to become available.
This is because the instance does not accept any requests until a cluster has been formed.
In the example above this happens when you startup the second instance.
To keep track of the startup state you can follow the messages in console.log - the path to that is printed before the startup script returns.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Now, you should be able to access the 3 servers and check their HA status:</p></div>
<div class="paragraph"><p><a href="http://neo4j-01.local:7474/webadmin/#/info/org.neo4j/High%20Availability/">http://neo4j-01.local:7474/webadmin/#/info/org.neo4j/High%20Availability/</a></p></div>
<div class="paragraph"><p><a href="http://neo4j-02.local:7474/webadmin/#/info/org.neo4j/High%20Availability/">http://neo4j-02.local:7474/webadmin/#/info/org.neo4j/High%20Availability/</a></p></div>
<div class="paragraph"><p><a href="http://neo4j-03.local:7474/webadmin/#/info/org.neo4j/High%20Availability/">http://neo4j-03.local:7474/webadmin/#/info/org.neo4j/High%20Availability/</a></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You can replace database #3 with an <em>arbiter</em> instance, see <a href="#arbiter-instances">Arbiter Instances</a>.</td>
</tr></table>
</div>
<div class="paragraph"><p>That&#8217;s it! You now have a Neo4j HA cluster of 3 instances running. You can start by making a change on any
instance and those changes will be propagated between them. For more HA related configuration options take a look at
<a href="#ha-configuration">HA Configuration</a>.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_setup_creating_a_local_cluster_for_testing">Alternative setup: Creating a local cluster for testing</h4>
<div class="paragraph"><p>If you want to start a cluster similar to the one described above, but for development and testing purposes, it is
convenient to run all Neo4j instances on the same machine. This is easy to achieve, although it requires some
additional configuration as the defaults will conflict with each other.</p></div>
<div class="sect4">
<h5 id="_download_and_unpack_neo4j_enterprise">Download and unpack Neo4j Enterprise</h5>
<div class="paragraph"><p>Download Neo4j Enterprise from <a href="http://neo4j.org/download">the Neo4j download site</a>, and unpack into 3 separate
directories on your test machine.</p></div>
</div>
<div class="sect4">
<h5 id="_configure_ha_related_settings_for_each_installation_2">Configure HA related settings for each installation</h5>
<div class="paragraph"><p>The following settings should be configured for each Neo4j installation.</p></div>
<div class="paragraph"><p><strong>Neo4j instance #1&#8201;&#8212;&#8201;~/neo4j-01</strong></p></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j.properties</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Unique server id for this Neo4j instance
# can not be negative id and must be unique
ha.server_id = 1

# IP and port for this instance to bind to for communicating data with the
# other neo4j instances in the cluster.
ha.server = 127.0.0.1:6363
online_backup_server = 127.0.0.1:6366

# IP and port for this instance to bind to for communicating cluster information
# with the other neo4j instances in the cluster.
ha.cluster_server = 127.0.0.1:5001

# List of other known instances in this cluster
ha.initial_hosts = 127.0.0.1:5001,127.0.0.1:5002,127.0.0.1:5003</pre></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j-server.properties</span></p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># http port (for all data, administrative, and UI access)
org.neo4j.server.webserver.port=7474

# https port (for all data, administrative, and UI access)
org.neo4j.server.webserver.https.port=7484

# HA - High Availability
# SINGLE - Single mode, default.
org.neo4j.server.database.mode=HA</pre></div>
<div class="paragraph"><p><strong>Neo4j instance #2&#8201;&#8212;&#8201;~/neo4j-02</strong></p></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j.properties</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Unique server id for this Neo4j instance
# can not be negative id and must be unique
ha.server_id = 2

# IP and port for this instance to bind to for communicating data with the
# other neo4j instances in the cluster.
ha.server = 127.0.0.1:6364
online_backup_server = 127.0.0.1:6367

# IP and port for this instance to bind to for communicating cluster information
# with the other neo4j instances in the cluster.
ha.cluster_server = 127.0.0.1:5002

# List of other known instances in this cluster
ha.initial_hosts = 127.0.0.1:5001,127.0.0.1:5002,127.0.0.1:5003</pre></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j-server.properties</span></p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># http port (for all data, administrative, and UI access)
org.neo4j.server.webserver.port=7475

# https port (for all data, administrative, and UI access)
org.neo4j.server.webserver.https.port=7485

# HA - High Availability
# SINGLE - Single mode, default.
org.neo4j.server.database.mode=HA</pre></div>
<div class="paragraph"><p><strong>Neo4j instance #3&#8201;&#8212;&#8201;~/neo4j-03</strong></p></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j.properties</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># Unique server id for this Neo4j instance
# can not be negative id and must be unique
ha.server_id = 3

# IP and port for this instance to bind to for communicating data with the
# other neo4j instances in the cluster.
ha.server = 127.0.0.1:6365
online_backup_server = 127.0.0.1:6368

# IP and port for this instance to bind to for communicating cluster information
# with the other neo4j instances in the cluster.
ha.cluster_server = 127.0.0.1:5003

# List of other known instances in this cluster
ha.initial_hosts = 127.0.0.1:5001,127.0.0.1:5002,127.0.0.1:5003</pre></div>
<div class="paragraph"><p><span class="monospaced">conf/neo4j-server.properties</span></p></div>
<div class="listingblock">
<pre class="programlisting brush: properties"># http port (for all data, administrative, and UI access)
org.neo4j.server.webserver.port=7476

# https port (for all data, administrative, and UI access)
org.neo4j.server.webserver.https.port=7486

# HA - High Availability
# SINGLE - Single mode, default.
org.neo4j.server.database.mode=HA</pre></div>
</div>
<div class="sect4">
<h5 id="_start_the_neo4j_servers_2">Start the Neo4j Servers</h5>
<div class="paragraph"><p>Start the Neo4j servers as normal.
Note the startup order does not matter.</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">localhost:~/neo4j-01$ ./bin/neo4j start</pre></div>
<div class="listingblock">
<pre class="programlisting brush: shell">localhost:~/neo4j-02$ ./bin/neo4j start</pre></div>
<div class="listingblock">
<pre class="programlisting brush: shell">localhost:~/neo4j-03$ ./bin/neo4j start</pre></div>
<div class="paragraph"><p>Now, you should be able to access the 3 servers and check their HA status:</p></div>
<div class="paragraph"><p><a href="http://127.0.0.1:7474/webadmin/#/info/org.neo4j/High%20Availability/">http://127.0.0.1:7474/webadmin/#/info/org.neo4j/High%20Availability/</a></p></div>
<div class="paragraph"><p><a href="http://127.0.0.1:7475/webadmin/#/info/org.neo4j/High%20Availability/">http://127.0.0.1:7475/webadmin/#/info/org.neo4j/High%20Availability/</a></p></div>
<div class="paragraph"><p><a href="http://127.0.0.1:7476/webadmin/#/info/org.neo4j/High%20Availability/">http://127.0.0.1:7476/webadmin/#/info/org.neo4j/High%20Availability/</a></p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ha-rest-info">REST endpoint for HA status information</h3>
<div class="sect3">
<h4 id="_introduction_3">Introduction</h4>
<div class="paragraph"><p>A common use case for Neo4j HA clusters is to direct all write requests to the master instance while using slaves for read operations.
This allows for maximum write performance, while distributing the read load.
This way you get read scalability and failover for your deployment.
The most common way to achieve this is to place a load balancer in front of the HA cluster, an example being shown with <a href="#ha-haproxy">HA Proxy</a>.
As you can see in that guide, it makes use of a REST endpoint to discover which instance is the master and direct write load to it.
In this section, we&#8217;ll deal with this REST endpoint and explain its semantics.</p></div>
</div>
<div class="sect3">
<h4 id="_the_endpoints">The endpoints</h4>
<div class="paragraph"><p>Each HA instance comes with 2 endpoints regarding its HA status.
They are complimentary but each may be used depending on your load balancing needs and your production setup.
Those are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">/db/manage/server/ha/master</span>
</p>
</li>
<li>
<p>
<span class="monospaced">/db/manage/server/ha/slave</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To use them, just do an HTTP GET at either and you&#8217;ll get back the following:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 11. HA REST endpoint responses</caption>
<col style="width:28%;">
<col style="width:14%;">
<col style="width:28%;">
<col style="width:28%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Endpoint                           </th>
<th class="tableblock halign-left valign-top" > Instance State  </th>
<th class="tableblock halign-left valign-top" > Returned Code  </th>
<th class="tableblock halign-left valign-top" > Body text</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2" ><p class="tableblock monospaced">/db/manage/server/ha/master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">200 OK</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Slave</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">404 Not Found</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">false</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2" ><p class="tableblock monospaced">/db/manage/server/ha/slave</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">404 Not Found</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Slave</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">200 OK</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_examples">Examples</h4>
<div class="paragraph"><p>From the command line, a common way to ask those endpoints is to use <span class="monospaced">curl</span>.
With no arguments, <span class="monospaced">curl</span> will do an HTTP <span class="monospaced">GET</span> on the URI provided and will output the body text, if any.
If you also want to get the response code, just add the <span class="monospaced">-v</span> flag for verbose output. Here are some examples:</p></div>
<div class="ulist"><ul>
<li>
<p>
Requesting <span class="monospaced">master</span> endpoint on a running master with verbose output
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: shell">#&gt; curl -v localhost:7474/db/manage/server/ha/master
* About to connect() to localhost port 7474 (#0)
*   Trying ::1...
* connected
* Connected to localhost (::1) port 7474 (#0)
&gt; GET /db/manage/server/ha/master HTTP/1.1
&gt; User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8r zlib/1.2.5
&gt; Host: localhost:7474
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Access-Control-Allow-Origin: *
&lt; Transfer-Encoding: chunked
&lt; Server: Jetty(6.1.25)
&lt;
* Connection #0 to host localhost left intact
true* Closing connection #0</pre></div>
<div class="ulist"><ul>
<li>
<p>
Requesting <span class="monospaced">slave</span> endpoint on a running master without verbose output:
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: shell">#&gt; curl localhost:7474/db/manage/server/ha/slave
false</pre></div>
<div class="ulist"><ul>
<li>
<p>
Finally, requesting the <span class="monospaced">master</span> endpoint on a slave with verbose output
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: shell">#&gt; curl -v localhost:7475/db/manage/server/ha/master
* About to connect() to localhost port 7475 (#0)
*   Trying ::1...
* connected
* Connected to localhost (::1) port 7475 (#0)
&gt; GET /db/manage/server/ha/master HTTP/1.1
&gt; User-Agent: curl/7.24.0 (x86_64-apple-darwin12.0) libcurl/7.24.0 OpenSSL/0.9.8r zlib/1.2.5
&gt; Host: localhost:7475
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 404 Not Found
&lt; Content-Type: text/plain
&lt; Access-Control-Allow-Origin: *
&lt; Transfer-Encoding: chunked
&lt; Server: Jetty(6.1.25)
&lt;
* Connection #0 to host localhost left intact
false* Closing connection #0</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="ha-haproxy">Setting up HAProxy as a load balancer</h3>
<div class="paragraph"><p>In the Neo4j HA architecture, the cluster is typically fronted by a load balancer. In this section we will explore
how to set up HAProxy to perform load balancing across the HA cluster.</p></div>
<div class="sect3">
<h4 id="_installing_haproxy">Installing HAProxy</h4>
<div class="paragraph"><p>For this tutorial we will assume a Linux environment. We will also be installing HAProxy from source, and we&#8217;ll be
using version 1.4.18. You need to ensure that your Linux server has a development environment set up. On
Ubuntu/apt systems, simply do:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">aptitude install build-essential</pre></div>
<div class="paragraph"><p>And on CentOS/yum systems do:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">yum -y groupinstall 'Development Tools'</pre></div>
<div class="paragraph"><p>Then download the tarball from the <a href="http://haproxy.1wt.eu/">HAProxy website</a>. Once you&#8217;ve downloaded it,
simply build and install HAProxy:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">tar -zvxf haproxy-1.4.18.tar.gz
cd haproxy-1.4.18
make
cp haproxy /usr/sbin/haproxy</pre></div>
<div class="paragraph"><p>Or specify a target for make (TARGET=linux26 for linux kernel 2.6 or above or linux24 for 2.4 kernel)</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">tar -zvxf haproxy-1.4.18.tar.gz
cd haproxy-1.4.18
make TARGET=linux26
cp haproxy /usr/sbin/haproxy</pre></div>
</div>
<div class="sect3">
<h4 id="_configuring_haproxy">Configuring HAProxy</h4>
<div class="paragraph"><p>HAProxy can be configured in many ways. The full documentation is available at their website.</p></div>
<div class="paragraph"><p>For this example, we will configure HAProxy to load balance requests to three HA servers. Simply write the follow
configuration to <span class="monospaced">/etc/haproxy.cfg</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">global
    daemon
    maxconn 256

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http-in
    bind *:80
    default_backend neo4j

backend neo4j
    server s1 10.0.1.10:7474 maxconn 32
    server s2 10.0.1.11:7474 maxconn 32
    server s3 10.0.1.12:7474 maxconn 32

listen admin
    bind *:8080
    stats enable</pre></div>
<div class="paragraph"><p>HAProxy can now be started by running:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">/usr/sbin/haproxy -f /etc/haproxy.cfg</pre></div>
<div class="paragraph"><p>You can connect to <a href="http://&lt;ha-proxy-ip&gt;:8080/haproxy?stats">http://&lt;ha-proxy-ip&gt;:8080/haproxy?stats</a> to view the status dashboard. This dashboard can
be moved to run on port 80, and authentication can also be added. See the HAProxy documentation for details on this.</p></div>
</div>
<div class="sect3">
<h4 id="_configuring_separate_sets_for_master_and_slaves">Configuring separate sets for master and slaves</h4>
<div class="paragraph"><p>It is possible to set HAProxy backends up to only include slaves or the master. For example, it may be desired
to only write to slaves. To accomplish this, Neo4j provides <em>health check URLs</em> that HAProxy (or any load balancer for that matter) can use to distinguish machines using HTTP response codes. The two URLs are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">/db/manage/server/ha/master</span>, which returns 200 if the machine is the master, and 404 if the machine is a slave
</p>
</li>
<li>
<p>
<span class="monospaced">/db/manage/server/ha/slave</span>, which returns 200 if the machine is a slave, and 404 if the machine is the master
</p>
</li>
</ul></div>
<div class="paragraph"><p>The following example excludes the master from the set of machines. Request will only be sent to the slaves.</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">global
    daemon
    maxconn 256

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http-in
    bind *:80
    default_backend neo4j-slaves

backend neo4j-slaves
    option httpchk GET /db/manage/server/ha/slave
    server s1 10.0.1.10:7474 maxconn 32 check
    server s2 10.0.1.11:7474 maxconn 32 check
    server s3 10.0.1.12:7474 maxconn 32 check

listen admin
    bind *:8080
    stats enable</pre></div>
</div>
<div class="sect3">
<h4 id="_cache_based_sharding_with_haproxy">Cache-based sharding with HAProxy</h4>
<div class="paragraph"><p>Neo4j HA enables what is called cache-based sharding. If the dataset is too big to fit into the cache of any
single machine, then by applying a consistent routing algorithm to requests, the caches on each machine will
actually cache different parts of the graph. A typical routing key could be user ID.</p></div>
<div class="paragraph"><p>In this example, the user ID is a query parameter in the URL being requested. This will route the same user
to the same machine for each request.</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">global
    daemon
    maxconn 256

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http-in
    bind *:80
    default_backend neo4j-slaves

backend neo4j-slaves
    balance url_param user_id
    server s1 10.0.1.10:7474 maxconn 32
    server s2 10.0.1.11:7474 maxconn 32
    server s3 10.0.1.12:7474 maxconn 32

listen admin
    bind *:8080
    stats enable</pre></div>
<div class="paragraph"><p>Naturally the health check and query parameter-based routing can be combined to only route requests to slaves
by user ID. Other load balancing algorithms are also available, such as routing by source IP (<span class="monospaced">source</span>),
the URI (<span class="monospaced">uri</span>) or HTTP headers(<span class="monospaced">hdr()</span>).</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operations-backup">Backup</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The Backup features are only available in the Neo4j Enterprise Edition.</td>
</tr></table>
</div>
<div class="paragraph"><p>Backups are performed over the network live from a running graph database onto a local copy.
There are two types of backup: full and incremental.</p></div>
<div class="paragraph"><p>A <em>full backup</em> copies the database files without acquiring any locks, allowing for continued operations on the target instance. This of course means that
while copying, transactions will continue and the store will change. For this reason, the transaction that was running when the backup operation started
is noted and, when the copy operation completes, all transactions from the latter down to the one happening at the end of the copy are replayed on the backup
files. This ensures that the backed up data represent a consistent and up-to-date snapshot of the database storage.</p></div>
<div class="paragraph"><p>In contrast, an <em>incremental backup</em> does not copy store files&#8201;&#8212;&#8201;instead it copies the logs of the transactions that have taken place since the last full or
incremental backup which are then replayed over an existing backup store. This makes incremental backups far more efficient than doing full backups every
time but they also require that a <em>full backup</em> has taken place before they are executed.</p></div>
<div class="paragraph"><p>The backup tool will detect whether you are trying to run a full backup or an incremental one by inspecting the target directory.
Regardless of the mode a backup is created with, the resulting files represent a consistent database snapshot and they can be used to boot up a Neo4j instance.</p></div>
<div class="paragraph"><p>The database to be backed up is specified using a URI with syntax</p></div>
<div class="paragraph"><p>&lt;running mode&gt;://&lt;host&gt;[:port]{,&lt;host&gt;[:port]*}</p></div>
<div class="paragraph"><p>Running mode must be defined and is either <em>single</em> for non-HA or <em>ha</em> for HA clusters. The &lt;host&gt;[:port] part
points to a host running the database, on port <em>port</em> if not the default. The additional <em>host:port</em> arguments
are useful for passing multiple cluster members.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">As of version 1.9, backups are enabled by default. That means that the configuration parameter <span class="monospaced">online_backup_enabled</span> defaults to true and that
makes the backup service available on the default port (6362).
To enable the backup service on a different port use <span class="monospaced">online_backup_server=:9999</span>.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="backup-embedded-and-server">Embedded and Server</h3>
<div class="paragraph"><p>To perform a backup from a running embedded or server database run:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell"># Performing a full backup: create a blank directory and run the backup tool
mkdir /mnt/backup/neo4j-backup
./neo4j-backup -from single://192.168.1.34 -to /mnt/backup/neo4j-backup

# Performing an incremental backup: just specify the location of your previous backup
./neo4j-backup -from single://192.168.1.34 -to /mnt/backup/neo4j-backup

# Performing an incremental backup where the service is registered on a custom port
./neo4j-backup -from single://192.168.1.34:9999 -to /mnt/backup/neo4j-backup</pre></div>
</div>
<div class="sect2">
<h3 id="backup-java">Online Backup from Java</h3>
<div class="paragraph"><p>In order to programmatically backup your data full or subsequently incremental from a
JVM based program, you need to write Java code like</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">OnlineBackup backup = OnlineBackup.from( InetAddress.getLocalHost().getHostAddress() );
backup.full( backupPath.getPath() );
backup.incremental( backupPath.getPath() );</pre>
</div></div>
<div class="paragraph"><p>For more information, please see <a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/backup/OnlineBackup.html">the Javadocs for
OnlineBackup</a></p></div>
</div>
<div class="sect2">
<h3 id="backup-ha">High Availability</h3>
<div class="paragraph"><p>To perform a backup on an HA cluster you specify one or more members of the target HA cluster.
Note that the addresses you must provide are the cluster server addresses and not the HA server addresses.
That is, use the value of the <span class="monospaced">ha.cluster_server</span> setting in the configuration.</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell"># Performing a backup from HA cluster, specifying only one cluster member
./neo4j-backup -from ha://192.168.1.15:5001 -to /mnt/backup/neo4j-backup

# Performing a backup from HA cluster, specifying two possible cluster members
./neo4j-backup -from ha://192.168.1.15:5001,192.168.1.16:5002 -to /mnt/backup/neo4j-backup</pre></div>
</div>
<div class="sect2">
<h3 id="backup-restoring">Restoring Your Data</h3>
<div class="paragraph"><p>The Neo4j backups are fully functional databases.
To use a backup, all you need to do replace your database folder with the backup.
Just make sure the database isn&#8217;t running while replacing the folder.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operations-security">Security</h2>
<div class="sectionbody">
<div class="paragraph"><p>Neo4j in itself does not enforce security on the data level.
However, there are different aspects that should be considered when using Neo4j in different scenarios.</p></div>
<div class="sect2">
<h3 id="security-server">Securing access to the Neo4j Server</h3>
<div class="sect3">
<h4 id="_secure_the_port_and_remote_client_connection_accepts">Secure the port and remote client connection accepts</h4>
<div class="paragraph"><p>By default, the Neo4j Server is bundled with a Web server that binds to host <span class="monospaced">localhost</span> on port <span class="monospaced">7474</span>, answering only requests from the local machine.</p></div>
<div class="paragraph"><p>This is configured in the <em>conf/neo4j-server.properties</em> file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"># http port (for all data, administrative, and UI access)
org.neo4j.server.webserver.port=7474

#let the webserver only listen on the specified IP. Default
#is localhost (only accept local connections). Uncomment to allow
#any connection.
#org.neo4j.server.webserver.address=0.0.0.0</pre></div>
<div class="paragraph"><p>If you need to enable access from external hosts, configure the Web server in the <em>conf/neo4j-server.properties</em> by setting the property <span class="monospaced">org.neo4j.server.webserver.address=0.0.0.0</span> to enable access from any host.</p></div>
</div>
<div class="sect3">
<h4 id="_arbitrary_code_execution">Arbitrary code execution</h4>
<div class="paragraph"><p>By default, the Neo4j Server comes with some places where arbitrary code code execution can happen. These are the <a href="#rest-api-traverse">[rest-api-traverse]</a> REST endpoints.
To secure these, either disable them completely by removing offending plugins from the server classpath, or secure access to these URLs through proxies or Authorization Rules.
Also, the <a href="http://docs.oracle.com/javase/1.4.2/docs/api/java/lang/SecurityManager.html">Java Security Manager</a> can be used to secure parts of the codebase.</p></div>
</div>
<div class="sect3">
<h4 id="_https_support">HTTPS support</h4>
<div class="paragraph"><p>The Neo4j server includes built in support for SSL encrypted communication over HTTPS.
The first time the server starts, it automatically generates a self-signed SSL certificate and a private key.
Because the certificate is self signed, it is not safe to rely on for production use, instead, you should provide your own key and certificate for the server to use.</p></div>
<div class="paragraph"><p>To provide your own key and certificate, replace the generated key and certificate, or change the neo4j-server.properties file to set the location of your certificate and key:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"># Certificate location (auto generated if the file does not exist)
org.neo4j.server.webserver.https.cert.location=ssl/snakeoil.cert

# Private key location (auto generated if the file does not exist)
org.neo4j.server.webserver.https.key.location=ssl/snakeoil.key</pre></div>
<div class="paragraph"><p>Note that the key should be unencrypted.
Make sure you set correct permissions on the private key, so that only the Neo4j server user can read/write it.</p></div>
<div class="paragraph"><p>You can set what port the HTTPS connector should bind to in the same configuration file, as well as turn HTTPS off:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"># Turn https-support on/off
org.neo4j.server.webserver.https.enabled=true

# https port (for all data, administrative, and UI access)
org.neo4j.server.webserver.https.port=443</pre></div>
</div>
<div class="sect3">
<h4 id="_server_authorization_rules">Server Authorization Rules</h4>
<div class="paragraph"><p>Administrators may require more fine-grained security policies in addition to IP-level restrictions on the Web server.  Neo4j server supports
administrators in allowing or disallowing access the specific aspects of the database based on credentials that users or applications provide.</p></div>
<div class="paragraph"><p>To facilitate domain-specific authorization policies in Neo4j Server, <span class="monospaced"><a href="http://components.neo4j.org/neo4j-server/2.0-SNAPSHOT/apidocs/org/neo4j/server/rest/security/SecurityRule.html">SecurityRules</a></span> can be implemented and
registered with the server. This makes scenarios like user and role based security and
authentication against external lookup services possible.</p></div>
<div class="sect4">
<h5 id="ops-enforcing-server-authorization-rules">Enforcing Server Authorization Rules</h5>
<div class="paragraph"><p>In this example, a (dummy) failing security rule is registered to deny
access to all URIs to the server by listing the rules class in
<em>neo4j-server.properties</em>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.rest.security_rules=my.rules.PermanentlyFailingSecurityRule</pre></div>
<div class="paragraph"><p>with the rule source code of:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public class PermanentlyFailingSecurityRule implements SecurityRule
{

    public static final String REALM = "WallyWorld"; // as per RFC2617 :-)

    @Override
    public boolean isAuthorized( HttpServletRequest request )
    {
        return false; // always fails - a production implementation performs
                      // deployment-specific authorization logic here
    }

    @Override
    public String forUriPath()
    {
        return "/*";
    }

    @Override
    public String wwwAuthenticateHeader()
    {
        return SecurityFilter.basicAuthenticationResponse(REALM);
    }
}</pre>
</div></div>
<div class="paragraph"><p>With this rule registered, any access to the server will be
denied. In a production-quality implementation the rule
will likely lookup credentials/claims in a 3rd-party
directory service (e.g. LDAP) or in a local database of
authorized users.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">POST</span></strong>  <span class="monospaced">http://localhost:7474/db/data/node</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">401:</span></strong> <span class="monospaced">Unauthorized</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">WWW-Authenticate:</span></strong> <span class="monospaced">Basic realm="WallyWorld"</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect4">
<h5 id="ops-using-wildcards-to-target-security-rules">Using Wildcards to Target Security Rules</h5>
<div class="paragraph"><p>In this example, a security rule is registered to deny
access to all URIs to the server by listing the rule(s) class(es) in
<em>neo4j-server.properties</em>.
In this case, the rule is registered
using a wildcard URI path (where <span class="monospaced">*</span> characters can be used to signify
any part of the path). For example <span class="monospaced">/users*</span> means the rule
will be bound to any resources under the <span class="monospaced">/users</span> root path. Similarly
<span class="monospaced">/users*type*</span> will bind the rule to resources matching
URIs like <span class="monospaced">/users/fred/type/premium</span>.</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.rest.security_rules=my.rules.PermanentlyFailingSecurityRuleWithWildcardPath</pre></div>
<div class="paragraph"><p>with the rule source code of:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public String forUriPath()
{
    return "/protected/*";
}</pre>
</div></div>
<div class="paragraph"><p>With this rule registered, any access to URIs under /protected/ will be
denied by the server. Using wildcards allows flexible targeting of security rules to
arbitrary parts of the server&#8217;s API, including any unmanaged extensions or managed
plugins that have been registered.</p></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/protected/tree/starts/here/dummy/more/stuff</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">401:</span></strong> <span class="monospaced">Unauthorized</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">WWW-Authenticate:</span></strong> <span class="monospaced">Basic realm="WallyWorld"</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
<div class="sect4">
<h5 id="ops-using-complex-wildcards-to-target-security-rules">Using Complex Wildcards to Target Security Rules</h5>
<div class="paragraph"><p>In this example, a security rule is registered to deny
access to all URIs matching a complex pattern.
The config looks like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">org.neo4j.server.rest.security_rules=my.rules.PermanentlyFailingSecurityRuleWithComplexWildcardPath</pre></div>
<div class="paragraph"><p>with the rule source code of:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">public class PermanentlyFailingSecurityRuleWithComplexWildcardPath implements SecurityRule
{

    public static final String REALM = "WallyWorld"; // as per RFC2617 :-)

    @Override
    public boolean isAuthorized( HttpServletRequest request )
    {
        return false;
    }

    @Override
    public String forUriPath()
    {
        return "/protected/*/something/else/*/final/bit";
    }

    @Override
    public String wwwAuthenticateHeader()
    {
        return SecurityFilter.basicAuthenticationResponse(REALM);
    }
}</pre>
</div></div>
<div class="paragraph"><p><em>Example request</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">GET</span></strong>  <span class="monospaced">http://localhost:7474/protected/wildcard_replacement/x/y/z/something/else/more_wildcard_replacement/a/b/c/final/bit/more/stuff</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">Accept:</span></strong> <span class="monospaced">application/json</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>Example response</em></p></div>
<div class="ulist"><ul>
<li>
<p>
<strong><span class="monospaced">401:</span></strong> <span class="monospaced">Unauthorized</span>
</p>
</li>
<li>
<p>
<strong><span class="monospaced">WWW-Authenticate:</span></strong> <span class="monospaced">Basic realm="WallyWorld"</span>
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: javascript"></pre></div>
</div>
</div>
<div class="sect3">
<h4 id="_hosted_scripting">Hosted Scripting</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">The neo4j server exposes remote scripting functionality by default that allow full access to the underlying system.
Exposing your server without implementing a security layer poses a substantial security vulnerability.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_security_in_depth">Security in Depth</h4>
<div class="paragraph"><p>Although the Neo4j server has a number of security features built-in (see the above chapters), for sensitive deployments it is often sensible to front against the outside world it with a proxy like Apache <span class="monospaced">mod_proxy</span> <span class="footnote"><br>[<a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html">http://httpd.apache.org/docs/2.2/mod/mod_proxy.html</a>]<br></span>.</p></div>
<div class="paragraph"><p>This provides a number of advantages:</p></div>
<div class="ulist"><ul>
<li>
<p>
Control access to the Neo4j server to specific IP addresses, URL patterns and IP ranges. This can be used to make for instance only the <em>/db/data</em> namespace accessible to non-local clients, while the <em>/db/admin</em> URLs only respond to a specific IP address.
</p>
<div class="listingblock">
<pre class="programlisting brush: plain">&lt;Proxy *&gt;
  Order Deny,Allow
  Deny from all
  Allow from 192.168.0
&lt;/Proxy&gt;</pre></div>
</li>
</ul></div>
<div class="paragraph"><p>While equivalent functionality can be implemented with Neo4j&#8217;s <span class="monospaced">SecurityRule</span> plugins (see above), for operations professionals configuring servers like Apache is often preferable to developing plugins. However it should be noted that where both approaches are used, they will work harmoniously providing the behavior is consistent across proxy server and <span class="monospaced">SecurityRule</span> plugins.</p></div>
<div class="ulist"><ul>
<li>
<p>
Run Neo4j Server as a non-root user on a Linux/Unix system on a port &lt; 1000 (e.g. port 80) using
</p>
<div class="listingblock">
<pre class="programlisting brush: plain">ProxyPass /neo4jdb/data http://localhost:7474/db/data
ProxyPassReverse /neo4jdb/data http://localhost:7474/db/data</pre></div>
</li>
<li>
<p>
Simple load balancing in a clustered environment to load-balance read load using the Apache <span class="monospaced">mod_proxy_balancer</span> <span class="footnote"><br>[<a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html">http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html</a>]<br></span> plugin
</p>
<div class="listingblock">
<pre class="programlisting brush: plain">&lt;Proxy balancer://mycluster&gt;
BalancerMember http://192.168.1.50:80
BalancerMember http://192.168.1.51:80
&lt;/Proxy&gt;
ProxyPass /test balancer://mycluster</pre></div>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operations-monitoring">Monitoring</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Most of the monitoring features are only available in the Advanced and Enterprise editions of Neo4j.</td>
</tr></table>
</div>
<div class="paragraph"><p>In order to be able to continuously get an overview of the health of a Neo4j database, there are different levels of monitoring facilities available.
Most of these are exposed through <a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html">JMX</a>.</p></div>
<div class="sect2">
<h3 id="jmx-remote">Adjusting remote JMX access to the Neo4j Server</h3>
<div class="paragraph"><p>Per default, the Neo4j Advanced Server and Neo4j Enterprise Server editions do not allow remote JMX connections, since the relevant options in the <em>conf/neo4j-wrapper.conf</em> configuration file are commented out.
To enable this feature, you have to remove the <span class="monospaced">#</span> characters from the various <span class="monospaced">com.sun.management.jmxremote</span> options there.</p></div>
<div class="paragraph"><p>When commented in, the default values are set up to allow remote JMX connections with certain roles, refer to the <em>conf/jmx.password</em>, <em>conf/jmx.access</em> and <em>conf/wrapper.conf</em> files for details.</p></div>
<div class="paragraph"><p>Make sure that <em>conf/jmx.password</em> has the correct file permissions.
The owner of the file has to be the user that will run the service, and the permissions should be read only for that user.
On Unix systems, this is <span class="monospaced">0600</span>.</p></div>
<div class="paragraph"><p>On Windows, follow the tutorial at <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/management/security-windows.html">http://docs.oracle.com/javase/6/docs/technotes/guides/management/security-windows.html</a> to set the correct permissions.
If you are running the service under the Local System Account, the user that owns the file and has access to it should be SYSTEM.</p></div>
<div class="paragraph"><p>With this setup, you should be able to connect to JMX monitoring of the Neo4j server using <span class="monospaced">&lt;IP-OF-SERVER&gt;:3637</span>, with the username <span class="monospaced">monitor</span> and the password <span class="monospaced">Neo4j</span>.</p></div>
<div class="paragraph"><p>Note that it is possible that you have to update the permissions and/or ownership of the <em>conf/jmx.password</em> and <em>conf/jmx.access</em> files&#8201;&#8212;&#8201;refer to the relevant section in <em>conf/wrapper.conf</em> for details.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">For maximum security, please adjust at least the password settings in <em>conf/jmx.password</em> for a production installation.</td>
</tr></table>
</div>
<div class="paragraph"><p>For more details, see: <a href="http://download.oracle.com/javase/6/docs/technotes/guides/management/agent.html">http://download.oracle.com/javase/6/docs/technotes/guides/management/agent.html</a></p></div>
</div>
<div class="sect2">
<h3 id="jmx-connect-jconsole">How to connect to a Neo4j instance using JMX and JConsole</h3>
<div class="paragraph"><p>First, start your embedded database or the Neo4j Server, for instance using</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$NEO4j_HOME/bin/neo4j start</pre></div>
<div class="paragraph"><p>Now, start JConsole with</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">$JAVA_HOME/bin/jconsole</pre></div>
<div class="paragraph"><p>Connect to the process running your Neo4j database instance:</p></div>
<div class="imageblock">
<div class="content">
<img src="images/jconsole_connect.png" alt="Connecting with JConsole">
</div>
<div class="title">Figure 120. Connecting JConsole to the Neo4j Java process</div>
</div>
<div class="paragraph"><p>Now, beside the MBeans exposed by the JVM, you will see an <span class="monospaced">org.neo4j</span> section in the MBeans tab.
Under that, you will have access to all the monitoring information exposed by Neo4j.</p></div>
<div class="paragraph"><p>For opening JMX to remote monitoring access, please see <a href="#jmx-remote">[jmx-remote]</a> and <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/management/agent.html#gdenl">the JMX documention</a>.
When using Neo4j in embedded mode, make sure to pass the <span class="monospaced">com.sun.management.jmxremote.port=portNum</span> or other configuration as JVM parameters to your running Java process.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/jconsole_beans.png" alt="Neo4j MBeans view">
</div>
<div class="title">Figure 121. Neo4j MBeans View</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-connect-programmatic">How to connect to the JMX monitoring programmatically</h3>
<div class="paragraph"><p>In order to programmatically connect to the Neo4j JMX server, there are some convenience methods in the Neo4j Management component to help you find out the most commonly used monitoring attributes of Neo4j.
See <a href="#tutorials-java-embedded-jmx">[tutorials-java-embedded-jmx]</a> for an example.</p></div>
<div class="paragraph"><p>Once you have access to this information, you can use it to for instance expose the values to <a href="http://en.wikipedia.org/wiki/Simple_Network_Management_Protocol">SNMP</a> or other monitoring systems.</p></div>
</div>
<div class="sect2">
<h3 id="jmx-mxbeans">Reference of supported JMX MBeans</h3>
<table class="tableblock frame-all grid-all" id="jmx-list"
style="
width:100%;
">
<caption class="title">Table 12. MBeans exposed by Neo4j</caption>
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-branched-store">Branched Store</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the branched stores present in this HA cluster member</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-cache-nodecache">Cache/NodeCache</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the caching in Neo4j</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-cache-relationshipcache">Cache/RelationshipCache</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the caching in Neo4j</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-configuration">Configuration</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The configuration parameters used to configure Neo4j</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-diagnostics">Diagnostics</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Diagnostics provided by Neo4j</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-high-availability">High Availability</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about an instance participating in a HA cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-kernel">Kernel</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the Neo4j kernel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-locking">Locking</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the Neo4j lock status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-memory-mapping">Memory Mapping</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The status of Neo4j memory mapping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-primitive-count">Primitive count</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Estimates of the numbers of different kinds of Neo4j primitives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-store-file-sizes">Store file sizes</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the sizes of the different parts of the Neo4j graph store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-transactions">Transactions</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the Neo4j transaction manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="#jmx-xa-resources">XA Resources</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about the XA transaction manager</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">For additional information on the primitive datatypes (<span class="monospaced">int</span>, <span class="monospaced">long</span> etc.) used in the JMX attributes,
please see <a href="#property-value-types">[property-value-types]</a>.</td>
</tr></table>
</div>
<table class="tableblock frame-all grid-all" id="jmx-branched-store"
style="
width:100%;
">
<caption class="title">Table 13. MBean Branched Store (org.neo4j.management.BranchedStore) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the branched stores present in this HA cluster member</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">BranchedStores</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A list of the branched stores</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/management/BranchedStoreInfo.html">org.neo4j.management.BranchedStoreInfo</a>[] as <a href="http://docs.oracle.com/javase/6/docs/api/javax/management/openmbean/CompositeData.html">CompositeData</a>[]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-cache-nodecache"
style="
width:100%;
">
<caption class="title">Table 14. MBean Cache/NodeCache (org.neo4j.management.Cache) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the caching in Neo4j</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">CacheSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size of this cache (nr of entities or total size in bytes)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">CacheType</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The type of cache used by Neo4j</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">HitCount</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of times a cache query returned a result</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">MissCount</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of times a cache query did not return a result</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 15. MBean Cache/NodeCache (org.neo4j.management.Cache) Operations</caption>
<col style="width:20%;">
<col style="width:40%;">
<col style="width:20%;">
<col style="width:20%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >ReturnType</th>
<th class="tableblock halign-left valign-top" >Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">clear</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Clears the Neo4j caches</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">void</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">(no parameters)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-cache-relationshipcache"
style="
width:100%;
">
<caption class="title">Table 16. MBean Cache/RelationshipCache (org.neo4j.management.Cache) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the caching in Neo4j</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">CacheSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size of this cache (nr of entities or total size in bytes)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">CacheType</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The type of cache used by Neo4j</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">HitCount</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of times a cache query returned a result</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">MissCount</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of times a cache query did not return a result</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 17. MBean Cache/RelationshipCache (org.neo4j.management.Cache) Operations</caption>
<col style="width:20%;">
<col style="width:40%;">
<col style="width:20%;">
<col style="width:20%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >ReturnType</th>
<th class="tableblock halign-left valign-top" >Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">clear</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Clears the Neo4j caches</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">void</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">(no parameters)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-configuration"
style="
width:100%;
">
<caption class="title">Table 18. MBean Configuration (org.neo4j.jmx.impl.ConfigurationBean) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>The configuration parameters used to configure Neo4j</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">all_stores_total_mapped_memory_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for a memory mapping pool to be shared between all stores.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">allow_store_upgrade</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether to allow a store upgrade in case the current version of the database starts against an older store version. Setting this to true does not guarantee successful upgrade, just that it allows an attempt at it.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">array_block_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Specifies the block size for storing arrays. This parameter is only honored when the store is created, otherwise it is ignored. The default block size is 120 bytes, and the overhead of each block is the same as for string blocks, i.e., 8 bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">backup_slave</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mark this database as a backup slave.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">cache_type</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The type of cache to use for nodes and relationships. Note that the Neo4j Enterprise Edition has the additional <em>gcr</em> cache type. See the chapter on caches in the manual for more information.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">cypher_parser_version</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Enable this to specify a parser other than the default one.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">dump_configuration</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Print out the effective Neo4j configuration after startup.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ephemeral</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Configuration attribute</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">forced_kernel_id</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">An identifier that uniquely identifies this graph database instance within this JVM. Defaults to an auto-generated number depending on how many instance are started in this JVM.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">gc_monitor_threshold</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of time in ms the monitor thread has to be blocked before logging a message it was blocked.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">gc_monitor_wait_time</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Amount of time in ms the GC monitor thread will wait before taking another measurement.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">gcr_cache_min_log_interval</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The minimal time that must pass in between logging statistics from the cache (when using the <em>gcr</em> cache).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">grab_file_lock</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether to grab locks on files or not.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.allow_init_cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether to allow this instance to create a cluster if unable to join</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.branched_data_policy</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Policy for how to handle branched data</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.broadcast_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for broadcasting values in cluster. Must consider end-to-end duration of Paxos algorithm</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.cluster_name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The name of a cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.cluster_server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Host name and port to use for the cluster server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.com_chunk_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Max size of the data chunks that flows between master and slaves in HA. Bigger size may increase throughput,but may be more sensitive to variations in bandwidth, whereas lower size increases tolerance for bandwidth variations. Examples: 500k or 3M. Must be within 1k-16M</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.configuration_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for waiting for configuration from an existing cluster member</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.default_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Default timeout used for clustering timeouts. Override with specific timeouts if necessary</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.election_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for waiting for other members to finish a role election</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.heartbeat_interval</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">How often heartbeat messages should be sent</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.heartbeat_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for heartbeats between cluster members. Should be at least twice that of the interval</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.initial_hosts</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">This is the list of potential cluster members</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.join_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for joining a cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.learn_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for learning values</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.leave_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for waiting for cluster leave to finish</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.lock_read_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for taking locks</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.max_concurrent_channels_per_slave</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Maximum number of connections a slave can have to the master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.paxos_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Default timeout for all Paxos timeouts</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.phase1_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for Paxos phase 1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.phase2_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for Paxos phase 2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.pull_interval</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Interval of pulling updates from master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.read_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for reading network data</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.server_id</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Id for a cluster instance. Must be unique within the cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Where to bind High Availability protocol server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.slave_only</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether this instance should only participate as slave in cluster. If enabled it will never be elected as master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.state_switch_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Timeout for waiting for instance to become master or slave</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.tx_push_factor</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of slaves the master will ask to replicate a committed transaction. The master will not throw an exception on commit if the replication failed.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.tx_push_strategy</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Push strategy of a transaction to a slave during commit.  Round robin ("round_robin")   or fixed ("fixed") selecting the slave with highest machine id first</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ha.zk_session_timeout</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">ZooKeeper session timeout. Only needed for rolling upgrade from 1.8 to 1.9</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">intercept_committing_transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Determines whether any TransactionInterceptors loaded will intercept prepared transactions before they reach the logical log.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">intercept_deserialized_transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Determines whether any TransactionInterceptors loaded will intercept externally received transactions (e.g. in HA) before they reach the logical log and are applied to the store.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">jmx.port</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Configuration attribute</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">keep_logical_logs</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Make Neo4j keep the logical transaction logs for being able to backup the database.Can be used for specifying the threshold to prune logical logs after. For example "10 days" will prune logical logs that only contains transactions older than 10 days from the current time, or "100k txs" will keep the 100k latest transactions and prune any older transactions.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">label_block_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Specifies the block size for storing labels exceeding in-lined space in node record. This parameter is only honored when the store is created, otherwise it is ignored. The default block size is 60 bytes, and the overhead of each block is the same as for string blocks, i.e., 8 bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">load_kernel_extensions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Enable loading kernel extensions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">log_mapped_memory_stats_filename</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The file where Neo4j will record memory mapping statistics.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">log_mapped_memory_stats_interval</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of records to be loaded between regular logging of memory mapping statistics.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">log_mapped_memory_stats</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tell Neo4j to regularly log memory mapping statistics.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">logging.threshold_for_rotation</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Threshold in bytes for when database logs (text logs, for debugging, that is) are rotated.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">logical_log</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The base name for the logical log files, either an absolute path or relative to the store_dir setting. This should generally not be changed.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">mapped_memory_page_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Target size for pages of mapped memory.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neo_store</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The base name for the Neo4j Store files, either an absolute path or relative to the store_dir setting. This should generally not be changed.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.nodestore.db.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for memory mapping the node store.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.arrays.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for memory mapping the array property store.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.index.keys.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for memory mapping the store for property key strings.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.index.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for memory mapping the store for property key indexes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for memory mapping the property value store.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.propertystore.db.strings.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for memory mapping the string property store.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">neostore.relationshipstore.db.mapped_memory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The size to allocate for memory mapping the relationship store.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">node_auto_indexing</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Controls the auto indexing feature for nodes. Setting to false shuts it down, while true enables it by default for properties listed in the node_keys_indexable setting.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">node_cache_array_fraction</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The fraction of the heap (1%-10%) to use for the base array in the node cache (when using the <em>gcr</em> cache).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">node_cache_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of memory to use for the node cache (when using the <em>gcr</em> cache).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">node_keys_indexable</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A list of property names (comma separated) that will be indexed by default. This applies to Nodes only.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">online_backup_enabled</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Enable support for running online backups</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">online_backup_port</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Listening port for online backups. Replaced by online_backup_server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">online_backup_server</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Listening server for online backups</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">read_only</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Only allow read operations from this Neo4j instance.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">rebuild_idgenerators_fast</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Use a quick approach for rebuilding the ID generators. This give quicker recovery time, but will limit the ability to reuse the space of deleted entities.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">relationship_auto_indexing</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Controls the auto indexing feature for relationships. Setting to false shuts it down, while true enables it by default for properties listed in the relationship_keys_indexable setting.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">relationship_cache_array_fraction</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The fraction of the heap (1%-10%) to use for the base array in the relationship cache (when using the <em>gcr</em> cache).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">relationship_cache_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of memory to use for the relationship cache (when using the <em>gcr</em> cache).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">relationship_grab_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">How many relationships to read at a time during iteration</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">relationship_keys_indexable</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A list of property names (comma separated) that will be indexed by default. This applies to Relationships only.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">remote_logging_enabled</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether to enable logging to a remote server or not.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">remote_logging_host</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Host for remote logging using LogBack SocketAppender.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">remote_logging_port</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Port for remote logging using LogBack SocketAppender.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">remote_shell_enabled</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Enable a remote shell server which shell clients can log in to</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">store_dir</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The directory where the database files are located.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">string_block_size</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Specifies the block size for storing strings. This parameter is only honored when the store is created, otherwise it is ignored. Note that each character in a string occupies two bytes, meaning that a block size of 120 (the default size) will hold a 60 character long string before overflowing into a second block. Also note that each block carries an overhead of 8 bytes. This means that if the block size is 120, the size of the stored records will be 128 bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">tx_manager_impl</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The name of the Transaction Manager service to use as defined in the TM service provider constructor.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">use_memory_mapped_buffers</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tell Neo4j to use memory mapped buffers for accessing the native storage layer.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 19. MBean Configuration (org.neo4j.jmx.impl.ConfigurationBean) Operations</caption>
<col style="width:20%;">
<col style="width:40%;">
<col style="width:20%;">
<col style="width:20%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >ReturnType</th>
<th class="tableblock halign-left valign-top" >Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">apply</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Apply settings</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">void</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">(no parameters)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-diagnostics"
style="
width:100%;
">
<caption class="title">Table 20. MBean Diagnostics (org.neo4j.management.Diagnostics) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Diagnostics provided by Neo4j</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">DiagnosticsProviders</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A list of the ids for the registered diagnostics providers.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">List (java.util.List)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 21. MBean Diagnostics (org.neo4j.management.Diagnostics) Operations</caption>
<col style="width:20%;">
<col style="width:40%;">
<col style="width:20%;">
<col style="width:20%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >ReturnType</th>
<th class="tableblock halign-left valign-top" >Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">dumpAll</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Dump diagnostics information to JMX</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">(no parameters)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">dumpToLog</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Dump diagnostics information to the log.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">void</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">(no parameters)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">dumpToLog</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Dump diagnostics information to the log.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">void</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">extract</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Operation exposed for management</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">java.lang.String</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-high-availability"
style="
width:100%;
">
<caption class="title">Table 22. MBean High Availability (org.neo4j.management.HighAvailability) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about an instance participating in a HA cluster</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">Alive</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether this instance is alive or not</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">boolean</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">Available</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether this instance is available or not</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">boolean</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">InstanceId</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The identifier used to identify this server in the HA cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">InstancesInCluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about all instances in this cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/management/ClusterMemberInfo.html">org.neo4j.management.ClusterMemberInfo</a>[] as <a href="http://docs.oracle.com/javase/6/docs/api/javax/management/openmbean/CompositeData.html">CompositeData</a>[]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">LastCommittedTxId</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The latest transaction id present in this instance&#8217;s store</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">LastUpdateTime</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The time when the data on this instance was last updated from the master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">Role</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The role this instance has in the cluster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 23. MBean High Availability (org.neo4j.management.HighAvailability) Operations</caption>
<col style="width:20%;">
<col style="width:40%;">
<col style="width:20%;">
<col style="width:20%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >ReturnType</th>
<th class="tableblock halign-left valign-top" >Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">update</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(If this is a slave) Update the database on this instance with the latest transactions from the master</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">(no parameters)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-kernel"
style="
width:100%;
">
<caption class="title">Table 24. MBean Kernel (org.neo4j.jmx.Kernel) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the Neo4j kernel</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">KernelStartTime</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The time from which this Neo4j instance was in operational mode.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">Date (java.util.Date)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">KernelVersion</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The version of Neo4j</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">MBeanQuery</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">An ObjectName that can be used as a query for getting all management beans for this Neo4j instance.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">javax.management.ObjectName</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ReadOnly</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Whether this is a read only instance</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">boolean</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">StoreCreationDate</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The time when this Neo4j graph store was created.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">Date (java.util.Date)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">StoreDirectory</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The location where the Neo4j store is located</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">StoreId</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">An identifier that, together with store creation time, uniquely identifies this Neo4j graph store.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">String</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">StoreLogVersion</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The current version of the Neo4j store logical log.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-locking"
style="
width:100%;
">
<caption class="title">Table 25. MBean Locking (org.neo4j.management.LockManager) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the Neo4j lock status</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">Locks</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about all locks held by Neo4j</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">java.util.List&lt;<a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/info/LockInfo.html">org.neo4j.kernel.info.LockInfo</a>&gt; as <a href="http://docs.oracle.com/javase/6/docs/api/javax/management/openmbean/CompositeData.html">CompositeData</a>[]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfAvertedDeadlocks</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of lock sequences that would have lead to a deadlock situation that Neo4j has detected and averted (by throwing DeadlockDetectedException).</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<caption class="title">Table 26. MBean Locking (org.neo4j.management.LockManager) Operations</caption>
<col style="width:20%;">
<col style="width:40%;">
<col style="width:20%;">
<col style="width:20%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >ReturnType</th>
<th class="tableblock halign-left valign-top" >Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">getContendedLocks</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">getContendedLocks</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">java.util.List&lt;<a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/kernel/info/LockInfo.html">org.neo4j.kernel.info.LockInfo</a>&gt; as <a href="http://docs.oracle.com/javase/6/docs/api/javax/management/openmbean/CompositeData.html">CompositeData</a>[]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-memory-mapping"
style="
width:100%;
">
<caption class="title">Table 27. MBean Memory Mapping (org.neo4j.management.MemoryMapping) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>The status of Neo4j memory mapping</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">MemoryPools</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Get information about each pool of memory mapped regions from store files with memory mapping enabled</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/management/WindowPoolInfo.html">org.neo4j.management.WindowPoolInfo</a>[] as <a href="http://docs.oracle.com/javase/6/docs/api/javax/management/openmbean/CompositeData.html">CompositeData</a>[]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-primitive-count"
style="
width:100%;
">
<caption class="title">Table 28. MBean Primitive count (org.neo4j.jmx.Primitives) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Estimates of the numbers of different kinds of Neo4j primitives</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfNodeIdsInUse</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">An estimation of the number of nodes used in this Neo4j instance</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfPropertyIdsInUse</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">An estimation of the number of properties used in this Neo4j instance</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfRelationshipIdsInUse</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">An estimation of the number of relationships used in this Neo4j instance</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfRelationshipTypeIdsInUse</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of relationship types used in this Neo4j instance</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-store-file-sizes"
style="
width:100%;
">
<caption class="title">Table 29. MBean Store file sizes (org.neo4j.management.StoreFile) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the sizes of the different parts of the Neo4j graph store</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">ArrayStoreSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of disk space used to store array properties, in bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">LogicalLogSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of disk space used by the current Neo4j logical log, in bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NodeStoreSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of disk space used to store nodes, in bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">PropertyStoreSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of disk space used to store properties (excluding string values and array values), in bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">RelationshipStoreSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of disk space used to store relationships, in bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">StringStoreSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The amount of disk space used to store string properties, in bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">TotalStoreSize</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The total disk space used by this Neo4j instance, in bytes.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-transactions"
style="
width:100%;
">
<caption class="title">Table 30. MBean Transactions (org.neo4j.management.TransactionManager) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the Neo4j transaction manager</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">LastCommittedTxId</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The id of the latest committed transaction</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfCommittedTransactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The total number of committed transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfOpenedTransactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The total number started transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">int</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfOpenTransactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The number of currently open transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">int</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">NumberOfRolledBackTransactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The total number of rolled back transactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">long</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">PeakNumberOfConcurrentTransactions</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The highest number of transactions ever opened concurrently</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">int</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" id="jmx-xa-resources"
style="
width:100%;
">
<caption class="title">Table 31. MBean XA Resources (org.neo4j.management.XaManager) Attributes</caption>
<col style="width:22%;">
<col style="width:40%;">
<col style="width:22%;">
<col style="width:7%;">
<col style="width:7%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >Name</th>
<th class="tableblock halign-left valign-top" >Description</th>
<th class="tableblock halign-left valign-top" >Type</th>
<th class="tableblock halign-left valign-top" >Read</th>
<th class="tableblock halign-left valign-top" >Write</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5" ><p class="tableblock"><em>Information about the XA transaction manager</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced">XaResources</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Information about all XA resources managed by the transaction manager</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock monospaced"><a href="http://components.neo4j.org/neo4j-enterprise/2.0-SNAPSHOT/apidocs/org/neo4j/management/XaResourceInfo.html">org.neo4j.management.XaResourceInfo</a>[] as <a href="http://docs.oracle.com/javase/6/docs/api/javax/management/openmbean/CompositeData.html">CompositeData</a>[]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h1 id="tools">Tools</h1>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>The Tools part describes available Neo4j tools and how to use them.</p></div>
</div></div>
<div class="sect1">
<h2 id="tools-webadmin">Web Administration</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Neo4j Web Administration is the primary user interface for Neo4j.
With it, you can:</p></div>
<div class="ulist"><ul>
<li>
<p>
monitor the Neo4j Server
</p>
</li>
<li>
<p>
manipulate and browse data
</p>
</li>
<li>
<p>
interact with the database via various consoles
</p>
</li>
<li>
<p>
view raw data management objects (JMX MBeans)
</p>
</li>
</ul></div>
<div class="paragraph"><p>The tool is available at <a href="http://127.0.0.1:7474/">http://127.0.0.1:7474/</a> after you have installed the <a href="#server">Neo4j Server</a>.</p></div>
<div class="sect2">
<h3 id="webadmin-dashboard">Dashboard tab</h3>
<div class="paragraph"><p>The Dashboard tab provides an overview of a running Neo4j instance.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-overview.png" alt="Dashboard tab">
</div>
<div class="title">Figure 122. Web Administration Dashboard</div>
</div>
<div class="sect3">
<h4 id="_entity_chart">Entity chart</h4>
<div class="paragraph"><p>The charts show entity counts over time: node, relationship and properties.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-charts.png" alt="Entity charts">
</div>
<div class="title">Figure 123. Entity charting</div>
</div>
</div>
<div class="sect3">
<h4 id="_status_monitoring">Status monitoring</h4>
<div class="paragraph"><p>Below the entity chart is a collection of status panels, displaying current resource usage.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-stats.png" alt="Status indicator panels">
</div>
<div class="title">Figure 124. Status indicator panels</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="webadmin-data">Data tab</h3>
<div class="paragraph"><p>Use the Data tab to browse, add or modify nodes, relationships and their properties.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-data.png" alt="Data tab">
</div>
<div class="title">Figure 125. Browsing and manipulating data</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-databrowser.png" alt="Node properties">
</div>
<div class="title">Figure 126. Editing properties</div>
</div>
</div>
<div class="sect2">
<h3 id="webadmin-console">Console tab</h3>
<div class="paragraph"><p>The Console tab gives:</p></div>
<div class="ulist"><ul>
<li>
<p>
scripting access to the database via the <a href="http://gremlin.tinkerpop.com">Gremlin</a> scripting engine,
</p>
</li>
<li>
<p>
query access via <a href="#cypher-query-lang">Cypher</a>,
</p>
</li>
<li>
<p>
HTTP access via the HTTP console.
</p>
</li>
</ul></div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-console-gremlin.png" alt="Data manipulation with Gremlin">
</div>
<div class="title">Figure 127. Traverse data with Gremlin</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-console-cypher.png" alt="Queries with Cypher">
</div>
<div class="title">Figure 128. Query data with Cypher</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-console-http.png" alt="Queries with Cypher">
</div>
<div class="title">Figure 129. Interact over HTTP</div>
</div>
</div>
<div class="sect2">
<h3 id="webadmin-serverinfo">The Server Info tab</h3>
<div class="paragraph"><p>The Server Info tab provides raw access to all available management objects (see <a href="#operations-monitoring">[operations-monitoring]</a> for details).</p></div>
<div class="imageblock">
<div class="content">
<img src="images/operations/webadmin-jmx.png" alt="JMX">
</div>
<div class="title">Figure 130. JMX Attributes</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shell">Neo4j Shell</h2>
<div class="sectionbody">
<div class="paragraph"><p>Neo4j shell is a command-line shell for browsing the graph, much like how the Unix shell along with commands like <span class="monospaced">cd</span>, <span class="monospaced">ls</span> and <span class="monospaced">pwd</span> can be used to browse your local file system.
It consists of two parts:</p></div>
<div class="ulist"><ul>
<li>
<p>
a lightweight client that sends commands via RMI and
</p>
</li>
<li>
<p>
a server that processes those commands and sends the result back to the client.
</p>
</li>
</ul></div>
<div class="paragraph"><p>It&#8217;s a nice tool for development and debugging.
This guide will show you how to get it going!</p></div>
<div class="sect2">
<h3 id="shell-starting">Starting the shell</h3>
<div class="paragraph"><p>When used together with Neo4j started as a server, simply issue the following at the command line:</p></div>
<div class="listingblock">
<pre class="programlisting brush: shell">./bin/neo4j-shell</pre></div>
<div class="paragraph"><p>For the full list of options, see the reference in the <a href="#shell-manpage">Shell manual page</a>.</p></div>
<div class="paragraph"><p>To connect to a running Neo4j database, use <a href="#read-only-mode">[read-only-mode]</a> for local databases
and see <a href="#shell-enabling-remote">[shell-enabling-remote]</a> for remote databases.</p></div>
<div class="paragraph"><p>You need to make sure that the shell jar file is on the classpath when you start up your Neo4j instance.</p></div>
<div class="sect3">
<h4 id="shell-enabling-remote">Enabling the shell server</h4>
<div class="paragraph"><p>Shell is enabled from the configuration of the Neo4j kernel, see <a href="#server-configuration">[server-configuration]</a>.
Here&#8217;s some sample configurations:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"># Using default values
enable_remote_shell = true
# ...or specify custom port, use default values for the others
enable_remote_shell = port=1234</pre></div>
<div class="paragraph"><p>When using the Neo4j server, see <a href="#server-configuration">[server-configuration]</a> for how to add configuration settings in that case.</p></div>
<div class="paragraph"><p>There are two ways to start the shell, either by connecting to a remote shell server or by pointing it to a Neo4j store path.</p></div>
</div>
<div class="sect3">
<h4 id="_connecting_to_a_shell_server">Connecting to a shell server</h4>
<div class="paragraph"><p>To start the shell and connect to a running server, run:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">neo4j-shell</pre></div>
<div class="paragraph"><p>Alternatively supply <span class="monospaced">-port</span> and <span class="monospaced">-name</span> options depending on how the remote shell server was enabled.
Then you&#8217;ll get the shell prompt like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">neo4j-sh (0)$</pre></div>
</div>
<div class="sect3">
<h4 id="_pointing_the_shell_to_a_path">Pointing the shell to a path</h4>
<div class="paragraph"><p>To start the shell by just pointing it to a Neo4j store path you run the shell jar file.
Given that the right neo4j-kernel-&lt;version&gt;.jar and jta jar files are in the same path as your neo4j-shell-&lt;version&gt;.jar file you run it with:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">$ neo4j-shell -path path/to/neo4j-db</pre></div>
</div>
<div class="sect3">
<h4 id="read-only-mode">Read-only mode</h4>
<div class="paragraph"><p>By issuing the <span class="monospaced">-readonly</span> switch when starting the shell with a store path,
changes cannot be made to the database during the session.</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">$ neo4j-shell -readonly -path path/to/neo4j-db</pre></div>
</div>
<div class="sect3">
<h4 id="_run_a_command_and_then_exit">Run a command and then exit</h4>
<div class="paragraph"><p>It is possible to tell the shell to just start, execute a command and then exit.
This opens up for uses of background jobs and also handling of huge output of f.ex. an <em>''ls</em>'' command where you then could pipe the output to <em>''less</em>'' or another reader of your choice, or even to a file.</p></div>
<div class="paragraph"><p>And even to another neo4j-shell, e.g. for importing a <em>''dump</em>'' of another database or cypher result. When used with command mode the shell will not output a welcome message.
So some examples of usage:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">$ neo4j-shell -c "cd -a 24 &amp;&amp; set name Mattias"
$ neo4j-shell -c "trav -r KNOWS" | less</pre></div>
</div>
<div class="sect3">
<h4 id="_execute_a_file_and_then_exit">Execute a file and then exit</h4>
<div class="paragraph"><p>To execute commands from a file  and then exit just provide a <span class="monospaced">-file
filename</span>. This is faster than piping to the shell which still handles
the input as if it was user input.</p></div>
<div class="paragraph"><p>For example reading a dump file directly from the command line and executing
it against the given database. For example:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">$ neo4j-shell -file export.cql &gt; result.txt</pre></div>
</div>
</div>
<div class="sect2">
<h3 id="shell-options">Passing options and arguments</h3>
<div class="paragraph"><p>Passing options and arguments to your commands is very similar to many CLI commands in an *nix environment.
Options are prefixed with a <span class="monospaced">-</span> and can contain one or more options.
Some options expect a value to be associated with it.
Arguments are string values which aren&#8217;t prefixed with <span class="monospaced">-</span>.
Let&#8217;s look at <span class="monospaced">ls</span> as an example:</p></div>
<div class="paragraph"><p><span class="monospaced">ls -r -f KNOWS:out -v 12345</span> will make a verbose listing of node <span class="monospaced">12345</span>'s outgoing relationships of type <span class="monospaced">KNOWS</span>.
The node id, <span class="monospaced">12345</span>, is an argument to <span class="monospaced">ls</span> which tells it to do the listing on that node instead of the current node (see <span class="monospaced">pwd</span> command).
However a shorter version of this can be written:</p></div>
<div class="paragraph"><p><span class="monospaced">ls -rfv KNOWS:out 12345</span>. Here all three options are written together after a single <em><span class="monospaced">-</span></em> prefix.
Even though <span class="monospaced">f</span> is in the middle it gets associated with the <span class="monospaced">KNOWS:out</span> value.
The reason for this is that the <span class="monospaced">ls</span> command doesn&#8217;t expect any values associated with the <span class="monospaced">r</span> or <span class="monospaced">v</span> options.
So, it can infer the right values for the rights options.</p></div>
</div>
<div class="sect2">
<h3 id="shell-options-enum">Enum options</h3>
<div class="paragraph"><p>Some options expects a value which is one of the values in an enum, f.ex. direction part of relationship type filtering where there&#8217;s <span class="monospaced">INCOMING</span>, <span class="monospaced">OUTGOING</span> and <span class="monospaced">BOTH</span>.
All such values can be supplied in an easier way.
It&#8217;s enough that you write the start of the value and the interpreter will find what you really meant.
F.ex. <span class="monospaced">out</span>, <span class="monospaced">in</span>, <span class="monospaced">i</span> or even <span class="monospaced">INCOMING</span>.</p></div>
</div>
<div class="sect2">
<h3 id="shell-filters">Filters</h3>
<div class="paragraph"><p>Some commands makes use of filters for varying purposes.
F.ex. <span class="monospaced">-f</span> in <span class="monospaced">ls</span> and in <span class="monospaced">trav</span>.
A filter is supplied as a <a href="http://www.json.org/">json</a> object (w/ or w/o the surrounding <span class="monospaced">{}</span> brackets.
Both keys and values can contain regular expressions for a more flexible matching.
An example of a filter could be <span class="monospaced">.*url.*:http.*neo4j.*,name:Neo4j</span>.
The filter option is also accompanied by the options <span class="monospaced">-i</span> and <span class="monospaced">-l</span> which stands for <span class="monospaced">ignore case</span> (ignore casing of the characters) and <span class="monospaced">loose matching</span> (it&#8217;s considered a match even if the filter value just matches a part of the compared value, not necessarily the entire value).
So for a case-insensitive, loose filter you can supply a filter with <span class="monospaced">-f -i -l</span> or <span class="monospaced">-fil</span> for short.</p></div>
</div>
<div class="sect2">
<h3 id="shell-titles">Node titles</h3>
<div class="paragraph"><p>To make it easier to navigate your graph the shell can display a title for each node, f.ex. in <span class="monospaced">ls -r</span>.
It will display the relationships as well as the nodes on the other side of the relationships.
The title is displayed together with each node and its best suited property value from a list of property keys.</p></div>
<div class="paragraph"><p>If you&#8217;re standing on a node which has two <span class="monospaced">KNOWS</span> relationships to other nodes it&#8217;d be difficult to know which friend is which.
The title feature addresses this by reading a list of property keys and grabbing the first existing property value of those keys and displays it as a title for the node.
So you may specify a list (with or without regular expressions), f.ex: <span class="monospaced">name,title.*,caption</span> and the title for each node will be the property value of the first existing key in that list.
The list is defined by the client (you) using the <span class="monospaced">TITLE_KEYS</span> <a href="#shell-env-vars">environment variable</a> and the default being <span class="monospaced">.*name.*,.*title.*</span></p></div>
</div>
<div class="sect2">
<h3 id="shell-commands">How to use (individual commands)</h3>
<div class="paragraph"><p>The shell is modeled after Unix shells like bash that you use to walk around your local file system.
It has some of the same commands, like <span class="monospaced">cd</span> and <span class="monospaced">ls</span>.
When you first start the shell (see instructions above), you will get a list of all the available commands.
Use <span class="monospaced">man &lt;command&gt;</span> to get more info about a particular command. Some notes:</p></div>
<div class="sect3">
<h4 id="comments">Comments</h4>
<div class="paragraph"><p>Single line comments, which will be ignored, can be made by using the prefix "//". Example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>// This is a comment</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="shell-current-pos">Current node/relationship and path</h4>
<div class="paragraph"><p>You have a current node/relationship and a "current path" (like a current working directory in bash) that you&#8217;ve traversed so far.
You start at the <a href="http://api.neo4j.org/current/org/neo4j/graphdb/GraphDatabaseService.html#getReferenceNode()">reference node</a> and can then <span class="monospaced">cd</span> your way through the graph (check your current path at any time with the <span class="monospaced">pwd</span> command).
<span class="monospaced">cd</span> can be used in different ways:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">cd &lt;node-id&gt;</span> will traverse one relationship to the supplied node id. The node must have a direct relationship to the current node.
</p>
</li>
<li>
<p>
<span class="monospaced">cd -a &lt;node-id&gt;</span> will do an absolute path change, which means the supplied node doesn&#8217;t have to have a direct relationship to the current node.
</p>
</li>
<li>
<p>
<span class="monospaced">cd -r &lt;relationship-id&gt;</span> will traverse to a relationship instead of a node. The relationship must have the current node as either start or end point. To see the relationship ids use the <span class="monospaced">ls -vr</span> command on nodes.
</p>
</li>
<li>
<p>
<span class="monospaced">cd -ar &lt;relationship-id&gt;</span> will do an absolute path change which means the relationship can be any relationship in the graph.
</p>
</li>
<li>
<p>
<span class="monospaced">cd</span> will take you back to the reference node, where you started in the first place.
</p>
</li>
<li>
<p>
<span class="monospaced">cd ..</span> will traverse back one step to the previous location, removing the last path item from your current path (<span class="monospaced">pwd</span>).
</p>
</li>
<li>
<p>
<span class="monospaced">cd start</span> <em>(only if your current location is a relationship)</em>. Traverses to the start node of the relationship.
</p>
</li>
<li>
<p>
<span class="monospaced">cd end</span> <em>(only if your current location is a relationship)</em>. Traverses to the end node of the relationship.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="shell-listing">Listing the contents of a node/relationship</h4>
<div class="paragraph"><p>List contents of the current node/relationship (or any other node) with the <span class="monospaced">ls</span> command.
Please note that it will give an empty output if the current node/relationship has no properties or relationships (for example in the case of a brand new graph).
<span class="monospaced">ls</span> can take a node id as argument as well as filters, see <a href="#shell-filters">[shell-filters]</a> and for information about how to specify direction see <a href="#shell-options-enum">[shell-options-enum]</a>.
Use <span class="monospaced">man ls</span> for more info.</p></div>
</div>
<div class="sect3">
<h4 id="_creating_nodes_and_relationships">Creating nodes and relationships</h4>
<div class="paragraph"><p>You create new nodes by connecting them with relationships to the current node.
For example, <span class="monospaced">mkrel -t A_RELATIONSHIP_TYPE -d OUTGOING -c</span> will create a new node (<span class="monospaced">-c</span>) and draw to it an <span class="monospaced">OUTGOING</span> relationship of type <span class="monospaced">A_RELATIONSHIP_TYPE</span> from the current node.
If you already have two nodes which you&#8217;d like to draw a relationship between (without creating a new node) you can do for example, <span class="monospaced">mkrel -t A_RELATIONSHIP_TYPE -d OUTGOING -n &lt;other-node-id&gt;</span> and it will just create a new relationship between the current node and that other node.</p></div>
</div>
<div class="sect3">
<h4 id="_setting_renaming_and_removing_properties">Setting, renaming and removing properties</h4>
<div class="paragraph"><p>Property operations are done with the <span class="monospaced">set</span>, <span class="monospaced">mv</span> and <span class="monospaced">rm</span> commands.
These commands operates on the current node/relationship.
* <span class="monospaced">set &lt;key&gt; &lt;value&gt;</span> with optionally the <span class="monospaced">-t</span> option (for value type) sets a property.
Supports every type of value that Neo4j supports. Examples of a property of type <span class="monospaced">int</span>:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">$ set -t int age 29</pre></div>
<div class="paragraph"><p>And an example of setting a <span class="monospaced">double[]</span> property:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">$ set -t double[] my_values [1.4,12.2,13]</pre></div>
<div class="paragraph"><p>Example of setting a <span class="monospaced">String</span> property containing a JSON string:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">mkrel -c -d i -t DOMAIN_OF --np "{'app':'foobar'}"</pre></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">rm &lt;key&gt;</span> removes a property.
</p>
</li>
<li>
<p>
<span class="monospaced">mv &lt;key&gt; &lt;new-key&gt;</span> renames a property from one key to another.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_deleting_nodes_and_relationships">Deleting nodes and relationships</h4>
<div class="paragraph"><p>Deletion of nodes and relationships is done with the <span class="monospaced">rmnode</span> and <span class="monospaced">rmrel</span> commands.
<span class="monospaced">rmnode</span> can delete nodes, if the node to be deleted still has relationships they can also be deleted by supplying -f option.
<span class="monospaced">rmrel</span> can delete relationships, it tries to ensure connectedness in the graph, but relationships can be deleted regardless with the -f option.
<span class="monospaced">rmrel</span> can also delete the node on the other side of the deleted relationship if it&#8217;s left with no more relationships, see -d option.</p></div>
</div>
<div class="sect3">
<h4 id="shell-env-vars">Environment variables</h4>
<div class="paragraph"><p>The shell uses environment variables a-la bash to keep session information, such as the current path and more.
The commands for this mimics the bash commands <span class="monospaced">export</span> and <span class="monospaced">env</span>. For example you can at anytime issue a <span class="monospaced">export STACKTRACES=true</span> command to set the <span class="monospaced">STACKTRACES</span> environment variable to <span class="monospaced">true</span>. This will then result in stacktraces being printed if an exception or error should occur.
Allowed values are all parseable JSON strings, so maps <span class="monospaced">{age:10,name:"Mattias"}</span> and arrays <span class="monospaced">[1,2,3]</span> are also supported.</p></div>
<div class="paragraph"><p>Variables can also be assigned to each other. E.g. <span class="monospaced">a=b</span> will result in <span class="monospaced">a</span> containing the value of <span class="monospaced">b</span>.</p></div>
<div class="paragraph"><p>This becomes especially interesting as all shell variables are automatically passed to cypher statements as parameters. That makes it easy to query for certain start nodes or
 create nodes and relationships with certain provided properties (as maps).</p></div>
<div class="paragraph"><p>Values are removed by setting them to <span class="monospaced">null</span> or an empty value. List environment variables using <span class="monospaced">env</span></p></div>
</div>
<div class="sect3">
<h4 id="_executing_groovy_python_scripts">Executing groovy/python scripts</h4>
<div class="paragraph"><p>The shell has support for executing scripts, such as <a href="http://groovy.codehaus.org">Groovy</a> and <a href="http://www.python.org">Python</a> (via <a href="http://www.jython.org">Jython</a>).
As of now the scripts (*.groovy, *.py) must exist on the server side and gets called from a client with for example, <span class="monospaced">gsh --renamePerson 1234 "Mathias" "Mattias" --doSomethingElse</span> where the scripts renamePerson.groovy and doSomethingElse.groovy must exist on the server side in any of the paths given by the <span class="monospaced">GSH_PATH</span> environment variable (defaults to .:src:src/script). This variable is like the java classpath, separated by a <span class="monospaced">:</span>. The python/jython scripts can be executed with the <span class="monospaced">jsh</span> in a similar fashion, however the scripts have the .py extension and the environment variable for the paths is <span class="monospaced">JSH_PATH</span>.</p></div>
<div class="paragraph"><p>When writing the scripts assume that there&#8217;s made available an <span class="monospaced">args</span> variable (a String[]) which contains the supplied arguments.
In the case of the <span class="monospaced">renamePerson</span> example above the array would contain <span class="monospaced">["1234", "Mathias", "Mattias"]</span>.
Also please write your outputs to the <span class="monospaced">out</span> variable, such as <span class="monospaced">out.println( "My tracing text" )</span> so that it will be printed at the shell client instead of the server.</p></div>
</div>
<div class="sect3">
<h4 id="_traverse">Traverse</h4>
<div class="paragraph"><p>You can traverse the graph with the <span class="monospaced">trav</span> command which allows for simple traversing from the current node.
You can supply which relationship types (w/ regex matching) and optionally direction as well as property filters for matching nodes.
In addition to that you can supply a command line to execute for each match.
An example: <span class="monospaced">trav -o depth -r KNOWS:both,HAS_.*:incoming -c "ls $n"</span>.
Which means traverse depth first for relationships with type <span class="monospaced">KNOWS</span> disregarding direction and incoming relationships with type matching <span class="monospaced">HAS_.\*</span> and do a <span class="monospaced">ls &lt;matching node&gt;</span> for each match. The node filtering is supplied with the <span class="monospaced">-f</span> option, see <a href="#shell-filters">[shell-filters]</a>.
See <a href="#shell-options-enum">[shell-options-enum]</a> for the traversal order option. Even relationship types/directions are supplied using the same format as filters.</p></div>
</div>
<div class="sect3">
<h4 id="_query_with_cypher">Query with Cypher</h4>
<div class="paragraph"><p>You can use Cypher to query the graph. For that, use the <span class="monospaced">start</span> command. You can also use <span class="monospaced">create</span> statements to create nodes and relationships and
use the <span class="monospaced">cypher VERSION</span> prefix to select a certain cypher parser.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Cypher queries need to be terminated by a semicolon <span class="monospaced">;</span>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Cypher commands are given all shell variables as parameters and the special <span class="monospaced">self</span> parameter for the current node or relationship.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">start n = node(0) return n;</span> will give you a listing of the node with ID 0
</p>
</li>
<li>
<p>
<span class="monospaced">cypher 1.8 start n = node(0) return n;</span> will execute the query with the Cypher parser version 1.8
</p>
</li>
<li>
<p>
<span class="monospaced">profile start n = node(0) return n;</span> will execute the cypher query and display profiling information
</p>
</li>
<li>
<p>
<span class="monospaced">START n = node({self}) MATCH (n)-[:KNOWS]&#8594;(friend) RETURN friend;</span> will
return the nodes connected to the current node.
</p>
</li>
<li>
<p>
<span class="monospaced">START n=node({me}) CREATE friend={props}, (me)-[r:KNOWS]&#8594;(friend);</span> will
create the friend and the relationship according to the variables available.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_indexing">Indexing</h4>
<div class="paragraph"><p>It&#8217;s possible to query and manipulate indexes via the index command.
Example: <span class="monospaced">index -i persons name</span> (will index the name for the current node or relationship in the "persons" index).</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">-g</span> will do exact lookup in the index and display hits. You can supply <span class="monospaced">-c</span> with a command to be executed for each hit.
</p>
</li>
<li>
<p>
<span class="monospaced">-q</span> will ask the index a query and display hits. You can supply <span class="monospaced">-c</span> with a command to be executed for each hit.
</p>
</li>
<li>
<p>
<span class="monospaced">--cd</span> will change current location to the hit from the query. It&#8217;s just a convenience for using the <span class="monospaced">-c</span> option.
</p>
</li>
<li>
<p>
<span class="monospaced">--ls</span> will do a listing of the contents for each hit. It&#8217;s just a convenience for using the <span class="monospaced">-c</span> option.
</p>
</li>
<li>
<p>
<span class="monospaced">-i</span> will index a key-value pair in an index for the current node/relationship. If no value is given the property value for that key for the current node is used as value.
</p>
</li>
<li>
<p>
<span class="monospaced">-r</span> will remove a key-value pair (if it exists) from an index for the current node/relationship. Key and value is optional.
</p>
</li>
<li>
<p>
<span class="monospaced">-t</span> will set the index type to work with, for example <span class="monospaced">index -t Relationship --delete friends</span> will delete the <span class="monospaced">friends</span> relationship index.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_transactions">Transactions</h4>
<div class="paragraph"><p>It is useful to be able to test changes, and then being able to commit or rollback said changes.</p></div>
<div class="paragraph"><p>Transactions can be nested. With a nested transaction, a commit does not write any changes to disk, except for the
top level transaction. A rollback, however works regardless of the level of the transaction. It will roll back
all open transactions.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">begin transaction</span>  Starts a transaction.
</p>
</li>
<li>
<p>
<span class="monospaced">commit</span> Commits a transaction.
</p>
</li>
<li>
<p>
<span class="monospaced">rollback</span> Rollbacks all open transactions.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_dumping_the_database_or_a_cypher_result_to_cypher_statements">Dumping the database or a cypher result to Cypher statements</h4>
<div class="paragraph"><p>As a simple way of exporting a database or a subset of it, the <span class="monospaced">dump</span> command converts the graph of a Cypher result or the whole database into a single Cypher <span class="monospaced">create</span> statement.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Index export is not yet supported.</td>
</tr></table>
</div>
<div class="paragraph"><p>Examples:
* <span class="monospaced">dump + dumps the whole database as single cypher create statement
* +dump START n=node({self}) MATCH p=(n)-[r:KNOWS*]&#8594;(m) RETURN n,r,m;</span> dumps the transitive friendship graph of the current node.
* <span class="monospaced">neo4j-shell -path db1 -c dump START n=node:node_auto_index(name='Mattias\') MATCH p=(n)-[r:KNOWS]&#8594;(m) RETURN p; | neo4j-shell -path db2</span>
imports the subgraph of the first database (db1) into the second (db2)</p></div>
<div class="sect4">
<h5 id="_example_dump_scripts">Example Dump Scripts</h5>
<div class="listingblock">
<pre class="programlisting brush: bash"> # create a new node and go to it
 neo4j-sh (0)$ mknode --cd --np "{'name':'Neo'}"

 # create a relationship
 neo4j-sh (Neo,1)$ mkrel -c -d i -t LIKES --np "{'app':'foobar'}"

 # Export the cypher statement results
 neo4j-sh (Neo,1)$ dump START n=node({self}) MATCH (n)-[r]-(m) return n,r,m;
 begin
 create (_1 {`name`:"Neo"})
 create (_2 {`app`:"foobar"})
 create _2-[:`LIKES`]-&gt;_1
 ;
 commit</pre></div>
<div class="listingblock">
<pre class="programlisting brush: bash"> # create an index
 neo4j-sh (0)$ create index on :Person(name);
 +--------------------------------------------+
 | No data returned, and nothing was changed. |
 +--------------------------------------------+
 20 ms


 # create one labeled node and a relationship
 neo4j-sh (0)$ create (m:Person:Hacker {name:'Mattias'}), (m)-[:KNOWS]-&gt;(m);
 +-------------------+
 | No data returned. |
 +-------------------+
 Nodes created: 1
 Relationships created: 1
 Properties set: 1
 Labels added: 2
 281 ms


 # Export the whole database including indexes
 neo4j-sh (0)$ dump
 begin
 create index on :`Person`(`name`);
 create (_1:`Person`:`Hacker` {`name`:"Mattias"})
 create _1-[:`KNOWS`]-&gt;_1
 ;
 commit</pre></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shell-extending">Extending the shell: Adding your own commands</h3>
<div class="paragraph"><p>Of course the shell is extendable and has a generic core which has nothing to do with Neo4j&#8230; only some of the <a href="http://components.neo4j.org/neo4j-shell/2.0-SNAPSHOT/apidocs/org/neo4j/shell/App.html">commands</a> do.</p></div>
<div class="paragraph"><p>So you say you&#8217;d like to start a Neo4j <a href="http://api.neo4j.org/current/org/neo4j/graphdb/GraphDatabaseService.html">graph database</a>, <a href="#shell-enabling-remote">enable the remote shell</a> and add your own apps to it so that your apps and the standard Neo4j apps co-exist side by side? Well, here&#8217;s an example of how an app could look like:</p></div>
<div class="listingblock">
<pre class="programlisting brush: java">import org.neo4j.helpers.Service;
import org.neo4j.shell.kernel.apps.GraphDatabaseApp;

@Service.Implementation( App.class )
public class LsRelTypes extends GraphDatabaseApp
{
    @Override
    protected String exec( AppCommandParser parser, Session session, Output out )
            throws ShellException, RemoteException
    {
        GraphDatabaseService graphDb = getServer().getDb();
        out.println( "Types:" );
        for ( RelationshipType type : graphDb.getRelationshipTypes() )
        {
            out.println( type.name() );
        }
        return null;
    }
}</pre></div>
<div class="paragraph"><p>And you could now use it in the shell by typing <span class="monospaced">lsreltypes</span> (its name is based on the class name) if <span class="monospaced">getName</span> method isn&#8217;t overridden.</p></div>
<div class="paragraph"><p>If you&#8217;d like it to display some nice help information when using the <span class="monospaced">help</span> (or <span class="monospaced">man</span>) app, override the <span class="monospaced">getDescription</span> method for a general description and use <span class="monospaced">addValueType</span> method to add descriptions about (and logic to) the options you can supply when using your app.</p></div>
<div class="paragraph"><p>Know that the apps reside server-side so if you have a running server and starts a remote client to it from another JVM you can&#8217;t add your apps on the client.</p></div>
</div>
<div class="sect2">
<h3 id="shell-sample-session">An example shell session</h3>
<div class="listingblock">
<pre class="programlisting brush: bash"> # where are we?
 neo4j-sh (0)$ pwd
 Current is (0)
 (0)


 # On the current node, set the key "name" to value "Jon"
 neo4j-sh (0)$ set name "Jon"

 # send a cypher query
 neo4j-sh (Jon,0)$ start n=node(0) return n;
 +---------------------+
 | n                   |
 +---------------------+
 | Node[0]{name:"Jon"} |
 +---------------------+
 1 row
 82 ms


 # make an incoming relationship of type LIKES, create the end node with the node properties specified.
 neo4j-sh (Jon,0)$ mkrel -c -d i -t LIKES --np "{'app':'foobar'}"

 # where are we?
 neo4j-sh (Jon,0)$ ls
 *name =[Jon]
 (me)&lt;-[:LIKES]-(1)


 # change to the newly created node
 neo4j-sh (Jon,0)$ cd 1

 # list relationships, including relationshship id
 neo4j-sh (1)$ ls -avr
 (me)-[:LIKES,0]-&gt;(Jon,0)


 # create one more KNOWS relationship and the end node
 neo4j-sh (1)$ mkrel -c -d i -t KNOWS --np "{'name':'Bob'}"

 # print current history stack
 neo4j-sh (1)$ pwd
 Current is (1)
 (Jon,0)--&gt;(1)


 # verbose list relationships
 neo4j-sh (1)$ ls -avr
 (me)-[:LIKES,0]-&gt;(Jon,0)
 (me)&lt;-[:KNOWS,1]-(Bob,2)</pre></div>
</div>
<div class="sect2">
<h3 id="shell-matrix-example">A Matrix example</h3>
<div class="paragraph"><p>This example is creating a graph of the characters in the Matrix via the shell and then executing Cypher queries against it:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Shell-Matrix-Example-graph.svg" alt="Shell-Matrix-Example-graph.svg">
</div>
<div class="title">Figure 131. Shell Matrix Example</div>
</div>
<div class="paragraph"><p>Neo4j is configured for autoindexing, in this case with the following in the Neo4j configuration file:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">node_auto_indexing=true
node_keys_indexable=name,age

relationship_auto_indexing=true
relationship_keys_indexable=ROOT,KNOWS,CODED_BY</pre></div>
<div class="paragraph"><p>The following is a sample shell session creating the Matrix graph and querying it.</p></div>
<div class="listingblock">
<pre class="programlisting brush: bash"> # create the Thomas Andersson node
 neo4j-sh (0)$ mkrel -t ROOT -c -v
 Node (1) created
 Relationship [:ROOT,0] created


 # go to the new node
 neo4j-sh (0)$ cd 1

 # set the name property
 neo4j-sh (1)$ set name "Thomas Andersson"

 # create Thomas direct friends
 neo4j-sh (Thomas Andersson,1)$ mkrel -t KNOWS -cv
 Node (2) created
 Relationship [:KNOWS,1] created


 # go to the new node
 neo4j-sh (Thomas Andersson,1)$ cd 2

 # set the name property
 neo4j-sh (2)$ set name "Trinity"

 # go back in the history stack
 neo4j-sh (Trinity,2)$ cd ..

 # create Thomas direct friends
 neo4j-sh (Thomas Andersson,1)$ mkrel -t KNOWS -cv
 Node (3) created
 Relationship [:KNOWS,2] created


 # go to the new node
 neo4j-sh (Thomas Andersson,1)$ cd 3

 # set the name property
 neo4j-sh (3)$ set name "Morpheus"

 # create relationship to Trinity
 neo4j-sh (Morpheus,3)$ mkrel -t KNOWS 2

 # list the relationships of node 3
 neo4j-sh (Morpheus,3)$ ls -rv
 (me)-[:KNOWS,3]-&gt;(Trinity,2)
 (me)&lt;-[:KNOWS,2]-(Thomas Andersson,1)


 # change the current position to relationship #2
 neo4j-sh (Morpheus,3)$ cd -r 2

 # set the age property on the relationship
 neo4j-sh [:KNOWS,2]$ set -t int age 3

 # back to Morpheus
 neo4j-sh [:KNOWS,2]$ cd ..

 # next relationsip
 neo4j-sh (Morpheus,3)$ cd -r 3

 # set the age property on the relationship
 neo4j-sh [:KNOWS,3]$ set -t int age 90

 # position to the start node of the current relationship
 neo4j-sh [:KNOWS,3]$ cd start

 # new node
 neo4j-sh (Morpheus,3)$ mkrel -t KNOWS -c

 # list relationships on the current node
 neo4j-sh (Morpheus,3)$ ls -r
 (me)-[:KNOWS]-&gt;(Trinity,2)
 (me)-[:KNOWS]-&gt;(4)
 (me)&lt;-[:KNOWS]-(Thomas Andersson,1)


 # go to Cypher
 neo4j-sh (Morpheus,3)$ cd 4

 # set the name
 neo4j-sh (4)$ set name Cypher

 # create new node from Cypher
 neo4j-sh (Cypher,4)$ mkrel -ct KNOWS

 # list relationships
 neo4j-sh (Cypher,4)$ ls -r
 (me)-[:KNOWS]-&gt;(5)
 (me)&lt;-[:KNOWS]-(Morpheus,3)


 # go to the Agent Smith node
 neo4j-sh (Cypher,4)$ cd 5

 # set the name
 neo4j-sh (5)$ set name "Agent Smith"

 # outgoing relationship and new node
 neo4j-sh (Agent Smith,5)$ mkrel -cvt CODED_BY
 Node (6) created
 Relationship [:CODED_BY,6] created


 # go there
 neo4j-sh (Agent Smith,5)$ cd 6

 # set the name
 neo4j-sh (6)$ set name "The Architect"

 # go to the first node in the history stack
 neo4j-sh (The Architect,6)$ cd

 # Morpheus' friends, looking up Morpheus by name in the Neo4j autoindex
 neo4j-sh (0)$ start morpheus = node:node_auto_index(name='Morpheus') match morpheus-[:KNOWS]-zionist return zionist.name;
 +--------------------+
 | zionist.name       |
 +--------------------+
 | "Trinity"          |
 | "Cypher"           |
 | "Thomas Andersson" |
 +--------------------+
 3 rows
 95 ms


 # Morpheus' friends, looking up Morpheus by name in the Neo4j autoindex
 neo4j-sh (0)$ cypher 2.0 start morpheus = node:node_auto_index(name='Morpheus') match morpheus-[:KNOWS]-zionist return zionist.name;
 +--------------------+
 | zionist.name       |
 +--------------------+
 | "Trinity"          |
 | "Cypher"           |
 | "Thomas Andersson" |
 +--------------------+
 3 rows
 54 ms


 # profile the query by displaying more query execution information
 neo4j-sh (0)$ profile start morpheus = node:node_auto_index(name='Morpheus') match morpheus-[:KNOWS]-zionist return zionist.name;
 +--------------------+
 | zionist.name       |
 +--------------------+
 | "Trinity"          |
 | "Cypher"           |
 | "Thomas Andersson" |
 +--------------------+
 3 rows

 ColumnFilter(symKeys=["zionist", "morpheus", "  UNNAMED69", "zionist.name"], returnItemNames=["zionist.name"], _rows=3, _db_hits=0)
 Extract(symKeys=["zionist", "morpheus", "  UNNAMED69"], exprKeys=["zionist.name"], _rows=3, _db_hits=3)
   TraversalMatcher(trail="(morpheus)-[  UNNAMED69:KNOWS WHERE true AND true]-(zionist)", _rows=3, _db_hits=4)</pre></div>
</div>
</div>
</div>
<h1 id="community">Community</h1>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>The Neo4j project has a strong community around it.
Read about how to get help from the community and how to contribute to it.</p></div>
</div></div>
<div class="sect1">
<h2 id="community-support">Community Support</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can learn a lot about Neo4j on different <em>events.</em>
To get information on upcoming Neo4j events, have a look here:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.neo4j.org/">http://www.neo4j.org/</a>
</p>
</li>
<li>
<p>
<a href="http://neo4j.meetup.com/">http://neo4j.meetup.com/</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Get help from the Neo4j open source community; here are some starting points.</p></div>
<div class="ulist"><ul>
<li>
<p>
The neo4j tag at stackoverflow: <a href="http://stackoverflow.com/questions/tagged/neo4j">http://stackoverflow.com/questions/tagged/neo4j</a>
</p>
</li>
<li>
<p>
Neo4j Community Discussions: <a href="https://groups.google.com/forum/#!forum/neo4j">https://groups.google.com/forum/#!forum/neo4j</a>
</p>
</li>
<li>
<p>
Twitter: <a href="https://twitter.com/neo4j">https://twitter.com/neo4j</a>
</p>
</li>
<li>
<p>
IRC channel: <a href="irc://irc.freenode.net/neo4j">irc://irc.freenode.net/neo4j</a> <a href="http://webchat.freenode.net/?randomnick=1&amp;channels=neo4j">web chat</a>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Report a <em>bug</em> or add a <em>feature request</em>:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/neo4j/neo4j/issues">https://github.com/neo4j/neo4j/issues</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Questions regarding the <em>documentation:</em>
The Neo4j Manual is published online with a comment function, please use that to post any questions or comments regarding the documentation.
See <a href="http://docs.neo4j.org/">http://docs.neo4j.org/</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="community-contributing">Contributing to Neo4j</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Neo4j project is an Open Source effort to bring fast complex data storage and processing to life. Every form of help is highly appreciated by the community - and you are not alone, see <a href="#contributors">[contributors]</a>!</p></div>
<div class="paragraph"><p>One crucial aspect of contributing to the Neo4j project is the <a href="#cla">[cla]</a>.</p></div>
<div class="paragraph"><p>In short: make sure to sign the CLA and send in the email, or the Neo4j project won&#8217;t be able to accept your contribution.</p></div>
<div class="paragraph"><p>Note that you can contribute to Neo4j also by contributing documentation or giving feedback on the current documentation.
Basically, at all the places where you can get help, there&#8217;s also room for contributions.</p></div>
<div class="paragraph"><p>If you want to contribute, there are some good areas to start with, especially for getting in contact with the community, <a href="#community-support">[community-support]</a>.</p></div>
<div class="paragraph"><p>To document your efforts, we highly recommend to read <a href="#community-docs">[community-docs]</a>.</p></div>
<div class="sect2">
<h3 id="cla">Contributor License Agreement</h3>
<div class="sect3">
<h4 id="_summary">Summary</h4>
<div class="paragraph"><p>We require all source code that is hosted on the Neo4j infrastructure to be contributed through the <a href="http://dist.neo4j.org/neo4j-cla.pdf">Neo4j Contributor License Agreement</a> (CLA). The purpose of the Neo4j Contributor License Agreement is to protect the integrity of the code base, which in turn protects the community around that code base: the founding entity Neo Technology, the Neo4j developer community and the Neo4j users. This kind of contributor agreement is common amongst free software and open source projects (it is in fact very similar to the widely signed  <a href="http://www.oracle.com/technetwork/community/oca-486395.html">Oracle Contributor Agreement</a>).</p></div>
<div class="paragraph"><p>Please see the below or send a mail to admins [at] neofourjay.org if you have any other questions about the intent of the CLA. If you have a legal question, please ask a lawyer.</p></div>
</div>
<div class="sect3">
<h4 id="_common_questions">Common questions</h4>
<div class="sect4">
<h5 id="_am_i_losing_the_rights_to_my_own_code">Am I losing the rights to my own code?</h5>
<div class="paragraph"><p>No, the <a href="http://dist.neo4j.org/neo4j-cla.pdf">Neo4j CLA</a> only asks you to <em>share</em> your rights, not relinquish them. Unlike some contribution agreements that require you to transfer copyrights to another organization, the CLA does not take away your rights to your contributed intellectual property. When you agree to the CLA, you grant us joint ownership in copyright, and a patent license for your contributions. You retain all rights, title, and interest in your contributions and may use them for any purpose you wish. Other than revoking our rights, you can still do whatever you want with your code.</p></div>
</div>
<div class="sect4">
<h5 id="_what_can_you_do_with_my_contribution">What can you do with my contribution?</h5>
<div class="paragraph"><p>We may exercise all rights that a copyright holder has, as well as the rights you grant in the <a href="http://dist.neo4j.org/neo4j-cla.pdf">Neo4j CLA</a> to use any patents you have in your contributions. As the CLA provides for joint copyright ownership, you may exercise the same rights as we in your contributions.</p></div>
</div>
<div class="sect4">
<h5 id="_what_are_the_community_benefits_of_this">What are the community benefits of this?</h5>
<div class="paragraph"><p>Well, it allows us to sponsor the Neo4j projects and provide an infrastructure for the community, while making sure that we can include this in software that we ship to our customers without any nasty surprises. Without this ability, we as a small company would be hard pressed to release all our code as free software.</p></div>
<div class="paragraph"><p>Moreover, the CLA lets us protect community members (both developers and users) from hostile intellectual property litigation should the need arise. This is in line with how other free software stewards like the <a href="http://www.fsf.org">Free Software Foundation - FSF</a> defend projects (except with the FSF, there&#8217;s no shared copyright but instead you completely sign it over to the FSF). The contributor agreement also includes a "free software covenant," or a promise that a contribution will remain available as free software.</p></div>
<div class="paragraph"><p>At the end of the day, you still retain all rights to your contribution and we can stand confident that we can protect the Neo4j community and the Neo Technology customers.</p></div>
</div>
<div class="sect4">
<h5 id="_can_we_discuss_some_items_in_the_cla">Can we discuss some items in the CLA?</h5>
<div class="paragraph"><p>Absolutely! Please give us feedback! But let&#8217;s keep the legalese off the mailing lists. Please mail your feedback directly to cla (@t) neotechnology dot cöm and we&#8217;ll get back to you.</p></div>
</div>
<div class="sect4">
<h5 id="_i_still_don_8217_t_like_this_cla">I still don&#8217;t like this CLA.</h5>
<div class="paragraph"><p>That&#8217;s fine. You can still host it anywhere else, of course. Please do! We&#8217;re only talking here about the rules for the infrastructure that we provide.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_sign">How to sign</h4>
<div class="paragraph"><p>When you&#8217;ve read through the CLA, please send a mail to cla (@t) neotechnology dot cöm. Include the following information:</p></div>
<div class="ulist"><ul>
<li>
<p>
Your full name.
</p>
</li>
<li>
<p>
Your e-mail address.
</p>
</li>
<li>
<p>
An attached copy of the <a href="http://dist.neo4j.org/neo4j-cla.pdf">Neo4j CLA</a>.
</p>
</li>
<li>
<p>
That you agree to its terms.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Hi. My name is John Doe (john@doe.com).
I agree to the terms in the attached Neo4j Contributor License Agreement.</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="community-contribution-areas">Areas for contribution</h3>
<div class="paragraph"><p>Neo4j is a project with a vast ecosystem and a lot of space for contributions. Where you can and want to pitch in depends of course on your time, skill set and interests. Below are some of the areas that might interest you:</p></div>
<div class="sect3">
<h4 id="_neo4j_distribution">Neo4j Distribution</h4>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/neo4j/neo4j/issues">The Neo4j open issues</a> for some starting points for contribution
</p>
</li>
<li>
<p>
See the <a href="https://github.com/neo4j/">GitHub Neo4j area</a> for a list of projects
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_maintaining_neo4j_documentation">Maintaining Neo4j Documentation</h4>
<div class="paragraph"><p>Some parts of the documentation need extra care from the community to stay up to date.
They typically refer to different kinds of community contributions.
Below is a list of such places, feel free to look into them and check for outdated or missing content!
The easiest way to contribute fixes is to comment at the <a href="http://docs.neo4j.org/chunked/snapshot/">online HTML version</a>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#tutorials-rest">[tutorials-rest]</a>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_drivers_and_bindings_to_neo4j">Drivers and bindings to Neo4j</h4>
<div class="ulist"><ul>
<li>
<p>
REST: see <a href="#tutorials-rest">[tutorials-rest]</a> for a list of active projects
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="community-docs">Writing Neo4j Documentation</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Other than writing documentation, you can help out by providing comments - head over to the <a href="http://docs.neo4j.org/chunked/snapshot/">online HTML version</a> to do that!</td>
</tr></table>
</div>
<div class="paragraph"><p>For how to build the manual see:
<a href="https://github.com/neo4j/neo4j/blob/master/manual/README.asciidoc">readme</a></p></div>
<div class="paragraph"><p>The documents use the asciidoc format, see:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.methods.co.nz/asciidoc/">Aciidoc Reference</a>
</p>
</li>
<li>
<p>
<a href="http://powerman.name/doc/asciidoc">AsciiDoc cheatsheet</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The cheatsheet is really useful!</p></div>
<div class="sect3">
<h4 id="community-docs-overall-flow">Overall Flow</h4>
<div class="paragraph"><p>Each (sub)project has its own documentation, which will produce a <em>docs.jar</em> file.
By default this file is assembled from the contents in <em>src/docs/</em>.
Asciidoc documents have the <span class="monospaced">.asciidoc</span> file extension.</p></div>
<div class="paragraph"><p>The documents can use code snippets which will extract code from the project.
The corresponding code must be deployed to the <em>sources.jar</em> or <em>test-sources.jar</em> file.</p></div>
<div class="paragraph"><p>By setting up a unit test accordingly, documentation can be written directly in the JavaDoc comment.</p></div>
<div class="paragraph"><p>The above files are all consumed by the build of the manual (by adding them as dependencies).
To get content included in the manual, it has to be explicitly included by a document in the manual as well.</p></div>
<div class="paragraph"><p>Note that different ways to add documentation works best for different cases:</p></div>
<div class="ulist"><ul>
<li>
<p>
For detail level documentation, it works well to write the documentation as part of unit tests (in the JavaDoc comment).
  In this case, you typically do not want to link to the source code in the documentation.
</p>
</li>
<li>
<p>
For tutorial level documentation, the result will be best by writing a <span class="monospaced">.asciidoc</span> file containing the text.
  Source snippets and output examples can then be included from there.
  In this case you typically want to link to the source code, and users should be able to run it without any special setup.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_file_structure_in_em_docs_jar_em">File Structure in <em>docs.jar</em></h4>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Directory </th>
<th class="tableblock halign-left valign-top" > Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>dev/</em></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">content aimed at developers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>dev/images/</em></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">images used by the dev docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>ops/</em></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">content aimed at operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>ops/images/</em></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">images used by the ops docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>man/</em></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">manpages</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Additional subdirectories are used as needed to structure the documents,
like <em>dev/tutorial/</em>, <em>ops/tutorial/</em> etc.</p></div>
</div>
<div class="sect3">
<h4 id="_headings_and_document_structure">Headings and document structure</h4>
<div class="paragraph"><p>Each document starts over with headings from level zero (the document title).
Each document should have an id.
In some cases sections in the document need to have id&#8217;s as well, this depends on where they fit in the overall structure.
To be able to link to content, it has to have an id.
Missing id&#8217;s in mandatory places will fail the build.</p></div>
<div class="paragraph"><p>This is how a document should start:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">[[unique-id-verbose-is-ok]]
= The Document Title =</pre></div>
<div class="paragraph"><p>To push the headings down to the right level in the output, the <span class="monospaced">leveloffset</span>
attribute is used when including the document inside of another document.</p></div>
<div class="paragraph"><p>Subsequent headings in a document should use the following syntax:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">== Subheading ==

... content here ...

=== Subsubheading ===

content here ...</pre></div>
<div class="paragraph"><p>Asciidoc comes with one more syntax for headings, but in this project it&#8217;s not used.</p></div>
</div>
<div class="sect3">
<h4 id="_writing">Writing</h4>
<div class="paragraph"><p>Put one sentence on each line.
This makes it easy to move content around, and also easy to spot (too) long sentences.</p></div>
</div>
<div class="sect3">
<h4 id="_gotchas">Gotchas</h4>
<div class="ulist"><ul>
<li>
<p>
A chapter can&#8217;t be empty. (the build will fail on the docbook xml validity check)
</p>
</li>
<li>
<p>
The document title should be "underlined" by the same
  number of <span class="monospaced">=</span> as there are characters in the title.
</p>
</li>
<li>
<p>
Always leave a blank line at the end of documents
  (or the title of the next document might end up in the last
  paragraph of the document)
</p>
</li>
<li>
<p>
As <span class="monospaced">{}</span> are used for Asciidoc attributes, everything inside will be treated as an attribute.
  What you have to do is to escape the opening brace: <span class="monospaced">\{</span>.
  If you don&#8217;t, the braces and the text inside them will be removed without any warning being issued!
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_links">Links</h4>
<div class="paragraph"><p>To link to other parts of the manual the id of the target is used.
This is how such a reference looks:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">&lt;&lt;community-docs-overall-flow&gt;&gt;</pre></div>
<div class="paragraph"><p>Which will render like: <a href="#community-docs-overall-flow">[community-docs-overall-flow]</a></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Just write "see &lt;&lt;target-id&gt;&gt;" and similar, that should suffice in most cases.</td>
</tr></table>
</div>
<div class="paragraph"><p>If you need to link to another document with your own link text, this is what to do:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">&lt;&lt;target-id, link text that fits in the context&gt;&gt;</pre></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Having lots of linked text may work well in a web context but is a pain in print, and we aim for both!</td>
</tr></table>
</div>
<div class="paragraph"><p>External links are added like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">http://neo4j.org/[Link text here]</pre></div>
<div class="paragraph"><p>Which renders like: <a href="http://neo4j.org/">Link text here</a></p></div>
<div class="paragraph"><p>For short links it may be better not to add a link text, just do:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">http://neo4j.org/</pre></div>
<div class="paragraph"><p>Which renders like: <a href="http://neo4j.org/">http://neo4j.org/</a></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">It&#8217;s ok to have a dot right after the URL, it won&#8217;t be part of the link.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_text_formatting">Text Formatting</h4>
<div class="ulist"><ul>
<li>
<p>
_Italics_ is rendered as <em>Italics</em> and used for emphasis.
</p>
</li>
<li>
<p>
*Bold* is rendered as <strong>Bold</strong> and used sparingly, for strong emphasis only.
</p>
</li>
<li>
<p>
+methodName()+ is rendered as <span class="monospaced">methodName()</span> and is used for literals as well
  (note: the content between the <span class="monospaced">+</span> signs <em>will</em> be parsed).
</p>
</li>
<li>
<p>
`command` is rendered as <span class="monospaced">command</span> (typically used for command-line)
  (note: the content between the <span class="monospaced">`</span> signs <em>will not</em> be parsed).
</p>
</li>
<li>
<p>
'my/path/' is rendered as <em>my/path/</em> (used for file names and paths).
</p>
</li>
<li>
<p>
``Double quoted'' (that is two grave accents to the left and two acute accents to the right) renders as &#8220;Double quoted&#8221;.
</p>
</li>
<li>
<p>
`Single quoted' (that is a single grave accent to the left and a single acute accent to the right) renders as &#8216;Single quoted&#8217;.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_admonitions">Admonitions</h4>
<div class="paragraph"><p>These are very useful and should be used where appropriate.
Choose from the following (write all caps and no, we can&#8217;t easily add new ones):</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Note.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Tip.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Important</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Caution</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Warning</td>
</tr></table>
</div>
<div class="paragraph"><p>Here&#8217;s how it&#8217;s done:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">NOTE: Note.</pre></div>
<div class="paragraph"><p>A multiline variation:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">[TIP]
Tiptext.
Line 2.</pre></div>
<div class="paragraph"><p>Which is rendered as:</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Tiptext.
Line 2.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_images">Images</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content"><em>All images in the entire manual share the same namespace.</em>
  You know how to handle that.</td>
</tr></table>
</div>
<div class="sect4">
<h5 id="_images_files">Images Files</h5>
<div class="paragraph"><p>To include an image file, make sure it resides in the <em>images/</em> directory relative to the document you&#8217;re including it from. Then go:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">image::neo4j-logo.png[]</pre></div>
<div class="paragraph"><p>Which is rendered as:</p></div>
<div class="imageblock">
<div class="content">
<img src="images/neo4j-logo.png" alt="neo4j-logo.png">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_graphviz_dot">Static Graphviz/DOT</h5>
<div class="paragraph"><p>We use the Graphviz/DOT language to describe graphs.
For documentation see <a href="http://graphviz.org/">http://graphviz.org/</a>.</p></div>
<div class="paragraph"><p>This is how to include a simple example graph:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"> ["dot", "community-docs-graphdb-rels.svg"]
 ----
 "Start node" -&gt; "End node" [label="relationship"]
 ----</pre></div>
<div class="paragraph"><p>Which is rendered as:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/community-docs-graphdb-rels.svg" alt="community-docs-graphdb-rels.svg">
</div>
</div>
<div class="paragraph"><p>Here&#8217;s an example using some predefined variables available in the build:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"> ["dot", "community-docs-graphdb-rels-overview.svg", "meta"]
 ----
 "A Relationship" [fillcolor="NODEHIGHLIGHT"]
 "Start node" [fillcolor="NODE2HIGHLIGHT"]
 "A Relationship" -&gt; "Start node" [label="has a"]
 "A Relationship" -&gt; "End node" [label="has a"]
 "A Relationship" -&gt; "Relationship type" [label="has a"]
 Name [TEXTNODE]
 "Relationship type" -&gt; Name [label="uniquely identified by" color="EDGEHIGHLIGHT" fontcolor="EDGEHIGHLIGHT"]
 ----</pre></div>
<div class="paragraph"><p>Which is rendered as:</p></div>
<div class="imageblock dot">
<div class="content">
<img src="images/community-docs-graphdb-rels-overview.svg" alt="community-docs-graphdb-rels-overview.svg">
</div>
</div>
<div class="paragraph"><p>The optional second argument given to the dot filter defines the style to use:</p></div>
<div class="ulist"><ul>
<li>
<p>
when not defined: Default styling for nodespace examples.
</p>
</li>
<li>
<p>
<span class="monospaced">neoviz</span>: Nodespace view generated by Neoviz.
</p>
</li>
<li>
<p>
<span class="monospaced">meta</span>: Graphs that don&#8217;t resemble db contents, but rather concepts.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Keywords of the DOT language have to be surrounded by double quotes when used for other purposes.
  The keywords include <em>node, edge, graph, digraph, subgraph,</em> and <em>strict</em>.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_attributes">Attributes</h4>
<div class="paragraph"><p>Common attributes you can use in documents:</p></div>
<div class="ulist"><ul>
<li>
<p>
{neo4j-version} - rendered as "2.0-SNAPSHOT"
</p>
</li>
<li>
<p>
{neo4j-git-tag} - rendered as "master"
</p>
</li>
<li>
<p>
{lucene-version} - rendered as "3_6_2"
</p>
</li>
</ul></div>
<div class="paragraph"><p>These can substitute part of URLs that point to for example APIdocs or source code.
Note that neo4j-git-tag also handles the case of snapshot/master.</p></div>
<div class="paragraph"><p>Sample Asciidoc attributes which can be used:</p></div>
<div class="ulist"><ul>
<li>
<p>
{docdir} - root directory of the documents
</p>
</li>
<li>
<p>
{nbsp} - non-breaking space
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_comments">Comments</h4>
<div class="paragraph"><p>There&#8217;s a separate build including comments.
The comments show up with a yellow background.
This build doesn&#8217;t run by default, but after a normal build, you can use <span class="monospaced">make annotated</span> to build it.
You can also use the resulting page to search for content, as the full manual is on a single page.</p></div>
<div class="paragraph"><p>Here&#8217;s how to write a comment:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">// this is a comment</pre></div>
<div class="paragraph"><p>The comments are not visible in the normal build.
Comment blocks won&#8217;t be included in the output of any build at all.
Here&#8217;s a comment block:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">////
Note that includes in here will still be processed, but not make it into the output.
That is, missing includes here will still break the build!
////</pre></div>
</div>
<div class="sect3">
<h4 id="_code_snippets">Code Snippets</h4>
<div class="sect4">
<h5 id="_explicitly_defined_in_the_document">Explicitly defined in the document</h5>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Use this kind of code snippets as little as possible.
  They are well known to get out of sync with reality after a while.</td>
</tr></table>
</div>
<div class="paragraph"><p>This is how to do it:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"> [source,cypher]
 ----
 start n=(2, 1) where (n.age &lt; 30 and n.name = "Tobias") or not(n.name = "Tobias")  return n
 ----</pre></div>
<div class="paragraph"><p>Which is rendered as:</p></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">start n=(2, 1) where (n.age &lt; 30 and n.name = "Tobias") or not(n.name = "Tobias")  return n</pre></div>
<div class="paragraph"><p>If there&#8217;s no suitable syntax highlighter, just omit the language: <span class="monospaced">[source]</span>.</p></div>
<div class="paragraph"><p>Currently the following syntax highlighters are enabled:</p></div>
<div class="ulist"><ul>
<li>
<p>
Bash
</p>
</li>
<li>
<p>
Cypher
</p>
</li>
<li>
<p>
Groovy
</p>
</li>
<li>
<p>
Java
</p>
</li>
<li>
<p>
JavaScript
</p>
</li>
<li>
<p>
Python
</p>
</li>
<li>
<p>
XML
</p>
</li>
</ul></div>
<div class="paragraph"><p>For other highlighters we could add see <a href="http://alexgorbatchev.com/SyntaxHighlighter/manual/brushes/">http://alexgorbatchev.com/SyntaxHighlighter/manual/brushes/</a>.</p></div>
</div>
<div class="sect4">
<h5 id="_fetched_from_source_code">Fetched from source code</h5>
<div class="paragraph"><p>Code can be automatically fetched from source files.
You need to define:</p></div>
<div class="ulist"><ul>
<li>
<p>
component: the <span class="monospaced">artifactId</span> of the Maven coordinates,
</p>
</li>
<li>
<p>
source: path to the file inside the jar it&#8217;s deployed to,
</p>
</li>
<li>
<p>
classifier: <span class="monospaced">sources</span> or <span class="monospaced">test-sources</span> or any other classifier pointing to the artifact,
</p>
</li>
<li>
<p>
tag: tag name to search the file for,
</p>
</li>
<li>
<p>
the language of the code, if a corresponding syntax highlighter is available.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Note that the artifact has to be included as a Maven dependency of the Manual project so that the files can be found.</p></div>
<div class="paragraph"><p>Be aware of that the tag "abc" will match "abcd" as well.
It&#8217;s a simple on/off switch, meaning that multiple occurrences will be assembled into a single code snippet in the output.
This behavior can be user to hide away assertions from code examples sourced from tests.</p></div>
<div class="paragraph"><p>This is how to define a code snippet inclusion:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"> [snippet,java]
 ----
 component=neo4j-examples
 source=org/neo4j/examples/JmxDocTest.java
 classifier=test-sources
 tag=getStartTime
 ----</pre></div>
<div class="paragraph"><p>This is how it renders:</p></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">private static Date getStartTimeFromManagementBean(
        GraphDatabaseService graphDbService )
{
    GraphDatabaseAPI graphDb = (GraphDatabaseAPI) graphDbService;
    ObjectName objectName = JmxUtils.getObjectName( graphDb, "Kernel" );
    Date date = JmxUtils.getAttribute( objectName, "KernelStartTime" );
    return date;
}</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_query_results">Query Results</h5>
<div class="paragraph"><p>There&#8217;s a special filter for Cypher query results.
This is how to tag a query result:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"> .Result
 [queryresult]
 ----
 +----------------------------------+
 | friend_of_friend.name | count(*) |
 +----------------------------------+
 | Ian                   | 2        |
 | Derrick               | 1        |
 | Jill                  | 1        |
 +----------------------------------+
 3 rows, 12 ms
 ----</pre></div>
<div class="paragraph"><p>This is how it renders:</p></div>
<div class="openblock">
<div class="title">Result</div>
<div class="content"><table class="queryresult" border="1" cellspacing="0" cellpadding="0"><thead><tr><td align="left" valign="top">friend_of_friend.name</td><td align="left" valign="top">count(*)</td></tr></thead><tfoot><tr><th align="left" valign="top" colspan="2">3 rows, 12 ms</th></tr></tfoot><tbody><tr><td align="left" valign="top"><p><code class="literal">Ian</code></p></td><td align="left" valign="top"><p><code class="literal">2</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Derrick</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Jill</code></p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td></tr></tbody></table></div></div>
</div>
</div>
<div class="sect3">
<h4 id="_a_sample_java_based_documentation_test">A sample Java based documentation test</h4>
<div class="paragraph"><p>For Java, there are a couple of premade utilities that keep code and documentation together in
Javadocs and code snippets that generate Asciidoc for the rest of the toolchain.</p></div>
<div class="paragraph"><p>To illustrate this, look at the following documentation that generates the Asciidoc file <span class="monospaced">hello-world-title.asciidoc</span> with a content of:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">[[examples-hello-world-sample-chapter]]
Hello world Sample Chapter
==========================

This is a sample documentation test, demonstrating different ways of
bringing code and other artifacts into Asciidoc form. The title of the
generated document is determined from the method name, replacing "+_+" with
" ".

Below you see a number of different ways to generate text from source,
inserting it into the JavaDoc documentation (really being Asciidoc markup)
via the +@@+ snippet markers and programmatic adding with runtime data
in the Java code.

- The annotated graph as http://www.graphviz.org/[GraphViz]-generated visualization:

.Hello World Graph
["dot", "Hello-World-Graph-hello-world-Sample-Chapter.svg", "neoviz", ""]
----
  N1 [
    label = "{Node\[1\]|name = \'you\'\l}"
  ]
  N2 [
    label = "{Node\[2\]|name = \'I\'\l}"
  ]
  N2 -&gt; N1 [
    color = "#2e3436"
    fontcolor = "#2e3436"
    label = "know\n"
  ]
----

- A sample Cypher query:

[source,cypher]
----
START n = node(2)
RETURN n
----

- A sample text output snippet:

[source]
----
Hello graphy world!
----

- a generated source link to the original GIThub source for this test:

https://github.com/neo4j/neo4j/blob/{neo4j-git-tag}/community/embedded-examples/src/test/java/org/neo4j/examples/DocumentationDocTest.java[DocumentationDocTest.java]

- The full source for this example as a source snippet, highlighted as Java code:

[snippet,java]
----
component=neo4j-examples
source=org/neo4j/examples/DocumentationDocTest.java
classifier=test-sources
tag=sampleDocumentation
----

This is the end of this chapter.</pre></div>
<div class="paragraph"><p>this file is included in this documentation via</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">  :leveloffset: 3
  include::{importdir}/neo4j-examples-docs-jar/dev/examples/hello-world-sample-chapter.asciidoc[]</pre></div>
<div class="paragraph"><p>which renders the following chapter:</p></div>
</div>
<div class="sect3">
<h4 id="examples-hello-world-sample-chapter">Hello world Sample Chapter</h4>
<div class="paragraph"><p>This is a sample documentation test, demonstrating different ways of
bringing code and other artifacts into Asciidoc form. The title of the
generated document is determined from the method name, replacing "<span class="monospaced">_</span>" with
" ".</p></div>
<div class="paragraph"><p>Below you see a number of different ways to generate text from source,
inserting it into the JavaDoc documentation (really being Asciidoc markup)
via the <span class="monospaced">@@</span> snippet markers and programmatic adding with runtime data
in the Java code.</p></div>
<div class="ulist"><ul>
<li>
<p>
The annotated graph as <a href="http://www.graphviz.org/">GraphViz</a>-generated visualization:
</p>
</li>
</ul></div>
<div class="imageblock dot">
<div class="content">
<img src="images/Hello-World-Graph-hello-world-Sample-Chapter.svg" alt="Hello-World-Graph-hello-world-Sample-Chapter.svg">
</div>
<div class="title">Figure 132. Hello World Graph</div>
</div>
<div class="ulist"><ul>
<li>
<p>
A sample Cypher query:
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: cypher">START n = node(2)
RETURN n</pre></div>
<div class="ulist"><ul>
<li>
<p>
A sample text output snippet:
</p>
</li>
</ul></div>
<div class="listingblock">
<pre class="programlisting brush: plain">Hello graphy world!</pre></div>
<div class="ulist"><ul>
<li>
<p>
a generated source link to the original GIThub source for this test:
</p>
</li>
</ul></div>
<div class="paragraph"><p><a href="https://github.com/neo4j/neo4j/blob/master/community/embedded-examples/src/test/java/org/neo4j/examples/DocumentationDocTest.java">DocumentationDocTest.java</a></p></div>
<div class="ulist"><ul>
<li>
<p>
The full source for this example as a source snippet, highlighted as Java code:
</p>
</li>
</ul></div>
<div class="listingblock"><div class="content">
<pre class="programlisting brush: java">// START SNIPPET: _sampleDocumentation
package org.neo4j.examples;

import org.junit.Test;
import org.neo4j.kernel.impl.annotations.Documented;
import org.neo4j.test.GraphDescription.Graph;

import static org.neo4j.visualization.asciidoc.AsciidocHelper.*;

public class DocumentationDocTest extends AbstractJavaDocTestbase
{
    /**
     * This is a sample documentation test, demonstrating different ways of
     * bringing code and other artifacts into Asciidoc form. The title of the
     * generated document is determined from the method name, replacing "+_+" with
     * " ".
     *
     * Below you see a number of different ways to generate text from source,
     * inserting it into the JavaDoc documentation (really being Asciidoc markup)
     * via the +@@+ snippet markers and programmatic adding with runtime data
     * in the Java code.
     *
     * - The annotated graph as http://www.graphviz.org/[GraphViz]-generated visualization:
     *
     * @@graph
     *
     * - A sample Cypher query:
     *
     * @@cypher
     *
     * - A sample text output snippet:
     *
     * @@output
     *
     * - a generated source link to the original GIThub source for this test:
     *
     * @@github
     *
     * - The full source for this example as a source snippet, highlighted as Java code:
     *
     * @@sampleDocumentation
     *
     * This is the end of this chapter.
     */
    @Test
    // signaling this to be a documentation test
    @Documented
    // the graph data setup as simple statements
    @Graph( "I know you" )
    // title is determined from the method name
    public void hello_world_Sample_Chapter()
    {
        // initialize the graph with the annotation data
        data.get();
        gen.get().addTestSourceSnippets( this.getClass(), "sampleDocumentation" );
        gen.get()
                .addGithubTestSourceLink( "github", this.getClass(),
                        "community/embedded-examples" );

        gen.get().addSnippet( "output",
                createOutputSnippet( "Hello graphy world!" ) );

        gen.get().addSnippet(
                "graph",
                createGraphVizWithNodeId( "Hello World Graph", graphdb(),
                        gen.get().getTitle() ) );
        // A cypher snippet referring to the generated graph in the start clause
        gen.get().addSnippet(
                "cypher",
                createCypherSnippet( "start n = node(" + data.get().get( "I" ).getId()
                                     + ") return n" ) );
    }
}
// END SNIPPET: _sampleDocumentation</pre>
</div></div>
<div class="paragraph"><p>This is the end of this chapter.</p></div>
</div>
<div class="sect3">
<h4 id="_integrated_live_console">Integrated Live Console</h4>
<div class="paragraph"><p>An interactive console can be added and will show up in the online HTML version.
An optional title can be added, which will be used for the text of the button.</p></div>
<div class="paragraph"><p>This is how to do it, using Geoff to define the data, with an empty line to separate it from the query:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain"> .Interactive Matrix Example
 [console]
 ----
 (A) {"name" : "Neo"};
 (B) {"name" : "Trinity"};
 (A)-[:LOVES]-&gt;(B)

 start n = node(*)
 return n
 ----</pre></div>
<div class="paragraph"><p>And this is the result:</p></div>
 <p class="cypherconsole"><b>Interactive Matrix Example</b><span class="database">(A) {"name" : "Neo"};
(B) {"name" : "Trinity"};
(A)-[:LOVES]-&gt;(B)
</span><span class="command"><strong>start n = node(*)
 return n</strong></span></p>
</div>
<div class="sect3">
<h4 id="_toolchain">Toolchain</h4>
<div class="paragraph"><p>Useful links when configuring the docbook toolchain:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.docbook.org/tdg/en/html/docbook.html">http://www.docbook.org/tdg/en/html/docbook.html</a>
</p>
</li>
<li>
<p>
<a href="http://www.sagehill.net/docbookxsl/index.html">http://www.sagehill.net/docbookxsl/index.html</a>
</p>
</li>
<li>
<p>
<a href="http://docbook.sourceforge.net/release/xsl/1.76.1/doc/html/index.html">http://docbook.sourceforge.net/release/xsl/1.76.1/doc/html/index.html</a>
</p>
</li>
<li>
<p>
<a href="http://docbook.sourceforge.net/release/xsl/1.76.1/doc/fo/index.html">http://docbook.sourceforge.net/release/xsl/1.76.1/doc/fo/index.html</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="community-translating">Translating the Neo4j Manual</h3>
<div class="paragraph"><p>To translate the Neo4j Manual, there&#8217;s a special project setup to use.
See the French translation project for an example:
<a href="https://github.com/neo4j/manual-french">https://github.com/neo4j/manual-french</a></p></div>
<div class="paragraph"><p>The project contains:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>conf/</em>&#8201;&#8212;&#8201;configuration for the project.
</p>
</li>
<li>
<p>
<em>docs/</em>&#8201;&#8212;&#8201;translated files for content provided by Neo4j modules.
</p>
</li>
<li>
<p>
<em>po/</em>&#8201;&#8212;&#8201;translation files and po4a configuration files.
</p>
</li>
<li>
<p>
<em>src/</em>&#8201;&#8212;&#8201;translated files for content provided by the original manual.
</p>
</li>
<li>
<p>
<em>Makefile</em>&#8201;&#8212;&#8201;a makefile with project-specific configuration.
</p>
</li>
<li>
<p>
<em>pom.xml</em>&#8201;&#8212;&#8201;Maven build configuration.
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_prerequisites">Prerequisites</h4>
<div class="ulist"><ul>
<li>
<p>
Apache Maven
</p>
</li>
<li>
<p>
GNU Make
</p>
</li>
<li>
<p>
Python
</p>
</li>
<li>
<p>
Perl
</p>
</li>
<li>
<p>
Perl module: <span class="monospaced">Unicode::GCString</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To check if you have the <span class="monospaced">Unicode::GCString</span> module installed, you can issue the following command:</p></div>
<div class="listingblock">
<pre class="programlisting brush: bash">perl -MUnicode::GCString -e ''</pre></div>
<div class="paragraph"><p>If there&#8217;s no error, the module has been successfully installed on your system.</p></div>
<div class="paragraph"><p>To install the module, you can use <a href="http://search.cpan.org/dist/App-cpanminus/lib/App/cpanminus.pm">cpanminus</a>.
For a convenient way to install it, see <a href="http://cpanmin.us">http://cpanmin.us</a>.
With cpanminus installed, execute this command:</p></div>
<div class="listingblock">
<pre class="programlisting brush: bash">cpanm Unicode::GCString</pre></div>
<div class="paragraph"><p>You will probably want to use a <em>.po</em> file editor as well, see <a href="#community-translating-tools">[community-translating-tools]</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_build_flow_and_file_layout">Build flow and file layout</h4>
<div class="paragraph"><p>The build is essentially a two-step process.
The first step generates or copies translated documents, while the second step is an ordinary AsciiDoc build using the output from the first step as sources.</p></div>
<div class="paragraph"><p>Other than the <em>src/</em> and <em>docs/</em> diirectories of the project, the build generates files with the same layout in two more places:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<em>target/original/(src|docs)/</em>&#8201;&#8212;&#8201;the contents of the original manual. Note that&#8217;s it easier to look for content here than to dig into the original manual itself.
</p>
</li>
<li>
<p>
<em>target/(src|docs)/</em>&#8201;&#8212;&#8201;the translated source to use for the AsciiDoc build.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The translated documents in <em>target/(src|docs)/</em> are generated in three steps:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
It starts out as a copy of the original manual.
</p>
</li>
<li>
<p>
Next, any static translated files fromt the <em>src/</em> and <em>docs/</em> directories of the project are copied.
</p>
</li>
<li>
<p>
Finally, the translation files in the <em>po/</em> directory are used to generate translated documents.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Files produced by later steps will overwrite existing files from earlier steps.</p></div>
</div>
<div class="sect3">
<h4 id="_adding_a_chapter_to_a_translation_file">Adding a chapter to a translation file</h4>
<div class="paragraph"><p>The translation is split over multiple translation files, one per &#8220;part&#8221; of the manual.
It&#8217;s all about making the translation easier to manage and the tools to perform well.
The basic rule of thumb is that if some content is moved, it should likely still end up in the same translation file.
In that case, the tools will even detect this and the translation will be moved automatically.</p></div>
<div class="paragraph"><p>To add a document to a translation file, do like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: bash">make add DOCUMENT="src/introduction/the-neo4j-graphdb.asciidoc" PART="introduction"</pre></div>
<div class="paragraph"><p>If the translation file does not already exist, it will be created.
The document will be added to the translation build configuration file as well.
(The configuration is in the corresponding <em>.conf</em> file in the <em>po/</em> directory.)</p></div>
<div class="paragraph"><p>If there exists a translated copy of the document at the location the <span class="monospaced">DOCUMENT</span> parameter points to, the script will attempt to populate the translation file with translated paragraphs from that document.
Note that the structure of the document has to be a <em>perfect match</em>, or it will fail.
However, the error messages are helpful, so just fix and try again until it works!
Translation file and configuration are only changed when the first part succeeds.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Only documents that need to be translated should be added.
For example Cypher queries and query results should not be translated.
In general, documents residing in a directory named <em>includes</em> should not be translated.</td>
</tr></table>
</div>
<div class="paragraph"><p>Also note that AsciiDoc <span class="monospaced">include::</span> lines are normally not part of the translation at all, but handled automatically.
In case they need to be handled differently in a document, this has to be configured in the corresponding <em>.conf</em> file.
For example a normal document entry in such a file can look like this:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">[type: asciidoc] target/original/src/operations/index.asciidoc fr:target/src/operations/index.asciidoc</pre></div>
<div class="paragraph"><p>To configure a single document not to handle <span class="monospaced">include::</span> lines automatically, add the following at the end of the line:</p></div>
<div class="listingblock">
<pre class="programlisting brush: plain">opt: "-o definitions=target/tools/main/resources/conf/translate-includes"</pre></div>
</div>
<div class="sect3">
<h4 id="_workflow">Workflow</h4>
<div class="paragraph"><p>First, use Maven to set up the environment and download the original manual and documentation tools:</p></div>
<div class="listingblock">
<pre class="programlisting brush: bash">mvn clean package</pre></div>
<div class="paragraph"><p>To refresh the original manual and the tools, use the maven command again.
For the sake of keeping in sync with the original manual, a daily run of this command is recommended.</p></div>
<div class="paragraph"><p>Once things are set up, use <span class="monospaced">make</span> during work.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">make</span>&#8201;&#8212;&#8201;same as <span class="monospaced">make preview</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">make add</span>&#8201;&#8212;&#8201;add a document to a translation file.
</p>
</li>
<li>
<p>
<span class="monospaced">make preview</span>&#8201;&#8212;&#8201;refresh and build preview of the manual.
</p>
</li>
<li>
<p>
<span class="monospaced">make refresh</span>&#8201;&#8212;&#8201;refresh translation files from the original and generated translated documents.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The preview of the translated manual is found in the <em>target/html/</em> directory.</p></div>
<div class="paragraph"><p>The actual work on translation is done by editing translation files.
Suggested tools for that are found below.</p></div>
</div>
<div class="sect3">
<h4 id="community-translating-tools">Translation tools</h4>
<div class="paragraph"><p>There are different editors for <em>.po</em> files containing the translations
Below is a list of editors.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://projects.gnome.org/gtranslator/">Gtranslator</a>
</p>
</li>
<li>
<p>
<a href="http://userbase.kde.org/Lokalize">Lokalize</a>
</p>
</li>
<li>
<p>
<a href="http://translate.sourceforge.net/wiki/virtaal/index">Virtaal</a>
</p>
</li>
<li>
<p>
<a href="http://www.poedit.net/">Poedit</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="community-contributing-code">Contributing Code to Neo4j</h3>
<div class="sect3">
<h4 id="community-contributing-code-intro">Intro</h4>
<div class="paragraph"><p>The Neo4j community is a free software and open source community centered around software and components for the Neo4j Graph Database.
It is sponsored by <a href="http://neotechnology.com">Neo Technology</a>, which provides infrastructure (different kinds of hosting, documentation, etc) as well as people to manage it.
The Neo4j community is an open community, in so far as it welcomes any member that accepts the basic criterias of contribution and adheres to the community&#8217;s Code of Conduct.</p></div>
<div class="paragraph"><p>Contribution can be in many forms (documentation, discussions, bug reports).
This document outlines the rules of governance for a contributor of code.</p></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-governance-fundamentals">Governance fundamentals</h4>
<div class="paragraph"><p>In a nutshell, you need to be aware of the following fundamentals if you wish to contribute code:</p></div>
<div class="ulist"><ul>
<li>
<p>
All software published by the Neo4j project must have been contributed under the Neo4j Code <a href="#cla">Contributor License Agreement</a>.
</p>
</li>
<li>
<p>
Neo4j is a free software and open source community.
  As a contributor, you are free to place your work under any license that has been approved by either the <a href="http://fsf.org">Free Software Foundation</a> or the <a href="http://opensource.org">Open Source Initiative</a>.
  You still retain copyright, so in addition to that license you can of course release your work under any other license (for example a fully proprietary license), just not on the Neo4j infrastructure.
</p>
</li>
<li>
<p>
The Neo4j software is split into components.
  A Git repository holds either a single or multiple components.
</p>
</li>
<li>
<p>
The source code should follow the Neo4j <a href="#community-contributing-code-code-style">Code Style</a> and &#8220;fit in&#8221; with the Neo4j infrastructure as much as is reasonable for the specific component.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-contributor-roles">Contributor roles</h4>
<div class="paragraph"><p>Every individual that contributes code does so in the context of a role (a single individual can have multiple roles).
The role defines their responsibilities and privileges:</p></div>
<div class="ulist"><ul>
<li>
<p>
A <em>patch submitter</em> is a person who wishes to contribute a patch to an existing component.
  See <a href="#community-contributing-code-workflow">Workflow</a> below.
</p>
</li>
<li>
<p>
A <em>committer</em> can contribute code directly to one or more components.
</p>
</li>
<li>
<p>
A <em>component maintainer</em> is in charge of a specific component.
  They can:
</p>
<div class="ulist"><ul>
<li>
<p>
commit code in their component&#8217;s repository,
</p>
</li>
<li>
<p>
manage tickets for the repository,
</p>
</li>
<li>
<p>
grant push rights to the repository.
</p>
</li>
</ul></div>
</li>
<li>
<p>
A <em>Neo4j admin</em> manages the Neo4j infrastructure.
  They:
</p>
<div class="ulist"><ul>
<li>
<p>
define new components and assign component maintainership,
</p>
</li>
<li>
<p>
drive, mentor and coach Neo4j component development.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-workflow">Contribution workflow</h4>
<div class="paragraph"><p>Code contributions to Neo4j are normally done via Github Pull Requests, following the workflow shown below.
Please check the <a href="#community-contributing-code-pull-requests">pull request checklist</a> before sending off a pull request as well.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fork the appropriate Github repository.
</p>
</li>
<li>
<p>
Create a new branch for your specific feature or fix.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-tests">Write unit tests for your code</a>.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-code-style">Write code</a>.
</p>
</li>
<li>
<p>
Write appropriate Javadocs and <a href="#community-docs">Manual entries</a>.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-commit-messages">Commit changes</a>.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-pull-requests">Send pull request</a>.
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-pull-requests">Pull request checklist</h4>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<a href="#community-contributing-code-intro-the-fast-track">Sign the CLA</a>.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-no-merging">Ensure that you have not added any merge commits</a>.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-single-commit">Squash all your changes into a single commit</a>.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-no-merging">Rebase against the latest master</a>.
</p>
</li>
<li>
<p>
<a href="#community-contributing-code-tests">Run all relevant tests</a>.
</p>
</li>
<li>
<p>
Send the request!
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-tests">Unit Tests</h4>
<div class="paragraph"><p>You have a much higher chance of getting your changes accepted if you supply us with small, readable unit tests covering the code you&#8217;ve written.
Also, make sure your code doesn&#8217;t break any existing tests.
<em>Note that there may be downstream components that need to be tested as well,</em> depending on what you change.</p></div>
<div class="paragraph"><p>To run tests, use Maven rather than your IDE to ensure others can replicate your test run.
The command for running Neo4j tests in any given component is <span class="monospaced">mvn clean validate</span>.</p></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-code-style">Code Style</h4>
<div class="paragraph"><p>The Neo4j Code style is maintained on GitHub in <a href="https://github.com/neo4j/neo4j.github.com/tree/master/code-style">styles for the different IDEs</a>.</p></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-commit-messages">Commit messages</h4>
<div class="paragraph"><p>Please take some care in providing good commit messages.
Use your common sense. In particular:</p></div>
<div class="ulist"><ul>
<li>
<p>
Use <em>english</em>. This includes proper punctuation and correct spelling.
  Commit messages are supposed to convey some information at a glance&#8201;&#8212;&#8201;they&#8217;re not a chat room.
</p>
</li>
<li>
<p>
Remember that a commit is a <em>changeset</em>, which describes a cohesive set of changes across potentially many files.
  Try to group every commit as a logical change.
  Explain what it changes.
  If you have to redo work, you might want to clean up your commit log before doing a pull request.
</p>
</li>
<li>
<p>
If you fix a bug or an issue that&#8217;s related to a ticket, then refer to the ticket in the message.
  For example, <em>`&#8216;Added this and then changed that. This fixes #14.&#8217;'</em>
  Just mentioning #xxx in the commit will connect  it to the GitHub issue with that number, see <a href="https://github.com/blog/831-issues-2-0-the-next-generation">GitHub issues</a>.
  Any of these synonyms will also work:
</p>
<div class="ulist"><ul>
<li>
<p>
fixes #xxx
</p>
</li>
<li>
<p>
fixed #xxx
</p>
</li>
<li>
<p>
fix #xxx
</p>
</li>
<li>
<p>
closes #xxx
</p>
</li>
<li>
<p>
close #xxx
</p>
</li>
<li>
<p>
closed #xxx.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Remember to convey <em>intent</em>.
  Don&#8217;t be too brief but don&#8217;t provide too much detail, either.
  That&#8217;s what <span class="monospaced">git diff</span> is for.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-intro-the-fast-track">Signing the CLA</h4>
<div class="paragraph"><p>One crucial aspect of contributing is the <a href="#cla">Contributor License Agreement</a>.
In short: make sure to sign the CLA, or the Neo4j project won&#8217;t be able to accept your contribution.</p></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-no-merging">Don&#8217;t merge, use rebase instead!</h4>
<div class="paragraph"><p>Because we would like each contribution to be contained in a single commit, merge commits are not allowed inside a pull request.
Merges are messy, and should only be done when necessary, eg. when merging a branch into master to remember where the code came from.</p></div>
<div class="paragraph"><p>If you want to update your development branch to incorporate the latest changes from master, use git rebase.
For details on how to use rebase, see Git manual on rebase: <a href="http://git-scm.com/book/en/Git-Branching-Rebasing">the Git Manual</a>.</p></div>
</div>
<div class="sect3">
<h4 id="community-contributing-code-single-commit">Single commit</h4>
<div class="paragraph"><p>If you have multiple commits, you should squash them into a single one for the pull request, unless there is some extraordinary reason not to.
Keeping your changes in a single commit makes the commit history easier to read, it also makes it easy to revert and move features around.</p></div>
<div class="paragraph"><p>One way to do this is to, while standing on your local branch with your changes, create a new branch and then interactively rebase your commits into a single one.</p></div>
<div class="listingblock">
<div class="title">Interactive rebasing with Git</div>
<pre class="programlisting brush: shell"># On branch mychanges
git checkout -b mychanges-clean

# Assuming you have 4 commits, rebase the last four commits interactively:
git rebase -i HEAD~4

# In the dialog git gives you, keep your first commit, and squash all others into it.
# Then reword the commit description to accurately depict what your commit does.
# If applicable, include any issue numbers like so: #760</pre></div>
<div class="paragraph"><p>For more details, see the git manual: <a href="http://git-scm.com/book/en/Git-Tools-Rewriting-History#Changing-Multiple-Commit-Messages">http://git-scm.com/book/en/Git-Tools-Rewriting-History#Changing-Multiple-Commit-Messages</a></p></div>
<div class="paragraph"><p>If you are asked to modify parts of your code, work in your original branch (the one with multiple commits), and follow the above process to create a fixed single commit.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="contributors">Contributors</h3>
<div class="paragraph"><p>As an Open Source Project, the Neo4j User community extends its warmest thanks to all the contributors who have signed the <a href="#cla">[cla]</a> to date and are contributing to this collective effort.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >name </th>
<th class="tableblock halign-left valign-top" > GIThub ID</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Johan Svensson</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/johan-neo">johan-neo</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Emil Eifrem</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/emileifrem">emileifrem</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Peter Neubauer</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/peterneubauer">peterneubauer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mattias Persson</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/tinwelint">tinwelint</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tobias Lindaaker</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/thobe">thobe</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Anders Nawroth</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/nawroth">nawroth</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Andrés Taylor</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/systay">systay</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Jacob Hansson</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/jakewins">jakewins</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Jim Webber</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/jimwebber">jimwebber</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Josh Adell</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/jadell">jadell</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Andreas Kollegger</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/akollegger">akollegger</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Chris Gioran</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/digitalstain">digitalstain</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Thomas Baum</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/tbaum">tbaum</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Alistair Jones</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/apcj">apcj</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Michael Hunger</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/jexp">jexp</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Jesper Nilsson</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/jespernilsson">jespernilsson</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tom Sulston</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/tomsulston">tomsulston</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">David Montag</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/dmontag">dmontag</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Marlon Richert</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/marlonrichert">marlonrichert</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Hugo Josefson</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/hugojosefson">hugojosefson</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Vivek Prahlad</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/vivekprahlad">vivekprahlad</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Adriano Almeida</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/adrianoalmeida7">adrianoalmeida7</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Benjamin Gehrels</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/BGehrels">BGehrels</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Christopher Schmidt</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/FaKod">FaKod</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Pascal Rehfeldt</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/prehfeldt">prehfeldt</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Björn Söderqvist</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/cybear">cybear</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Abdul Azeez Shaik</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/abdulazeezsk">abdulazeezsk</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">James Thornton</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/espeed">espeed</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Radhakrishna Kalyan</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/nrkkalyan">nrkkalyan</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Michel van den Berg</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/promontis">promontis</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Brandon McCauslin</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/bm3780">bm3780</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Hendy Irawan</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/ceefour">ceefour</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Luanne Misquitta</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/luanne">luanne</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Jim Radford</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/radford">radford</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Axel Morgner</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/amorgner">amorgner</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Taylor Buley</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/editor">editor</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Alex Smirnov</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/alexsmirnov">alexsmirnov</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Johannes Mockenhaupt</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/jotomo">jotomo</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Pablo Pareja Tobes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/pablopareja">pablopareja</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Björn Granvik</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/bjorngranvik">bjorngranvik</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Julian Simpson</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/simpsonjulian">simpsonjulian</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Pablo Pareja Tobes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/pablopareja">pablopareja</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Rickard Öberg</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/rickardoberg">rickardoberg</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Stefan Armbruster</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/sarmbruster">sarmbruster</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Stephan Hagemann</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/shageman">shageman</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Linan Wang</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/wangii">wangii</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Ian Robinson</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/iansrobinson">iansrobinson</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Marko Rodriguez</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/okram">okram</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Saikat Kanjilal</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/skanjila">skanjila</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Craig Taverner</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/craigtaverner">craigtaverner</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">David Winslow</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/dwins">dwins</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Patrick Fitzgerald</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/paddydub">paddydub</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Stefan Berder</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/hrbonz">hrbonz</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Michael Kanner</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/SepiaGroup">SepiaGroup</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Lin Zhemin</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/miaoski">miaoski</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Christophe Willemsen</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/kwattro">kwattro</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Tony Liu</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/kooyeed">kooyeed</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Michael Klishin</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/michaelklishin">michaelklishin</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Wes Freeman</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/wfreeman">wfreeman</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Chris Leishman</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/chrisleishman">chrisleishman</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Brian Levine</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/blevine">blevine</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Ben Day</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/benday280412">benday280412</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Davide Savazzi</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/svzdvd">svzdvd</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Nigel Small</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/nigelsmall">nigelsmall</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Lasse Westh-Nielsen</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/lassewesth">lassewesth</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Wujek Srujek</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/wujek-srujek">wujek-srujek</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Alexander Yastrebov</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/AlexanderYastrebov">AlexanderYastrebov</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mike Bryant</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/mikesname">mikesname</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Klaus Grossmann</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/iKlaus">iKlaus</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Pablo Lalloni</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/plalloni">plalloni</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Stefan Plantikow</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/boggle">boggle</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Trenton Strong</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/trentonstrong">trentonstrong</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Maciej Mazur</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/mamciek">mamciek</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">German Borbolla</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/germanborbolla">germanborbolla</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Laurent Raufaste</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/lra">lra</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Thomas Häfele</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="https://github.com/Perfect-Pixel">Perfect-Pixel</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manpages">Appendix A: Manpages</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Neo4j Unix manual pages are included on the following pages.</p></div>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="neo4j.1.xml"></xi:include>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="neo4j-shell.1.xml"></xi:include>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="neo4j-backup.1.xml"></xi:include>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="neo4j-arbiter.1.xml"></xi:include>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Last updated 2013-04-23 10:44:41 MST
</div>
</div>
</body>
</html>
